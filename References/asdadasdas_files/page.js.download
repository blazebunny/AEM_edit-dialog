/*
 F - v1.0.2 - 2015-03-31
 https://lazd.github.com/F/
 Copyright (c) 2015 Larry Davis <lazdnet@gmail.com>; Licensed BSD */
(function($,ns,channel,window,undefined){ns.Timewarp={COOKIE_NAME:"timewarp",getTime:function(){var timestamp=parseInt($.cookie(this.COOKIE_NAME));return timestamp?new Date(timestamp):null},setTime:function(date){$.cookie(this.COOKIE_NAME,date.getTime(),{path:"/"});ns.ContentFrame.reload()},isActive:function(){return!!this.getTime()},exit:function(){$.cookie(this.COOKIE_NAME,null,{path:"/"});ns.ContentFrame.reload()}}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var CONFIG={name:"Timewarp",title:Granite.I18n.get("Timewarp")};var STATUS={type:"timewarp",title:Granite.I18n.get("Timewarp"),message:Granite.I18n.get("Viewing page as of \x3ci\x3e{0}\x3c/i\x3e"),actions:[{id:"timewarp-set-date",label:Granite.I18n.get("Set date")},{id:"timewarp-exit",label:Granite.I18n.get("Exit Timewarp")}]};var SELECTORS={dialog:".js-editor-TimewarpDialog",datePicker:"coral-datepicker",cancelButton:"coral-dialog-footer button[variant\x3dsecondary]",
confirmButton:"coral-dialog-footer button[variant\x3dprimary]",pageInfoTrigger:"#pageinfo-trigger"};ns.TimewarpLayer=ns.util.extendClass(ns.PreviewLayer,{_dialog:null,constructor:function TimewarpLayer(){ns.TimewarpLayer.super_.constructor.apply(this,[CONFIG]);this.hidden=false;this.dialog=document.querySelector(SELECTORS.dialog);var datePicker=this.dialog.querySelector(SELECTORS.datePicker);var confirmButton=this.dialog.querySelector(SELECTORS.confirmButton);this.dialog.addEventListener("coral-overlay:beforeopen",
function(e){if(e.target==this.dialog){datePicker.valueAsDate=ns.Timewarp.getTime();if(datePicker.valueAsDate)confirmButton.removeAttribute("disabled");else confirmButton.setAttribute("disabled","");datePicker.max=new Date}}.bind(this));datePicker.addEventListener("change",function(){if(datePicker.valueAsDate)confirmButton.removeAttribute("disabled");else confirmButton.setAttribute("disabled","")});confirmButton.addEventListener("click",function(){ns.Timewarp.setTime(datePicker.valueAsDate)}.bind(this))},
setUp:function(){ns.TimewarpLayer.super_.setUp.call(this);document.querySelector(SELECTORS.pageInfoTrigger).setAttribute("hidden","");var $cancelButton=$(SELECTORS.cancelButton,this.dialog);$cancelButton.off("click");var time=ns.Timewarp.getTime();if(!time){this.dialog.show();$cancelButton.on("click",function(){ns.layerManager.loadPersistedLayer()})}else if(ns.ui.statusBarManager.getStatusBar().hasLoaded())this._showStatus();else channel.one("cq-editor-statusbar-loaded",this._showStatus.bind(this))},
tearDown:function(){ns.TimewarpLayer.super_.tearDown.call(this);document.querySelector(SELECTORS.pageInfoTrigger).removeAttribute("hidden")},_showStatus:function(){var date=moment(ns.Timewarp.getTime()).format(Granite.I18n.get("MMMM Do YYYY, h:mm a",null,"timewarp date"));var message=STATUS.message.replace("{0}",date);var bar=ns.ui.statusBarManager.getStatusBar();var id=bar.addStatus(STATUS.type,STATUS.title,message,date,null,null,null,null,STATUS.actions);bar.showStatus(id)}});channel.on("click",
".editor-StatusBar-action[data-status-action-id\x3d'"+STATUS.actions[0].id+"']",function(){document.querySelector(SELECTORS.dialog).show()});channel.on("click",".editor-StatusBar-action[data-status-action-id\x3d'"+STATUS.actions[1].id+"']",function(){ns.Timewarp.exit()})})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var LAYER_NAMESPACE="cq-editor-layer";var TIMEWARP_LAYER="Timewarp";ns.PageLayerManager=ns.util.extendClass(ns.LayerManager,{getCurrentLayerName:function(){if(ns.ContentFrame.currentLocation().indexOf(".scaffolding.")>0)return"Scaffolding";else if(ns.Timewarp.isActive())return TIMEWARP_LAYER;return ns.PageLayerManager.super_.getCurrentLayerName.call(this)},setCurrentLayer:function(layerName){var prevLayer=ns.preferences.cookie.get(LAYER_NAMESPACE);ns.PageLayerManager.super_.setCurrentLayer.call(this,
layerName);if(layerName==="Scaffolding"||layerName===TIMEWARP_LAYER)ns.preferences.cookie.set(LAYER_NAMESPACE,prevLayer)},getDefaultLayer:function(ignoreScaffolding){var layerName;if(ignoreScaffolding!==true&&ns.ContentFrame.currentLocation().indexOf(".scaffolding.")>0)layerName="Scaffolding";else if(!this.getCurrentLayerName()||this.getCurrentLayerName()==="Scaffolding")layerName=this.wcmMode==="preview"?"Preview":"Edit";else layerName=this.getCurrentLayerName();return layerName},beforeLoadLayer:function(name){var activateLayer=
true;var that=this;if(name==="Scaffolding"){var location=ns.ContentFrame.currentLocation();if(ns.ContentFrame.currentLocation().indexOf(".scaffolding.")>0)location.replace(".scaffolding.",".");ns.ContentFrame.load(location.replace(".html",".scaffolding.html"));activateLayer=false}else if(this._currentLayer&&this._currentLayer.name==="Scaffolding"){ns.ContentFrame.load(ns.ContentFrame.currentLocation().replace(".scaffolding.","."));activateLayer=false;ns.ContentFrame.iframe.one("load",function(e){that.activateLayer(name)})}else if(this.getCurrentLayerName()===
TIMEWARP_LAYER&&name!=TIMEWARP_LAYER&&ns.Timewarp.isActive()){activateLayer=false;ns.preferences.cookie.set(LAYER_NAMESPACE,name);ns.Timewarp.exit()}return activateLayer},init:function(){this.updateLayerSelector();var layerName=this.getCurrentLayerName()||this.getDefaultLayer.apply(this,arguments);if(layerName==="Scaffolding"&&ns.ContentFrame.currentLocation().indexOf(".scaffolding.")===-1||layerName===TIMEWARP_LAYER&&!ns.Timewarp.isActive())layerName=ns.preferences.cookie.get(LAYER_NAMESPACE);if(!layerName||
!this._layers[layerName]||!this._layers[layerName].isAvailable())if(this._layers["Edit"]&&this._layers["Edit"].isAvailable())layerName="Edit";else layerName="Preview";this.activateLayer(layerName)},loadLayer:function(name){var activateLayer=this.beforeLoadLayer(name);if(activateLayer)this.activateLayer(name)},loadPersistedLayer:function(){var layer=ns.preferences.cookie.get(LAYER_NAMESPACE);if(layer)this.loadLayer(layer)}})})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window){ns.ui.contentTree={};channel.on("cq-editor-loaded",function(){if(!ns.device.isDesktop()){ns.ui.SidePanel.toggleTab(ns.ui.SidePanel.TAB_CLASSES.CONTENT);return}var container=document.querySelector(".editor-ContentTree .content-panel");if(container){ns.ui.contentTree=new ns.ui.ContentTree({container:container,editables:ns.editables});ns.ui.contentTree.init()}})})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window){var layers=[ns.edit.Layer,ns.responsive.Layer,ns.ScaffoldingLayer,ns.design.Layer,ns.PreviewLayer,ns.TimewarpLayer];if(ns.device.isDesktop())layers.splice(3,0,ns.developer.Layer);ns.init({name:"page",layerManager:ns.PageLayerManager,layers:layers,toolbarActionOrder:["EDIT","CONFIGURE","STYLE","COPY","CUT","DELETE","INSERT","PASTE","GROUP","designimporter-clear","designimporter-download","MSM_CANCEL_INHERITANCE","MSM_REENABLE_INHERITANCE","MSM_ROLLOUT","MSM_PARENT","LIVEFYRE_STUDIO",
"PARENT","LAYOUT"]})})(jQuery,Granite.author,jQuery(document),this);(function($,ns,channel,window,undefined){ns.annotate={};ns.annotate.persistence=Object.create(ns.persistence);ns.annotate.$container=$("#OverlayWrapper");ns.annotate.utils=function(){};ns.annotate.utils.getColorLuminance=function(color){var hex=color.substring(1),r=parseInt(hex.substr(0,2),16),g=parseInt(hex.substr(2,2),16),b=parseInt(hex.substr(4,2),16),l=r*.299+g*.587+b*.144;return l}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){ns.annotate.Theme=function(){var attributes,colors,popover,templates={};attributes={"CLASS_ACTIVE":"is-active","CLASS_DISABLED":"is-disabled","CLASS_TRANSITION_DISABLED":"is-transitionDisabled","CLASS_ANNOTATE":"cq-Annotate","CLASS_MODE_EDIT":"cq-AnnotateMode--edit","CLASS_MODE_ADD":"cq-AnnotateMode--add","CLASS_MARK":"cq-AnnotateMark","CLASS_MARK_DOT":"cq-AnnotateMark--dot","CLASS_MARK_BRIGHT":"cq-AnnotateMark--bright","CLASS_ANNOTATION_ACTION":"cq-annotate-action",
"CLASS_COMMENT":"cq-AnnotateComment","CLASS_LASTMODIFIED":"cq-AnnotateLastmodified","ROWS_COMMENT":5,"CLASS_SKETCH":"cq-AnnotateSketch","CLASS_SKETCH_AREA":"cq-AnnotateSketch-area","CLASS_OVERLAY":"cq-Overlay--annotate","LAYER_ICON":"note"};templates.buttons={"SKETCH":'\x3cbutton is\x3d"coral-button" icon\x3d"annotate" variant\x3d"quiet" class\x3d"'+attributes.CLASS_ANNOTATION_ACTION+'" title\x3d"'+Granite.I18n.get("Add sketch")+'" data-action\x3d"SKETCH"\x3e\x3c/button\x3e',"COLORPICKER":'\x3ccoral-colorinput variant\x3d"swatch" showdefaultcolors\x3d"off" showproperties\x3d"off"\x3e\x3c/coral-colorinput\x3e',
"DELETE":'\x3cbutton is\x3d"coral-button" icon\x3d"delete" variant\x3d"quiet" class\x3d"'+attributes.CLASS_ANNOTATION_ACTION+'" title\x3d"'+Granite.I18n.get("Delete annotation")+'" data-action\x3d"DELETE"\x3e\x3c/button\x3e'};templates.annotation={};templates.annotation.TOOLBAR=['\x3cdiv class\x3d"u-coral-pullLeft"\x3e',templates.buttons.SKETCH,templates.buttons.COLORPICKER,"\x3c/div\x3e",'\x3cdiv class\x3d"u-coral-pullRight"\x3e',templates.buttons.DELETE,"\x3c/div\x3e"].join("");templates.annotation.TEXTAREA=
'\x3ctextarea is\x3d"coral-textarea" class\x3d"'+attributes.CLASS_COMMENT+'" rows\x3d"'+attributes.ROWS_COMMENT+'" placeholder\x3d"'+Granite.I18n.get("Add comment")+'"\x3e\x3c/textarea\x3e';templates.annotation.POPOVER=['\x3ccoral-popover target\x3d"_prev" class\x3d"cq-AnnotateTools"\x3e',"\x3ccoral-popover-header\x3e"+Granite.I18n.get("Annotation")+"\x3c/coral-popover-header\x3e","\x3ccoral-popover-content\x3e",'\x3cdiv class\x3d"u-coral-margin"\x3e','\x3cdiv class\x3d"cq-AnnotateTools-toolbar u-coral-clearFix"\x3e',
templates.annotation.TOOLBAR,"\x3c/div\x3e","\x3cdiv\x3e",templates.annotation.TEXTAREA,"\x3c/div\x3e",'\x3cdiv class\x3d"'+attributes.CLASS_LASTMODIFIED+'"\x3e\x3c/div\x3e',"\x3c/div\x3e","\x3c/coral-popover-content\x3e","\x3c/coral-popover\x3e"].join("");templates.annotation.MARK='\x3cspan class\x3d"'+attributes.CLASS_MARK+" "+attributes.CLASS_MARK_DOT+'"\x3e'+Granite.I18n.get("Edit annotation")+"\x3c/span\x3e";templates.sketch={"SKETCH":'\x3cdiv class\x3d"'+attributes.CLASS_SKETCH+'"\x3e\x3c/div\x3e',
"SKETCH_AREA":'\x3cdiv class\x3d"'+attributes.CLASS_SKETCH_AREA+'"\x3e\x3c/div\x3e'};colors={"yellow":"#f5c841","orange":"#eb782d","pink":"#f0557d","orchid":"#aa5fa5","lime":"#8cc350","blue":"#3287d2"};popover={"POINTFROM":"right","ALIGNFROM":"left"};return{"attributes":attributes,"templates":templates,"colors":colors,"popover":popover,"LAYER_NAME":"Annotate","ANNOTATION_BADGE_DEFAULT_TOGGLE_LAYER":"Edit","MARK_LUMINANCE_THRESHOLD":160,"MARK_TOUCH_LEVITATE_DISTANCE":40,"MAXIMUM_ANNOTATION_ITEMS":1E3}}()})(jQuery,
Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){ns.annotate.ItemsController=function(){var self={};self.baseZIndex=1;self.items=[];self.active=undefined;self.repositionPointer=undefined;self.add=function(item){self.items.push(item)};self.remove=function(item){if(self.active===item)self.active=undefined;var index=self.items.indexOf(item);if(index!==-1)item=self.items.splice(index,1);return item};self.clear=function(){self.items=[];self.active=undefined};self.setActive=function(item){if(item!=self.active){item._lastActivation=
(new Date).getTime();self.setItemsZIndex();if(self.active){self.active.setActive(false);if(self.active.popover)self.active.popover.hide()}self.active=item;item.setActive(true)}};self.setAllEnabled=function(condition){$.each(self.items,function(i,item){if(item)if(condition===true||condition===undefined)item.setEnabled(true);else if(condition===false)item.setEnabled(false)})};self.find=function(path){var result=[];if($.type(path)==="string")$.each(self.items,function(i,item){if(item.options&&item.options.path&&
item.options.path===path)result.push(item)});return result.length>0?result[0]:false};self.orderItems=function(){self.items.sort(function(itemA,itemB){return itemA._lastActivation<itemB._lastActivation||!itemA._lastActivation?-1:1})};self.setItemsZIndex=function(){self.orderItems();$.each(self.items,function(i,item){item.setZIndex(self.baseZIndex+i)})};self.resetActive=function(){self.active=undefined};self.repositionItems=function(){var item,_doReposition;_doReposition=function(){if(self.repositionPointer&&
self.repositionPointer>0){item=self.items[--self.repositionPointer];item.reposition();window.requestAnimationFrame(_doReposition)}else{self.repositionPointer=undefined;ns.annotate.Layer.handleItemsBeyondVisibleArea()}};if(self.repositionPointer===undefined){self.repositionPointer=self.items.length;window.requestAnimationFrame(_doReposition)}};self.getFurthestItemInDirection=function(dir){var curr,oldLimit,pos,limit=undefined,item=undefined,validDir=$.inArray(dir,["top","right","bottom","left"])>-1;
if(self.items.length>0&&validDir)for(var i=0;i<self.items.length;i++){pos=self.items[i].getPosition();oldLimit=limit;if(dir==="top"){curr=pos.top;limit=limit===undefined?curr:curr<limit?curr:limit}else if(dir==="right"){curr=pos.left;limit=limit===undefined?curr:curr>limit?curr:limit}else if(dir==="bottom"){curr=pos.top;limit=limit===undefined?curr:curr>limit?curr:limit}else{curr=pos.left;limit=limit===undefined?curr:curr<limit?curr:limit}if(oldLimit!==limit)item=self.items[i]}return item};return self}()})(jQuery,
Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){ns.annotate.actions=function(){var self={};self.cleanUp=function(){};self.doDelete=function(annotation,param,target){var message="";if(!annotation.sketches)message=Granite.I18n.get("Delete this annotation?");else if(annotation.sketches.length===1)message=Granite.I18n.get("Delete this annotation and its sketch?");else message=Granite.I18n.get("Delete this annotation and its sketches?");ns.ui.helpers.prompt({title:Granite.I18n.get("Delete annotation"),message:message,
type:ns.ui.helpers.PROMPT_TYPES.DEFAULT,actions:[{id:"CANCEL",text:Granite.I18n.get("Cancel","Label for Cancel button")},{id:"DELETE",text:Granite.I18n.get("Delete","Label for Confirm button"),warning:true}],callback:function(actionId){$("body").off("touchstart.annotate-delete click.annotate-delete");if(actionId==="CANCEL"){$(target).blur();annotation.popover.open=true;self.cleanUp()}else{ns.annotate.persistence.deleteAnnotation(annotation);self.cleanUp()}}})};self.doSketch=function(annotation,param,
target){annotation.popover.hide();ns.annotate.ItemsController.setAllEnabled(false);annotation._addSketch()};self.doEnterAnnotateModeAdd=function(){ns.annotate.$container.removeClass(ns.annotate.Theme.attributes.CLASS_MODE_EDIT);ns.annotate.$container.addClass(ns.annotate.Theme.attributes.CLASS_MODE_ADD);ns.annotate.ItemsController.setAllEnabled(false);channel.on("cq-overlay-click.annotate cq-overlay-fast-dblclick.annotate cq-slow-dblclick.annotate",function(event){self.onInspectableClickTap(event)});
if(ns.annotate.menu){ns.annotate.menu.setActions({"ENTER_ANNOTATE_MODE_EDIT":ns.annotate.Menu.actions.ENTER_ANNOTATE_MODE_EDIT});ns.annotate.menu.render()}};self.doEnterAnnotateModeEdit=function(){ns.annotate.$container.removeClass(ns.annotate.Theme.attributes.CLASS_MODE_ADD);ns.annotate.$container.addClass(ns.annotate.Theme.attributes.CLASS_MODE_EDIT);ns.editables.map(function(inspectable){inspectable.overlay.setSelected(false)});ns.annotate.ItemsController.resetActive();ns.annotate.ItemsController.setAllEnabled(true);
channel.off("cq-overlay-click.annotate").off("cq-overlay-fast-dblclick.annotate").off("cq-overlay-slow-dblclick.annotate").off("cq-overlay-outside-click.annotate");if(ns.annotate.menu){ns.annotate.menu.setActions({"ENTER_ANNOTATE_MODE_ADD":ns.annotate.Menu.actions.ENTER_ANNOTATE_MODE_ADD});ns.annotate.menu.render()}};self.onInspectableClickTap=function(event){var config,inspectable=event.inspectable;if(inspectable.overlay.isDisabled()||$.inArray("ANNOTATE",inspectable.config.editConfig.actions)===
-1)return;inspectable.overlay.setSelected();config={"path":inspectable.path+"/cq:annotations/","offsetX":event.originalEvent.pageX-$(inspectable.dom).offset().left-ns.ContentFrame.wrapper.offset().left,"offsetY":event.originalEvent.pageY-$(inspectable.dom).offset().top-ns.ContentFrame.wrapper.offset().top,"posEl":inspectable.dom};ns.annotate.actions.doEnterAnnotateModeEdit();new ns.annotate.Annotation(config,undefined,ns.annotate.$container,config.posEl)};return self}()})(jQuery,Granite.author,jQuery(document),
this);
(function($,ns,channel,window,undefined){var template=ns.annotate.Theme.templates.sketch;ns.annotate.Sketch=function(options,annotation){var self={},o;self.annotation=annotation?annotation:undefined;self._init=function(){var dimensions,sketchData,startPos;self.options=o=$.extend(true,{},ns.annotate.Sketch.defaults,options);self.$sketchArea=$(template.SKETCH_AREA);self.annotation.$wrapper.prepend(self.$sketchArea);if(o.data){sketchData=$.parseJSON(o.data);dimensions=sketchData.dimension;self._resize(dimensions,false);
self.sketch=$(self.$sketchArea).annotation(o.aOptions);self.sketch.open();self.sketch.fromJson(o.data);self.setVisible(true);self._setupUI();self._recolor(o.color);startPos={"x":self.annotation.getPosElOffset().left+o.offsetX,"y":self.annotation.getPosElOffset().top+o.offsetY};self._reposition(startPos);self.sketch.$canvas.off();self._addListeners()}else{self._resize({"w":self.$sketchArea.parent().width(),"h":self.$sketchArea.parent().height()});self._startSketch();channel.not(ns.annotate.Theme.attributes.SKETCH_AREA).on("mousedown.outside-sketch-area",
self._cancelNewSketch)}ns.annotate.ItemsController.add(self)};self._cancelNewSketch=function(){self.$sketchArea.off();self.sketch.$canvas.off();ns.annotate.ItemsController.setAllEnabled(true);self.destroy();channel.off("mousedown.outside-sketch-area")};self._startSketch=function(){if(self.sketch){self.sketch.$el.off("annotateEnd");self.sketch.clear();self.sketch.close()}self.sketch=$(self.$sketchArea).annotation(o.aOptions);self.sketch.open();self.sketch.close();self.sketch.open();if(self.sketch.$canvas)self.sketch.$canvas.css("z-index",
2*ns.annotate.Theme.MAXIMUM_ANNOTATION_ITEMS);self.sketch.start();self.sketch.damCanvas.color=o.color;self.sketch.$el.on("annotateEnd",function(){self._onSketchEnd()});if(self.sketch.$canvas)self.sketch.$canvas.on("click",function(){if(self.sketch)self._startSketch()})};self.reposition=function(){var posElOffset,pos;if(self.annotation){posElOffset=self.annotation.getPosElOffset();pos={"x":Math.round(self.options.offsetX+posElOffset.left),"y":Math.round(self.options.offsetY+posElOffset.top)};self._reposition(pos,
false)}};self._reposition=function(pos){if(self.$sketch){$(self.$sketch).css({top:pos.y,left:pos.x});return true}return false};self._calcOffset=function(pos){var posElOffset,offset;if(self.annotation){posElOffset=self.annotation.getPosElOffset();offset={"x":Math.round((pos.x-posElOffset.left)*10)/10,"y":Math.round((pos.y-posElOffset.top)*10)/10}}return offset};self._setOffset=function(offset,persist){o.offsetX=offset.x;o.offsetY=offset.y;if(persist!==false)ns.annotate.persistence.moveAnnotationSketch(self,
{"x":o.offsetX,"y":o.offsetY})};self._resize=function(dim){var dimensions={"width":dim.w,"height":dim.h};if(self.sketch){self.sketch.dimension=dim;if(self.sketch.$canvas){self.sketch.$canvas.css(dimensions);self.sketch.$canvas.attr(dimensions)}}if(self.$sketchArea)self.$sketchArea.css(dimensions)};self._resketch=function(sketchData){self.setVisible(false);self.sketch.fromJson(JSON.stringify(sketchData));self.setVisible(true)};self._recolor=function(color){var sketchData=$.parseJSON(self.sketch.toJson()),
shape;if(sketchData.shapes&&sketchData.shapes.length>0){shape=sketchData.shapes[0];if(shape.fillStyle!==undefined)sketchData.shapes[0].fillStyle=color;if(shape.strokeStyle!==undefined)sketchData.shapes[0].strokeStyle=color;self._resketch(sketchData)}};self._setupUI=function(){self.$sketchArea.add(self.sketch.$canvas).wrapAll(template.SKETCH);self.$sketch=self.sketch.$canvas.parent()};self._adaptSketchData=function(sketchData){var newSketch={},sbb={},bb={},dbb={},dim={},shape={},bleed,dp0,dp1,ctl,
ctlD,xMax,xMin,yMax,yMin,t,xTemp,yTemp;if(sketchData&&sketchData.shapes&&sketchData.shapes.length>0){shape=sketchData.shapes[0];if(shape.type==="ellipse"){bleed=3;sbb=shape.box;sbb.w=Math.abs(sbb.x1-sbb.x0);sbb.h=Math.abs(sbb.y1-sbb.y0);dim={w:sbb.w+2*bleed,h:sbb.h+2*bleed};bb={x0:bleed,x1:dim.w-bleed,y0:bleed,y1:dim.h-bleed}}else if(shape.type==="arrow"){bleed=20;ctl={x:Math.floor(shape.box.x0+shape.box.ctlx),y:Math.ceil(shape.box.y0+shape.box.ctly)};for(var i=1;i<9;i++){t=i/10;xTemp=(shape.box.x0-
2*ctl.x+shape.box.x1)*t*t+(-2*shape.box.x0+2*ctl.x)*t+shape.box.x0;yTemp=(shape.box.y0-2*ctl.y+shape.box.y1)*t*t+(-2*shape.box.y0+2*ctl.y)*t+shape.box.y0;if(xMax==null){xMax=xTemp;yMax=yTemp;xMin=xTemp;yMin=yTemp}xMax=Math.max(xTemp,xMax);xMin=Math.min(xTemp,xMin);yMax=Math.max(yTemp,yMax);yMin=Math.min(yTemp,yMin)}sbb={x0:Math.min(shape.box.x0,shape.box.x1,xMin),x1:Math.max(shape.box.x0,shape.box.x1,xMax),y0:Math.min(shape.box.y0,shape.box.y1,yMin),y1:Math.max(shape.box.y0,shape.box.y1,yMax)};if(Math.abs(ctl.x-
shape.box.x1)>10)if(ctl.x<shape.box.x1)sbb.x1+=20;else sbb.x0-=20;else{sbb.x1+=10;sbb.x0-=10}if(Math.abs(ctl.y-shape.box.y1)>10)if(ctl.y<shape.box.y1)sbb.y1+=20;else sbb.y0-=20;else{sbb.y1+=10;sbb.y0-=10}sbb.w=Math.abs(sbb.x1-sbb.x0);sbb.h=Math.abs(sbb.y1-sbb.y0);dim={w:sbb.w+2*bleed,h:sbb.h+2*bleed};bb={x0:shape.box.x0-sbb.x0+bleed,x1:shape.box.x1-sbb.x0+bleed,y0:shape.box.y0-sbb.y0+bleed,y1:shape.box.y1-sbb.y0+bleed};ctlD=self._V2DMapping({x:shape.box.ctlx,y:shape.box.ctly},dim);dbb.ctlx=ctlD.x;
dbb.ctly=ctlD.y}dp0=self._V2DMapping({x:bb.x0,y:bb.y0},dim);dp1=self._V2DMapping({x:bb.x1,y:bb.y1},dim);dbb.x0=dp0.x;dbb.x1=dp1.x;dbb.y0=dp0.y;dbb.y1=dp1.y;sketchData.shapes[0].box=bb;sketchData.shapes[0].domainBox=dbb;sketchData.dimension=dim;newSketch={"data":sketchData,"offsetX":sbb.x0-bleed,"offsetY":sbb.y0-bleed};return newSketch}};self._addListeners=function(){self._removeListeners();if(self.$sketch)if(o.draggable){self._dragAction=new Coral.DragAction(self.$sketch[0]);self._dragAction.scroll=
true;self.$sketch[0].addEventListener("coral-dragaction:dragstart",self._onDragStart);self.$sketch[0].addEventListener("coral-dragaction:dragend",self._onDragEnd)}};self._onDragStart=function(){self.setActive(true)};self._onDragEnd=function(){var dropPosition={x:self.$sketch[0].offsetLeft,y:self.$sketch[0].offsetTop};self._setOffset(self._calcOffset(dropPosition),true);ns.annotate.Layer.handleItemsBeyondVisibleArea()};self._removeListeners=function(){$(self.$sketch).off();if(self.$sketch){self.$sketch[0].removeEventListener("coral-dragaction:dragstart",
self._onDragStart);self.$sketch[0].removeEventListener("coral-dragaction:dragend",self._onDragEnd)}};self._onSketchEnd=function(){var sketchData=$.parseJSON(self.sketch.toJson()),newSketch=self._adaptSketchData(sketchData);self.$sketchArea.off();self._resize(newSketch.data.dimension);self._setupUI();self._setOffset(self._calcOffset({"x":newSketch.offsetX,"y":newSketch.offsetY}),false);self.reposition();o.data=newSketch.data;self._resketch(o.data);ns.annotate.persistence.createAnnotationSketch(self);
self.sketch.$canvas.off();self._addListeners();o.data=newSketch.data;channel.off("mousedown.outside-sketch-area")};self.afterCreate=function(data){o.path=$(data).find("#Path").text();ns.annotate.ItemsController.setAllEnabled(true);ns.annotate.ItemsController.setActive(self)};self.unrender=function(){if(self.sketch)self.sketch.close();if(self.$sketch)self.$sketch.remove();if(self.$sketchArea)self.$sketchArea.remove()};self.destroy=function(){self.unrender();channel.off("keyup.delete-sketch-area");
self.$sketch=null;self.$sketchArea=null;self.sketch=null;ns.annotate.ItemsController.remove(self)};self.setVisible=function(condition){if(self.sketch)if(condition===true||condition===undefined)self.sketch.show();else if(condition===false)self.sketch.hide()};self.setEnabled=function(condition){if(condition===true||condition===undefined){self.isDisabled=false;self._addListeners();if(self.$sketch!=undefined)self.$sketch.toggleClass(ns.annotate.Theme.attributes.CLASS_DISABLED,self.isDisabled)}else if(condition===
false){self.isDisabled=true;self._removeListeners();if(self.$sketch!=undefined)self.$sketch.toggleClass(ns.annotate.Theme.attributes.CLASS_DISABLED,self.isDisabled)}return self};self.setActive=function(condition){if(condition===true||condition===undefined){self.isActive=true;self.$sketch.addClass(ns.annotate.Theme.attributes.CLASS_ACTIVE);self.annotation.setOverlaySelected(true);ns.annotate.ItemsController.setActive(self);channel.off("mousedown.outside-active-sketch");channel.on("mousedown.outside-active-sketch",
function(event){if(!self.$sketch[0].contains(event.target)){self.setActive(false);channel.off("mousedown.outside-active-sketch")}});channel.off("keyup.delete-sketch-area");channel.on("keyup.delete-sketch-area",function(e){if(e.keyCode===46&&self.annotation)ns.annotate.actions.doDelete(self.annotation)})}else if(condition===false){self.isActive=false;self.$sketch.removeClass(ns.annotate.Theme.attributes.CLASS_ACTIVE);self.annotation.setOverlaySelected(false);channel.off("keyup.delete-sketch-area")}return self};
self.setZIndex=function(ZIndex){if(self.$sketch)self.$sketch.css("z-index",ZIndex);return self};self.getPosition=function(){return self.$sketch?self.$sketch.position():undefined};self._V2DMapping=function(p,dim){var newP={};if(dim.w&&dim.h){newP.x=p.x/dim.w*1E3;newP.y=p.y/dim.h*1E3}return newP};self._init();return self};ns.annotate.Sketch.defaults={"draggable":"true","aOptions":{"resizeWatch":"true"},"offsetX":0,"offsetY":0,"color":"#3287d2"}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var template=ns.annotate.Theme.templates.annotation;ns.annotate.Annotation=function(options,el,$wrapper,$posEl){var self={};self.el=el&&el.length>0?el:undefined;self.$el=el&&el.length>0?$(el):undefined;self.$wrapper=$wrapper&&$wrapper.length>0?$wrapper:$(channel[0].body);self.$posEl=$posEl.length>0?$posEl:self.$wrapper;self._init=function(){var editables;self.options=$.extend(true,{},ns.annotate.Annotation.defaults,options);if(self.options.path){editables=
ns.editables.find(self.options.path.substr(0,self.options.path.indexOf("/cq:annotation")));self.editable=editables.length>0?editables[0]:undefined}if(!self.options.name){var props=self._buildOffsetProperties();self._createAnnotation(props)}else{self.id=self.options.path.replace(/\//g,"");self._buildAnnotation()}};self._buildAnnotation=function(){self._render();self._initSketches();self._addListeners();self.setEnabled(true);self.setZIndex(1);self.$el.data("annotation",self)};self._initSketches=function(){if(self.options.sketches)$.each(self.options.sketches,
function(id,sketch){if(id=="jcr:primaryType")return true;if(sketch&&sketch.data){sketch.id=id;self._addSketch(sketch)}})};self._render=function(){if(!self.$el)self._buildMark();self._buildPopover();self.reposition()};self._buildMark=function(){var $mark=$(template.MARK),attributes={"data-path":self.options.path};$mark.attr(attributes);self.$wrapper.append($mark);self.$el=$mark;self.el=$mark[0];self._updateMarkText()};self._setModifiedInfo=function(userId,date){var d,datestring="",titlestring="",now,
diff;if(date){d=new Date(date);if(!isNaN(d.getTime())){now=ns.annotate.clientMillisecondOffset?moment().add(ns.annotate.clientMillisecondOffset,"milliseconds"):moment();diff=moment(d).diff(now);if(diff>0)now.add(diff,"milliseconds");moment.locale(Granite.I18n.getLocale());datestring=moment(d).from(now);titlestring=moment(d).format("MMMM Do YYYY, h:mm a")}}var _writeModifiedInfo=function(authorstr,datestr,titlestr){if(self.$lastmodified)if(datestr!==""){self.$lastmodified.text(Granite.I18n.get("{0} by {1}",
[datestr,authorstr],"example: {5 days ago} by {Alison Parker}"));self.$lastmodified.attr("title",titlestr)}};self._getFriendlyUserString(userId).done(function(friendlystring){_writeModifiedInfo(friendlystring,datestring,titlestring)}).fail(function(){_writeModifiedInfo(userId,datestring,titlestring)})};self._updateMarkText=function(){if(self.$comment)self.options.text=self.$comment.val();var isDot=self.options.text&&self.options.text!==""?false:true,text=Granite.I18n.get("Edit annotation"),words;
if(!isDot){words=$.trim(self.options.text).split(" ");text=words.length>1?words[0]+" . . .":words[0]}self.$el.text(text);self.$el.toggleClass(ns.annotate.Theme.attributes.CLASS_MARK_DOT,isDot)};self._buildPopover=function(){self.$popover=$(template.POPOVER);self.$el.after(self.$popover);self.$lastmodified=self.$popover.find("."+ns.annotate.Theme.attributes.CLASS_LASTMODIFIED);self.$comment=self.$popover.find("."+ns.annotate.Theme.attributes.CLASS_COMMENT);self.$comment.val("");self._amendPopoverContent();
self.popover=self.$popover[0];self.$colorpicker=self.$popover.find("coral-colorinput");self.colorpicker=self.$colorpicker[0];Coral.commons.ready(self.colorpicker,function(){for(var color in self.options.colors)if(self.options.colors.hasOwnProperty(color))self.colorpicker.items.add({"value":self.options.colors[color]});self._setUIColor(self._getColorHex(self.options.color));self.colorpicker.on("change",function(event){self._setColor(self._getColorId(self.colorpicker.value))})});self.$popover.on("keyup",
function(e){if(e.keyCode===46&&!(e.target&&e.target.nodeName in{"INPUT":1,"TEXTAREA":1}))ns.annotate.actions.doDelete(self)});Coral.commons.ready(self.popover,function(){self.popover.on("coral-overlay:close",function(){clearInterval(self.lastModifiedInterval);channel.off("cq-overlay-click."+self.id);self._updateMarkText();if(!ns.annotate.ItemsController.active||ns.annotate.ItemsController.active===self)self.setActive(false);self.$comment.blur();self.$popover.find("coral-overlay").each(function(){$(this)[0].open=
false})});self.popover.on("coral-overlay:open",function(){self.setActive(true);self._setModifiedInfo(self.options.lastModifiedBy,self.options.lastModified);self.lastModifiedInterval=setInterval(function(){self._setModifiedInfo(self.options.lastModifiedBy,self.options.lastModified)},ns.annotate.Annotation.MODIFIEDINFO_REFRESH_INTERVAL);channel.on("cq-overlay-click."+self.id,function(){if(self.popover)self.popover.open=false})})})};self._amendPopoverContent=function(){self.$popover.attr("id",self.id);
self.$comment.val(self.options.text);self.$popover.find("."+ns.annotate.Theme.attributes.CLASS_ANNOTATION_ACTION).attr("data-path",self.options.path);self._setModifiedInfo(self.options.lastModifiedBy,self.options.lastModified)};self._addSketch=function(sketch){var sOptions={"path":self.options.path+"/shapes/","color":self._getColorHex(self.options.color)},s;if(sketch){sOptions.path=self.options.path+"/shapes/"+sketch.id;sOptions.data=sketch.data;sOptions.offsetX=sketch.x;sOptions.offsetY=sketch.y}s=
new ns.annotate.Sketch(sOptions,self);self.sketches=self.sketches?self.sketches:[];self.sketches.push(s);return s};self._setColor=function(colorId){var color=self._getColorHex(colorId);if(color){self.options.color=colorId;self._setUIColor(color);self._updateProperty("color",colorId,true)}};self._setUIColor=function(color){self.$el.css("background-color",color);self.$el.toggleClass(ns.annotate.Theme.attributes.CLASS_MARK_BRIGHT,ns.annotate.utils.getColorLuminance(color)>ns.annotate.Theme.MARK_LUMINANCE_THRESHOLD);
self.colorpicker.value=color;if(self.sketches&&self.sketches.length>0)$.each(self.sketches,function(i,sketch){sketch._recolor(color)})};self._getColorHex=function(colorId){return self.options.colors[colorId]};self._getColorId=function(color){for(var colorId in self.options.colors)if(self.options.colors.hasOwnProperty(colorId))if(self.options.colors[colorId]===color)return colorId};self._unrender=function(){self.$el.remove();self.$popover.remove();if(self.sketches)$.each(self.sketches,function(i,sketch){sketch.unrender()})};
self._destroy=function(){self.setActive(false);self.popover.off("coral-overlay:open");self.popover.off("coral-overlay:close");self._unrender();self.$el=null;self.$popover=null;if(self.sketches){$.each(self.sketches,function(i,sketch){sketch.destroy();delete self.sketches[i]});self.sketches=null}ns.annotate.ItemsController.remove(self)};self._fetch=function(){return ns.annotate.persistence.readAnnotation(self)};self._updateProperty=function(property,content,preventSetJcrModified){if(property.length<
2||property.substring(0,2)!="./")property="./"+property;return ns.annotate.persistence.updateAnnotationProperty(self,property,content,preventSetJcrModified)};self._updateProperties=function(properties,preventSetJcrModified){properties=self._prefixProperties(properties);return ns.annotate.persistence.updateAnnotation(self,properties,preventSetJcrModified)};self._readModifiedInfo=function(){var start=new Date;ns.annotate.persistence.readAnnotation(self).done(function(data,textStatus,jqXHR){if(!ns.annotate.clientMillisecondOffset){var serverDate=
jqXHR.getResponseHeader("date");var end=new Date;var clientDateOffset=moment(new Date(serverDate)).diff(end);var ajaxProcessingDuration=moment(start).diff(end);ns.annotate.clientMillisecondOffset=clientDateOffset-ajaxProcessingDuration}var annotationData=$.parseJSON(data);self.options.lastModifiedBy=annotationData["jcr:lastModifiedBy"];self.options.lastModified=annotationData["jcr:lastModified"];self._setModifiedInfo(self.options.lastModifiedBy,self.options.lastModified)})};self._createAnnotation=
function(properties){properties=self._prefixProperties(properties);return ns.annotate.persistence.createAnnotation(self,properties)};self._buildOffsetProperties=function(){return{"x":Math.round(self.options.offsetX),"y":Math.round(self.options.offsetY),"x@TypeHint":"Long","y@TypeHint":"Long"}};self._prefixProperties=function(properties){for(var name in properties)if(properties.hasOwnProperty(name))if(name.length<2||name.substring(0,2)!="./"){var value=properties[name];delete properties[name];properties["./"+
name]=value}return properties};self._setSketchesEnabled=function(condition){if(self.sketches&&self.sketches.length>0)$.each(self.sketches,function(i,sketch){if(condition===true||condition===undefined)sketch.setEnabled(true);else if(condition===false)sketch.setEnabled(false)})};self.setEnabled=function(condition){if(condition===true||condition===undefined){self.isEnabled=true;self.$el.toggleClass(ns.annotate.Theme.attributes.CLASS_DISABLED,!self.isEnabled);self._setSketchesEnabled(true)}else if(condition===
false){self.isEnabled=false;self.popover.hide();self.$el.toggleClass(ns.annotate.Theme.attributes.CLASS_DISABLED,!self.isEnabled);self._setSketchesEnabled(false)}return self};self.setActive=function(condition){if(condition===true||condition===undefined){self.isActive=true;self.$el.toggleClass(ns.annotate.Theme.attributes.CLASS_ACTIVE,!self.isActive);ns.editables.map(function(inspectable){inspectable.overlay.setSelected(false)});self.setOverlaySelected(true);ns.annotate.ItemsController.setActive(self)}else if(condition===
false){self.isActive=false;self.$el.toggleClass(ns.annotate.Theme.attributes.CLASS_ACTIVE,!self.isActive);self.setOverlaySelected(false)}return self};self.setOverlaySelected=function(condition){if(self.editable&&self.editable.overlay!=undefined)if(condition===true||condition===undefined)self.editable.overlay.setSelected(true);else if(condition===false)self.editable.overlay.setSelected(false)};self.setZIndex=function(ZIndex){self.$el.css("z-index",ZIndex+self.options.baseZIndex);return self};self.getPosition=
function(){return self.$el.position()};self.afterDelete=function(){self._destroy()};self.afterCreate=function(data){self.options.path=$(data).find("#Path").text();self.id=self.options.path.replace(/\//g,"");self._buildAnnotation();self._readModifiedInfo();self.setActive(true);ns.annotate.ItemsController.add(self);Coral.commons.nextFrame(function(){if(self.popover)self.popover.open=true})};self.afterUpdate=function(data){self._readModifiedInfo()};self.getPosElOffset=function(){if(self.$posEl)return{"top":self.$posEl.offset().top,
"left":self.$posEl.offset().left};return false};self.reposition=function(){var posElOffset=self.getPosElOffset();var pos={"x":Math.round(posElOffset.left+self.options.offsetX),"y":Math.round(posElOffset.top+self.options.offsetY)};self._reposition(pos,false)};self._reposition=function(pos){$(self.$el).css({top:pos.y,left:pos.x})};self._calcOffset=function(pos){var posElOffset=self.getPosElOffset(),offset={"x":Math.round((pos.x-posElOffset.left)*10)/10,"y":Math.round((pos.y-posElOffset.top)*10)/10};
return offset};self._setOffset=function(offset,persist){self.options.offsetX=offset.x;self.options.offsetY=offset.y;if(persist!==false)ns.annotate.persistence.moveAnnotation(self,{"x":self.options.offsetX,"y":self.options.offsetY},true)};self._addListeners=function(){self.$comment.on("change",function(){var val=$(this).val();self.options.text=val;self._updateProperty("text",$(this).val())});if(self.options.draggable&&!self._dragAction){self._dragAction=new Coral.DragAction(self.el);self._dragAction.scroll=
true;self.el.addEventListener("coral-dragaction:dragstart",function(event){if(self.popover.open)self.popover.open=false;self._dragStartPosition={x:self.el.offsetLeft,y:self.el.offsetTop};self.setActive(true)});self.el.addEventListener("coral-dragaction:dragend",function(event){var dropPosition={x:self.el.offsetLeft,y:self.el.offsetTop};if(self._dragStartPosition.x!==dropPosition.x&&self._dragStartPosition.y!==dropPosition.y){self.popover.interaction="off";self._setOffset(self._calcOffset(dropPosition),
true);self.setActive(false);ns.annotate.Layer.handleItemsBeyondVisibleArea()}else{self.popover.interaction="on";ns.annotate.Layer.handleItemsBeyondVisibleArea()}})}};self._getFriendlyUserString=function(userId){var deferred=$.Deferred();$.ajax({type:"GET",dataType:"html",url:ns.annotate.Annotation.AUTHORIZABLE_SERVLET_QUERY_TEMPLATE.replace("#NAME#",userId)}).done(function(data){var dataJson=$.parseJSON(data),userData,userString="",success=false;if(dataJson.hasOwnProperty("authorizables")&&dataJson.authorizables.length){userData=
dataJson.authorizables[0];if(userData.hasOwnProperty("name")){userString=userData.name;success=true}}if(success)deferred.resolve(userString);else deferred.reject()}).fail(function(){deferred.reject()});return deferred.promise()};self._init();return self};ns.annotate.Annotation.defaults={"color":"blue","offsetX":0,"offsetY":0,"colors":ns.annotate.Theme.colors,"draggable":true,"baseZIndex":ns.annotate.Theme.MAXIMUM_ANNOTATION_ITEMS};ns.annotate.Annotation.AUTHORIZABLE_SERVLET_QUERY_TEMPLATE='/libs/granite/security/search/authorizables.json?query\x3d{"condition":[{"named":"#NAME#"}]}';
ns.annotate.Annotation.MODIFIEDINFO_REFRESH_INTERVAL=46E3})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){ns.annotate.Menu=function(options){var self={},o;self._init=function(){self.options=o=$.extend(true,{},ns.annotate.Menu.defaults,options);self.render();self._addListeners()};self._addListeners=function(){$(document).on("click.menu",".cq-annotate-menu-action",self._handleEvent.bind(this))};self._removeListeners=function(){$(document).off("click.menu",".cq-annotate-menu-action")};self.destroy=function(){self._removeListeners();ns.ui.globalBar.empty();o.dom=null};
self.registerAction=function(name,action){o.actions[name]=action};self.removeAction=function(name){delete o.actions[name]};self.setActions=function(actions){o.actions=actions};self.appendButton=function(name,action){var button=undefined;if(action.handler){button=ns.ui.globalBar.addButton("cq-annotate-menu-action",action.icon,action.text);button.attr("data-action",name)}return button};self.render=function(){ns.ui.globalBar.empty();$.each(o.actions,function(name,action){self.appendButton(name,action)})};
self._handleEvent=function(event){var target=$(event.currentTarget),action=target.data("action"),param=target.data("param"),actionObj=o.actions[action];event.stopPropagation();actionObj.handler.call(target,param)};self._init();return self};ns.annotate.Menu.actions={"ENTER_ANNOTATE_MODE_ADD":{icon:"add",text:Granite.I18n.get("Add annotation"),handler:function(target,param){ns.annotate.actions.doEnterAnnotateModeAdd()}},"ENTER_ANNOTATE_MODE_EDIT":{icon:"closeCircle",text:Granite.I18n.get("Cancel"),
handler:function(target,param){ns.annotate.actions.doEnterAnnotateModeEdit()}}};ns.annotate.Menu.defaults={"actions":{"ENTER_ANNOTATE_MODE_ADD":ns.annotate.Menu.actions.ENTER_ANNOTATE_MODE_ADD}}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var badgeUpdateEvents=["cq-persistence-after-delete","cq-persistence-after-create","cq-persistence-after-copy","wcm-after-create-annotation","wcm-after-delete-annotation"].join(" ");function setBadgeValue(val){ns.ui.globalBar.annotationBadge.setValue(val)}channel.on("cq-page-info-loaded",function(event){var annotatedEditables=ns.pageInfo.annotations,annotationCnt=0,promises=[];if(annotatedEditables&&annotatedEditables.length)$.each(annotatedEditables,function(i,
path){promises.push(ns.annotate.persistence.readAnnotations(path).done(function(data){if(data){var d=$.parseJSON(data);$.each(d,function(name,a){if(name=="jcr:primaryType")return true;if(a)annotationCnt++})}}))});$.when.apply($,promises).then(function(){setBadgeValue(annotationCnt)})});channel.on(badgeUpdateEvents,function(){ns.loadPageInfo()})})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){ns.annotate.Overlay=function(editable,container){ns.annotate.Overlay.super_.constructor.call(this,editable,container)};ns.util.inherits(ns.annotate.Overlay,ns.ui.Overlay);ns.annotate.Overlay.prototype.render=function(editable){var dom=ns.annotate.Overlay.super_.render.apply(this,arguments);$(dom).addClass(ns.annotate.Theme.attributes.CLASS_OVERLAY);return dom}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){ns.annotate.persistence.GetRequest=function(){ns.persistence.Request.call(this,arguments);this.type="GET"};ns.util.inherits(ns.annotate.persistence.GetRequest,ns.persistence.Request);ns.annotate.persistence.GetRequest.prototype.prepareReadAnnotations=function(config){return this.setURL(config.path+"/cq:annotations.infinity.json")};ns.annotate.persistence.GetRequest.prototype.prepareReadAnnotation=function(config){return this.setURL(config.path+".json")}})(jQuery,
Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){ns.annotate.persistence.PostRequest=function(){ns.persistence.Request.call(this,arguments);this.type="POST"};ns.util.inherits(ns.annotate.persistence.PostRequest,ns.persistence.Request);ns.annotate.persistence.PostRequest.prototype.prepareCreateAnnotation=function(config){return this.setURL(config.path).setParam("./jcr:created","").setParam("./jcr:createdBy","").setParam("./jcr:lastModified","").setParam("./jcr:lastModifiedBy","").setParam("_charset_","utf-8").setParams(config.properties)};
ns.annotate.persistence.PostRequest.prototype.prepareUpdateAnnotation=function(config){if(config.preventSetJcrModified!==true)this.setParam("./jcr:lastModified","").setParam("./jcr:lastModifiedBy","");return this.setURL(config.path).setParam("_charset_","utf-8").setParams(config.properties)};ns.annotate.persistence.PostRequest.prototype.prepareDeleteAnnotation=function(config){return this.setURL(config.path).setParam(":operation","delete")};ns.annotate.persistence.PostRequest.prototype.prepareCreateAnnotationSketch=
function(config){return this.setURL(config.path).setParam("./jcr:created","").setParam("./jcr:createdBy","").setParam("./jcr:lastModified","").setParam("./jcr:lastModifiedBy","").setParams(config.properties)};ns.annotate.persistence.PostRequest.prototype.prepareUpdateAnnotationSketch=function(config){return this.setURL(config.path).setParam("./jcr:created","").setParam("./jcr:createdBy","").setParam("./jcr:lastModified","").setParam("./jcr:lastModifiedBy","").setParams(config.properties)}})(jQuery,
Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var self=ns.annotate.persistence;self.createAnnotation=function(annotation,properties){var args=arguments;channel.trigger("wcm-before-create-annotation",args);return sendCreateAnnotation({path:annotation.options.path,properties:properties}).done(function(data){annotation.afterCreate(data);channel.trigger("wcm-after-create-annotation",args)}).fail(function(){ns.ui.helpers.notify({content:Granite.I18n.get("Annotation create operation failed."),type:ns.ui.helpers.NOTIFICATION_TYPES.ERROR})})};
self.readAnnotations=function(path){return sendReadAnnotations({path:path})};self.readAnnotation=function(annotation){return sendReadAnnotation({path:annotation.options.path})};self.updateAnnotation=function(annotation,properties,preventSetJcrModified){var args=arguments;channel.trigger("wcm-before-update-annotation",args);return sendUpdateAnnotation({path:annotation.options.path,properties:properties,preventSetJcrModified:preventSetJcrModified}).done(function(data){annotation.afterUpdate(data);channel.trigger("wcm-after-update-annotation",
args)}).fail(function(){ns.ui.helpers.notify({content:Granite.I18n.get("Annotation update operation failed."),type:ns.ui.helpers.NOTIFICATION_TYPES.ERROR})})};self.updateAnnotationProperty=function(annotation,property,content,preventSetJcrModified){var properties={};properties[property]=content;return ns.annotate.persistence.updateAnnotation(annotation,properties,preventSetJcrModified)};self.moveAnnotation=function(annotation,offset,preventSetJcrModified){var args=arguments;channel.trigger("wcm-before-move-annotation",
args);return sendUpdateAnnotation({path:annotation.options.path,properties:{"./x":Math.round(offset.x),"./y":Math.round(offset.y),"./x@TypeHint":"Long","./y@TypeHint":"Long"},preventSetJcrModified:preventSetJcrModified}).done(function(){channel.trigger("wcm-after-move-annotation",args)}).fail(function(){ns.ui.helpers.notify({content:Granite.I18n.get("Annotation move operation failed."),type:ns.ui.helpers.NOTIFICATION_TYPES.ERROR})})};self.deleteAnnotation=function(annotation){var args=arguments;channel.trigger("wcm-before-delete-annotation",
args);return sendDeleteAnnotation({path:annotation.options.path}).done(function(){annotation.afterDelete();channel.trigger("wcm-after-delete-annotation",args)}).fail(function(){ns.ui.helpers.notify({content:Granite.I18n.get("Annotation delete operation failed."),type:ns.ui.helpers.NOTIFICATION_TYPES.ERROR})})};self.createAnnotationSketch=function(sketch){var args=arguments;channel.trigger("wcm-before-create-annotation-sketch",args);return sendCreateAnnotationSketch({path:sketch.options.path,properties:{"./data":sketch.sketch.toJson(),
"./x":Math.round(sketch.options.offsetX),"./y":Math.round(sketch.options.offsetY),"./x@TypeHint":"Long","./y@TypeHint":"Long"}}).done(function(data){sketch.afterCreate(data);channel.trigger("wcm-after-create-annotation-sketch",args)}).fail(function(){ns.ui.helpers.notify({content:Granite.I18n.get("Annotation create sketch operation failed."),type:ns.ui.helpers.NOTIFICATION_TYPES.ERROR})})};self.moveAnnotationSketch=function(sketch,offset){var args=arguments;channel.trigger("wcm-before-move-annotation-sketch",
args);return sendUpdateAnnotationSketch({path:sketch.options.path,properties:{"./x":Math.round(offset.x),"./y":Math.round(offset.y),"./x@TypeHint":"Long","./y@TypeHint":"Long"}}).done(function(){channel.trigger("wcm-after-move-annotation-sketch",args)}).fail(function(){ns.ui.helpers.notify({content:Granite.I18n.get("Annotation move sketch operation failed."),type:ns.ui.helpers.NOTIFICATION_TYPES.ERROR})})};var sendCreateAnnotation=function(config){return(new ns.annotate.persistence.PostRequest).prepareCreateAnnotation(config).send()};
var sendReadAnnotations=function(config){return(new ns.annotate.persistence.GetRequest).prepareReadAnnotations(config).send()};var sendReadAnnotation=function(config){return(new ns.annotate.persistence.GetRequest).prepareReadAnnotation(config).send()};var sendUpdateAnnotation=function(config){return(new ns.annotate.persistence.PostRequest).prepareUpdateAnnotation(config).send()};var sendDeleteAnnotation=function(config){return(new ns.annotate.persistence.PostRequest).prepareDeleteAnnotation(config).send()};
var sendCreateAnnotationSketch=function(config){return(new ns.annotate.persistence.PostRequest).prepareCreateAnnotationSketch(config).send()};var sendUpdateAnnotationSketch=function(config){return(new ns.annotate.persistence.PostRequest).prepareUpdateAnnotationSketch(config).send()}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var menuPosNeighbour=".pageinfo";ns.annotate.Layer=function(name,icon,overlayConstructor,toolbarConstructor,title){name=name||ns.annotate.Theme.LAYER_NAME;title=title||Granite.I18n.get("Annotate","title of authoring layer");icon=icon||ns.annotate.Theme.attributes.LAYER_ICON;this.hidden=true;ns.annotate.Layer.super_.constructor.call(this,name,icon,title);this.toolbarConstructor=toolbarConstructor||ns.ui.Toolbar;this.overlayConstructor=overlayConstructor||ns.annotate.Overlay};
ns.util.inherits(ns.annotate.Layer,ns.edit.Layer);ns.annotate.Layer.prototype.createAnnotations=function(path,data){var config,self=this;if(data)$.each(data,function(name,a){if(name=="jcr:primaryType")return true;if(a){config={"name":name,"path":path+"/cq:annotations/"+name,"text":a.text,"lastModified":a["jcr:lastModified"],"lastModifiedBy":a["jcr:lastModifiedBy"],"offsetX":a.x,"offsetY":a.y,"color":a.color,"sketches":a.shapes?a.shapes:{},"posEl":ns.editables.find(path)[0].dom};ns.annotate.ItemsController.add(new ns.annotate.Annotation(config,
undefined,ns.annotate.$container,config.posEl))}});ns.annotate.Layer.handleItemsBeyondVisibleArea(true,false)};ns.annotate.Layer.prototype.buildAnnotations=function(){var self=this,promises=[];if(ns.pageInfo.annotations&&ns.pageInfo.annotations.length)$.each(ns.pageInfo.annotations,function(i,path){ns.annotate.persistence.readAnnotations(path).done(function(data){self.createAnnotations(path,$.parseJSON(data))})});$.when.apply($,promises).done(function(){channel.trigger($.Event("cq-annotate-annotations-created"))})};
ns.annotate.Layer.prototype.bindEventListeners=function(){var annotationActions={"DELETE":function(annotation,param,target){ns.annotate.actions.doDelete(annotation)},"SKETCH":function(annotation,param,target){ns.annotate.actions.doSketch(annotation)}};channel.on("cq-overlay-hover.annotate",function(event){event.stopImmediatePropagation();if($.inArray("ANNOTATE",event.inspectable.config.editConfig.actions)!==-1)event.inspectable.overlay.dom.toggleClass("is-hover",event.originalEvent.type==="mouseover")});
$(window).on("resize.annotate",function(){ns.annotate.ItemsController.repositionItems()});channel.on("click","."+ns.annotate.Theme.attributes.CLASS_ANNOTATION_ACTION,function(event){var target=$(event.currentTarget),path=target.data("path"),action=target.data("action"),param=target.data("param"),annotation=ns.annotate.ItemsController.find(path),actionFunction=annotationActions[action];event.stopPropagation();event.preventDefault();try{actionFunction.call(annotation,annotation,param,target)}catch(e){channel.trigger($.Event("error",
{message:"An error has occured during execution of the selected action: "+e.message}))}})};ns.annotate.Layer.prototype.unbindEventListeners=function(){channel.off("cq-overlay-hover.annotate").off("cq-overlay-click.annotate").off("cq-overlay-outside-click.annotate").off("cq-annotate-annotations-created.annotate").off("click","."+ns.annotate.Theme.attributes.CLASS_ANNOTATION_ACTION);$(window).off("resize.annotate");return this};ns.annotate.Layer.handleItemsBeyondVisibleArea=function(scroll,reset){var $containersToAdjust=
ns.ContentFrame.wrapper.add(ns.annotate.$container),leftmostItem=ns.annotate.ItemsController.getFurthestItemInDirection("left"),minLeft;if(leftmostItem!==undefined){minLeft=leftmostItem.getPosition().left;if(minLeft<0&&reset!==true&&$containersToAdjust.css("left")!==-minLeft){$containersToAdjust.css({"left":-minLeft+"px"});if(scroll)ns.annotate.$container.offsetParent().scrollLeft(-minLeft)}else $containersToAdjust.css({"left":"0px"})}};ns.annotate.Layer.prototype.setUp=function(){var self=this;ns.ui.dropController.disable();
ns.annotate.menu=new ns.annotate.Menu;ns.overlayManager.setOverlayRendering(this.overlayConstructor);ns.overlayManager.setup();ns.overlayManager.reposition(true);ns.overlayManager.setVisible(true);ns.ui.globalBar.pageInfoButton.disabled=true;ns.ui.globalBar.currentLayerButton.disabled=true;ns.ui.globalBar.layerSwitcher.disabled=true;ns.ui.globalBar.previewLayerButton.disabled=true;ns.selection.bindEvents();ns.annotate.actions.doEnterAnnotateModeEdit();ns.annotate.$container.addClass(ns.annotate.Theme.attributes.CLASS_ANNOTATE);
ns.ui.SidePanel.showEmptyContent();channel.on("cq-annotate-annotations-created.annotate",function(){self.bindEventListeners()});if(Granite.author.ui.SidePanel.isOpened()){ns.ui.SidePanel.close(true);Coral.commons.transitionEnd(Granite.author.ui.SidePanel.$el[0],function(){self.buildAnnotations()})}else self.buildAnnotations()};ns.annotate.Layer.prototype.tearDown=function(){ns.ui.dropController.enable();$("#LayerWrapperMenu").remove();ns.annotate.menu.destroy();ns.annotate.menu=null;ns.annotate.$container.removeClass(ns.annotate.Theme.attributes.CLASS_ANNOTATE);
ns.overlayManager.teardown();ns.overlayManager.resetOverlayRendering();ns.overlayManager.setVisible(false);ns.ui.globalBar.pageInfoButton.disabled=false;ns.ui.globalBar.currentLayerButton.disabled=false;ns.ui.globalBar.layerSwitcher.disabled=false;ns.ui.globalBar.previewLayerButton.disabled=false;ns.selection.unbindEvents();ns.annotate.$container.find("*").not("#EditableToolbar").remove();ns.annotate.$container.removeClass(ns.annotate.Theme.attributes.CLASS_MODE_EDIT+" "+ns.annotate.Theme.attributes.CLASS_MODE_ADD);
this.unbindEventListeners();ns.annotate.ItemsController.clear();ns.annotate.Layer.handleItemsBeyondVisibleArea(true)};ns.annotate.Layer.prototype.isAvailable=function(){return true};ns.layerManager.registerLayer(new ns.annotate.Layer)})(jQuery,Granite.author,jQuery(document),this);
(function(document,Granite,_g,$){var ui=$(window).adaptTo("foundation-ui");window.MSM=window.MSM||{};window.MSM.MSMCommons=window.MSM.MSMCommons||function(){var self={};var selectedEditablesStore=[];self.Constants={ICON_LOCKED:"link",ICON_UNLOCKED:"linkOff",ICON_ROLLOUT:"unmerge",PROP_LIVE_RELATIONSHIP:"msm:liveRelationship",PROP_PAGE_STATUS_BLUEPRINT:"msm:isSource",PROP_PAGE_STATUS_LIVE_COPY:"msm:isLiveCopy",PROP_BP_TARGETS:"msm:targets",PROP_TARGET_PATH:"msm:targetPath",PROP_SOURCE_PATH:"msm:sourcePath",
PROP_CANCELLED_PROPERTIES:"msm:cancelledProperties",PROP_IS_BLUEPRINT_EXISTING:"msm:isSourceExisting",PROP_IS_MANUALLY_CREATED:"msm:isTargetManuallyCreated",PROP_BP_PATH:"msm:liveCopyBpPath",PROP_LIVE_PATH:"msm:liveCopyPath",PARAM_STATUS:"msm:status",PARAM_IS_CANCELLED:"msm:isCancelled",PARAM_IS_CANCELLED_FOR_CHILDREN:"msm:isCancelledForChildren",PARAM_PROPERTY_NAME:"msm:propertyName",PARAM_COMMAND:"cmd",PARAM_PATH:"path",PARAM_ROLLOUT_TYPE:"type",PARAM_ROLLOUT_PARAGRAPHS:"paras",COMMAND_CANCEL_PROP_INHERITANCE:"cancelPropertyInheritance",
COMMAND_REENABLE_PROP_INHERITANCE:"reenablePropertyInheritance",COMMAND_ROLLOUT:"rollout",ROLLOUT_TYPE_SELECTED:"selected",ROLLOUT_TYPE_PAGE:"page",ROLLOUT_TYPE_DEEP:"deep",OPTION_SYNC:"_syncAfterRevert",ENDPOINT_ROLLOUT_OPTIONS:"/libs/wcm/msm/content/touch-ui/authoring/rolloutoptions.html",ENDPOINT_MSM_CONFIG:".msm-config-endpoint",ENDPOINT_ROLLOUT_URI:"/bin/wcmcommand",NODE_METADATA:"metadata"};self.showConfirmation=function(type,header,message,confirmHandler,cancelHandler){var dialog=(new Coral.Dialog).set({variant:type,
header:{innerHTML:header},content:{innerHTML:message.html()?message.html():message}});var confirmButton=(new Coral.Button).set({label:{innerHTML:Granite.I18n.get("Yes")},variant:"primary"}).on("click",function(){if(confirmHandler)confirmHandler.call(this);dialog.open=false});var cancelButton=(new Coral.Button).set({label:{innerHTML:Granite.I18n.get("No")}}).on("click",function(){if(cancelHandler)cancelHandler.call(this);dialog.open=false});dialog.classList.add("msm-modal");document.body.appendChild(dialog);
dialog.footer.appendChild(cancelButton);dialog.footer.appendChild(confirmButton);dialog.open=true};self.isBlueprintPage=function(namespace){if(namespace&&namespace.page&&namespace.page.info&&namespace.page.info.msm&&namespace.page.info.msm[MSM.MSMCommons.Constants.PROP_PAGE_STATUS_BLUEPRINT]==true)return true;return false};self.isLiveCopyPage=function(namespace){if(namespace&&namespace.page&&namespace.page.info&&namespace.page.info.msm&&namespace.page.info.msm[MSM.MSMCommons.Constants.PROP_PAGE_STATUS_LIVE_COPY]==
true)return true;return false};self.removeDropTargets=function(editable){$.each(editable.dropTargets,function(key,dropTarget){if(dropTarget.dom)dropTarget.dom=null;if(dropTarget.overlay)dropTarget.overlay=null});editable.dropTargets=[]};self.isInheritanceCancelled=function(editable){var msmConfig=editable.config[MSM.MSMCommons.Constants.PROP_LIVE_RELATIONSHIP];var inheritanceCancelled=msmConfig&&msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS]&&msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS][MSM.MSMCommons.Constants.PARAM_IS_CANCELLED]&&
msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS][MSM.MSMCommons.Constants.PARAM_IS_CANCELLED]==true;return!!inheritanceCancelled};self.isManuallyCreated=function(editable){var msmConfig=editable.config[MSM.MSMCommons.Constants.PROP_LIVE_RELATIONSHIP];var manuallyCreated=msmConfig&&msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS]&&msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS][MSM.MSMCommons.Constants.PROP_IS_MANUALLY_CREATED]&&msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS][MSM.MSMCommons.Constants.PROP_IS_MANUALLY_CREATED]==
true;return!!manuallyCreated};self.updateSelection=function(editableArray){selectedEditablesStore=editableArray};self.getSelection=function(){return selectedEditablesStore};self.initMsmLockedProperties=function(data){if(data){var msmPageStatusInfo=undefined;if(data)msmPageStatusInfo=data[MSM.MSMCommons.Constants.PARAM_STATUS];if(!msmPageStatusInfo||msmPageStatusInfo[MSM.MSMCommons.Constants.PROP_IS_MANUALLY_CREATED])return;$.ajax({type:"GET",url:MSM.MSMCommons.getPageContentUrl()+".2.json",traditional:true,
cache:false}).done(function(pagePropertiesData){var cancelledProperties=msmPageStatusInfo[MSM.MSMCommons.Constants.PROP_CANCELLED_PROPERTIES];var isBlueprintExisting=msmPageStatusInfo[MSM.MSMCommons.Constants.PROP_IS_BLUEPRINT_EXISTING];$.each($("[data-cq-msm-lockable]"),function(idx,lockableField){var fieldAPI=$(this).adaptTo("foundation-field");var fieldWrapper=$(lockableField).parents(".coral-Form-fieldwrapper");if(fieldWrapper.length==0)fieldWrapper=$(lockableField).parents(".foundation-field-edit");
var lockableName=$(lockableField).data("cq-msm-lockable");lockableName=lockableName.replace(/^.\//g,"");var childField=fieldWrapper.find(".coral-Form-field");if(childField.length==0)childField=fieldWrapper.children().not(".cq-msm-property-toggle-inheritance");childField.addClass("cq-msm-lockable-field");var icon=MSM.MSMCommons.Constants.ICON_LOCKED;var inheritanceLocked=true;if(MSM.MSMCommons.isCancelled(lockableName,cancelledProperties,pagePropertiesData)){icon=MSM.MSMCommons.Constants.ICON_UNLOCKED;
childField.find("button[is\x3dcoral-button]").each(function(){this.disabled=false});childField.find("a[is\x3dcoral-anchorbutton]").each(function(){this.disabled=false});childField.find("button.coral-Button:not([is\x3dcoral-button])").removeClass("is-disabled");childField.find("a.coral-Button:not([is\x3dcoral-anchorbutton])").removeClass("is-disabled");childField.find("span.coral-Button").removeClass("is-disabled");childField.find(":input").filter("[disabled]").attr("disabled",false);if(fieldAPI&&
fieldAPI.setDisabled)fieldAPI.setDisabled(false);else childField.attr("disabled",false);inheritanceLocked=false}else{childField.find(":input").not("[disabled]").attr("disabled",true);if(fieldAPI&&fieldAPI.setDisabled)fieldAPI.setDisabled(true);else childField.attr("disabled",true);childField.find("button[is\x3dcoral-button]").each(function(){this.disabled=true});childField.find("a[is\x3dcoral-anchorbutton]").each(function(){this.disabled=true});childField.find("button.coral-Button:not([is\x3dcoral-button])").addClass("is-disabled");
childField.find("a.coral-Button:not([is\x3dcoral-anchorbutton])").addClass("is-disabled");childField.find("span.coral-Button").addClass("is-disabled");inheritanceLocked=true}var disableToggle=!inheritanceLocked&&!isBlueprintExisting;var link=fieldWrapper.find(".cq-msm-property-toggle-inheritance");if(link.length===0){var link=$("\x3ca/\x3e",{"class":"cq-msm-property-toggle-inheritance ","data-toggle-property-inheritance":lockableName,"data-inheritance-locked-status":inheritanceLocked,"data-path":data[MSM.MSMCommons.Constants.PROP_TARGET_PATH].slice(0,
-"/jcr:content".length),"data-sourcepath":data[MSM.MSMCommons.Constants.PROP_SOURCE_PATH].slice(0,-"/jcr:content".length),"title":inheritanceLocked?Granite.I18n.get("Cancel inheritance"):Granite.I18n.get("Revert inheritance"),href:"#"}).insertAfter(childField[childField.length-1]);var $icon=$("\x3ccoral-icon/\x3e",{"icon":icon,"size":"S"}).appendTo(link);var fieldInfo=fieldWrapper.find(".coral-Form-fieldinfo");var outerWidth=childField.outerWidth();if(fieldInfo.length>0&&outerWidth>0&&childField.css("width").indexOf("%")<
0)childField.css({"width":outerWidth-icon.outerWidth()})}else{link.data("inheritance-locked-status",inheritanceLocked);var $icon=link.find("coral-icon");if($icon.length>0)$icon[0].icon=icon;if(inheritanceLocked){var fieldValue;if(lockableName[0]=="/"){fieldValue=pagePropertiesData[lockableName.substring(1)]?pagePropertiesData[lockableName.substring(1)]:"";var childFieldPropertyName=childField.attr("name");if(childFieldPropertyName){childFieldPropertyName=childFieldPropertyName.replace(/^.\//g,"").replace(lockableName.substring(1),
"").replace(/^\//,"");if(fieldValue[childFieldPropertyName])childField.val(fieldValue[childFieldPropertyName])}}else{fieldValue=MSM.MSMCommons.getValueByLockableName(pagePropertiesData,lockableName)||"";if(fieldAPI)if(!fieldValue&&fieldAPI.clear)fieldAPI.clear();else if(Array.isArray(fieldValue)&&fieldAPI.setValues)fieldAPI.setValues(fieldValue);else if(fieldValue instanceof Object);else{if(fieldAPI.setValue){if(lockableField.type=="datetime")fieldValue=lockableField.value;fieldAPI.setValue(fieldValue)}}else childField.val(fieldValue)}}}link.attr("disabled",
disableToggle);$icon.attr("disabled",disableToggle)})})}};self.isCancelled=function(lockableName,cancelledProperties,pagePropertiesData){var isCancelled=false;if(lockableName[0]!="/")isCancelled=$.inArray(lockableName,cancelledProperties)>=0;else{lockableName=lockableName.substring(1);var nodeData=pagePropertiesData[lockableName];isCancelled=nodeData&&nodeData["jcr:mixinTypes"]&&$.inArray("cq:LiveSyncCancelled",nodeData["jcr:mixinTypes"])>=0}return isCancelled};self.checkDoSyncPageAfterRevert=function(){var $syncAfterRevertCheck=
$('[name\x3d"'+MSM.MSMCommons.Constants.OPTION_SYNC+'"]');return $syncAfterRevertCheck?$syncAfterRevertCheck.prop("checked"):false};self.getLiveRelationshipStatus=function(){var msmConfigEndpoint=MSM.MSMCommons.getPageContentUrl();if(!msmConfigEndpoint)return;MSM.MSMCommons.requestLiveRelationShipStatus(msmConfigEndpoint).done(function(msmEndpointData){var msmStatusInfo;if(msmEndpointData)msmStatusInfo=msmEndpointData[MSM.MSMCommons.Constants.PARAM_STATUS];if(!msmStatusInfo||msmStatusInfo[MSM.MSMCommons.Constants.PROP_IS_MANUALLY_CREATED])return;
var msmMetadataEndpoint=MSM.MSMCommons.getPageContentUrl()+"/"+MSM.MSMCommons.Constants.NODE_METADATA;MSM.MSMCommons.requestLiveRelationShipStatus(msmMetadataEndpoint).done(function(msmMetadataEndpointData){var cancelledPropsForEndpoint=msmStatusInfo[MSM.MSMCommons.Constants.PROP_CANCELLED_PROPERTIES];if(!cancelledPropsForEndpoint)msmStatusInfo[MSM.MSMCommons.Constants.PROP_CANCELLED_PROPERTIES]=[];var metadataStatusInfo=msmMetadataEndpointData[MSM.MSMCommons.Constants.PARAM_STATUS]||{};var cancelledPropsForMetadata=
metadataStatusInfo[MSM.MSMCommons.Constants.PROP_CANCELLED_PROPERTIES]||[];for(var i=0;i<cancelledPropsForMetadata.length;i++)cancelledPropsForEndpoint.push(MSM.MSMCommons.Constants.NODE_METADATA+"/"+cancelledPropsForMetadata[i]);MSM.MSMCommons.initMsmLockedProperties(msmEndpointData)})})};self.requestLiveRelationShipStatus=function(endpoint){var deferred=$.Deferred();endpoint+=".msm.conf";$.ajax({type:"GET",url:endpoint,data:"advancedStatus\x3dtrue",traditional:true,cache:false}).always(function(data){deferred.resolve(data)});
return deferred.promise()};self.getPageContentUrl=function(){var configEndpoint=$(MSM.MSMCommons.Constants.ENDPOINT_MSM_CONFIG).val();if(document.location.pathname.indexOf("scaffolding.html")!=-1)configEndpoint=document.location.pathname.replace(".scaffolding.html","");if(!configEndpoint)return undefined;if(!configEndpoint.match(/jcr:content$/))configEndpoint=configEndpoint+"/jcr:content";return Granite.HTTP.externalize(configEndpoint)};self.sendPropertyInheritanceToggleXHR=function(inheritanceToggleEndpoint,
params,callback){if(!inheritanceToggleEndpoint||!params)return;$.ajax({type:"POST",url:inheritanceToggleEndpoint,data:params}).done(function(data,textStatus,jqXHR){if(!_g.HTTP.isOkStatus(jqXHR.status))return;MSM.MSMCommons.getLiveRelationshipStatus();if(callback)callback.call(this)})};self.syncPage=function(blueprintPath,livecopyPath,isDeep){if(!blueprintPath||!livecopyPath)return;ui.wait();return $.ajax({url:Granite.HTTP.externalize(MSM.MSMCommons.Constants.ENDPOINT_ROLLOUT_URI),type:"POST",data:{_charset_:"UTF-8",
cmd:MSM.MSMCommons.Constants.COMMAND_ROLLOUT,type:isDeep?MSM.MSMCommons.Constants.ROLLOUT_TYPE_DEEP:MSM.MSMCommons.Constants.ROLLOUT_TYPE_PAGE,reset:"false",path:blueprintPath,"msm:targetPath":livecopyPath?livecopyPath:""}}).done(function(data,textStatus,jqXHR){ui.clearWait();document.location.reload()}).fail(function(xhr){ui.clearWait();ui.alert(Granite.I18n.get("Error"),Granite.I18n.get("An error occurred while"+" synchronizing the Live Copy."),"error")})};self.buildSyncAfterRevertOption=function(optionIsEnabled){var $syncAfterRevertCheck=
$('[name\x3d"'+MSM.MSMCommons.Constants.OPTION_SYNC+'"]');if($syncAfterRevertCheck)$syncAfterRevertCheck.remove();var $optionsSection=$(document.createElement("p"));var checkbox=(new Coral.Checkbox).set({label:{innerHTML:Granite.I18n.get("Synchronize after reverting inheritance")},name:MSM.MSMCommons.Constants.OPTION_SYNC,value:"true",checked:optionIsEnabled});return $(checkbox).appendTo($optionsSection)};self.getValueByLockableName=function(data,propertyPath){var segments=propertyPath.split("/");
for(var value=data,index=0;value&&index<segments.length;index++)value=value[segments[index]];return value};return self}();$(document).off("click.cq-msm-property-toggle-inheritance").on("click.cq-msm-property-toggle-inheritance",".cq-msm-property-toggle-inheritance",function(e){var activator=$(this);e.preventDefault();var disabled=activator.attr("disabled");if(disabled=="disabled"||disabled=="true")return;var togglePropertyName=activator.data("toggle-property-inheritance");var inheritanceLockedStatus=
activator.data("inheritance-locked-status");var msmConfigEndpoint=MSM.MSMCommons.getPageContentUrl();if(!msmConfigEndpoint)return;var isNode=false;if(togglePropertyName[0]=="/"){msmConfigEndpoint+=togglePropertyName;isNode=true}else if(togglePropertyName.indexOf(MSM.MSMCommons.Constants.NODE_METADATA)===0&&togglePropertyName.split("/").length===2){msmConfigEndpoint+="/"+MSM.MSMCommons.Constants.NODE_METADATA;togglePropertyName=togglePropertyName.split("/").pop()}msmConfigEndpoint+=".msm.conf";var params=
{};if(isNode){params[MSM.MSMCommons.Constants.PARAM_STATUS+"/"+MSM.MSMCommons.Constants.PARAM_IS_CANCELLED]=inheritanceLockedStatus;params[MSM.MSMCommons.Constants.PARAM_STATUS+"/"+MSM.MSMCommons.Constants.PARAM_IS_CANCELLED_FOR_CHILDREN]=inheritanceLockedStatus}else{params[MSM.MSMCommons.Constants.PARAM_PROPERTY_NAME]=togglePropertyName;params[MSM.MSMCommons.Constants.PARAM_COMMAND]=inheritanceLockedStatus?MSM.MSMCommons.Constants.COMMAND_CANCEL_PROP_INHERITANCE:MSM.MSMCommons.Constants.COMMAND_REENABLE_PROP_INHERITANCE}var header=
inheritanceLockedStatus?Granite.I18n.get("Cancel inheritance"):Granite.I18n.get("Revert inheritance");var modalMessage=inheritanceLockedStatus?Granite.I18n.get("Do you really want to cancel the inheritance?"):Granite.I18n.get("Do you really want to revert the inheritance?");var $message=$(document.createElement("div"));$(document.createElement("p")).text(modalMessage).appendTo($message);if(!inheritanceLockedStatus)MSM.MSMCommons.buildSyncAfterRevertOption(false).appendTo($message);var confirmationHandler=
function(){$(document).trigger("cq-msm-propertylock-ok",activator);var blueprintPath=activator.data("sourcepath");var livecopyPath=activator.data("path");if(!inheritanceLockedStatus&&MSM.MSMCommons.checkDoSyncPageAfterRevert())if(blueprintPath&&livecopyPath)MSM.MSMCommons.sendPropertyInheritanceToggleXHR(msmConfigEndpoint,params,function(){MSM.MSMCommons.syncPage(blueprintPath,livecopyPath,false)});else MSM.MSMCommons.sendPropertyInheritanceToggleXHR(msmConfigEndpoint,params);else MSM.MSMCommons.sendPropertyInheritanceToggleXHR(msmConfigEndpoint,
params)};var cancellationHandler=function(){$(document).trigger("cq-msm-propertylock-cancel",activator)};MSM.MSMCommons.showConfirmation("warning",header,$message,confirmationHandler,cancellationHandler)})})(document,Granite,_g,Granite.$);(function($,ns,channel,window,undefined){ns.msm=ns.msm||{}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){ns.msm.Overlay=function(editable,container){ns.msm.Overlay.super_.constructor.call(this,editable,container)};ns.util.inherits(ns.msm.Overlay,ns.edit.Overlay);ns.msm.Overlay.prototype.dropTargets=null;ns.msm.Overlay.prototype.render=function(editable,container){var dom=ns.msm.Overlay.super_.render.apply(this,arguments);if(ns.MsmAuthoringHelper.isLiveCopy(editable)){if(editable.config.isContainer&&!editable.hasActionsAvailable()){var children=ns.store.getChildren(editable);
for(var i=0;i<children.length;i++){var actions=children[i].config.editConfig.actions;if(actions&&(actions.indexOf("MOVE")||actions.indexOf("INSERT"))){this.setDisabled(false);break}}}var $dom=$(dom[0]);if(!$dom.hasClass("is-disabled"))if(editable.hasPlaceholder())$dom.addClass("is-bordered");else if(ns.MsmAuthoringHelper.isInheritanceCancelled(editable))$dom.addClass("is-bordered is-msm-inactive");else $dom.addClass("is-bordered is-msm-active")}return dom}})(jQuery,Granite.author,jQuery(document),
this);
(function($,ns){function setUpSidePanel(){ns.ui.SidePanel.close()}ns.msm.CONFIG={name:"MSM",title:Granite.I18n.get("Live Copy Status","title of authoring layer"),iconClass:"link",overlayConstructor:ns.msm.Overlay,sidePanel:{setUp:setUpSidePanel}};ns.msm.Layer=ns.util.extendClass(ns.edit.Layer,{constructor:function MSMLayer(config){this.priority=60;ns.msm.Layer.super_.constructor.apply(this,arguments)},config:ns.msm.CONFIG,isAvailable:function(){return ns.page&&ns.page.info&&ns.page.info.msm&&ns.page.info.msm["msm:isLiveCopy"]===
true}});ns.layerManager.registerLayer(new ns.msm.Layer)})(jQuery,Granite.author);
(function($,ns,channel,window,undefined){ns.MsmAuthoringHelper=ns.MsmAuthoringHelper||function(){var self={};self.RolloutDialogUrl="";self.RolloutDialogMaxItems=-1;self.isInitialized=false;self.toggleInheritance=function(editable,param,target){_showConfirmationModal(editable,target)};self.cancelInheritance=function(editable){_sendInheritanceToggleXHR(editable,null,true)};var _sendInheritanceToggleXHR=function(editable,target,cancelInheritance,callback){var params={};params[MSM.MSMCommons.Constants.PARAM_STATUS+
"/"+MSM.MSMCommons.Constants.PARAM_IS_CANCELLED]=cancelInheritance;params[MSM.MSMCommons.Constants.PARAM_STATUS+"/"+MSM.MSMCommons.Constants.PARAM_IS_CANCELLED_FOR_CHILDREN]=!editable.config.isContainer;$.ajax({type:"POST",url:editable.path+".msm.conf",data:params}).done(function(data,textStatus,jqXHR){if(!_g.HTTP.isOkStatus(jqXHR.status))return;ns.edit.actions.doRefresh(editable).then(function(){ns.overlayManager.recreate(editable)});if(callback)callback.call(this)})};var _initPageInfo=function(callback){if(ns.pageInfo.msm.sourcePath&&
ns.pageInfo.msm.targetPath)return;$.ajax({type:"GET",url:Granite.author.ContentFrame.getContentPath()+".msm.conf"}).done(function(data,textStatus,jqXHR){if(!_g.HTTP.isOkStatus(jqXHR.status))return;ns.pageInfo.msm[MSM.MSMCommons.Constants.PROP_SOURCE_PATH]=data[MSM.MSMCommons.Constants.PROP_SOURCE_PATH];ns.pageInfo.msm[MSM.MSMCommons.Constants.PROP_TARGET_PATH]=data[MSM.MSMCommons.Constants.PROP_TARGET_PATH];if(callback)callback.call(this)})};var _showConfirmationModal=function(editable,target){var cancelInheritance=
!self.isInheritanceCancelled(editable);var modalHeader=cancelInheritance?Granite.I18n.get("Cancel inheritance"):Granite.I18n.get("Revert inheritance");var modalMessage=cancelInheritance?Granite.I18n.get("Do you really want to cancel the inheritance?"):Granite.I18n.get("Do you really want to revert the inheritance?");var $message=$(document.createElement("div"));$(document.createElement("p")).text(modalMessage).appendTo($message);if(!cancelInheritance)MSM.MSMCommons.buildSyncAfterRevertOption(false).appendTo($message);
var modalConfirmationHandler=function(){if(!cancelInheritance&&MSM.MSMCommons.checkDoSyncPageAfterRevert()){var blueprintPath=ns.MsmAuthoringHelper.getBlueprintPath(editable);var livecopyPath=ns.MsmAuthoringHelper.getLiveCopyPath(editable);if(blueprintPath&&livecopyPath)_sendInheritanceToggleXHR(editable,target,cancelInheritance,function(){MSM.MSMCommons.syncPage(blueprintPath,livecopyPath,false)});else ns.ui.alert(Granite.I18n.get("Error"),Granite.I18n.get("An error occurred while"+" synchronizing the Live Copy."),
"error")}else _sendInheritanceToggleXHR(editable,target,cancelInheritance)};var promptConfig={title:modalHeader,message:$message.html(),type:ns.ui.helpers.PROMPT_TYPES["NOTICE"],actions:[{id:"OK",text:Granite.I18n.get("Yes"),primary:true},{id:"CANCEL",text:Granite.I18n.get("No"),primary:false}],callback:function(actionId){if("OK"===actionId)modalConfirmationHandler()}};ns.ui.helpers.prompt(promptConfig)};self.openRolloutDialog=function(dialogSource){var dialog=new ns.ui.Dialog({getConfig:function(){return{src:dialogSource,
loadingMode:"auto",isFloating:false}},onReady:function(){MSM.Rollout.initDialog();$(".msm-rollout-dialog").off("dialog-beforeclose").on("dialog-beforeclose",function(){$(".msm-rollout-dialog").hide()})}});ns.DialogFrame.openDialog(dialog)};self.isInheritanceCancelled=function(editable){var msmConfig=editable.config[MSM.MSMCommons.Constants.PROP_LIVE_RELATIONSHIP];return msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS]&&msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS][MSM.MSMCommons.Constants.PARAM_IS_CANCELLED]};
self.isLiveCopy=function(editable){var msmConfig=editable.config[MSM.MSMCommons.Constants.PROP_LIVE_RELATIONSHIP];var isManuallyCreated=msmConfig&&msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS]&&msmConfig[MSM.MSMCommons.Constants.PARAM_STATUS][MSM.MSMCommons.Constants.PROP_IS_MANUALLY_CREATED]==true;var isNewComponent=editable.dom.hasClass("new");return msmConfig&&!isManuallyCreated&&!isNewComponent};self.getBlueprintPath=function(editable){return ns.pageInfo.msm[MSM.MSMCommons.Constants.PROP_SOURCE_PATH]};
self.getLiveCopyPath=function(editable){return ns.pageInfo.msm[MSM.MSMCommons.Constants.PROP_TARGET_PATH]};var _renderInheritanceToggleCondition=function(editable,actionName){if(self.isLiveCopy(editable)&&ns.pageInfoHelper.canModify()){var addMSMAction=self.isInheritanceCancelled(editable)?"MSM_REENABLE_INHERITANCE":"MSM_CANCEL_INHERITANCE";var defaultBeforeDeleteFunc=editable.config.editConfig.listeners["beforedelete"];editable.config.editConfig.listeners["beforedelete"]=function(){ns.persistence.deleteParagraph(editable).done(function(){editable.refresh(false).then(function(){ns.overlayManager.recreate(editable);
if(ns.layerManager.getCurrentLayer()==="msm")$(editable.overlay.dom[0]).addClass("is-bordered")})});editable.config.editConfig.listeners["beforedelete"]=defaultBeforeDeleteFunc;return false};return addMSMAction==actionName}return false};var _initializeBlueprintEditableToolbar=function(editable){$(".rollout-popover").remove();_updateRolloutOptions(editable);var selection=[];if(ns.selection.isGroupSelection)selection=ns.selection.selected;else selection=[editable];MSM.MSMCommons.updateSelection(selection)};
var _updateRolloutOptions=function(editable){var $popoverContent=$(".hidden-rollout-options").clone();$popoverContent.removeClass("hidden-rollout-options");$popoverContent.addClass("rollout-popover");$popoverContent.hide();$popoverContent.insertAfter(editable.overlay.dom)};var _decorateToolbarAction=function(actionConfig,newCondition){if(!actionConfig)return;var existingCondition=actionConfig.condition;actionConfig.condition=function(editable){var conditionResult=true;if(existingCondition)conditionResult=
existingCondition.call(this,editable);return conditionResult&&newCondition.call(this,editable)};if(!existingCondition)existingCondition=function(){return true};actionConfig.decoratedCondition=existingCondition};var _decorateLiveCopyActions=function(){if(!MSM.MSMCommons.isLiveCopyPage(ns))return;var allowActionsAlways=["COPY","MOVE","CUT","INSERT","PASTE","GROUP","MSM_CANCEL_INHERITANCE","MSM_REENABLE_INHERITANCE","MSM_ROLLOUT","MSM_PARENT"];$.each(ns.EditorFrame.editableToolbar.config.actions,function(actionName,
actionConfig){if($.inArray(actionName,allowActionsAlways)<0)_decorateToolbarAction(actionConfig,function(editable){var msmConfig=editable.config[MSM.MSMCommons.Constants.PROP_LIVE_RELATIONSHIP];return MSM.MSMCommons.isInheritanceCancelled(editable)||MSM.MSMCommons.isManuallyCreated(editable)})})};var _restoreEditableActions=function(){if(ns.EditorFrame&&ns.EditorFrame.editableToolbar)$.each(ns.EditorFrame.editableToolbar.config.actions,function(actionName,actionConfig){if(actionConfig.decoratedCondition){actionConfig.condition=
actionConfig.decoratedCondition;actionConfig.decoratedCondition=undefined}})};var _updateDropTargetState=function(editable){if(MSM.MSMCommons.isInheritanceCancelled(editable)||MSM.MSMCommons.isManuallyCreated(editable)){if(editable.disabledDropTargets){editable.dropTargets=editable.disabledDropTargets;editable.disabledDropTargets=undefined;ns.overlayManager.recreate(editable)}}else if(editable.dropTargets&&editable.dropTargets.length>0){editable.disabledDropTargets=editable.dropTargets;MSM.MSMCommons.removeDropTargets(editable)}};
self.showRolloutPopover=function(editable,param,target){$(".rollout-popover").show();var $popover=$(".rollout-popover").popover({pointAt:editable.overlay.dom,pointFrom:"top",alignFrom:"right"}).data("popover");$popover.toggleVisibility()};self.inheritanceToolbarButtons={"MSM_CANCEL_INHERITANCE":{icon:MSM.MSMCommons.Constants.ICON_LOCKED,text:Granite.I18n.getMessage("Cancel Inheritance"),handler:self.toggleInheritance,condition:function(editable){return _renderInheritanceToggleCondition(editable,"MSM_CANCEL_INHERITANCE")}},
"MSM_REENABLE_INHERITANCE":{icon:MSM.MSMCommons.Constants.ICON_UNLOCKED,text:Granite.I18n.getMessage("Re-enable Inheritance"),handler:self.toggleInheritance,condition:function(editable){return _renderInheritanceToggleCondition(editable,"MSM_REENABLE_INHERITANCE")}},"MSM_ROLLOUT":{icon:MSM.MSMCommons.Constants.ICON_ROLLOUT,text:Granite.I18n.getMessage("Rollout"),handler:self.showRolloutPopover,condition:function(editable){if(MSM.MSMCommons.isBlueprintPage(ns)&&!editable.hasPlaceholder()){_initializeBlueprintEditableToolbar(editable);
return true}return false}},"MSM_PARENT":{icon:"selectContainer",text:Granite.I18n.get("Parent"),handler:function(editable,param,target){target.addClass("is-active");ns.edit.actions.doSelectParent(editable,target,[ns.store.getParent(editable)]);return false},condition:function(editable){return ns.layerManager.getCurrentLayer()==="msm"&&!!ns.store.getParent(editable)}}};self.initialize=function(){if(self.isInitialized)return;var isLiveCopy=MSM.MSMCommons.isLiveCopyPage(ns);if(!isLiveCopy&&!MSM.MSMCommons.isBlueprintPage(ns))return;
_initPageInfo();$.ajax({type:"GET",dataType:"html",url:MSM.MSMCommons.Constants.ENDPOINT_ROLLOUT_OPTIONS}).done(function(data,textStatus,jqXHR){var $rolloutOptions=$("\x3cdiv\x3e");$rolloutOptions.addClass("hidden-rollout-options");$rolloutOptions.append(data);$rolloutOptions.hide();$rolloutOptions.appendTo($("body"));var $dialogPath=$rolloutOptions.find("[data-dialogpath]");if($dialogPath.length>0){ns.MsmAuthoringHelper.RolloutDialogUrl=Granite.HTTP.externalize($dialogPath.data("dialogpath"));if($dialogPath.data("max-items")>
0)ns.MsmAuthoringHelper.RolloutDialogMaxItems=$dialogPath.data("max-items")}});if(ns.EditorFrame&&ns.EditorFrame.editableToolbar){_decorateLiveCopyActions();if(isLiveCopy)$.each(ns.store,function(index,editable){_updateDropTargetState(editable);var oldRefresh=editable.updateConfig;editable.updateConfig=function(config){oldRefresh.call(this,config);_updateDropTargetState(editable)}});$.each(self.inheritanceToolbarButtons,function(name,msmActionConfig){ns.EditorFrame.editableToolbar.registerAction(name,
msmActionConfig)})}self.isInitialized=true};self.tearDown=function(){if(!self.isInitialized)return;_restoreEditableActions();self.isInitialized=false};return self}();$("#OverlayWrapper").on("click",".msm-rollout-option",function(e){e.stopPropagation();var el=$(this);if(el.find("[data-dialogpath]").length>0){el=el.find("[data-dialogpath]");var dialogSource=Granite.HTTP.externalize(el.data("dialogpath"))+ns.page.path;if(el.data("max-items")>0)dialogSource+="?maxSize\x3d"+el.data("max-items");ns.MsmAuthoringHelper.openRolloutDialog(dialogSource)}else if(el.find("[data-rollout-command-path]").length>
0){el=el.find("[data-rollout-command-path]");var rolloutCommandPath=el.data("rollout-command-path");var blueprint=ns.page.path;if(rolloutCommandPath&&blueprint)MSM.Rollout.doRollout(Granite.HTTP.externalize(rolloutCommandPath),blueprint)}});channel.off("click.rollout-page").on("click.rollout-page","#rolloutBtn",function(e){if(ns){if(ns.selection&&ns.selection.deselectAll)ns.selection.deselectAll();if(ns.EditorFrame&&ns.EditorFrame.editableToolbar&&ns.EditorFrame.editableToolbar.close)ns.EditorFrame.editableToolbar.close()}MSM.MSMCommons.updateSelection([]);
var dialogSource=ns.MsmAuthoringHelper.RolloutDialogUrl+Granite.HTTP.internalize(ns.page.path);if(ns.MsmAuthoringHelper.RolloutDialogMaxItems>0)dialogSource+="?maxSize\x3d"+ns.MsmAuthoringHelper.RolloutDialogMaxItems;ns.MsmAuthoringHelper.openRolloutDialog(dialogSource);$(".msm-rollout-dialog").show()});channel.on("cq-layer-activated",function(e){if(e.layer==="Edit"||e.layer==="Preview"||e.layer==="msm"||e.layer==="Targeting"){ns.MsmAuthoringHelper.tearDown();ns.MsmAuthoringHelper.initialize()}});
channel.on("cq-persistence-after-move",function(event,editable){if(!editable||!ns.MsmAuthoringHelper.isLiveCopy(editable))return;else if(ns.layerManager.getCurrentLayer()==="msm")ns.EditorFrame.editableToolbar.close();var parent=ns.store.getParent(editable);if(ns.MsmAuthoringHelper.isLiveCopy(parent)&&!ns.MsmAuthoringHelper.isInheritanceCancelled(parent)){var modalConfirmationHandler=function(){ns.MsmAuthoringHelper.cancelInheritance(parent)};var promptConfig={title:Granite.I18n.get("Cancel inheritance"),
message:Granite.I18n.get("Do you want to cancel the inheritance of the paragraph system?"),type:ns.ui.helpers.PROMPT_TYPES["NOTICE"],actions:[{id:"OK",text:Granite.I18n.get("Yes"),primary:true},{id:"CANCEL",text:Granite.I18n.get("No"),primary:false}],callback:function(actionId){if("OK"===actionId){ns.EditorFrame.editableToolbar.close();modalConfirmationHandler()}}};ns.ui.helpers.prompt(promptConfig)}})})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){ns.wcm=ns.wcm||{};ns.wcm.DesignImporter=ns.wcm.DesignImporter||{};ns.wcm.DesignImporter.isZipFile=function(file){return $.inArray(file.type,["application/zip","application/x-zip-compressed"])>=0};ns.wcm.DesignImporter.importDesignPackage=function(importerPath,file){var formData=new FormData;if(typeof file==="object"){formData.append("designpackage/file",file);formData.append("designpackage/file@TypeHint","nt:file")}else formData.append("./designPackageReference",
file);var url=Granite.HTTP.externalize(importerPath);$.ajax({url:url,type:"POST",success:function(){window.location.reload()},error:function(){ns.ui.helpers.notify(Granite.I18n.get("An error occurred while importing the design package"))},data:formData,cache:false,contentType:false,processData:false})};ns.wcm.DesignImporter.confirmClear=function(callback){var promptConfig={title:Granite.I18n.get("Clear"),message:Granite.I18n.get("Do you really want to clear the imported design?"),type:ns.ui.helpers.PROMPT_TYPES["NOTICE"],
actions:[{id:"cancel",text:Granite.I18n.get("Cancel"),primary:false},{id:"clear",text:Granite.I18n.get("Clear"),primary:true}],callback:function(actionId){if("clear"===actionId)callback()}};ns.ui.helpers.prompt(promptConfig)};ns.wcm.DesignImporter.clearCanvas=function(importerPath,retainNodes){var url="/bin/designimporter/commands/clear";var data={path:importerPath,retainAuthorNodes:!!retainNodes};return $.post(url,data).promise()};ns.wcm.DesignImporter.downloadDesignPackage=function(designpackagePath){if(!designpackagePath)return;
window.location=Granite.HTTP.externalize(designpackagePath)}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){channel.on("cq-editor-loaded",function(){var droptargetSelector='.cq-droptarget[data-asset-id\x3d"designpackage"]';var overClass="cq-dragover";channel.on("dragenter",droptargetSelector,function(event){event.preventDefault();channel.trigger("cq-designimporter-dragenter")});channel.on("dragover",droptargetSelector,function(event){event.preventDefault();$(event.currentTarget).addClass(overClass)});channel.on("dragleave",droptargetSelector,function(event){event.preventDefault();
$(event.currentTarget).removeClass(overClass);channel.trigger("cq-designimporter-dragleave")});channel.on("drop",droptargetSelector,function(event){event.preventDefault();event.stopPropagation();$(event.currentTarget).removeClass(overClass);channel.trigger("cq-designimporter-drop");var file=event.originalEvent.dataTransfer.files[0];if(!ns.wcm.DesignImporter.isZipFile(file)){ns.ui.helpers.notify(Granite.I18n.getVar("Dropped file is not a zip file"));return}ns.wcm.DesignImporter.importDesignPackage($(event.currentTarget).data("path"),
file)})})})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){channel.on("coral-fileupload:fileadded",".cq-designimporter-actions-upload",function(event){var file=event.originalEvent.detail.item._originalFile;if(!ns.wcm.DesignImporter.isZipFile(file)){ns.ui.helpers.notify(Granite.I18n.getVar("Selected file is not a zip file"));return}ns.wcm.DesignImporter.importDesignPackage(ns.pageInfo.designimporter.importerPath,file)});channel.on("coral-fileupload:filemimetyperejected",".cq-designimporter-actions-upload",function(){ns.ui.helpers.notify(Granite.I18n.getVar("Selected file is not a zip file"))});
channel.on("click",".cq-designimporter-actions-clear",function(){ns.wcm.DesignImporter.confirmClear(function(){ns.wcm.DesignImporter.clearCanvas(ns.pageInfo.designimporter.importerPath).done(function(){window.location.reload()})})});channel.on("click",".cq-designimporter-actions-download",function(){ns.wcm.DesignImporter.downloadDesignPackage(ns.pageInfo.designimporter.designpackagePath)});channel.on("cq-layer-activated",function(event){if(event.layer==="Edit"){ns.EditorFrame.editableToolbar.registerAction("designimporter-clear",
{icon:"revert",text:Granite.I18n.getMessage("Clear"),handler:function(editable){var $div=editable.dom.find("div[data-importer-path]");if(!$div.length)return;ns.wcm.DesignImporter.confirmClear(function(){ns.wcm.DesignImporter.clearCanvas($div.data("importer-path")).done(function(){editable.refresh()})})},condition:function(editable){if(editable.type!="wcm/designimporter/components/importerEx")return false;var $div=editable.dom.find("div[data-importer-path]");return!!($div.length&&$div.data("importer-path"))}});
ns.EditorFrame.editableToolbar.registerAction("designimporter-download",{icon:"download",text:Granite.I18n.getMessage("Download zip"),handler:function(editable){var $div=editable.dom.find("div[data-designpackage-path]");if(!$div.length)return;ns.wcm.DesignImporter.downloadDesignPackage($div.data("designpackage-path"))},condition:function(editable){if(editable.type!="wcm/designimporter/components/importerEx")return false;var $div=editable.dom.find("div[data-designpackage-path]");return!!($div.length&&
$div.data("designpackage-path"))}})}})})(jQuery,Granite.author,jQuery(document),this);
(function(channel){function beforeInsert(event,targetComponent,properties){var isAjaxCall=true;var networkName="";var authToken="";var order="";var url=properties.path+"/";var slingResourceType=targetComponent.componentConfig.resourceType;var parentResourceType=properties.type;var componentName=targetComponent.componentConfig.title;var data="_charset_\x3dutf-8"+"\x26./jcr:created\x3d"+"\x26./jcr:createdBy\x3d"+"\x26./jcr:lastModified\x3d"+"\x26./jcr:lastModifiedBy\x3d"+"\x26./sling:resourceType\x3d"+
slingResourceType+"\x26parentResourceType\x3d"+parentResourceType;searchedData="";var appType={"Livefyre Carousel":"carousel-component","Livefyre Chat":"chat-component","Livefyre Comments":"comment-component","Livefyre LiveBlog":"blog-component","Livefyre Map":"maps-component","Livefyre Media Wall":"streamhub-wall","Livefyre Mosaic":"mosaic-component","Livefyre Poll":"poll-component","Livefyre Reviews":"auto_reviews","Livefyre Single Card":"card-component","Livefyre Storify 2":"liveblog-v2-component",
"Livefyre Trending":"trends-component","Livefyre Upload Button":"media-upload","Livefyre Filmstrip":"filmstrip"};$(document).ajaxSend(function(event,jqXHR,settings){if(settings.url.indexOf("/responsivegrid")!==-1&&isAjaxCall){isAjaxCall=false;var embedData=decodeURIComponent(settings.data).split("\x26");var dropLocation=embedData[embedData.length-2];order=dropLocation.replace("+"," ");settings.data=""}else if(settings.url.match(/^(?=.*\bforceeditcontext\b)(?=.*\bresponsivegrid).*$/))jqXHR.abort()});
removeExistingDialog("livefyreCloudConfigurationError");removeExistingDialog("livefyreAppDialog");removeExistingDialog("livefyreSelectAppDialog");$.ajax({method:"GET",url:"/bin/importConfig",data:"json"}).done(function(data){configValues=JSON.parse(data);networkName=configValues.networkName;authToken=configValues.authToken;document.body.appendChild(livefyreAppDialog);livefyreAppDialog.show();$("#livefyreAppDialog coral-dialog-content").parent().addClass("livefyreAppPopup")}).error(function(data){document.body.appendChild(livefyreCloudConfigurationError);
livefyreCloudConfigurationError.show()});var livefyreCloudConfigurationError=(new Coral.Dialog).set({id:"livefyreCloudConfigurationError",variant:Coral.Dialog.variant.ERROR,header:{innerHTML:"Livefyre Configuration Error."},content:{innerHTML:"Please configure the livefyre network. For more info "+"\x3ca target\x3d'_blank' href\x3d'http://answers.livefyre.com/product/livefyre-for-adobe-experience-"+"manager-aem/livefyre-for-adobe-experience-manager/#configure_aem_to_use_livefyre'\x3eclick here\x3c/a\x3e"},
footer:{innerHTML:"\x3cbutton id\x3d'livefyreCloudServiceDiscard' is\x3d'coral-button' variant\x3d'primary' "+"style\x3d'border-radius: 2rem; width: 5rem;'\x3eOk\x3c/button\x3e"}});livefyreCloudConfigurationError.on("click","#livefyreCloudServiceDiscard",function(){livefyreCloudConfigurationError.hide();document.body.removeChild(livefyreCloudConfigurationError)});var livefyreAppDialog=(new Coral.Dialog).set({id:"livefyreAppDialog",closable:Coral.Dialog.closable.ON,header:{innerHTML:targetComponent.componentConfig.title},
content:{innerHTML:"\x3cdiv class\x3d'coral-Form-field coral-RadioGroup coral-RadioGroup--vertical'"+" id\x3d'appIntegrationOptions'\x3e"+"\x3ccoral-radio class\x3d'coral-Form-field' name\x3d'selectApp' value\x3d'createNewApp' checked\x3e"+"Create new app\x3c/coral-radio\x3e"+"\x3ccoral-radio class\x3d'coral-Form-field' name\x3d'selectApp' value\x3d'addExistingApp'\x3e"+"Embed existing app\x3c/coral-radio\x3e"+"\x3c/div\x3e"},footer:{innerHTML:"\x3cbutton id\x3d'livefyreAppNextButton' is\x3d'coral-button' variant\x3d'primary' "+
"style\x3d'border-radius: 2rem;'\x3eNext\x3c/button\x3e"}});livefyreAppDialog.on("click","#livefyreAppNextButton",function(){var optionSelected=$("#appIntegrationOptions input[type\x3d'radio']:checked").val();livefyreAppDialog.hide();document.body.removeChild(livefyreAppDialog);if(optionSelected=="addExistingApp"){document.body.appendChild(livefyreSelectAppDialog);livefyreSelectAppDialog.show();$("#livefyreSelectAppDialog coral-dialog-content").parent().addClass("livefyreAppPopup");if($("#searchAppContent tbody \x3e tr").length==
0)searchLivefyreApp("",appType[componentName],authToken,targetComponent)}else if(optionSelected=="createNewApp"){isAjaxCall=false;data="\x26"+order+data+"\x26:nameHint\x3d";embedLivefyreComponent(url,data)}});var livefyreSelectAppDialog=(new Coral.Dialog).set({id:"livefyreSelectAppDialog",closable:Coral.Dialog.closable.ON,header:{innerHTML:"Select App to Embed"},content:{innerHTML:"\x3cdiv\x3e"+"\x3cspan class\x3d'coral-DecoratedTextfield componentSearchField'\x3e"+"\x3ci class\x3d'coral-DecoratedTextfield-icon coral-Icon coral-Icon--sizeXS "+
"coral-Icon--search'\x3e\x3c/i\x3e"+"\x3cinput type\x3d'text' class\x3d'coral-DecoratedTextfield-input coral-Textfield' "+"id\x3d'appSearchField' placeholder\x3d'Search "+targetComponent.componentConfig.cellNames[0]+" app...'\x3e"+"\x3ccoral-wait class\x3d'coral-DecoratedTextfield-button waitContainerIcon hide'\x3e"+"\x3c/coral-wait\x3e"+"\x3c/span\x3e"+"\x3cdiv id\x3d'searchAppContent'\x3e\x3c/div\x3e"+"\x3c/div\x3e"+"\x3cdiv class\x3d'noContent hide'\x3eNo content to display. Please retry with some other keyword.\x3c/div\x3e"},
footer:{innerHTML:"\x3cbutton id\x3d'livefyreAppBackButton' is\x3d'coral-button' variant\x3d'default' "+"style\x3d'border-radius: 2rem;'\x3eBack\x3c/button\x3e"+"\x3cbutton id\x3d'livefyreAppEmbedButton' is\x3d'coral-button' variant\x3d'primary' "+"style\x3d'border-radius: 2rem;' disabled\x3eNext\x3c/button\x3e"}});livefyreSelectAppDialog.on("click","#livefyreAppBackButton",function(){livefyreSelectAppDialog.hide();document.body.removeChild(livefyreSelectAppDialog);document.body.appendChild(livefyreAppDialog);
livefyreAppDialog.show()});livefyreSelectAppDialog.on("keydown","#appSearchField",function(e){var key=$(this).val();if(e.keyCode==13&&key)searchLivefyreApp(key,appType[componentName],authToken,targetComponent)});livefyreSelectAppDialog.on("click","#livefyreAppEmbedButton",function(e){isAjaxCall=false;var selectedIndex=$("#searchAppContent tbody").find(".is-selected")[0].dataset.index;var selectedRow=searchedData.apps[selectedIndex];if(selectedRow.id.indexOf("app")!=-1){var embedCode="";var appIdSplit=
selectedRow.id.split("\x3d");var appId=appIdSplit[appIdSplit.length-1];embedCode=fetchEmbedCode(appId,networkName,authToken);if(embedCode.status=="404"){var statusCode=publishedApp(appId,authToken);if(statusCode==200)embedCode=fetchEmbedCode(appId,networkName,authToken)}embedCode=embedCode.replace(/&/g,"%26");data+="\x26"+order+"\x26:nameHint\x3d"+appId+"\x26./LivefyreAppId\x3d"+appId+"\x26./LivefyreEmbedCode\x3d"+embedCode;embedLivefyreComponent(url,data)}else{var siteIdSplit=selectedRow.groups[0].split("\x3d");
var appSiteId=siteIdSplit[siteIdSplit.length-1];var articleId=selectedRow.elements[0].config.collection.articleId;var articleIdSplit=articleId.split("/");var nameHint=articleIdSplit[articleIdSplit.length-1];data+="\x26"+order+"\x26:nameHint\x3d"+nameHint+"\x26./LivefyreArticleId\x3d"+articleId+"\x26./LivefyreAppSiteId\x3d"+appSiteId;embedLivefyreComponent(url,data)}livefyreSelectAppDialog.hide();document.body.removeChild(livefyreSelectAppDialog)})}var removeExistingDialog=function(livefyreDialogId){$("coral-dialog[id\x3d'"+
livefyreDialogId+"']").each(function(){var $this=$(this);$this.hide();$this.remove()})};var searchLivefyreApp=function(key,appType,authToken,targetComponent){$(".waitContainerIcon").removeClass("hide");var url="https://api.livefyre.com/app-service/v4/apps/search?limit\x3d50\x26from\x3d0"+"\x26query\x3d"+key+"\x26type\x3d"+appType+"\x26sort\x3d-score";$.ajax({method:"GET",url:url,beforeSend:function(xhr){xhr.setRequestHeader("Authorization",authToken)},data:"json"}).done(function(data){$(".waitContainerIcon").addClass("hide");
searchedData=data;displayTableContent(data,targetComponent);$("#searchAppContent tbody \x3e tr").length==0?$(".noContent").removeClass("hide"):$(".noContent").addClass("hide");$("#searchAppContent tbody \x3e tr").length==0?$("#searchAppContent \x3e table").addClass("hide"):$("#searchAppContent \x3e table").removeClass("hide")}).error(function(){$(".waitContainerIcon").addClass("hide")})};var embedLivefyreComponent=function(url,data){$.ajax({method:"POST",url:url,data:data}).done(function(data){setTimeout(function(){window.location.reload(true)},
3E3)})};var fetchEmbedCode=function(appId,networkName,authToken){var embedData="";$.ajax({method:"GET",url:"https://api.livefyre.com/"+networkName+"/apps/v1/"+appId+"/embed",beforeSend:function(xhr){xhr.setRequestHeader("Authorization",authToken)},async:false}).done(function(res){embedData=res}).error(function(res){embedData=res});return embedData};var publishedApp=function(appId,authToken){var statusCode="";$.ajax({method:"PUT",url:"https://api.livefyre.com/app-service/v4/apps/"+appId+"/tags/published",
beforeSend:function(xhr){xhr.setRequestHeader("Authorization",authToken);xhr.setRequestHeader("content-type","application/json")},data:JSON.stringify({"name":"published","appVersion":"0"}),async:false}).done(function(response){statusCode=200}).error(function(response){statusCode=404});return statusCode};var displayTableContent=function(data,targetComponent){var livefyreAppTable=(new Coral.Table).set({selectable:true});var livefyreAppTableHead=(new Coral.Table.Head).set({sticky:true});var headerRow=
new Coral.Table.Row;headerRow.appendChild(headerCellTableData("TITLE"));headerRow.appendChild(headerCellTableData("CONTENT COUNT"));headerRow.appendChild(headerCellTableData("DATE MODIFIED"));livefyreAppTableHead.appendChild(headerRow);var livefyreAppTableBody=new Coral.Table.Body;$.each(data.apps,function(i,item){var updatedDate=getTimeToShow(item.updatedAt);var collectionCount=item.elements[0].config.collection?item.elements[0].config.collection.counters.content:0;var bodyRow=new Coral.Table.Row;
$(bodyRow).attr("data-index",i);bodyRow.appendChild(bodyCellTableData(item.title));bodyRow.appendChild(bodyCellTableData(collectionCount));bodyRow.appendChild(bodyCellTableData(updatedDate));livefyreAppTableBody.appendChild(bodyRow)});livefyreAppTable.appendChild(livefyreAppTableHead);livefyreAppTable.appendChild(livefyreAppTableBody);$("#searchAppContent").html(livefyreAppTable);$("#searchAppContent tbody \x3e tr").off("click").on("click",function(){setTimeout(function(){var isSelected=$("#searchAppContent tbody").find(".is-selected")[0]?
true:false;if(isSelected)$("#livefyreAppEmbedButton").prop("disabled",false);else $("#livefyreAppEmbedButton").prop("disabled",true)},500)})};var bodyCellTableData=function(data){return(new Coral.Table.Cell).set({content:{textContent:data}})};var headerCellTableData=function(data){return(new Coral.Table.HeaderCell).set({content:{textContent:data}})};var getTimeToShow=function(updatedAt){var seconds=Math.floor(((new Date).getTime()-(new Date(updatedAt)).getTime())/1E3);var weeks=Math.floor(seconds/
(60*60*24*7));var years=Math.floor(seconds/(60*60*24*365));if(years||weeks>9)return(new Date(updatedAt)).getFullYear();if(weeks)return weeks+"w";var days=Math.floor(seconds/(60*60*24));if(days)return days+"d";var hours=Math.floor(seconds/(60*60));if(hours)return hours+"h";var minutes=Math.floor(seconds/60);if(minutes)return minutes+"m";if(seconds)return seconds+"s"};function beforeEdit(event,targetComponent,properties){var importLivefyreContentDialog=(new Coral.Dialog).set({id:"acceptLivefyreDragDropDialog",
header:{innerHTML:"Are you sure?"},content:{innerHTML:"Publishing is in real time, are you sure you want to publish?"},footer:{innerHTML:"\x3cbutton id\x3d'livefyreDragDropCancelButton' is\x3d'coral-button' variant\x3d'default'"+" coral-close\x3eCancel\x3c/button\x3e\x3cbutton id\x3d'livefyreDragDropAcceptButton' is\x3d'coral-button' "+"variant\x3d'primary'\x3eAccept\x3c/button\x3e"}});importLivefyreContentDialog.on("coral-overlay:close",function(event){document.body.removeChild(importLivefyreContentDialog)});
importLivefyreContentDialog.on("click","#livefyreDragDropAcceptButton",function(){var $dom=targetComponent.dom.find("[data-lf-networkname]");var fragmentPath=properties["./fragmentId"];var networkName=$dom.data("lf-networkname");var articleId=$dom.data("lf-articleid")||"";var appId=$dom.data("lf-appid")||"";var fragmentPathSplit=fragmentPath.split("/");var socialId=fragmentPathSplit[fragmentPathSplit.length-1];var socialIdSplit=socialId.split(".");var generator=socialIdSplit[0]+"."+socialIdSplit[1];
var foreignId=socialIdSplit[2];$.ajax({method:"POST",url:"/bin/livefyreExportAsset",data:"livefyreFragmentPath\x3d"+fragmentPath+"\x26livefyreNetworkName\x3d"+networkName+"\x26livefyreArticleId\x3d"+articleId+"\x26livefyreGeneratorId\x3d"+generator+"\x26livefyreForeignId\x3d"+foreignId+"\x26livefyreAppId\x3d"+appId}).done(function(data){});importLivefyreContentDialog.hide()});document.body.appendChild(importLivefyreContentDialog);importLivefyreContentDialog.show()}channel.on("cq-social-cfm-beforeedit",
beforeEdit);channel.on("cq-social-cfm-beforeinsert",beforeInsert)})($(document));
(function($,author,channel,window,undefined){var actionDef={text:Granite.I18n.get("Livefyre Studio"),condition:function(editable){try{var isLivefyre=editable.type.indexOf("livefyre")!==-1}catch(e){console.error("Error checking if component isLivefyre",e);return false}return isLivefyre},handler:function(editable,param,target){var el=editable.dom.get(0);var doc=el.ownerDocument;var win=doc.defaultView||doc.parentWindow;var SCF=win.SCF;var componentDataUrl=this.path+SCF.constants.URL_EXT;var studioWindow=
window.open();$.get(componentDataUrl).promise().then(function(componentData){var collection=collectionFromComponentData(componentData);var url=createStudioUrlForCollection(collection);studioWindow.location.replace(url)}).then(null,function(err){console.error(err)})},isNonMulti:true};channel.on("cq-layer-activated",function(ev){if(ev.layer==="Edit")author.EditorFrame.editableToolbar.registerAction("LIVEFYRE_STUDIO",actionDef)});function collectionFromComponentData(componentData){var collection={network:componentData.networkname,
siteId:componentData.siteid,articleId:componentData.articleId};if(componentData.isDesigner){collection.isDesigner=componentData.isDesigner;collection.appId=componentData.appId}return collection}function createStudioUrlForCollection(collection){var template="https://{host}/api/v4/resolver/?rel\x3dstudio\x26amp;urn\x3d{urn}";var host=collection.network.replace(".fyre.co",".admin.fyre.co");var urn=createCollectionURN(collection);var url=template.replace("{host}",host).replace("{urn}",encodeURIComponent(urn));
if(collection.isDesigner)url=getAppURLFromData(collection.network,collection.appId);return url}function createCollectionURN(collection){var template="urn:livefyre:{network}:site\x3d{siteId}:article\x3d{articleId}:collection";var urn=template.replace("{network}",collection.network).replace("{siteId}",collection.siteId).replace("{articleId}",encodeURIComponent(collection.articleId));return urn}function getAppURLFromData(network,appId){return"https://studio.livefyre.com/"+network+"/apps/urn:livefyre:"+
network+":app\x3d"+appId+"/details"}})(jQuery,Granite.author,jQuery(document),this);
(function($){var CONTEXTHUB_EVENT_NAMESPACE="ch";var EVENT_UI_INITIALIZED="ui-initialized";var EVENT_AUTHORING_LAYER_ACTIVATED="cq-layer-activated";var EVENT_AUTHORING_CONTEXTHUB_TOGGLE="cq-contexthub-toggle";var EVENT_AUTHORING_EMULATOR_BAR_TOGGLE="cq-emulatorbar-toggle";var EVENT_AUTHORING_CONTEXTHUB_INIT="ch-authoring-hook";var AUTHORING_SELECTOR=".editor-GlobalBar";var CONTEXTHUB_TOGGLE_BUTTON=".js-editor-ContextHubTrigger";var EMULATOR_TOGGLE_BUTTON=".js-editor-EmulatorBar-toggle";var PAGE_CONTENT_SELECTOR=
".editor-panel-content-with-header";var LAYER_PREVIEW="Preview";var toggleContextHubButton=function(makeVisible){$(document).trigger($.Event(EVENT_AUTHORING_CONTEXTHUB_INIT,{visible:makeVisible}))};var uiAdjustment=function(ev){var UI=window.ContextHub&&ContextHub.UI;if(!UI&&ev)UI=$.extend(true,{data:{data:[{}]}},ev.originalEvent).data.data[0].UI;if(UI){var makeVisible=Granite.author.layerManager.getCurrentLayerName()===LAYER_PREVIEW;UI.Properties.set("IFRAME_TOP_MARGIN",function(){var heights=$(AUTHORING_SELECTOR+
":visible").map(function(){return $(this).height()||0}).get();heights.push(0);return Math.max.apply(null,heights)});UI.Properties.set("VISIBLE",makeVisible);UI.Properties.set("PAGE_CONTAINER",$(PAGE_CONTENT_SELECTOR));UI.Properties.set("HIDE_CONTAINER_DRAWER",true);toggleContextHubButton(makeVisible)}};var authoringLayerActivated=function(ev){var makeVisible=ev.layer===LAYER_PREVIEW;if(window.ContextHub&&ContextHub.UI){var isExpanded=!!ContextHub.persistence.getItem(ContextHub.Constants.IS_CONTAINER_EXPANDED);
ContextHub.UI.Properties.set("VISIBLE",makeVisible);if($.contains(document.documentElement,(ContextHub.UIFrame||[])[0]))ContextHub.UI.Container.toggle({state:isExpanded,noTransition:true});toggleContextHubButton(makeVisible)}};var uiToggle=function(){var currentTimestamp=+new Date;this.toggleTimestamp=this.toggleTimestamp||0;if(window.ContextHub&&ContextHub.UI&&currentTimestamp-this.toggleTimestamp>230){var emulatorToggle=$(AUTHORING_SELECTOR+" "+EMULATOR_TOGGLE_BUTTON);var uiVisible=ContextHub.UI.Container.isExpanded();
this.toggleTimestamp=currentTimestamp;if(emulatorToggle.hasClass("is-selected")&&!uiVisible)emulatorToggle.click();ContextHub.UI.Container.toggle()}};var emulatorBarToggle=function(event,data){var emulatorVisible=data&&data.isOpen;if(emulatorVisible&&window.ContextHub&&ContextHub.UI&&ContextHub.UI.Container.isExpanded()){$(AUTHORING_SELECTOR+" "+CONTEXTHUB_TOGGLE_BUTTON).removeClass("is-selected");ContextHub.UI.Container.toggle()}};var toggleButtonHighlight=function(){if(window.ContextHub&&ContextHub.UI)$(AUTHORING_SELECTOR+
" "+CONTEXTHUB_TOGGLE_BUTTON).toggleClass("is-selected",ContextHub.UI.Container.isExpanded())};var eventSelector=".authoring-hook";var bindHandler=function(handle,eventName,handler){var name=eventName+eventSelector;handle.off(name).on(name,handler)};var channel=$(window);var uiReadyEvent=CONTEXTHUB_EVENT_NAMESPACE+"-"+EVENT_UI_INITIALIZED;if(window.ContextHub&&ContextHub.eventing.alreadyTriggered(uiReadyEvent))uiAdjustment();else bindHandler(channel,uiReadyEvent,uiAdjustment);bindHandler(channel,
EVENT_AUTHORING_LAYER_ACTIVATED,authoringLayerActivated);bindHandler(channel,EVENT_AUTHORING_CONTEXTHUB_TOGGLE,uiToggle);bindHandler(channel,EVENT_AUTHORING_EMULATOR_BAR_TOGGLE,emulatorBarToggle);bindHandler(channel,"ch-ui-container-opened ch-ui-container-closed",toggleButtonHighlight)})(jQuery);
(function($,ns,channel,window){var defaultDelete=ns.edit.ToolbarActions.DELETE.execute;function customDelete(message,selected){ns.ui.helpers.prompt({title:Granite.I18n.get("Delete"),message:Granite.I18n.get(message),actions:[{id:"CANCEL",text:Granite.I18n.get("Cancel","Label for Cancel button"),className:"cq-deletecancel"},{id:"DELETE",text:Granite.I18n.get("Delete","Label for Confirm button"),className:"coral-Button--warning cq-deleteconfirm"}],callback:function(actionId){if(actionId==="CANCEL")ns.selection.deselectAll();
else{ns.selection.deselectAll();ns.editableHelper.actions.DELETE.execute(selected)}}})}function doDelete(){var selected=ns.selection.getAllSelected(),hasReferences=false,paths=[];for(var i=0;i<selected.length;i++)paths.push(selected[i].path);$.ajax({type:"GET",url:"/bin/wcm/references",data:{"_charset_":"utf-8",path:paths}}).done(function(data,textStatus,jqXHR){if(_g.HTTP.isOkStatus(jqXHR.status))if(data.pages.length>0)hasReferences=true;if(hasReferences){var message="One or more of the selected components are referenced. "+
"Do you really want to delete them?";customDelete(message,selected)}else defaultDelete()})}ns.edit.ToolbarActions.DELETE.execute=doDelete;ns.edit.ToolbarActions.DELETE.handler=doDelete})(jQuery,Granite.author,jQuery(document),this);(function(document,$){$(document).on("foundation-contentloaded",function(e){$(".js-store-view-data").on("click",function(e){window.open(Granite.HTTP.externalize($(".js-store-path").val()+".json"),"FormReport")})})})(document,Granite.$);
(function(){var remotedam={};remotedam.ui=remotedam.ui||{};window.remotedam=remotedam})();
(function(document,remotedam){remotedam.config=function(){var self={};var KEY_CONF_REMOTE_ORIGIN="remoteOrigin";var KEY_CONF_REMOTE_DAM_MOUNT_POINT="remoteDamMountPoint";var KEY_CONF_ASSET_FETCH_TIMEOUT="remoteAssetFetchTimeout";var KEY_CONF_SHOULD_TRANSFORM_REMOTE_ENDPOINT="shouldTransform";var remoteOrigin="";var searchPath="/content/dam";var mountPath="/content/dam";var assetFetchTimeOut=5E3;var searchSrc="/libs/dam/remoteassets/content/query.json";var localSyncSrc="/libs/dam/remoteassets/fetch.html";
var loginLandingPage="/libs/dam/remoteassets/content/landing.html";var initialized=false;var shouldTransform=false;self.init=function($confMeta){var confJson=$confMeta.data("remoteConf");if($confMeta.length>0){remoteOrigin=confJson[KEY_CONF_REMOTE_ORIGIN];mountPath=confJson[KEY_CONF_REMOTE_DAM_MOUNT_POINT];assetFetchTimeOut=confJson[KEY_CONF_ASSET_FETCH_TIMEOUT];shouldTransform=confJson[KEY_CONF_SHOULD_TRANSFORM_REMOTE_ENDPOINT]}if(remoteOrigin===undefined||remoteOrigin==="")throw new Error("Remote DAM configuration not found.");
initialized=true};self.getRemoteOrigin=function(){if(initialized===true)if(shouldTransform){var urlSubLevels=remoteOrigin.split(".");if(urlSubLevels[1]==="int")urlSubLevels[1]="corp";return urlSubLevels.join(".")}else return remoteOrigin;else throw new Error("Remote DAM configuration is not initialized.");};self.getRemoteSearchSrc=function(){if(initialized===true)return searchSrc;else throw new Error("Remote DAM configuration is not initialized.");};self.getRemoteSearchPath=function(){if(initialized===
true)return searchPath;else throw new Error("Remote DAM configuration is not initialized.");};self.getRemoteMountPath=function(){if(initialized===true)return mountPath;else throw new Error("Remote DAM configuration is not initialized.");};self.getLocalSyncSrc=function(){if(initialized===true)return localSyncSrc;else throw new Error("Remote DAM configuration is not initialized.");};self.getLoginLandingPage=function(){if(initialized===true)return loginLandingPage;else throw new Error("Remote DAM configuration is not initialized.");
};self.getAssetFetchTimeOut=function(){if(initialized===true)return assetFetchTimeOut;else throw new Error("Remote DAM configuration is not initialized");};return self}()})(document,remotedam);
(function(document,remotedam){remotedam.ui.authorization=function(){var self={};var loginWindowProps={"toolbar":"no","location":"yes","directories":"no","status":"no","menubar":"no","scrollbar":"yes","resizable":"yes","copyhistory":"no","width":"600","height":"600"};var handler;self.start=function(remoteOrigin,remoteLandingPage,authHandler){handler=authHandler;loginWindowProps.top=(window.innerHeight-loginWindowProps.height)/2;loginWindowProps.left=(window.innerWidth-loginWindowProps.width)/2;var loginWindow=
window.open(remoteOrigin+remoteLandingPage,"_blank",objectToCommaString(loginWindowProps));function handleLoginMessage(e){if(e.origin===remoteOrigin&&e.data==="remotedamloggedin"){loginWindow.close();handler.handleAuthCompleted()}}window.removeEventListener("message",handleLoginMessage,false);window.addEventListener("message",handleLoginMessage,false)};self.detectUnAuthorization=function(jqXhr){if(jqXhr.status===401)return false;return true};return self}();function objectToCommaString(obj){var strArr=
[];for(var key in obj)if(obj.hasOwnProperty(key))strArr.push(key+"\x3d"+obj[key]);return strArr.join(",")}})(document,remotedam);
(function(document,$,remotedam,remoteConfig){remotedam.ui.resultParser=function(){var self={};function formatSize(bytes){var oneKB=1024;var oneMB=1048576;var oneGB=1073741824;if(bytes<oneKB)return Granite.I18n.get("{0} Bytes",bytes);else if(bytes<oneMB)return Granite.I18n.get("{0} KB",parseFloat((bytes/oneKB).toFixed(3)));else if(bytes<oneGB)return Granite.I18n.get("{0} MB",parseFloat((bytes/oneMB).toFixed(3)));else return Granite.I18n.get("{0} GB",parseFloat((bytes/oneGB).toFixed(3)))}function getOriginalSizeAndResolution(renditionSources,
showResolution){for(var rendition in renditionSources)if(renditionSources[rendition]["path"].endsWith("original")){var resolution=rendition.split("_")[1].replace("."," x ");var size=formatSize(renditionSources[rendition]["size"]);if(showResolution===true)return resolution+" | "+size;else return size}return""}function getOriginalRenditionSize(renditionSources){for(var rendition in renditionSources)if(renditionSources[rendition]["path"].endsWith("original")){var size=renditionSources[rendition]["size"];
return size}return""}function getMountedPath(remotePath){return remoteConfig.getRemoteMountPath()+remotePath.substr("/content/dam".length,remotePath.length)}self.createCards=function(jsonStr,cardConfig){var cards=[];var json=JSON.parse(jsonStr);json.forEach(function(item){var card=new Coral.Card;card.classList.add("editor-Card-asset");card.classList.add("card-asset");card.classList.add("cq-draggable");card.classList.add("u-coral-openHand");$(card).attr("data-remote-path",item["data"]["path"]);$(card).attr("data-path",
getMountedPath(item["data"]["path"]));$(card).attr("data-asset-group","media");$(card).attr("data-asset-mimetype",item["data"]["asset-mimetype"]);$(card).attr("data-type",cardConfig.getAssetDataType());$(card).attr("data-original-size",getOriginalRenditionSize(item["renditionsSources"]));card.draggable=true;var thumbnail=item["data"]["path"]+".thumb.319.319.png";if(item["renditionsSources"]["rend_319.319"])thumbnail=remoteConfig.getRemoteOrigin()+item["renditionsSources"]["rend_319.319"]["path"];
card.asset.append($("\x3cimg\x3e").attr("class","cq-dd-image").attr("src",thumbnail).attr("alt",item["description"])[0]);if(item["isNew"]){var cardInfo=new Coral.Card.Info;var newTag=(new Coral.Tag).set({label:{textContent:Granite.I18n.get("New")}});newTag.setAttribute("color","blue");cardInfo.append(newTag);card.append(cardInfo)}card.content.append((new Coral.Card.Title).set({title:item["title"],innerText:item["title"]}));var propertyList=new Coral.Card.PropertyList;propertyList.append((new Coral.Card.Property).set({innerText:getOriginalSizeAndResolution(item["renditionsSources"],
cardConfig.showResolution())}));card.content.append(propertyList);cards.push(card)});return cards};return self}();remotedam.ui.resultParser.CardConfig=function(){this.showResolution=function(){return true};this.getAssetDataType=function(){return"Remote-Assets"}}})(document,Granite.$,remotedam,remotedam.config);
(function($,Granite,ns,remotedam,remoteConfig){var ASYNC_JOBS_STATUS_PAGE="/mnt/overlay/dam/gui/content/asyncjobs.html";remotedam.ui.dragDropController=function(){var self={};function getContext(){var uri=document.location.pathname;return uri.substring(uri.indexOf(".html")+5,uri.length)}function syncRemoteAsset(remotePath,originalRendSize,syncHandler){$.ajax({type:"POST",dataType:"json",timeout:remoteConfig.getAssetFetchTimeOut(),url:Granite.HTTP.externalize(remoteConfig.getLocalSyncSrc()),data:{context:getContext(),
assetpath:remotePath,originalRenditionSize:originalRendSize}}).done(function(jsonResponse){if(jsonResponse["status"]==="OK")syncHandler.onSuccess(jsonResponse);else syncHandler.onFailure(jsonResponse)}).fail(function(){syncHandler.onFailure()})}function showSyncError(){var $dialog=$("#remoteSyncErrDialog");if($dialog.length===0){var dialog=(new Coral.Dialog).set({id:"remoteSyncErrDialog",header:{innerHTML:Granite.I18n.get("Error")},content:{innerHTML:Granite.I18n.get("Remote asset sync failed.")},
variant:"error",closable:"on"});$dialog=$(dialog);var okButton=(new Coral.Button).set({variant:"primary"});okButton.on("click",function(){dialog.hide()});okButton.label.textContent=Granite.I18n.get("OK");$("coral-dialog-footer",$dialog).append(okButton);$("body").append($dialog)}$dialog[0].show()}function showAsyncOrigFetchDialog(){var $dialog=$("#remoteAsyncFetchDialog");var msg=Granite.I18n.get("While you continue authoring the page, this asset will be fetched in the background. Queued and failed fetches can be seen at Async Jobs Status page ");
var asyncUILink=$("\x3ca\x3e").attr("href",ASYNC_JOBS_STATUS_PAGE).text(Granite.I18n.get("here.")).attr("target","_blank");msg=$("\x3cspan\x3e").text(msg).append(asyncUILink);if($dialog.length===0){var dialog=(new Coral.Dialog).set({id:"remoteAsyncFetchDialog",header:{innerHTML:Granite.I18n.get("Info")},content:{innerHTML:msg.html()},variant:"info",closable:"on"});$dialog=$(dialog);var okButton=(new Coral.Button).set({variant:"primary"});okButton.on("click",function(){dialog.hide()});okButton.label.textContent=
Granite.I18n.get("OK");$("coral-dialog-footer",$dialog).append(okButton);$("body").append($dialog)}$dialog[0].show()}self.init=function(){var name="Remote-Assets";function RemoteAssetDragAndDrop(){this.constructor.super_.constructor.apply(this,arguments)}ns.util.inherits(RemoteAssetDragAndDrop,ns.ui.assetFinder.AssetDragAndDrop);RemoteAssetDragAndDrop.prototype.prepareProperties=function(event,dropTarget){var properties=RemoteAssetDragAndDrop.super_.prepareProperties.apply(this,arguments);var imgNode=
dropTarget.name.substring(0,dropTarget.name.lastIndexOf("/"));properties[imgNode+"/jcr:lastModified"]=null;properties[imgNode+"/jcr:lastModifiedBy"]=null;properties[imgNode+"/fileName"]=null;properties[imgNode+"/file@Delete"]="true";return properties};RemoteAssetDragAndDrop.prototype.handleDrop=function(event,dropTarget){var args=arguments;var context=this;var syncHandler={};syncHandler.onSuccess=function(jsonResponse){RemoteAssetDragAndDrop.super_.handleDrop.apply(context,args);ns.ui.helpers.clearWait();
if(jsonResponse.origFetchAsync)showAsyncOrigFetchDialog()};syncHandler.onFailure=function(jsonResponse){ns.ui.helpers.clearWait();showSyncError()};ns.ui.helpers.wait();syncRemoteAsset($(event.dragTarget).data("remote-path"),$(event.dragTarget).data("original-size"),syncHandler)};ns.ui.dropController.register(name,new RemoteAssetDragAndDrop)};return self}()})(Granite.$,Granite,Granite.author,remotedam,remotedam.config);
(function(document,Granite,$,channel,ns,authorization,resultParser,remoteConfig){remotedam.ui.remoteTab=function(){var self={};self.SIDE_PANEL_SELECTOR="#SidePanel";self.SELECTOR=self.SIDE_PANEL_SELECTOR+" .sidepanel-tab-remote-assets";self.SELECTOR_CONFIGMETA=self.SELECTOR+" .remotedam-config-container";self.SELECTER_ASSET_TYPE=self.SELECTOR+" coral-select.remote-assetfilter.type";self.FULLTEXT_SEARCH_SELECTOR=self.SELECTOR+" #remoteassetsearch";self.FILTER_DETAIL_SELECTOR=self.SELECTOR+" #remote-assetfinder-filter-detail";
self.isActive=function(){var $remoteTabContent=$(self.SELECTOR);return $(self.SIDE_PANEL_SELECTOR).hasClass("sidepanel-opened")&&$remoteTabContent.parents(".js-SidePanel-content").is(":visible")&&$remoteTabContent.length>0&&$("coral-tab:selected").attr("aria-controls")===$remoteTabContent.parents("coral-panel").attr("id")};var pageSize=20;var defaultLimit=20;var startLimit=0;var endLimit=defaultLimit;var MASONRY_LAYOUT_SETTINGS={layout:"variable",columnWidth:140,spacing:15};var eventTypeLoad="loadAssets";
var isAllDataLoaded=false;var offscrollTimer=null;var assetsLoaded=false;var spinnerVisible=false;var FULLTEXT_SEARCH_SELECTOR=self.SELECTOR+" #remoteassetsearch";var RESULT_SPINNER_SELECTOR=self.SELECTOR+" .resultspinner";var RESULT_EMPTYRESULT_SELECTOR=self.SELECTOR+" .emptyresult";var RESULT_ERRORMSG_SELECTOR=self.SELECTOR+" .errormsg";var CONTENT_PANEL_SELECTOR=self.SELECTOR+" .remoteasset-content-panel";var LOGIN_BUTTON_SELECTOR=CONTENT_PANEL_SELECTOR+" .remote-login-button";var controllersMap=
{};self.authHandler={};self.authHandler.handleAuthCompleted=function(){hideLoginButton();clearResult();startAssetsLoad(false)};self.Controller=function(){this.type="Default";this.setUpFilterPanel=function(){throw new Error("Not implemented");};this.resetFilterPanel=function(){throw new Error("Not implemented");};this.addFilterParams=function(params){};this.getCardConfig=function(){throw new Error("Not implemented");}};self.register=function(name,controller){controllersMap[name]=controller};self.handleFilterChange=
function(){clearResult();startAssetsLoad(false)};function showLoginButton(){var loginButton=$(LOGIN_BUTTON_SELECTOR);if(loginButton.length===0){loginButton=(new Coral.Button).set({variant:"default",label:{innerText:Granite.I18n.get("Log in to Connected Assets")}});loginButton=$(loginButton);loginButton.addClass("remote-login-button");$(CONTENT_PANEL_SELECTOR).append(loginButton);loginButton.on("click",function(){authorization.start(remoteConfig.getRemoteOrigin(),remoteConfig.getLoginLandingPage(),
self.authHandler)})}else loginButton.show()}function hideLoginButton(){var loginButton=$(LOGIN_BUTTON_SELECTOR);if(loginButton.length>0)loginButton.hide()}function showSpinner(){var $spinner=$(RESULT_SPINNER_SELECTOR);if($spinner.length===0){$spinner=$('\x3cdiv class\x3d"resultspinner"\x3e').append('\x3ccoral-wait size\x3d"L"\x3e\x3c/coral-wait\x3e');var $div=$('\x3cdiv class\x3d"status"\x3e\x3c/div\x3e');$div.text(Granite.I18n.get("Loading results"));$spinner.append($div);$(CONTENT_PANEL_SELECTOR).append($spinner)}spinnerVisible=
true;var $parent=$spinner.parent();$spinner=$spinner.detach();$parent.append($spinner);$spinner.show();var parentTop=$parent.position().top,parentBottom=parentTop+$parent.height(),h=$(window).height();if(parentTop<=h&&parentBottom>=0)$spinner[0].scrollIntoView(false)}function hideSpinner(){var $spinner=$(RESULT_SPINNER_SELECTOR);if($spinner.length===0)return;var noResultsFound=$(".editor-AssetFinder .emptyresult:visible").length;var masonryItems=$(self.SELECTOR+" coral-masonry");if(masonryItems.length)masonryItems=
masonryItems[0].querySelectorAll("coral-masonry-item");var allItemsReady=Array.from(masonryItems).filter(function(el){return window.getComputedStyle(el).opacity!=="1"}).length===0;if(noResultsFound||allItemsReady){spinnerVisible=false;$spinner.hide();return}window.requestAnimationFrame(hideSpinner)}function showEmptyResult(){$(RESULT_EMPTYRESULT_SELECTOR).show()}function hideEmptyResult(){$(RESULT_EMPTYRESULT_SELECTOR).hide()}function showErrorMsg(){$(RESULT_ERRORMSG_SELECTOR).show()}function hideErrorMsg(){$(RESULT_ERRORMSG_SELECTOR).hide()}
function addResult(masonry){$(CONTENT_PANEL_SELECTOR).append(masonry);assetsLoaded=true}function clearResult(){$(self.SELECTOR+" coral-masonry").remove();assetsLoaded=false}function clearAssetFinder(){$(FULLTEXT_SEARCH_SELECTOR).val("");clearResult();hideSpinner();hideErrorMsg();hideEmptyResult();hideLoginButton()}function startAssetsLoad(append){append=!!append;if(!append&&!assetsLoaded||append)$(CONTENT_PANEL_SELECTOR).trigger({type:eventTypeLoad,append:append})}function handleUnauthorized(){clearAssetFinder();
showLoginButton()}function syncFilterPanel(type){var controllers=Object.values(controllersMap);for(var idx in controllers)controllers[idx].resetFilterPanel();var controller=controllersMap[type];if(controller===undefined)throw new Error("No controller for asset type: "+type);controller.setUpFilterPanel()}function getCardConfig(){var $typeSelect=$(self.SELECTER_ASSET_TYPE);var selectedType=$typeSelect.val();var controller=controllersMap[selectedType];return controller.getCardConfig()}function addFilterParams(commonParams){var $typeSelect=
$(self.SELECTER_ASSET_TYPE);var selectedType=$typeSelect.val();var controller=controllersMap[selectedType];controller.addFilterParams(commonParams)}function handleLoadAssets(event){var appendData=event.append;if(!appendData)_resetInternal();_getAndShowResults(appendData);function _resetInternal(){startLimit=0;endLimit=defaultLimit}function _getAndShowResults(appendData){hideErrorMsg();hideEmptyResult();showSpinner();var fulltextSearch="";var $elSearch=$(self.FULLTEXT_SEARCH_SELECTOR);if($elSearch.length&&
$elSearch.val().length)fulltextSearch=$elSearch.val().trim();var param={"_dc":(new Date).getTime(),"fullText":fulltextSearch,"limit":startLimit+".."+endLimit,"_charset_":"utf-8"};addFilterParams(param);$.ajax({type:"GET",dataType:"json",url:remoteConfig.getRemoteOrigin()+remoteConfig.getRemoteSearchSrc(),data:param,xhrFields:{withCredentials:true}}).done(function(response,textStatus,jqXHR){var isAuthorized=authorization.detectUnAuthorization(response);if(!isAuthorized)handleUnauthorized();else{_insertCardsToMasonry(resultParser.createCards(JSON.stringify(response),
getCardConfig()),appendData);startLimit=endLimit;endLimit=endLimit+pageSize}}).fail(function(req,textStatus,error){var isAuthorized=authorization.detectUnAuthorization(req);if(!isAuthorized)handleUnauthorized();else if(textStatus==="error")showErrorMsg();else showEmptyResult()}).always(function(req,textStatus,error){hideSpinner()})}function _getMasonry(appendData){var $masonry=$(self.SELECTOR).find("coral-masonry"),masonry=$masonry[0];if(!appendData&&masonry){$masonry[0].remove();masonry=undefined}if(!masonry){masonry=
(new Coral.Masonry).set(MASONRY_LAYOUT_SETTINGS);self.masonry=masonry;addResult(masonry)}return masonry}function _insertCardsToMasonry(cards,appendData){isAllDataLoaded=cards.length<endLimit-startLimit;$(self.SELECTOR).find(".foundation-layout-masonry-empty").toggle(true);self.masonry=_getMasonry(appendData);if(cards.length){hideErrorMsg();hideEmptyResult();cards.forEach(function(card){var item=new Coral.Masonry.Item;item.content.appendChild(card);self.masonry.items.add(item)});$(self.SELECTOR).find(".editor-SidePanel-resultMessage").toggle(false);
if(ns.device.isIE11)$(self.masonry).find("object").css("display","none")}else if(!startLimit&&!cards.length)showEmptyResult()}}function handleTabSwitch(){if(self.isActive()){remoteConfig.init($(self.SELECTOR_CONFIGMETA));syncFilterPanel($(self.SELECTER_ASSET_TYPE).val());startAssetsLoad(false)}}function handleFulltextSearch(){var keycode=Granite.Util.getKeyCode(event);if(keycode===13){clearResult();startAssetsLoad(false)}}function handleFulltextSearchClear(){clearResult();startAssetsLoad(false)}function handleTypeSelection(){syncFilterPanel(this.value);
clearResult();startAssetsLoad(false)}function handleScroll(event){var elem=$(event.currentTarget),scrollTop=elem.scrollTop(),scrollHeight=elem.get(0).scrollHeight,clientHeight=elem.get(0).clientHeight;$.toe.off();if(offscrollTimer)clearTimeout(offscrollTimer);offscrollTimer=setTimeout(function(){$.toe.on();offscrollTimer=null},500);var margin=5;if(!spinnerVisible&&scrollTop>0&&scrollTop+clientHeight+margin>=scrollHeight)if(!isAllDataLoaded)startAssetsLoad(true)}function init(){remotedam.ui.dragDropController.init();
channel.on("cq-sidepanel-tab-switched",handleTabSwitch);$(CONTENT_PANEL_SELECTOR).on(eventTypeLoad,$.debounce(125,false,handleLoadAssets));$(FULLTEXT_SEARCH_SELECTOR).on("keyup",handleFulltextSearch);var $clear=$(FULLTEXT_SEARCH_SELECTOR).siblings("button");$clear.on("click",handleFulltextSearchClear);var $typeSelect=$(self.SELECTER_ASSET_TYPE);$typeSelect.on("change",handleTypeSelection);$(CONTENT_PANEL_SELECTOR).on("scroll",handleScroll)}channel.one("cq-editor-loaded",init);return self}()})(document,
Granite,Granite.$,Granite.$(document),Granite.author,remotedam.ui.authorization,remotedam.ui.resultParser,remotedam.config);
(function($,remoteTab,resultParser){var BaseController=remoteTab.Controller;function ImageController(){}ImageController.prototype=new BaseController;var imageController=new ImageController;imageController.type="Images";imageController.setUpFilterPanel=function(){};imageController.resetFilterPanel=function(){};imageController.addFilterParams=function(params){params["jcr:content/metadata/dc:format"]="image%"};imageController.getCardConfig=function(){var DefaultCardConfig=resultParser.CardConfig;return new DefaultCardConfig};
remotedam.ui.remoteTab.register(imageController.type,imageController)})(Granite.$,remotedam.ui.remoteTab,remotedam.ui.resultParser);
(function($,remoteTab,resultParser){var BaseController=remoteTab.Controller;var SEL_FILTER_TYPE_DOC=remoteTab.FILTER_DETAIL_SELECTOR+" .remote-assetfilter-documents";var SEL_DOCUMENTS_FILTER_FILETYPE=SEL_FILTER_TYPE_DOC+"[data-filtertype\x3d'fileType']";var SEL_DOCUMENTS_FILTER_FILETYPE_OPTIONS=SEL_DOCUMENTS_FILTER_FILETYPE+" coral-checkbox";function DocumentController(){}DocumentController.prototype=new BaseController;var documentController=new DocumentController;documentController.type="Documents";
documentController.setUpFilterPanel=function(){$(SEL_FILTER_TYPE_DOC).show();$(document).off("change",SEL_DOCUMENTS_FILTER_FILETYPE_OPTIONS,remoteTab.handleFilterChange).on("change",SEL_DOCUMENTS_FILTER_FILETYPE_OPTIONS,remoteTab.handleFilterChange)};documentController.resetFilterPanel=function(){$(SEL_FILTER_TYPE_DOC).hide()};documentController.addFilterParams=function(params){params[getFilterPropPath(SEL_DOCUMENTS_FILTER_FILETYPE)]=getSelectedTypes()};documentController.getCardConfig=function(){var BaseCardConfig=
resultParser.CardConfig;function DocumentCardConfig(){}DocumentCardConfig.prototype=new BaseCardConfig;var documentCardConfig=new DocumentCardConfig;documentCardConfig.showResolution=function(){return false};return documentCardConfig};function getFilterPropPath(filterSelector){return $(filterSelector+" input.propertyPath").val()}function getSelectedTypes(){var selectedTypes=[];var MIMETYPE_SEL_SELECTED=SEL_DOCUMENTS_FILTER_FILETYPE_OPTIONS+"[checked]";var $filterSelected=$(MIMETYPE_SEL_SELECTED);
var $filters;if($filterSelected.length)$filters=$filterSelected;else $filters=$(SEL_DOCUMENTS_FILTER_FILETYPE_OPTIONS);$filters.each(function(){try{var multiTypes=JSON.parse(this.value);multiTypes.forEach(function(value){selectedTypes.push(value)})}catch(exp){selectedTypes.push(this.value)}});return selectedTypes.toString()}remotedam.ui.remoteTab.register(documentController.type,documentController)})(Granite.$,remotedam.ui.remoteTab,remotedam.ui.resultParser);
(function($,ns,channel,window){ns.CFM={}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var iframe=ns.ContentFrame.iframe;var cache={fragments:undefined};function adaptToFragment(dom){var $dom=$(dom);var json=$dom.children().first().attr("data-json");if(json)return JSON.parse(json);var $config=$dom.find(".cq-contentfragment-details").last();if($config.length){var associatedContent=$config.find(".cq-contentfragment-associatedcontent-item").map(function(){var $item=$(this);return{path:$item.data("path"),title:$item.data("title")}});return{path:$config.data("fragment-path"),
title:$config.data("fragment-title"),element:$config.data("fragment-element"),variation:$config.data("fragment-variation"),associatedContent:associatedContent.length>0?associatedContent:undefined}}else return null}function findByPath(array,value){return array.filter(function(element){return element.path===value})}function notNull(element){return element!=null}function uniqueByPath(array){var i=0;var result=[];while(i<array.length){var path=array[i].path;if(findByPath(result,path).length===0)result.push(array[i]);
i++}return result}function loadFragments(){var $fragments=iframe.contents().find(".contentfragment");var fragments=$fragments.toArray().map(adaptToFragment).filter(notNull);fragments=uniqueByPath(fragments);cache.fragments=fragments;channel.trigger("cq-cfm-fragments-loaded");return fragments}function hasAssociatedContent(fragment){return fragment&&fragment.associatedContent&&fragment.associatedContent.length>0}function getFragments(config){var allFragments=cache.fragments?cache.fragments:loadFragments();
if(config&&config.withAssociatedContentOnly)return allFragments.filter(hasAssociatedContent);else return allFragments}channel.on("cq-editor-loaded",function(event){loadFragments()});channel.on("cq-contentfragment-edit",function(event){loadFragments()});channel.on("cq-contentfragment-insert",function(event){loadFragments()});channel.on("cq-contentfragment-delete",function(event){loadFragments()});ns.CFM.Fragments={getFragments:getFragments,adaptToFragment:adaptToFragment}})(jQuery,Granite.author,jQuery(document),
this);
(function($,ns,channel,window,undefined){var externalize=Granite.HTTP.externalize;var assetFinder=ns.ui.assetFinder;var FRAGMENTS_FILTER_NAME="Content Fragments";var ASSET_VIEW_SERVLET="/bin/wcm/contentfinder/asset/view.html";var ITEM_RT="dam/cfm/components/v2/asset";var searchPath="/content/dam";var fragmentsFilter={viewInAdminRoot:"/editor.html{+item}",searchRoot:"/content/dam",loadAssets:function(query,lowerLimit,upperLimit){var param={"_dc":(new Date).getTime(),"query":query,"contentFragment":"true","itemResourceType":ITEM_RT,
"limit":lowerLimit+".."+upperLimit,"_charset_":"utf-8"};return $.ajax({type:"GET",dataType:"html",url:externalize(ASSET_VIEW_SERVLET)+searchPath,data:param})},setServlet:function(servlet){ASSET_VIEW_SERVLET=servlet},setSearchPath:function(path){if(path)searchPath=path.replace(/\/$/,"")},setItemResourceType:function(resourceType){ITEM_RT=resourceType},resetSearchPath:function(){searchPath=this.searchRoot}};assetFinder.register(FRAGMENTS_FILTER_NAME,fragmentsFilter)})(jQuery,Granite.author,jQuery(document),
this);
(function($,ns,channel,window,undefined){var extendClass=ns.util.extendClass;var AssetDragAndDrop=ns.ui.assetFinder.AssetDragAndDrop;var dropController=ns.ui.dropController;var FRAGMENT_CONTROLLER_NAME="Content Fragment";var FragmentDragAndDrop=extendClass(AssetDragAndDrop,{constructor:function(){AssetDragAndDrop.constructor.apply(this,arguments)},showConfirmationDialog:function(fragment,callback){var title=Granite.I18n.get("Warning");var message=Granite.I18n.get("Please confirm replacing the current content fragment and all in-page modifications with this new content fragment:");message+=
"\x3cbr/\x3e\x3cbr/\x3e\x3cb\x3e"+fragment+"\x3c/b\x3e";var cancel=Granite.I18n.get("Cancel");var update=Granite.I18n.get("Update");$(window).adaptTo("foundation-ui").prompt(title,message,"warning",[{text:cancel},{text:update,primary:true,handler:callback}])},handleDrop:function(event){var dropHandler=FragmentDragAndDrop.super_.handleDrop.bind(this,event);var editable=event.currentDropTarget.targetEditable;var $editable=$(editable.dom);if(!$editable.find(".cq-placeholder").length&&editable.dropTargets.length){var $card=
$(event.origin);var fragment=$card.data("title")||$card.data("path");this.showConfirmationDialog(fragment,dropHandler)}else dropHandler()}});dropController.register(FRAGMENT_CONTROLLER_NAME,new FragmentDragAndDrop)})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var I18n=Granite.I18n;var externalize=Granite.HTTP.externalize;var CardView=CUI.CardView;var sidePanel=ns.ui.SidePanel.$el;var Fragments=ns.CFM.Fragments;var ASSETS_TAB_HEADING=I18n.get("Assets");var ASSOCIATED_CONTENT_TAB_HEADING=I18n.get("Associated Content");var ASSOCIATED_CONTENT_TAB_PATH="/mnt/overlay/wcm/core/content/editor/_jcr_content/sidepanels/plugin/associatedcontent";var GRID_LAYOUT_SETTINGS={colWidth:145,gutterX:14,selector:"coral-card.card-asset"};
function toPath(element){return element&&element.path}function removeDuplicateAssets(associatedAssetsTab){var $tab=$(associatedAssetsTab);var $assets=$tab.find(".associatedassets-content-container .card-asset[data-path]");var lookup={};$.each($assets,function(idx,asset){var path=$(asset).data("path");if(lookup[path])$(asset).remove();else lookup[path]=true});return $tab.html()}function addTab(sidePanel,associatedContentTab){var sidePanelTabs=sidePanel.find("coral-tabview coral-tablist");var sidePanelStack=
sidePanel.find("coral-tabview coral-panelstack");var tabs=sidePanelTabs[0].items.getAll();var panels=sidePanelStack[0].items.getAll();var $associatedContentTab=$(associatedContentTab);var tabIcon=$associatedContentTab.find(".cq-AssociatedAssets-icon");var iconName=tabIcon.attr("class").match(/coral-Icon--([^ ]+)/)||["",""];var tabIconContainer=tabIcon.parent();var tabSection=$associatedContentTab.find(".cq-AssociatedAssets");var tabContent=tabSection.children();if(sidePanelTabs.length&&sidePanelStack.length){sidePanelTabs[0].items.add({title:I18n.get("Associated Content"),
icon:iconName[1],invalid:false,disabled:false,selected:false},tabs[tabs.length-1]);var tabId="coral-id-"+(100+sidePanelTabs[0].items.length);var newPanel=new Coral.Panel;var wrapper=$("\x3cdiv\x3e").addClass("sidepanel-tab sidepanel-tab-associatedassets").append(tabContent);newPanel.content.appendChild(wrapper[0]);sidePanelStack[0].items.add(newPanel,panels[panels.length-1]);$(sidePanelTabs[0].items.getAll()).filter('[title\x3d"'+ASSOCIATED_CONTENT_TAB_HEADING+'"]').attr("aria-controls",tabId);$(newPanel).attr("id",
tabId)}var newTabSection=$(newPanel).find(".sidepanel-tab");var newTabIconContainer=tabIcon.parent();newTabIconContainer.addClass(tabIconContainer.attr("class"));newTabIconContainer.attr("title",tabIconContainer.attr("title"));newTabSection.addClass(tabSection.attr("class"));newTabSection.removeClass("coral-TabPanel-pane");newTabSection.attr("data-headertitle",tabSection.attr("data-headertitle"));return newTabSection}function addAssociatedContentTab(sidePanel,fragments){return $.ajax({type:"GET",
url:externalize(ASSOCIATED_CONTENT_TAB_PATH+".html"),dataType:"html",data:{fragments:fragments.map(toPath)}}).then(function(associatedContentTab){channel.trigger("foundation-contentloaded");associatedContentTab=removeDuplicateAssets(associatedContentTab);var $associatedContentTab=addTab(sidePanel,associatedContentTab);channel.off("cq-sidepanel-tab-switched.cfm-associatedcontent").on("cq-sidepanel-tab-switched.cfm-associatedcontent",function(event){if(event.tabName==="sidepanel-tab-associatedassets"){var fragments=
ns.CFM.Fragments.getFragments({withAssociatedContentOnly:true});renderAssociatedContentTab($associatedContentTab,fragments)}});$associatedContentTab.on("change.cfm-associatedcontent",".cq-AssociatedAssets-fragmentSelect",handleFragmentChange).on("change.cfm-associatedcontent",".cq-AssociatedAssets-collectionSelect",handleCollectionChange)})}function removeAssociatedContentTab(sidePanel){var sidePanelTabs=sidePanel.find("coral-tablist");var tab=sidePanelTabs.find("coral-tab[title\x3d'"+ASSOCIATED_CONTENT_TAB_HEADING+
"']");if(tab.length>0){var sidePanelStack=sidePanel.find("coral-panelstack");var panel=sidePanelStack.find("coral-panel#"+tab.attr("aria-controls"));sidePanelTabs[0].items.remove(tab[0]);if(panel.length>0)sidePanelStack[0].items.remove(panel[0])}}function getAssociatedContentTab(sidePanel){return sidePanel&&sidePanel.find(".sidepanel-tab-associatedassets").eq(0)}function updateAssociatedContentTab(associatedContentTab,filters){var fragments;var collection;if(!filters||!filters.fragments)fragments=
Fragments.getFragments();else if(filters){fragments=filters.fragments;collection=filters.collection}if(!fragments||fragments.length==null||fragments.length===0)return;return $.ajax({type:"GET",url:externalize(ASSOCIATED_CONTENT_TAB_PATH+".html"),dataType:"html",data:{fragments:fragments.map(toPath),collection:collection}}).then(function(newAssociatedContentTab){newAssociatedContentTab=removeDuplicateAssets(newAssociatedContentTab);updateGrid(associatedContentTab,newAssociatedContentTab)})}function updateGrid(associatedContentTab,
newAssociatedContentTab){var $associatedContentTab=$(associatedContentTab);var $newAssociatedContentTab=$(newAssociatedContentTab);var grid=$associatedContentTab.find(".associatedassets-content-container.grid");grid.empty();var grid0=$("\x3cdiv class\x3d'grid-0'\x3e\x3c/div\x3e");var assets=$newAssociatedContentTab.find(".card-asset");grid0.append(assets);grid.append(grid0);initializeGrid(associatedContentTab)}function renderAssociatedContentTab(associatedContentTab,fragments){populateFilters(associatedContentTab,
fragments);initializeGrid(associatedContentTab)}function initializeGrid(associatedContentTab){var gridContainer=$(associatedContentTab).find(".associatedassets-content-container.grid");var cardView=CardView.get(gridContainer);cardView.setDisplayMode(CardView.DISPLAY_GRID);if(ns.device.isDesktop())cardView.layout(GRID_LAYOUT_SETTINGS);else cardView.layout($.extend({},GRID_LAYOUT_SETTINGS,{"colWidth":200}));gridContainer.find("a.label").on("click",function(event){event.preventDefault()});var contentPanel=
gridContainer.parent();contentPanel.height(Math.round($(window).height()-contentPanel.offset().top))}function populateFilters(associatedContentTab,fragments){if(fragments.length>0){populateFragmentSelector(associatedContentTab,fragments);populateCollectionSelector(associatedContentTab)}}function populateFragmentSelector(tabContent,fragments){var fragmentSelector=$(tabContent).find(".cq-AssociatedAssets-fragmentSelect").get(0);var allPaths=[];if(fragmentSelector){fragmentSelector.items.clear();fragments.forEach(function(fragment){fragmentSelector.items.add({content:{innerHTML:fragment.title},
value:fragment.path});allPaths.push(fragment.path)})}fragmentSelector.items.add({content:{innerHTML:I18n.get("All Fragments")},value:allPaths},fragmentSelector.items.first());fragmentSelector.items.first().selected=true}function populateCollectionSelector(tabContent,fragment){var collectionSelector=$(tabContent).find(".cq-AssociatedAssets-collectionSelect").get(0);if(collectionSelector){collectionSelector.items.clear();collectionSelector.items.add({content:{innerHTML:I18n.get("All Collections")},
value:"all"});if(fragment&&fragment.associatedContent)$(fragment.associatedContent).each(function(){collectionSelector.items.add({content:{innerHTML:this.title},value:this.path})});collectionSelector.items.first().selected=true}}function updateSelectorState(contentTab){var fragmentSelector=contentTab.find(".cq-AssociatedAssets-fragmentSelect").get(0);var collectionSelector=contentTab.find(".cq-AssociatedAssets-collectionSelect").get(0);var fragmentPath=fragmentSelector.value;collectionSelector.disabled=
fragmentPath.indexOf(",")!==-1}function handleFragmentChange(event){var associatedContentTab=getAssociatedContentTab(sidePanel);var collectionSelector=associatedContentTab.find(".cq-AssociatedAssets-collectionSelect").get(0);var fragmentSelector=event.target;var fragmentPath=fragmentSelector.value;var filters={fragments:[{path:fragmentPath}]};updateAssociatedContentTab(sidePanel,filters);if(fragmentPath.indexOf(",")===-1){collectionSelector.disabled=false;var fragment=Fragments.getFragments().filter(function(frag){return frag.path===
fragmentPath})[0];populateCollectionSelector(associatedContentTab,fragment)}else{collectionSelector.disabled=true;populateCollectionSelector(associatedContentTab)}}function handleCollectionChange(event){var associatedContentTab=getAssociatedContentTab(sidePanel);var fragmentSelector=associatedContentTab.find(".cq-AssociatedAssets-fragmentSelect").get(0);var collectionSelector=event.target;var fragmentPath=fragmentSelector.value;var collectionPath=collectionSelector.value;if(fragmentSelector&&collectionSelector){var filters=
{fragments:[{path:fragmentPath}],collection:collectionPath};updateAssociatedContentTab(associatedContentTab,filters)}}function initializeFragments(addAssociatedContent){var fragments=ns.CFM.Fragments.getFragments({withAssociatedContentOnly:true});var associatedContentTab=getAssociatedContentTab(sidePanel);if(fragments.length)if(associatedContentTab.length){populateFilters(associatedContentTab,fragments);updateAssociatedContentTab(associatedContentTab,{fragments:fragments});updateSelectorState(associatedContentTab)}else{if(addAssociatedContent===
true)addAssociatedContentTab(sidePanel,fragments).then(function(){initializeFragments(false)})}else removeAssociatedContentTab(sidePanel)}channel.on("cq-cfm-fragments-loaded",function(){initializeFragments(true)})})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window){var createClass=ns.util.createClass;var externalize=Granite.HTTP.externalize;var Fragments=ns.CFM.Fragments;var editorRegistry=ns.editor;var CF_EDITOR_PATH="/editor.html";var FragmentAdminEditor=createClass({constructor:function(){},setUp:function(editable){var fragment=Fragments.adaptToFragment(editable.dom);var cfEditorURL=CF_EDITOR_PATH+fragment.path;if(fragment.element!=null)cfEditorURL+="?element\x3d"+fragment.element;if(fragment.variation!=null&&fragment.variation!==
"master")if(cfEditorURL.indexOf("?element")>0)cfEditorURL+="\x26variation\x3d"+fragment.variation;else cfEditorURL+="?variation\x3d"+fragment.variation;window.open(externalize(cfEditorURL))},canEdit:function(editable){var fragment=Fragments.adaptToFragment(editable.dom);return fragment?fragment.path&&fragment.path!=="":false}});editorRegistry.register("fragment-admin",new FragmentAdminEditor)})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var EditorFrame=null;if(ns!=undefined&&ns!=null)EditorFrame=ns.EditorFrame;var ACTION_ICON="coral-Icon--reorder";var ACTION_TITLE=Granite.I18n.get("Collapse/Expand");var ACTION_NAME="COLLAPSE/EXPAND";var collpaseAction={icon:ACTION_ICON,text:ACTION_TITLE,handler:function(editable){$(".cq-workflow--touch-split-body",editable.dom).toggle();$(".cq-workflow--touch-split-container",editable.dom).toggleClass("collapseSplit");$(editable.overlay.dom).toggleClass("collapseSplitOverlay")},
condition:function(editable){return $(".cq-workflow--touch-split-container",editable.dom).length>0}};channel.on("cq-layer-activated",function(event){if(event.layer==="Edit")EditorFrame.editableToolbar.registerAction(ACTION_NAME,collpaseAction)})})(jQuery,Granite.author,jQuery(document),this);
(function(window,document,Granite,$){var rel=".cq-AssetPickerField",assetPickerDialog,$assetPicker,modifiedPreviewTargets=[];function showAssetPicker(){var href=Granite.HTTP.externalize("/aem/assetpicker?mode\x3dsingle"),$iframe=$('\x3ciframe class\x3d"cq-AssetPicker cq-AssetPicker-iframe"\x3e\x3c/iframe\x3e');$iframe.attr("src",href);assetPickerDialog=new Coral.Dialog;var $assetPicker=$(assetPickerDialog);$assetPicker.appendTo("body");$assetPicker.empty();$assetPicker.append($iframe);$assetPicker.attr("modal",
"true");$assetPicker.addClass("cq-AssetPicker cq-AssetPicker-modal");assetPickerDialog.show();return $assetPicker}function receiveMessage(event){if(event.origin!==location.origin)return;if(!$assetPicker)return;var fromDam=JSON.parse(event.data);if(fromDam.data){var $sink=$assetPicker.data("sink"),path=decodeURI(fromDam.data[0].path);$sink.val(path).change()}if(fromDam.config){var configFromDam=fromDam.config;if(configFromDam.action==="close"||configFromDam.action==="done")assetPickerDialog.hide()}}
window.addEventListener("message",receiveMessage,false);$(document).on("change",rel+" .js-datafield",function(e){var $pickerField=$(e.target).closest(rel),$productImageForm=$pickerField.closest(".product-image"),path=Granite.HTTP.externalize($(e.target).val()),previewSelector=$pickerField.attr("data-previewtarget"),$previewTarget=null;if($productImageForm.length>0){$previewTarget=$productImageForm.find(previewSelector);$previewTarget.attr("src",path)}else{$previewTarget=$(document).find(previewSelector);
if($previewTarget.length>0){if(!$previewTarget.data("reset-value")){$previewTarget.data("reset-value",$previewTarget.attr("src"));modifiedPreviewTargets.push($previewTarget)}$previewTarget.attr("src",path)}}});$(document).on("reset","form",function(e){e.preventDefault();for(var i=0;i<modifiedPreviewTargets.length;i++){var $previewTarget=modifiedPreviewTargets[i];if($previewTarget&&$previewTarget.data("reset-value"))$previewTarget.attr("src",$previewTarget.data("reset-value"))}});$(document).on("click",
rel+" .js-browse-activator",function(e){var $pickerField=$(e.target).closest(rel),$sink=$pickerField.find(".js-datafield");$assetPicker=showAssetPicker();$assetPicker.data("sink",$sink)})})(window,document,Granite,Granite.$);
(function($,ns,channel,window){CQ=window.CQ||{};CQ.commerce=CQ.commerce||{};CQ.commerce.Edit=CQ.commerce.Edit||{};CQ.commerce.Edit.productAfterEdit=CQ.commerce.Edit.productAfterEdit||function(){var editable=this;Granite.$.ajax({type:"POST",url:Granite.HTTP.externalize("/libs/commerce/products"),data:{"_charset_":"utf-8",":operation":"checkVariantHierarchy","catalogPath":editable.path},success:function(data,status,request){ns.edit.actions.doRefresh(editable)}})}})(jQuery,Granite.author,jQuery(document),
this);(function($,ns,channel,window,undefined){var name="Products";function ProductDragAndDrop(){}ns.util.inherits(ProductDragAndDrop,ns.ui.assetFinder.AssetDragAndDrop);ns.ui.dropController.register(name,new ProductDragAndDrop)})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var self={},name="Products",insertAfter="Documents";self.searchRoot="/var/commerce/products";var searchPath=self.searchRoot,productServlet="/bin/wcm/contentfinder/product/view.html",itemResourceType="commerce/gui/components/authoring/assetfinder/product";self.loadAssets=function(query,lowerLimit,upperLimit){var param={"_dc":(new Date).getTime(),"query":query,"itemResourceType":itemResourceType,"limit":lowerLimit+".."+upperLimit,"_charset_":"utf-8"};return $.ajax({type:"GET",
dataType:"html",url:Granite.HTTP.externalize(productServlet)+searchPath,data:param})};self.setServlet=function(servlet){productServlet=servlet};self.setSearchPath=function(path){searchPath=path.replace(/\/$/,"")};self.setItemResourceType=function(resourceType){itemResourceType=resourceType};self.resetSearchPath=function(){searchPath=self.searchRoot};ns.ui.assetFinder.register(name,self,insertAfter)})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window){function submitData($form,$previewThumbnail){Granite.$.ajax({type:$form.prop("method"),url:$form.prop("action"),contentType:$form.prop("enctype"),data:$form.serialize(),success:function(data,textStatus,xhr){if(_g.shared.HTTP.isOkStatus(xhr.status)){if($previewThumbnail.length>0)renderProxyPagePreview($previewThumbnail)}else{var response=_g.shared.HTTP.buildPostResponseFromHTML(xhr.responseText);_onError(response.headers["Message"])}},error:function(xhr,textStatus,errorThrown){var response=
_g.shared.HTTP.buildPostResponseFromHTML(xhr.responseText);_onError(response.headers["Message"])}})}function convertToEditablePage(path,redirectTo){Granite.$.ajax({type:"POST",url:Granite.HTTP.externalize("/bin/wcmcommand"),data:{"_charset_":"utf-8","cmd":"convertToEditablePage","srcPath":path},success:function(data,textStatus,xhr){if(_g.shared.HTTP.isOkStatus(xhr.status)){if(redirectTo)document.location.href=Granite.HTTP.externalize(redirectTo)}else{var response=_g.shared.HTTP.buildPostResponseFromHTML(xhr.responseText);
_onError(response.headers["Message"])}},error:function(xhr,textStatus,errorThrown){var response=_g.shared.HTTP.buildPostResponseFromHTML(xhr.responseText);_onError(response.headers["Message"])}})}function _onError(message){if(!message||typeof message!=="string")message=Granite.I18n.get("Failed to convert page.");var dialog=(new Coral.Dialog).set({variant:"error",movable:true,closable:"on",header:{innerHTML:Granite.I18n.get("Error")},content:{innerHTML:message}});document.body.appendChild(dialog);
dialog.show()}function renderProxyPagePreview($previewThumbnail){var $iframe=$previewThumbnail.children("iframe");var $spinner=(new Coral.Wait).set({size:"L",centered:true});$previewThumbnail.append($spinner);$iframe.on("load",function(){$spinner.hide().remove()});var url=Granite.HTTP.externalize($previewThumbnail.data("page-url"));if(url.indexOf("?")>0)url+="\x26ck\x3d"+$.now();else url+="?ck\x3d"+$.now();$iframe.attr("src",url)}channel.on("cq-content-frame-loaded",function(e){var $contentFrameContents=
$("#ContentFrame").contents(),$previewThumbnail=$contentFrameContents.find(".foundation-layout-thumbnail-image .preview-thumbnail"),$dataFields=$contentFrameContents.find(".js-datafield"),$convertButton=$contentFrameContents.find(".cq-commerce-convert-to-editable-page");if($convertButton.length){$convertButton.on("click",function(e){var path=$convertButton.closest("form").attr("action");path=path.replace(/[/]_jcr_content$/,"");var redirectTo="/editor.html"+path+".html";convertToEditablePage(path,
redirectTo)});channel.trigger("cq-hide-overlays");channel.on("editor-frame-mode-changed",function(e){window.location.reload()});$dataFields.each(function(){this.onchange=function(e){var $form=$(e.target).closest("form");submitData($form,$previewThumbnail)}});if($previewThumbnail.length){$previewThumbnail.height(260);var iframe=$("\x3ciframe/\x3e",{"style":"border: 0; width: 980px; height: 980px;"+" -ms-zoom: 0.316; "+" -transform: scale(0.316);"+" -moz-transform: scale(0.316); -moz-transform-origin: 0 0;"+
" -o-transform: scale(0.316); -o-transform-origin: 0 0;"+" -webkit-transform: scale(0.316); -webkit-transform-origin: 0 0;"});$previewThumbnail.append(iframe);renderProxyPagePreview($previewThumbnail)}}var $productPageProxyFlag=$contentFrameContents.find(".productPageProxyFlag");if($productPageProxyFlag.length)channel.on("editor-frame-mode-changed",function(e){window.location.reload()})})})(jQuery,Granite.author,jQuery(document),this);
(function($,Granite,ns){var template=""+'\x3cdiv class\x3d"imageeditor-map-toolbar toolbar"\x3e'+'   \x3cimg class\x3d"cq-commerce-productthumbnail" src\x3d"'+Granite.HTTP.externalize("/libs/cq/ui/resources/0.gif")+'"\x3e'+'   \x3cspan class\x3d"coral-InputGroup" \x3e'+'       \x3cfoundation-autocomplete  class\x3d"coral-Form-field" name\x3d"href" placeholder\x3d"Product path" pickersrc\x3d"/mnt/overlay/commerce/gui/content/common/productfield/picker.html?root\x3d%2fvar%2fcommerce%2fproducts\x26filter\x3dfolderOrProduct\x26selectionCount\x3dsingle" data-foundation-validation\x3d""\x3e'+
'           \x3ccoral-overlay  foundation-autocomplete-suggestion\x3d"" class\x3d"foundation-picker-buttonlist" data-foundation-picker-buttonlist-src\x3d"/mnt/overlay/commerce/gui/content/common/productfield/suggestion{.offset,limit}.html?root\x3d%2fvar%2fcommerce%2fproducts\x26amp;filter\x3dproduct{\x26amp;query}"\x3e\x3c/coral-overlay\x3e'+'           \x3ccoral-taglist  foundation-autocomplete-value\x3d"" name\x3d"href"\x3e'+'               \x3ccoral-tag value\x3d""\x3e\x3c/coral-tag\x3e'+"           \x3c/coral-taglist\x3e"+
'           \x3cinput  class\x3d"foundation-field-related" type\x3d"hidden" name\x3d"href@Delete"\x3e'+"       \x3c/foundation-autocomplete\x3e"+"   \x3c/span\x3e"+'    \x3cinput is\x3d"coral-textfield" name\x3d"alt" placeholder\x3d"Alt Text" /\x3e'+'    \x3ccoral-select class\x3d"coral-Form-field" name\x3d"target" placeholder\x3d"Target"\x3e'+'        \x3ccoral-select-item value\x3d""\x3eTarget\x3c/coral-select-item\x3e'+'        \x3ccoral-select-item value\x3d"_self"\x3eSame Tab\x3c/coral-select-item\x3e'+
'        \x3ccoral-select-item value\x3d"_blank"\x3eNew Tab\x3c/coral-select-item\x3e'+'        \x3ccoral-select-item value\x3d"_parent"\x3eParent frame\x3c/coral-select-item\x3e'+'        \x3ccoral-select-item value\x3d"_top"\x3eTop frame\x3c/coral-select-item\x3e'+"    \x3c/coral-select\x3e"+'    \x3cspan class\x3d"actions"\x3e'+'        \x3cbutton is\x3d"coral-button" variant\x3d"warning" class\x3d"imageeditor-map-delete" icon\x3d"delete"\x3e\x3c/button\x3e'+'        \x3cbutton is\x3d"coral-button" class\x3d"imageeditor-map-unlaunch" icon\x3d"close"\x3e\x3c/button\x3e'+
'        \x3cbutton is\x3d"coral-button" variant\x3d"primary" class\x3d"imageeditor-map-confirm" icon\x3d"check"\x3e\x3c/button\x3e'+"    \x3c/span\x3e"+"\x3c/div\x3e";ns.editor.ImageEditor.prototype.setUp=function(editable,targetId){if(editable.type==="commerce/components/addtocartimage"){var oldFn=CUI.imageeditor.actions.Map.prototype.createPopover;CUI.imageeditor.actions.Map.prototype.createPopover=function(execDef){this.editor.templates.templates["map-popover"]=function(){return template};oldFn.apply(this,
execDef)}}this.startImageEditor(editable,targetId)}})(jQuery,Granite,Granite.author);
(function($,ns){var CLASS_CONTENTFRAGMENT="cmp-contentfragment";var ATTRIBUTE_PATH="data-path";var EDITOR_URL="/editor.html";var ContentFragmentEditor=ns.util.createClass({constructor:function(){},canEdit:function(editable){return $(editable.dom).find("."+CLASS_CONTENTFRAGMENT+"["+ATTRIBUTE_PATH+"]").length>0},setUp:function(editable){var fragmentPath=$(editable.dom).find("."+CLASS_CONTENTFRAGMENT).attr(ATTRIBUTE_PATH);if(fragmentPath){var fragmentEditUrl=EDITOR_URL+fragmentPath;var fragment=ns.CFM.Fragments.adaptToFragment(editable.dom);
if(fragment&&typeof fragment.variation!=="undefined"&&fragment.variation!=="master")fragmentEditUrl=fragmentEditUrl+"?variation\x3d"+fragment.variation;window.open(Granite.HTTP.externalize(fragmentEditUrl))}}});ns.editor.register("contentfragment",new ContentFragmentEditor)})(jQuery,Granite.author);
(function(channel){channel.on("cq-editor-loaded",function(event){if(window.CQ&&window.CQ.CoreComponents&&window.CQ.CoreComponents.panelcontainer&&window.CQ.CoreComponents.panelcontainer.v1&&window.CQ.CoreComponents.panelcontainer.v1.registry)window.CQ.CoreComponents.panelcontainer.v1.registry.register({name:"cmp-tabs",selector:".cmp-tabs",itemSelector:"[data-cmp-hook-tabs\x3d'tabpanel']",itemActiveSelector:".cmp-tabs__tabpanel--active"})})})(jQuery(document));
(function(){window.CQ=window.CQ||{};window.CQ.CoreComponents=window.CQ.CoreComponents||{};window.CQ.CoreComponents.experiencefragment=window.CQ.CoreComponents.experiencefragment||{};window.CQ.CoreComponents.experiencefragment.v1=window.CQ.CoreComponents.experiencefragment.v1||{};window.CQ.CoreComponents.experiencefragment.v1.actions={}})();
(function($,ns){var MSG_NO_FRAGMENT_PATH=Granite.I18n.get("This experience fragment component doesn't have an associated variation");ns.experiencefragment.v1.actions.edit=function(){var ui=$(window).adaptTo("foundation-ui");$.get(this.path+".model.json").then(function(response){var path=response["localizedFragmentVariationPath"];if(typeof path==="string"&&path.length>0)window.open(Granite.HTTP.externalize("/editor.html"+path.substring(0,path.lastIndexOf("/"))+".html"));else ui.notify("",MSG_NO_FRAGMENT_PATH,
"notice")})}})(jQuery,CQ.CoreComponents);
(function($,ns){var CLASS_CONTENTFRAGMENT="cmp-contentfragment";var ATTRIBUTE_PATH="data-cmp-contentfragment-path";var EDITOR_URL="/editor.html";var ContentFragmentEditor=ns.util.createClass({constructor:function(){},canEdit:function(editable){return $(editable.dom).find("."+CLASS_CONTENTFRAGMENT+"["+ATTRIBUTE_PATH+"]").length>0},setUp:function(editable){var fragmentPath=$(editable.dom).find("."+CLASS_CONTENTFRAGMENT).attr(ATTRIBUTE_PATH);if(fragmentPath){var fragmentEditUrl=EDITOR_URL+fragmentPath;
var fragment=ns.CFM.Fragments.adaptToFragment(editable.dom);if(fragment&&typeof fragment.variation!=="undefined"&&fragment.variation!=="master")fragmentEditUrl=fragmentEditUrl+"?variation\x3d"+fragment.variation;window.open(Granite.HTTP.externalize(fragmentEditUrl))}}});ns.editor.register("contentfragment",new ContentFragmentEditor)})(jQuery,Granite.author);(function(){window.CQ=window.CQ||{};window.CQ.CoreComponents=window.CQ.CoreComponents||{}})();
(function($,ns,channel,window){var panelSelector;var NS_PANELSELECTOR=".cmp-panelselector";var PN_PANEL_TITLE="cq:panelTitle";var selectors={indexMarker:".cmp-panelselector__indexMarker"};var PanelSelector=ns.util.createClass({_config:{},_panelContainer:{},_elements:{},constructor:function PanelSelector(config){var that=this;that._config=config;var panelContainerType=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerType(that._config.editable);if(panelContainerType){var element=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(that._config.editable);
that._panelContainer=new CQ.CoreComponents.panelcontainer.v1.PanelContainer({path:that._config.editable.path,panelContainerType:panelContainerType,el:element});that._render().done(function(){that._bindEvents()});that._handleOutOfAreaClickBound=that._handleOutOfAreaClick.bind(that)}},isOpen:function(){return this._elements.popover&&this._elements.popover.open},_render:function(){this._createPopover();this._createTable();this._elements.popover.content.appendChild(this._elements.table);ns.ContentFrame.scrollView[0].appendChild(this._elements.popover);
return this._renderItems()},_createPopover:function(){var that=this;var popover=(new Coral.Popover).set({alignAt:Coral.Overlay.align.LEFT_BOTTOM,alignMy:Coral.Overlay.align.LEFT_TOP,target:that._config.target,interaction:Coral.Popover.interaction.OFF,open:true});popover.classList.add("cmp-panelselector");this._elements.popover=popover},_createTable:function(){var table=(new Coral.Table).set({orderable:true,selectable:true});var colgroup=document.createElement("colgroup");colgroup.appendChild(new Coral.Table.Column);
colgroup.appendChild((new Coral.Table.Column).set({fixedWidth:true}));var tableHead=(new Coral.Table.Head).set({sticky:true});tableHead.appendChild(new Coral.Table.HeaderCell);tableHead.appendChild(new Coral.Table.HeaderCell);tableHead.classList.add("cmp-panelselector__tableHead");table.appendChild(colgroup);table.appendChild(tableHead);table.classList.add("cmp-panelselector__table");this._elements.table=table},_renderItems:function(){var deferred=$.Deferred();var that=this;var children=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerItems(that._config.editable);
that._panelContainer.getItems().done(function(panelContainerItems){var items=[];children.forEach(function(child,index){items.push({id:child.path,name:child.name,title:getTitle(child,panelContainerItems[child.name],index+1)})});that._createItems(items);deferred.resolve()});return deferred.promise()},_createItems:function(items){var activeIndex=this._panelContainer.getActiveIndex();this._elements.reorderButtons=[];for(var i=0;i<items.length;i++){var row=this._elements.table.items.add({});row.dataset.id=
items[i].id;row.dataset.name=items[i].name;var titleCell=(new Coral.Table.Cell).set({content:{innerHTML:items[i].title}});var button=(new Coral.Button).set({icon:"dragHandle",iconSize:"S",variant:"minimal"});button.setAttribute("coral-table-roworder",true);var dragHandleCell=new Coral.Table.Cell;dragHandleCell.appendChild(button);this._elements.reorderButtons.push(button);row.appendChild(titleCell);row.appendChild(dragHandleCell);if(activeIndex===i)row.selected=true}this._elements.table.style.height=
this._elements.table.offsetHeight+"px"},_bindEvents:function(){var that=this;$(document).off("keyup"+NS_PANELSELECTOR).on("keyup"+NS_PANELSELECTOR,function(event){if(event.keyCode===27)that._finish()});document.removeEventListener("click",that._handleOutOfAreaClickBound);document.addEventListener("click",that._handleOutOfAreaClickBound,true);that._elements.table.on("coral-table:change",function(event){if(event.detail.selection.length===0)if(event.detail.oldSelection.length)Coral.commons.nextFrame(function(){event.detail.oldSelection[0].setAttribute("selected",
true)});if(event.detail.selection!==event.detail.oldSelection)that._navigate()});for(var i=0;i<that._elements.reorderButtons.length;i++)$(that._elements.reorderButtons[i]).on("mousedown",function(){var selectedId=that._elements.table.selectedItem.dataset.id;that._elements.table.off("coral-table:roworder").on("coral-table:roworder",function(event){that._markRowIndexes();var items=that._elements.table.items.getAll();var ordered=[];for(var i=0;i<items.length;i++)ordered.push(items[i].dataset.name);that._panelContainer.update(ordered).done(function(){ns.edit.EditableActions.REFRESH.execute(that._config.editable).done(function(){that._config.editable.overlay.setSelected(true);
var element=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(that._config.editable);that._panelContainer.setElement(element);that._navigate()})});if(event.detail.row.dataset.id===selectedId)event.detail.row.selected=true})});channel.off("cq-overlays-repositioned"+NS_PANELSELECTOR).on("cq-overlays-repositioned"+NS_PANELSELECTOR,function(){if(that._elements.popover)that._elements.popover.reposition()})},_handleOutOfAreaClick:function(event){var that=this;if(!$(event.target).closest(that._elements.popover).length)that._finish()},
_markRowIndexes:function(){var rows=this._elements.table.items.getAll();for(var i=0;i<rows.length;i++){var indexSpan=rows[i].querySelector(selectors.indexMarker);if(indexSpan)indexSpan.textContent=i+1}},_navigate:function(){var selectedItem=this._elements.table.selectedItem;if(selectedItem){var index=Array.prototype.slice.call(selectedItem.parentElement.children).indexOf(selectedItem);this._panelContainer.navigate(index)}},_unbindEvents:function(){var that=this;$(document).off("click"+NS_PANELSELECTOR);
that._elements.table.off("coral-table:change");for(var i=0;i<that._elements.reorderButtons.length;i++)$(that._elements.reorderButtons[i]).off("mousedown")},_finish:function(){var that=this;if(that._elements.popover&&that._elements.popover.parentNode){that._elements.popover.open=false;that._unbindEvents();that._elements.popover.parentNode.removeChild(that._elements.popover)}}});var panelSelect=new ns.ui.ToolbarAction({name:"PANEL_SELECT",text:Granite.I18n.get("Select panel"),icon:"multipleCheck",order:"before COPY",
execute:function(editable,param,target){if(!panelSelector||!panelSelector.isOpen())panelSelector=new PanelSelector({"editable":editable,"target":target[0]});return false},condition:function(editable){var isPanelContainer=false;var children=[];if(CQ&&CQ.CoreComponents&&CQ.CoreComponents.panelcontainer&&CQ.CoreComponents.panelcontainer.v1&&CQ.CoreComponents.panelcontainer.v1.utils){isPanelContainer=CQ.CoreComponents.panelcontainer.v1.utils.isPanelContainer(editable);children=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerItems(editable)}return children.length>
1&&isPanelContainer},isNonMulti:true});channel.on("cq-layer-activated",function(event){if(event.layer==="Edit")ns.EditorFrame.editableToolbar.registerAction("PANEL_SELECT",panelSelect)});function getTitle(editable,item,index){var title="\x3cspan class\x3d'foundation-layout-util-subtletext cmp-panelselector__indexMarker'\x3e"+index+"\x3c/span\x3e\x26nbsp;\x26nbsp;";var subTitle="";title=title+" "+Granite.I18n.getVar(ns.editableHelper.getEditableDisplayableName(editable));if(item)if(item[PN_PANEL_TITLE])subTitle=
item[PN_PANEL_TITLE];else if(item.title)subTitle=item.title;if(subTitle)title=title+": \x3cspan class\x3d'foundation-layout-util-subtletext'\x3e"+subTitle+"\x3c/span\x3e";return title}})(jQuery,Granite.author,jQuery(document),this);(function(){window.CQ=window.CQ||{};window.CQ.CoreComponents=window.CQ.CoreComponents||{};window.CQ.CoreComponents.panelcontainer=window.CQ.CoreComponents.panelcontainer||{};window.CQ.CoreComponents.panelcontainer.v1={}})();
(function($,ns,channel,window,undefined){var GET_DATA_SUFFIX=".model.json";var DATA_ITEMS_KEY=":items";var POST_SUFFIX=".container.html";var MESSAGE_ID="cmp.panelcontainer";var NAVIGATE_DELAY=200;CQ.CoreComponents.panelcontainer.v1.PanelContainer=ns.util.createClass({_config:{},_data:{},constructor:function PanelContainer(config){this._config=config;this.getItems()},navigate:function(index){if(this._config.panelContainerType){this._config.el.dataset["cmpPanelcontainerId"]=this._config.path;var data=
{id:this._config.path,type:this._config.panelContainerType.name,operation:"navigate",index:index};ns.ContentFrame.postMessage(MESSAGE_ID,data);setTimeout(function(){channel.trigger({type:"cmp-panelcontainer-navigated",id:data.id,index:data.index})},NAVIGATE_DELAY)}},getActiveIndex:function(){var that=this;var activeIndex=0;if(that._config.el&&that._config.panelContainerType){var items=$(this._config.el).find(that._config.panelContainerType.itemSelector);items.each(function(index){if($(this).is(that._config.panelContainerType.itemActiveSelector)){activeIndex=
index;return false}})}return activeIndex},getItems:function(){var that=this;var deferred=$.Deferred();if(that._data[DATA_ITEMS_KEY])deferred.resolve(that._data[DATA_ITEMS_KEY]);$.ajax({url:that._config.path+GET_DATA_SUFFIX}).done(function(data){if(data)that._data=data;var items=that._data[DATA_ITEMS_KEY]?that._data[DATA_ITEMS_KEY]:{};deferred.resolve(items)}).fail(function(){deferred.resolve([])});return deferred.promise()},getPath:function(){return this._config.path},setElement:function(element){this._config.el=
element},update:function(ordered,deleted){var url=this._config.path+POST_SUFFIX;return $.ajax({type:"POST",url:url,data:{"delete":deleted,"order":ordered}})}})})(jQuery,Granite.author,jQuery(document),this);
(function(){var registry=new Map;CQ.CoreComponents.panelcontainer.v1.registry={register:function(panelContainerType){if(panelContainerType!==null&&typeof panelContainerType==="object"&&panelContainerType.name)registry.set(panelContainerType.name,panelContainerType)},get:function(name){return registry.get(name)},getAll:function(){var values=[];registry.forEach(function(value,key,map){values.push(value)});return values}}})();
(function(ns){CQ.CoreComponents.panelcontainer.v1.utils={isPanelContainer:function(editable){var panelContainerType=getPanelContainerType(editable);return panelContainerType!==undefined},getPanelContainerType:function(editable){return getPanelContainerType(editable)},getPanelContainerHTMLElement:function(editable){var container=getPanelContainerType(editable);var element;if(container)if($(editable.dom[0]).is(container.selector))element=editable.dom[0];else{var children=editable.dom[0].children;for(var i=
0;i<children.length;i++){var child=children[i];if($(child).is(container.selector)){element=child;break}}}return element},getPanelContainerItems:function(editable){var children=[];var container=getPanelContainerType(editable);if(container)if(editable.isContainer())children=editable.getChildren().filter(isDisplayable);return children}};function getPanelContainerType(editable){var panelContainerType;var panelContainerTypes=CQ.CoreComponents.panelcontainer.v1.registry.getAll();if(editable&&editable.dom)for(var i=
0;i<panelContainerTypes.length;i++){var container=panelContainerTypes[i];var match=$(editable.dom[0]).is(container.selector);if(!match){var children=editable.dom[0].children;for(var j=0;j<children.length;j++){var child=children[j];match=$(child).is(container.selector);if(match)break}}if(match){panelContainerType=container;break}}return panelContainerType}function isDisplayable(editable){return editable instanceof ns.Editable&&(editable.isContainer()||editable.hasActionsAvailable()&&!editable.isNewSection())}
})(Granite.author);
(function($,ns,channel,window,undefined){CQ.CoreComponents.panelcontainer.v1.AFTER_CHILD_INSERT=function(childEditable){var editable=ns.editables.getParent(childEditable);var path=childEditable.path;var panelContainer;var isSelected=editable.overlay.isSelected();var panelContainerType=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerType(editable);if(panelContainerType)panelContainer=new CQ.CoreComponents.panelcontainer.v1.PanelContainer({path:editable.path,panelContainerType:panelContainerType,el:CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(editable)});
ns.edit.EditableActions.REFRESH.execute(editable).done(function(){var index=0;if(isSelected)editable.overlay.setSelected(true);var children=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerItems(editable);for(var i=0;i<children.length;i++)if(children[i].path===path){index=i;break}var element=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(editable);panelContainer.setElement(element);panelContainer.navigate(index)})};CQ.CoreComponents.panelcontainer.v1.AFTER_CHILD_DELETE=
function(childEditable){var editable=ns.editables.getParent(childEditable);var panelContainer;var panelContainerType=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerType(editable);if(panelContainerType)panelContainer=new CQ.CoreComponents.panelcontainer.v1.PanelContainer({path:editable.path,panelContainerType:panelContainerType,el:CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(editable)});var index=panelContainer.getActiveIndex()-1;ns.edit.EditableActions.REFRESH.execute(editable).done(function(){if(!(index<
0)){var element=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(editable);panelContainer.setElement(element);panelContainer.navigate(index)}})};CQ.CoreComponents.panelcontainer.v1.AFTER_CHILD_MOVE=function(){var editable=this;var panelContainer;var panelContainerType=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerType(editable);if(panelContainerType)panelContainer=new CQ.CoreComponents.panelcontainer.v1.PanelContainer({path:editable.path,panelContainerType:panelContainerType,
el:CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(editable)});var index=panelContainer.getActiveIndex()-1;ns.edit.EditableActions.REFRESH.execute(editable).done(function(){if(!(index<0)){var element=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(editable);panelContainer.setElement(element);panelContainer.navigate(index)}})}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var selectors={contentTree:".editor-ContentTree coral-tree"};channel.on("cmp-panelcontainer-navigated",function(event){var editables=ns.editables.find(event.id);if(editables.length)updatePanelContainerOverlayState(editables[0])});channel.on("cq-editor-loaded",function(event){var editables=ns.editables;for(var i=0;i<editables.length;i++){var editable=editables[i];if(CQ.CoreComponents.panelcontainer.v1.utils.isPanelContainer(editable))updatePanelContainerOverlayState(editable)}});
channel.on("cq-sidepanel-tab-switched",function(event){Coral.commons.nextFrame(function(){var $contentTree=$(selectors.contentTree);if($contentTree.length){var contentTree=$contentTree[0];contentTree.off("coral-tree:change.panelcontainer").on("coral-tree:change.panelcontainer",function(){var selectedItem=contentTree.selectedItem;if(selectedItem){var editable=ns.editables.find(selectedItem.value)[0];var editableParent=editable.getParent();var panelContainer;var panelContainerType=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerType(editableParent);
if(panelContainerType){panelContainer=new CQ.CoreComponents.panelcontainer.v1.PanelContainer({path:editableParent.path,panelContainerType:panelContainerType,el:CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(editableParent)});var index=Array.prototype.indexOf.call(selectedItem.parentElement.children,selectedItem);channel.one("cmp-panelcontainer-navigated",function(){editable.overlay.dom.focus();ns.selection.deselectAll();ns.selection.deactivateCurrent();ns.selection.select(editable);
ns.selection.activate(editable);var active=ns.selection.getCurrentActive();if(active)channel.trigger($.Event("cq-interaction-focus",{editable:active}))});panelContainer.navigate(index)}}})}})});function updatePanelContainerOverlayState(editable){var panelContainerType=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerType(editable);var panelContainer;if(panelContainerType)panelContainer=new CQ.CoreComponents.panelcontainer.v1.PanelContainer({path:editable.path,panelContainerType:panelContainerType,
el:CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerHTMLElement(editable)});var activeIndex=panelContainer.getActiveIndex();var items=CQ.CoreComponents.panelcontainer.v1.utils.getPanelContainerItems(editable);for(var i=0;i<items.length;i++)if(items[i].overlay)items[i].overlay.setDisabled(activeIndex!==i)}})(jQuery,Granite.author,jQuery(document),this);
(function(channel){channel.on("cq-editor-loaded",function(event){if(window.CQ&&window.CQ.CoreComponents&&window.CQ.CoreComponents.panelcontainer&&window.CQ.CoreComponents.panelcontainer.v1&&window.CQ.CoreComponents.panelcontainer.v1.registry)window.CQ.CoreComponents.panelcontainer.v1.registry.register({name:"cmp-carousel",selector:".cmp-carousel",itemSelector:"[data-cmp-hook-carousel\x3d'item']",itemActiveSelector:".cmp-carousel__item--active"})})})(jQuery(document));
(function(channel){channel.on("cq-editor-loaded",function(event){if(window.CQ&&window.CQ.CoreComponents&&window.CQ.CoreComponents.panelcontainer&&window.CQ.CoreComponents.panelcontainer.v1&&window.CQ.CoreComponents.panelcontainer.v1.registry)window.CQ.CoreComponents.panelcontainer.v1.registry.register({name:"cmp-accordion",selector:".cmp-accordion",itemSelector:"[data-cmp-hook-accordion\x3d'panel']",itemActiveSelector:"[data-cmp-hook-accordion\x3d'item'][data-cmp-expanded] [data-cmp-hook-accordion\x3d'panel']"})})})(jQuery(document));
(function(ns,window){ns.TargetingConstants={AMBIT_DEFAULT_NAME:"master",ENGINE_CONTEXTHUB:"cq_contexthub",ENGINE_TARGET:"tnt",OFFER_LIBRARY_DEFAULT_NAME:"offer-library",PARSYS_RT:"foundation/components/parsys",PARSYS_NEW_RT:"foundation/components/parsys/new",RESPONSIVEGRID_RT:"wcm/foundation/components/responsivegrid",RESPONSIVEGRID_NEW_RT:"wcm/foundation/components/responsivegrid/new",TARGET_COMPONENT_RTYPE:"cq/personalization/components/target",TARGET_PARSYS_RTYPE:"cq/personalization/components/targetparsys",
TARGET_PARSYS_END_RTYPE:"cq/personalization/components/targetparsys/end",TARGET_RESPONSIVEGRID_COMPONENT_RTYPE:"cq/personalization/components/target-responsivegrid",TARGET_RESPONSIVEGRID_RTYPE:"cq/personalization/components/targetresponsivegrid",TEASER_RT:"cq/personalization/components/teaser"}})(CQ,this);
(function($,channel,window){window.AudienceManagement=window.AudienceManagement||function(){var self={};self.audienceCreateGuard={};var _sendAudienceUpdateXHR=function(audience,tntConfig,audiencePath,successCallback,failCallback){if(self.audienceCreateGuard[audience.name])return;self.audienceCreateGuard[audience.name]=true;var audienceJson=JSON.stringify(audience);var windowUI=$(window).adaptTo("foundation-ui");windowUI.wait();$.ajax({type:"post",url:tntConfig+"/jcr:content.audienceupdate.json",contentType:"application/x-www-form-urlencoded",
data:{"audienceJson":audienceJson,"audiencePath":audiencePath,_charset_:"utf-8"},success:function(data,status,xhr){self.audienceCreateGuard[audience.name]=false;windowUI.clearWait();if(successCallback)successCallback.call()},error:function(xhr,status,error){self.audienceCreateGuard[audience.name]=false;windowUI.clearWait();if(failCallback)failCallback.call(self,xhr)}})};self.editTargetAudience=function(audience,tntConfig,audiencePath,successCallback,failCallback){_sendAudienceUpdateXHR(audience,tntConfig,
audiencePath,successCallback,failCallback)};self.createTargetAudience=function(audience,tntConfig,successCallback,failCallback){_sendAudienceUpdateXHR(audience,tntConfig,"",successCallback,failCallback)};return self}()})(jQuery,jQuery(document),this);
(function(global){function extendThis(){var i,ni,objects,object,prop;objects=arguments;for(i=0,ni=objects.length;i<ni;i++){object=objects[i];for(prop in object)this[prop]=object[prop]}return this}function makeApplier(method){return function(){return this[method].apply(this,arguments)}}function defineAndInheritProperties(Component,properties){var constructor,descriptor,property,propertyDescriptors,propertyDescriptorHash,propertyDescriptorQueue;Component.properties=properties;propertyDescriptorHash=
{};constructor=Component;do{if(constructor.properties)for(property in constructor.properties){propertyDescriptorQueue=propertyDescriptorHash[property]||(propertyDescriptorHash[property]=[]);propertyDescriptorQueue.unshift(constructor.properties[property])}constructor=constructor.superConstructor}while(constructor);propertyDescriptors={};for(property in propertyDescriptorHash){descriptor=propertyDescriptors[property]=extendThis.apply({},propertyDescriptorHash[property]);if(typeof descriptor.set===
"string")descriptor.set=makeApplier(descriptor.set);if(typeof descriptor.get==="string")descriptor.get=makeApplier(descriptor.get)}Component.properties=propertyDescriptors}var noop=function(){};var superTest=/xyz/.test(function(){return"xyz"})?/\._super\b/:{test:function(){return true}};var superifyDynamic=function(name,func,superPrototype){return function PseudoClass_setStaticSuper(){var previousSuper=this._super;this._super=superPrototype[name];var ret=func.apply(this,arguments);this._super=previousSuper;
return ret}};var superifyStatic=function(name,func,object){var _super=object[name];return function PseudoClass_setDynamicSuper(){this._super=_super;return func.apply(this,arguments)}};var mixin=function(properties,superPrototype){superPrototype=superPrototype||this.constructor&&this.constructor.prototype;for(var name in properties){var value=properties[name];if(name==="construct"||name==="destruct")continue;var usesSuper=superPrototype&&typeof value==="function"&&typeof superPrototype[name]==="function"&&
superTest.test(value);if(usesSuper)if(this.hasOwnProperty(name))this[name]=superifyStatic(name,value,this);else this[name]=superifyDynamic(name,value,superPrototype);else this[name]=value}};var PseudoClass=function(properties){if(properties&&properties.extend)return properties.extend.extend(properties);return PseudoClass.extend(properties)};PseudoClass.prototype.mixin=mixin;PseudoClass.extend=function extend(properties){function PseudoClass(){if(this instanceof PseudoClass===false)throw new Error("Cannot create instance without new operator");
var propertyDescriptors=PseudoClass.properties;if(propertyDescriptors)Object.defineProperties(this,propertyDescriptors);this.construct.apply(this,arguments);this.init()}var superConstructor=this;var superPrototype=this.prototype;PseudoClass.superConstructor=superConstructor;PseudoClass.extend=extend;var prototype=PseudoClass.prototype=Object.create(superPrototype);prototype.constructor=PseudoClass;prototype.superPrototype=superPrototype;if(properties){var propertyDescriptors=properties.properties;
delete properties.properties;mixin.call(prototype,properties,superPrototype);if(Array.isArray(properties.mixins))for(var i=0,ni=properties.mixins.length;i<ni;i++)mixin.call(prototype,properties.mixins[i],prototype);defineAndInheritProperties(PseudoClass,propertyDescriptors);if(properties.construct){var construct=properties.construct;if(superPrototype.construct)prototype.construct=function(){superPrototype.construct.apply(this,arguments);construct.apply(this,arguments)};else prototype.construct=construct}if(properties.destruct){var destruct=
properties.destruct;if(superPrototype.destruct)prototype.destruct=function(){destruct.apply(this,arguments);superPrototype.destruct.apply(this,arguments)};else prototype.destruct=destruct}if(typeof properties.toString==="string"){var className=properties.toString;prototype.toString=function(){return className}}}if(typeof prototype.construct!=="function")prototype.construct=noop;if(typeof prototype.init!=="function")prototype.init=noop;return PseudoClass};if(typeof module!=="undefined"&&module.exports)module.exports=
PseudoClass;else if(typeof global.define==="function")(function(define){define(function(){return PseudoClass})})(global.define);else{global.PseudoClass=PseudoClass;if(!global.Class)global.Class=PseudoClass}})(this);var F=F||{};try{window["\u0192"]=F}catch(err){console.log("\u0192: could not set \u0192 variable")}F.options={debug:false};_.extend(F,Backbone.Events);
F.extendView=function(component,properties){var view=component.prototype.View||component.prototype.ListView;if(view){properties.events=_.extend({},view.prototype.events,properties.events);return view.extend(properties)}};F.addToSet=function(obj,prop,value){if(typeof obj[prop]!=="undefined"){if(!_.isArray(obj[prop]))obj[prop]=[obj[prop]];obj[prop].push(value)}else obj[prop]=value};
F.set=function(obj,prop,value,makeArrays){if(!obj)obj={};var propParts=prop.split(".");if(propParts.length>1){var curObj=obj;propParts.forEach(function(part,index){if(index===propParts.length-1)if(makeArrays)F.addToSet(curObj,part,value);else curObj[part]=value;else{if(typeof curObj[part]==="undefined")curObj[part]={};curObj=curObj[part]}})}else if(makeArrays)F.addToSet(obj,prop,value);else obj[prop]=value;return obj};F.EventEmitter=new PseudoClass(Backbone.Events);
(function(){var delegateEventSplitter=/^(\S+)\s*(.*)$/;var getValue=function(object,prop){if(!(object&&object[prop]))return null;return _.isFunction(object[prop])?object[prop]():object[prop]};F.View=Backbone.View.extend({initialize:function(options){this.options=options;if(this.options.container!==undefined&&this.options.el!==undefined)throw new Error("View: should provide either options.el or options.container, never both");var template=this.template=this.options.template||this.template;this.render=
this.render.bind(this);if(this.options.el){var actualNodeName=this.$el[0].nodeName.toUpperCase();var requiredNodeName=this.tagName.toUpperCase();if(this.tagName!=="div"&&actualNodeName!==requiredNodeName)throw new Error("View: cannot create view, incorrect tag provided. Expected "+requiredNodeName+", but got "+actualNodeName);this.$el.addClass(this.className)}this.container=this.options.container;this.component=this.options.component;if(this.options.events)this.delegateEvents(this.options.events);
if(this.options.model)this.setModel(this.options.model);this.rendered=null},setModel:function(model){if(this.model&&this.model.off)this.stopListening(this.model);this.model=model;var noRerender=this.options.noRerender||this.options.component&&this.options.component.options.noRerender;if(this.model&&this.model.on&&!noRerender)this.listenTo(this.model,"change",this.render);this.rendered=null},age:function(){return this.rendered!==null?(new Date).getTime()-this.rendered:-1},remove:function(){this.$el.remove();
if(this.model&&this.model.off)this.stopListening()},show:function(){if(this.template)this.renderOnce();this.$el.show();return this},hide:function(){this.$el.hide();return this},renderOnce:function(){if(this.rendered===null)this.render();return this},inDebugMode:function(){return F.options.debug||this.component&&this.component.options.debug},render:function(){if(this.inDebugMode())console.log("%s: Rendering view...",this.component&&this.component.toString()||"Orphaned view");if(this.template){var model=
this.model||this.component&&this.component.model;this.$el.html(this.template(model&&model.toJSON&&model.toJSON()||model||{}))}if(this.container&&!$(this.el.parentNode).is(this.container))$(this.container).append(this.el);this.rendered=(new Date).getTime();this.trigger("renderComplete");return this},delegateEvents:function(events){if(!(events||(events=getValue(this,"events"))))return;this.undelegateEvents();for(var key in events){var method=events[key];var base=this.component;if(!_.isFunction(method))if(this.component){var parts=
events[key].split(".");if(parts.length>1){method=this.component;for(var i=0;i<parts.length;i++){var part=parts[i];base=method;method=method[part];if(!method)break}}else method=this.component[events[key]]}else method=this[events[key]];if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=this.component?_.bind(method,base):_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===
"")this.$el.bind(eventName,method);else this.$el.delegate(selector,eventName,method)}return this}})})();
(function(){function decapitalize(str){return str.slice(0,1).toLowerCase()+str.slice(1)}F.Component=new PseudoClass({toString:"Component",extend:F.EventEmitter,options:{singly:false,visible:false,debug:false,independent:false},construct:function(options){this.mergeOptions(options);this.components={};this._bubbledEvts={};this.bind("_handleSubComponentShown");this.bind("render")},init:function(){if(this.view){if(this.view.el)if(this.options.visible===true)this.show({silent:true});else this.view.$el.hide();
else console.warn("Component %s has a view without an element",this.toString,this,this.view,this.view.options);var self=this;this.listenTo(this.view,"renderComplete",function(){if(typeof this.handleRenderComplete==="function")this.handleRenderComplete();this.teardownIfSetup();this.setupIfNotSetup();self.trigger("view:rendered",{component:self,view:self.view})})}},destruct:function(){if(this.view)this.view.remove();this.teardownIfSetup();this.removeComponents();this.stopListening();delete this.components},
render:function(){if(this.view)this.view.render();if(!this.isVisible())this.view.$el.hide();return this},bind:function(name){if(typeof this[name]==="function")this[name]=this[name].bind(this)},unbind:undefined,bubble:function(componentName,evt){if(!this[componentName]){console.error("%s: cannot set event '%s' for bubbling from component '%s', component does not exist",this.toString(),evt,componentName);return this}if(!this._bubbledEvts[componentName])this._bubbledEvts[componentName]={};var handler=
this._bubbledEvts[componentName][evt]=function(){var args=Array.prototype.slice.call(arguments);args.unshift(evt);this.trigger.apply(this,args)}.bind(this);this[componentName].on(evt,handler);return this},unbubble:function(componentName,evt){if(!this._bubbledEvts[componentName]||!this._bubbledEvts[componentName][evt]){console.warn("%s: cannot discontinue bubbling of event '%s' for component '%s', event was not set for bubbling",this.toString(),evt,componentName);return this}this[componentName].off(evt,
this._bubbledEvts[componentName][evt]);return this},addComponent:function(component,componentName){if(componentName)componentName=decapitalize(componentName);else componentName=decapitalize(component.toString());component.setName(componentName);this[componentName]=this.components[componentName]=component;component.parent=this;this.listenTo(component,"component:shown",this._handleSubComponentShown);return component},removeComponent:function(componentName){var component=this.components[componentName];
if(component!==undefined){this.stopListening(component);delete this[componentName];delete this.components[componentName];if(typeof component.destruct==="function")component.destruct()}return this},removeComponents:function(){for(var componentName in this.components)this.removeComponent(componentName);return this},_handleSubComponentShown:function(evt){var subComponent=this.components[evt.name];if(subComponent!==undefined){if(this.options.singly&&!subComponent.options.independent){this.hideAllSubComponents([evt.name]);
this.currentSubComponent=subComponent}this.trigger("subComponent:shown",{name:evt.name,component:subComponent})}},show:function(options){options=options||{};if(this.inDebugMode())if(this.isVisible())console.log("%s: not showing self; already visible",this.toString());else console.log("%s: showing self",this.toString());if(!options.silent)this.trigger("component:shown",{name:this.toString(),component:this});if(this.view)this.view.show();this.setupIfNotSetup();this.options.visible=true;return this},
hide:function(options){options=options||{};if(!this.isVisible())return false;if(this.inDebugMode())console.log("%s: hiding self",this.toString());if(this.view)this.view.hide();if(!options.silent)this.trigger("component:hidden",{name:this.toString(),component:this});this.teardownIfSetup();if(this.options.hideChildren!==false)this.hideAllSubComponents();this.options.visible=false;return this},teardownIfSetup:function(){if(this.options.isSetup&&typeof this.teardown==="function"){this.teardown();this.options.isSetup=
false}},setupIfNotSetup:function(){if(!this.options.isSetup&&typeof this.setup==="function"){this.setup();this.options.isSetup=true}},inDebugMode:function(){return this.options.debug||F.options.debug},isVisible:function(){return this.options.visible},showAllSubComponents:function(except){except=_.isArray(except)?except:false;for(var componentName in this.components){if(except&&~except.indexOf(componentName))continue;this.components[componentName].show()}return this},hideAllSubComponents:function(except){except=
_.isArray(except)?except:false;for(var componentName in this.components){if(except&&~except.indexOf(componentName))continue;this.components[componentName].hide()}return this},setName:function(customName){this.toString=function(){return customName};return this},setPropsFromOptions:function(options,props){_.each(props,function(prop){this[prop]=options[prop]||this[prop];delete options[prop]}.bind(this));return this},mergeOptions:function(options){var optionSets=[];var proto=this.constructor.prototype;
while(proto){if(proto.hasOwnProperty("options"))optionSets.unshift(proto.options);proto=proto.superPrototype}optionSets.unshift({});if(options)optionSets.push(options);this.options=_.extend.apply(_,optionSets)}})})();
F.ModelComponent=new PseudoClass({toString:"ModelComponent",extend:F.Component,construct:function(options){this.Model=this.Model||options.Model},Model:Backbone.Model,refresh:function(callback){this.trigger("model:loading",{model:this.model});this.model.fetch({success:function(model,response){var trigger=true;if(typeof this.handleLoadSuccess==="function")trigger=this.handleLoadSuccess(this.model,response)===false?false:true;if(trigger){this.model.trigger("loaded");this.trigger("model:loaded",{model:this.model});
if(typeof callback==="function")callback.call(this,this.model)}}.bind(this),error:function(model,response){console.warn("%s: Error loading model",this.toString());this.trigger("model:loadFailed",{model:this.model,response:response});if(typeof this.handleLoadError==="function")this.handleLoadError(this.model,response)}.bind(this)});return this},_setModel:function(model){this.model=model;if(this.model&&this.model.off&&this.view)this.view.setModel(model);if(this.model&&this.model.on)this.listenTo(this.model,
"change",this._triggerChange);return this},_triggerChange:function(){this.trigger("model:changed",{model:this.model})},fetch:function(itemId,callback){var data={};if(itemId!==undefined)data[this.Model.prototype.idAttribute]=itemId;this.trigger("model:loading",{model:this.model});var model=new this.Model(data);model.fetch({success:function(model,response){this._setModel(model);var trigger=this._handleLoadComplete(response);if(trigger)if(typeof callback==="function")callback.call(this,this.model)}.bind(this),
error:function(model,response){console.warn("%s: Error loading model",this.toString());this.trigger("model:loadFailed",{model:this.model,response:response});if(typeof this.handleLoadError==="function")this.handleLoadError(this.model,response)}.bind(this)});return this},_handleLoadComplete:function(response){var trigger=true;if(typeof this.handleLoadSuccess==="function")trigger=this.handleLoadSuccess(this.model,response||{local:true})===false?false:true;if(trigger)this.trigger("model:loaded",{model:this.model});
return trigger},load:function(modelOrData){if(modelOrData instanceof Backbone.Model)this._setModel(modelOrData);else this._setModel(new this.Model(modelOrData));this._handleLoadComplete();return this},save:function(data,callback,options){if(this.model){if(this.inDebugMode())console.log("%s: Saving...",this.toString());this.trigger("model:saving",{model:this.model});this.model.save(data||{},_.extend({success:function(model,response){if(this.inDebugMode())console.log("%s: Save successful",this.toString());
if(typeof callback==="function")callback.call(this,null,this.model,response);if(typeof this.handleSaveSuccess==="function")this.handleSaveSuccess(this.model,response);this.trigger("model:saved",{model:this.model,response:response})}.bind(this),error:function(model,response){console.warn("%s: Error saving model",this.toString());if(typeof callback==="function")callback.call(this,new Error("Error saving model"),this.model,response);if(typeof this.handleSaveError==="function")this.handleSaveError(this.model,
response);this.trigger("model:saveFailed",{model:this.model,response:response})}.bind(this)},options))}else console.warn("%s: Cannot save, model is not truthy",this.toString());return this},show:function(options){options=options||{};if(options.id){if(this.inDebugMode())console.log("%s: fetching item with ID %s",this.toString(),options.id);this.fetch(options.id,function(model){if(this.inDebugMode())console.log("%s: fetch complete!",this.toString());this.show({silent:options.silent})})}else if(options.model){if(this.inDebugMode())console.log("%s: showing with new model",
this.toString(),options.model);this.load(options.model);this.show({silent:options.silent})}else this._super.apply(this,arguments);return this}});
F.CollectionComponent=new PseudoClass({toString:"CollectionComponent",extend:F.Component,options:{defaultParams:{}},construct:function(options){this.bind("addModel");this.bind("removeModel");this.bind("render");this._useCollection(options.collection||new this.Collection);this.collectionLoaded=!!options.collection},destruct:function(){this._releaseCollection()},Collection:Backbone.Collection,_useCollection:function(collection){this.collection=collection;this.listenTo(this.collection,"add",this.addModel);
this.listenTo(this.collection,"remove",this.removeModel);this.listenTo(this.collection,"loaded",this.render)},_releaseCollection:function(){this.stopListening(this.collection);this.collection=null},refresh:function(callback){this.fetch(this.params,callback);return this},addModel:function(model){},removeModel:function(model){},clearParams:function(){this.params={};return this},fetch:function(fetchParams,callback){if(fetchParams)this.params=_.extend({},this.options.defaultParams,fetchParams);else this.params=
_.extend({},this.options.defaultParams);this.trigger("collection:loading",this.collection);this.collection.fetch({data:this.params,success:function(){if(!this.collection)return;this.collection.trigger("loaded");this.trigger("collection:loaded",this.collection);this.collectionLoaded=true;if(typeof callback==="function")callback.call(this,this.collection)}.bind(this)});return this},load:function(collectionOrData){this._releaseCollection();if(collectionOrData instanceof Backbone.Collection)this._useCollection(collectionOrData);
else this._useCollection(new this.Collection(collectionOrData));return this},show:function(options){options=options||{};if(options.params)this.fetch(options.params,function(){this.show({silent:options.silent})});else if(!this.collectionLoaded)this.refresh(function(){this.show({silent:options.silent})});else this._super.apply(this,arguments);return this}});
(function(){var FormView=F.View.extend({tagName:"form",events:{"submit":"handleSubmit"}});F.FormComponent=new PseudoClass({toString:"FormComponent",extend:F.ModelComponent,construct:function(options){this.view=new this.View(_.extend({component:this,template:this.Template},options));this.model=new this.Model;this.bind("handleSubmit")},View:FormView,Template:null,clear:function(){this._setModel(new this.Model);var trigger=true;if(typeof this.handleLoadSuccess==="function")this.handleLoadSuccess(this.model);
this.render();return this},doBlur:function(){var $button=this.view.$('[type\x3d"submit"], button').filter(":visible").last().focus();setTimeout(function(){$button.blur()},10)},handleSubmit:function(evt){this.doBlur();if(evt&&evt.preventDefault)evt.preventDefault();this.saveForm()},extractValuesFromForm:function(){var $form=this.view.$el;if(this.view.el.tagName!=="FORM")$form=this.view.$("form");var fields=$form.filter(':not([data-serialize\x3d"false"])').serializeArray();var data={};_.each(fields,
function(field){F.set(data,field.name,field.value,true)});return data},setValuesFromForm:function(){this.model.set(this.extractValuesFromForm())},saveForm:function(callback){this.save(this.extractValuesFromForm(),callback)}})})();
(function(){var ListView=F.View.extend({tagName:"ul",initialize:function(options){options=options||{};F.View.prototype.initialize.apply(this,arguments);this.ItemView=options.ItemView||this.ItemView;this.ItemTemplate=options.ItemTemplate||this.ItemTemplate;this.subViews=[];this.addSubView=this.addSubView.bind(this)},addSubView:function(model){if(!this.rendered)return;var view=new this.ItemView({model:model,template:this.ItemTemplate,component:this.component});view.render();if(this.options.ListContainer)this.$(this.options.ListContainer).append(view.el);
else this.$el.append(view.el);view.$el.data("viewIndex",this.subViews.length);this.subViews.push(view)},remove:function(){this.removeSubViews();F.View.prototype.remove.call(this,arguments)},removeSubView:function(modelOrViewIndex){if(!this.rendered)return;var view=null;var viewIndex=-1;if(typeof viewIndex!=="Number")_.some(this.subViews,function(tmpView,index){if(tmpView&&tmpView.model===modelOrViewIndex){view=tmpView;viewIndex=index}}.bind(this));else view=this.subViews[viewIndex];if(view){view.remove();
this.subViews[viewIndex]=undefined}},removeSubViews:function(){if(this.subViews.length){_.each(this.subViews,function(view){if(view)view.remove()});this.subViews=[]}},show:function(){this.renderOnce();this.$el.show()},render:function(){if(this.inDebugMode())console.log("%s: rendering list view...",this.component&&this.component.toString()||"List view");if(this.container&&!$(this.el.parentNode).is(this.container))$(this.container).append(this.el);if(this.rendered===null){if(this.template)this.$el.html(this.template({}));
this.rendered=(new Date).getTime()}this.removeSubViews();this.component.collection.each(this.addSubView);if(this.component.collection.isEmpty()){var EmptyView=this.ItemView;var emptyTemplate;if(!this.component.params||_.isEqual(this.component.params,this.component.options.defaultParams)&&this.component.ListEmptyTemplate){emptyTemplate=this.component.ListEmptyTemplate;if(this.component.ListEmptyView)EmptyView=this.component.ListEmptyView}else if(this.component.NoResultsTemplate){emptyTemplate=this.component.NoResultsTemplate;
if(this.component.NoResultsView)EmptyView=this.component.NoResultsView}if(emptyTemplate){var view=(new EmptyView({template:emptyTemplate,component:this.component,model:this.component.params})).render();if(this.options.ListContainer)this.$(this.options.ListContainer).append(view.el);else this.$el.append(view.el);this.subViews.push(view)}}this.rendered=(new Date).getTime();this.trigger("renderComplete");return this}});var ItemView=F.View.extend({tagName:"li",className:"listItem"});F.ListComponent=new PseudoClass({toString:"ListComponent",
extend:F.CollectionComponent,construct:function(options){this.view=new this.ListView(_.extend({component:this,template:this.ListTemplate,ItemView:this.ItemView,ItemTemplate:this.ItemTemplate,ListContainer:this.ListContainer,events:_.extend({},{"click li":"handleSelect"},this.ListView.prototype.events)},options));this.selectedItem=null},Collection:Backbone.Collection,NoResultsTemplate:null,NoResultsView:null,ListEmptyView:null,ListEmptyTemplate:null,ListTemplate:null,ListView:ListView,ItemTemplate:null,
ItemView:ItemView,addModel:function(model){this.view.addSubView(model)},removeModel:function(model){this.view.removeSubView(model)},getModelFromLi:function(listItem){var viewIndex=$(listItem).data("viewIndex");return viewIndex!==undefined&&this.view.subViews[viewIndex]&&this.view.subViews[viewIndex].model||null},getViewFromLi:function(listItem){return this.view.subViews[$(listItem).data("viewIndex")]},handleSelect:function(evt){var model=this.getModelFromLi(evt.currentTarget);if(model){this.selectedItem=
model.id;this.trigger("list:itemSelected",{listItem:$(evt.currentTarget),model:model})}}})})();Handlebars.registerHelper("appendck",function(imageSrc){if(!_.isString(imageSrc))throw new Error("Handlebars#appendck expects string as image source.");return imageSrc+"?ch_ck\x3d"+moment().unix()});Handlebars.registerHelper("subtract",function(lvalue,rvalue){if(arguments.length<3)throw new Error("Handlebars#subtract needs 2 parameters");return parseFloat(lvalue)-parseFloat(rvalue)});
Handlebars.registerHelper("divide",function(dividend,divisor){if(arguments.length<3)throw new Error("Handlebars#divide needs 2 parameters");return parseFloat(dividend)/parseFloat(divisor)});Handlebars.registerHelper("equals",function(lvalue,rvalue,options){if(arguments.length<3)throw new Error("Handlebars#equals needs 2 parameters");if(lvalue!=rvalue)return options.inverse(this);return options.fn(this)});
Handlebars.registerHelper("and",function(value1,value2,options){if(arguments.length<3)throw new Error("Handlebars#and needs 2 parameters");if(value1&&value2)return options.fn(this);return options.inverse(this)});Handlebars.registerHelper("gt",function(lvalue,rvalue,options){if(arguments.length<3)throw new Error("Handlebars#gt needs 2 parameters");if(lvalue>rvalue)return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("lt",function(lvalue,rvalue,options){if(arguments.length<3)throw new Error("Handlebars#lt needs 2 parameters");if(lvalue<rvalue)return options.fn(this);return options.inverse(this)});Handlebars.registerHelper("gte",function(lvalue,rvalue,options){if(arguments.length<3)throw new Error("Handlebars#gte needs 2 parameters");if(lvalue>=rvalue)return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("lte",function(lvalue,rvalue,options){if(arguments.length<3)throw new Error("Handlebars#lte needs 2 parameters");if(lvalue<=rvalue)return options.fn(this);return options.inverse(this)});Handlebars.registerHelper("inRange",function(variable,lvalue,rvalue,options){if(arguments.length<4)throw new Error("Handlebars#inRange needs 3 parameters");if(parseFloat(lvalue)<=variable&&variable<=parseFloat(rvalue))return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("notInRange",function(variable,lvalue,rvalue,options){if(arguments.length<4)throw new Error("Handlebars#notInRange needs 3 parameters");if(variable<parseFloat(lvalue)||variable>parseFloat(rvalue))return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("eachString",function(str,separator,options){if(arguments.length<3)throw new Error("Handlebars#eachString needs 2 parameters.");if(typeof str==="string")return Handlebars.helpers.each.call(this,str.split(separator),options)});
Handlebars.registerHelper("number",function(context,decPlaces){var locale=TSDK.I18n.getLocale(),groupSeparator=",",commaDecimalSeparator=["de","es","fr","it","pt"],dotGroupSeparator=["de","es","it","pt"],spaceGroupSeparator=["fr"];if(context.fn&&typeof context.fn==="function")context=context.fn(this);if(_.isNumber(context)&&_.isNumber(decPlaces))context=context.toFixed(decPlaces);if(dotGroupSeparator.indexOf(locale)!=-1)groupSeparator=".";else if(spaceGroupSeparator.indexOf(locale)!=-1)groupSeparator=
" ";context=context.toString();if(commaDecimalSeparator.indexOf(locale)!=-1)context=context.split(".").join(",");while(/(\d+)(\d{3})/.test(context))context=context.replace(/(\d+)(\d{3})/,"$1"+groupSeparator+"$2");return context||"---"});Handlebars.registerHelper("formatPercent",function(context,options){var fixed=options.hash.fixed||2;return(context*100).toFixed(fixed)+"%"});
Handlebars.registerHelper("getDate",function(ISOFormattedDate,options){var format=options.hash.format,comment=options.hash.comment,dateFormat=TSDK.I18n.get("YYYY-MM-DD",null,"Date format pattern for moment.js. e.g. 2013-11-13 (http://momentjs.com/docs)");if(format)dateFormat=TSDK.I18n.getVar(format,comment);if(!ISOFormattedDate)return moment().format(dateFormat);return moment(ISOFormattedDate).format(dateFormat)});
Handlebars.registerHelper("getTime",function(ISOFormattedDate,options){var format=options.hash.format,comment=options.hash.comment,timeFormat=TSDK.I18n.get("HH:mm",null,"Time format pattern for moment.js. e.g. 12:48 (http://momentjs.com/docs)");if(format)timeFormat=TSDK.I18n.getVar(format,comment);if(!ISOFormattedDate)return moment().format(timeFormat);return moment(ISOFormattedDate).format(timeFormat)});
Handlebars.registerHelper("getActivityPriority",function(priority){if(priority===0)return TSDK.I18n.get("Low");if(priority===1)return TSDK.I18n.get("Medium");if(priority===2)return TSDK.I18n.get("High");return priority});Handlebars.registerHelper("toCapitalCase",function(value){if(value&&typeof value==="string")return value.substring(0,1).toUpperCase()+value.substring(1).toLowerCase();return""});
Handlebars.registerHelper("toLowerCase",function(value){if(value&&typeof value==="string")return value.toLowerCase();return""});Handlebars.registerHelper("toUpperCase",function(value){if(value&&typeof value==="string")return value.toUpperCase();return""});Handlebars.registerHelper("getDays",function(daysCount){if(daysCount&&typeof daysCount==="number")return TSDK.I18n.get("{0} {1}",[daysCount,"day(s)"]);return""});
Handlebars.registerHelper("i18n",function(){var params=Array.prototype.slice.call(arguments,0);var options=params.pop();var rawMessage=Array.prototype.shift.call(params);var i18nParams=[rawMessage];if(typeof options.fn==="function")params=[options.fn(this)];i18nParams.push(params);if(typeof options.hash.comment==="string")i18nParams.push(options.hash.comment);var translated=TSDK.I18n.get.apply(this,i18nParams)||"";if(options.hash.html)return new Handlebars.SafeString(translated);return translated});
Handlebars.registerHelper("notEquals",function(lvalue,rvalue,options){if(arguments.length<3)throw new Error("Handlebars#notEquals needs 2 parameters");if(lvalue==rvalue)return options.inverse(this);return options.fn(this)});Handlebars.registerHelper("each_with_index",function(array,fn){var buffer="",arrayLength=array.length;for(var i=0,j=arrayLength;i<j;i++){var item=array[i];item.index=i;buffer+=typeof fn=="object"?fn.fn(item):fn(item)}return buffer});
Handlebars.registerHelper("each_reverse",function(context,options){var contextLength,ret="",data,i;if(context instanceof Array){if(options.data)data=Handlebars.createFrame(options.data);contextLength=context.length;for(i=contextLength-1;i>=0;i--){if(data){data.index=contextLength-i-1;data.reverseIndex=i}ret+=options.fn(context[i],{data:data})}}if(contextLength)return ret;return options.inverse(this)});
Handlebars.registerHelper("getIconById",function(id){if(id&&id.lastIndexOf("/")>-1)id=id.substring(id.lastIndexOf("/")+1);var map={"firefox":"icon-devicemobile","internet_explorer":"icon-devicemobile","chrome":"icon-devicemobile","safari":"icon-devicemobile","windows":"icon-windows8","mac":"icon-apple","linux":"icon-linux","mobile":"icon-devicemobile","tablet":"icon-devicetablet","desktop":"icon-devicedesktop","google":"icon-merge","bing":"icon-merge","yahoo":"icon-merge","returning_visitors":"icon-users",
"new_visitors":"icon-users","all_visitors":"icon-demographic","us_returning_male":"icon-demographic","us_female":"icon-demographic"};if(map.hasOwnProperty(id))return map[id];return"icon-users"});
Handlebars.registerHelper("getValueFromObj",function(obj,field,options){if(arguments.length<2)throw new Error("Handlebars#getValueFromObj needs 2 parameters");obj=obj||{};var value=obj[field],isNotDefined=_.isUndefined(value)||_.isNull(value)||_.isNaN(value),isEmptyString=typeof value==="string"&&_.isEmpty(value);if(typeof options.fn==="function")return isNotDefined||isEmptyString?options.inverse({}):options.fn(value);return value||"---"});
Handlebars.registerHelper("hasValue",function(array,value,options){if(arguments.length<3)throw new Error("Handlebars#hasValue needs 2 parameters");if(array&&array.indexOf(value)!=-1)return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("buildMetricsMeasurementDisplayRule",function(action,array){if(arguments.length<2)throw new Error("Handlebars#buildMetricsMeasurementDisplayRule needs 2 parameters");if(action==="elementClick")return TSDK.I18n.get("Clicked an element");if(action==="clickRecommendation")return TSDK.I18n.get("Clicked on recommendation");var orConjunction=TSDK.I18n.get("or"),arrayLength=array.length,pageEnumeration="";for(var index=0;index<arrayLength;index++){if(index)pageEnumeration+=" "+
orConjunction+" ";pageEnumeration+=array[index].term}if(action==="pageView")return TSDK.I18n.get("Viewing of page {0}",_.escape(pageEnumeration));else if(action==="mboxView")return TSDK.I18n.get("Viewing of mbox {0}",_.escape(pageEnumeration))});
Handlebars.registerHelper("isActivityUpdating",function(status,targetSyncPending,options){if(arguments.length<2)throw new Error("Handlebars#isActivityUpdating needs 2 parameters");var statusCriteria=[ELM.Activities.status.SYNCING,ELM.Activities.status.ACTIVATING,ELM.Activities.status.DEACTIVATING];if(targetSyncPending||_.contains(statusCriteria,status))return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("activitySyncFailed",function(syncRoot,options){if(arguments.length<1)throw new Error("Handlebars#activitySyncFailed needs 1 parameter");if(syncRoot.targetSyncFailed&&!syncRoot.targetSyncPending)return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("join",function(array,separator){if(arguments.length<2)throw new Error("Handlebars#join needs 1 or 2 parameters.");if(typeof separator!=="string")separator=", ";if(_.isArray(array))return array.join(separator).replace(/(\\r\\n|\\n|\\r)/g,"\n");return""});
Handlebars.registerHelper("in",function(value){var numOfArgs=arguments.length,options;if(numOfArgs<3)throw new Error("Handlebars#in needs at least 2 parameters.");options=arguments[numOfArgs-1];for(var i=1;i<numOfArgs-1;i++)if(value===arguments[i])return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("notIn",function(value){var numOfArgs=arguments.length,options;if(numOfArgs<3)throw new Error("Handlebars#notIn needs at least 2 parameters.");options=arguments[numOfArgs-1];for(var i=1;i<numOfArgs-1;i++)if(value===arguments[i])return options.inverse(this);return options.fn(this)});
Handlebars.registerHelper("formatEstimatedValue",function(value,decPlaces){if(_.isNumber(value)){var ONE_MILLION=1E6,ONE_THOUSAND=1E3,currencySymbol=Handlebars.helpers.getCurrencySymbol.call(this);if(value/ONE_MILLION>1){value=value/ONE_MILLION;value=Handlebars.helpers.number.call(this,value,decPlaces);value=TSDK.I18n.get("{0}{1}M",[currencySymbol,value],"{0} argument is currency symbol, {1} argument is number and M is symbol for millions")}else if(value/ONE_THOUSAND>1){value=value/ONE_THOUSAND;value=
Handlebars.helpers.number.call(this,value,decPlaces);value=TSDK.I18n.get("{0}{1}K",[currencySymbol,value],"{0} argument is currency symbol, {1} argument is number and K is symbol for thousands")}else value=TSDK.I18n.get("\x3c{0}1K",currencySymbol,"Estimated lift is less than one thousand. {0} argument is currency symbol")}return value||"---"});
Handlebars.registerHelper("formatRevenue",function(value){if(_.isNumber(value)){var ONE_QUINTILLION=1E18,ONE_QUADRILLION=1E15,ONE_TRILLION=1E12,ONE_BILLION=1E9,ONE_MILLION=1E6,TEN_THOUSAND=1E4,HUNDRED_THOUSAND=1E5,ONE_THOUSAND=1E3;var symbol="";var roundplaces=2;if(value>=HUNDRED_THOUSAND)roundplaces=1;else roundplaces=2;if(value>=ONE_QUINTILLION){value=value/ONE_QUINTILLION;symbol="E"}else if(value>=ONE_QUADRILLION){symbol="P";value=value/ONE_QUADRILLION}else if(value>=ONE_TRILLION){symbol="T";value=
value/ONE_TRILLION}else if(value>=ONE_BILLION){symbol="B";value=value/ONE_BILLION}else if(value>=ONE_MILLION){symbol="M";value=value/ONE_MILLION}else if(value>=TEN_THOUSAND){symbol="K";value=value/ONE_THOUSAND}value=Handlebars.helpers.RoundNumber.call(null,value,roundplaces);return value+symbol}return value});Handlebars.registerHelper("RoundNumber",function(value,places){if(_.isNumber(value))value=+(Math.round(value+"e+"+places)+"e-"+places);return value});
Handlebars.registerHelper("getCurrencySymbol",function(){return ELM.CurrencySymbol[ELM.clientLocale]||"$"});Handlebars.registerHelper("getActivityDisplayType",function(value,size){if(arguments.length<1)throw new Error("Handlebars#getActivityDisplayType needs at least 1 parameter");if(size==="short")return ELM.Activities.activityDisplayTypes[value].shortText;return ELM.Activities.activityDisplayTypes[value].longText});
Handlebars.registerHelper("ifEither",function(lvar,lvalue,rvar,rvalue,options){if(lvar===lvalue||rvar===rvalue)return options.fn(this);return options.inverse(this)});Handlebars.registerHelper("ifNeither",function(lvar,lvalue,rvar,rvalue,options){if(lvar!==lvalue&&rvar!==rvalue)return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("ifNotAfter",function(arrayLength,currentIndex,options){if(arguments.length<2)throw new Error("Handlebars#ifNotAfter needs 2 parameters");if(arrayLength-currentIndex<=1)return options.fn(this);return options.inverse(this)});Handlebars.registerHelper("ifNotBefore",function(currentIndex,options){if(arguments.length<1)throw new Error("Handlebars#ifNotBefore needs 1 parameters");if(currentIndex<1)return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("getTemplateTestingCriteriaParameter",function(param,type,subParam){if(arguments.length<2)throw new Error("Handlebars#getTemplateTestingCriteriaParameter needs 2 parameters.");var value;if(type==="MBOX")return"mBox Parameter "+param;else if(typeof param==="string"){value=param.substring(param.lastIndexOf(".")+1);if(typeof subParam==="string"&&subParam)value=value+" parameter "+subParam;return value}});
Handlebars.registerHelper("getTemplateTestingCriteriaOperator",function(value){if(arguments.length<1)throw new Error("Handlebars#getTemplateTestingCriteriaOperator needs 1 parameter.");var map={"containsIgnoreCase":TSDK.I18n.get("contains"),"doesNotContainIgnoreCase":TSDK.I18n.get("does not contain"),"equals":TSDK.I18n.get("is (case sensitive)"),"doesNotEqualIgnoreCase":TSDK.I18n.get("is not")};if(map.hasOwnProperty(value))return map[value];return value});
Handlebars.registerHelper("getExperiencesCount",function(activityModel){var count=1,offers,offersLength;if(arguments.length<1)throw new Error("Handlebars#getExperiencesCount needs 1 parameter.");var locations=activityModel["locations"],exclusions=activityModel["exclusions"];if(activityModel["activityType"]==="MVT")return activityModel["experiences"].length-exclusions;_.each(locations,function(location){offers=location["offers"];offersLength=offers.length;if(offers&&offersLength)if(offers[0]["included"])count*=
offersLength;else count*=offersLength-1});return count-exclusions.length/locations.length});Handlebars.registerHelper("add",function(lvalue,rvalue){if(arguments.length<3)throw new Error("Handlebars#add needs 2 parameters");return parseFloat(lvalue)+parseFloat(rvalue)});
Handlebars.registerHelper("getControlExperienceType",function(type){if(arguments.length<1)throw new Error("Handlebars#getControlExperienceType needs 1 parameter.");var map={"random":TSDK.I18n.get("Random Experiences"),"default_content":TSDK.I18n.get("Default Experience"),"custom":TSDK.I18n.get("Selected Experience")};return map[type]});
Handlebars.registerHelper("getOneToOneOffer",function(locations,locationIndex,offerIndex){if(arguments.length<3)throw new Error("Handlebars#getOneToOneOffer needs 3 parameters.");return locations[locationIndex].offers[offerIndex]["jcr:title"]});Handlebars.registerHelper("getOneToOneLocation",function(locations,locationIndex){if(arguments.length<2)throw new Error("Handlebars#getOneToOneLocation needs 2 parameters.");return locations[locationIndex]["jcr:title"]});
Handlebars.registerHelper("getOneToOneOffer",function(locations,locationIndex,offerIndex){if(arguments.length<3)throw new Error("Handlebars#getOneToOneOffer needs 3 parameters.");return locations[locationIndex].offers[offerIndex]["jcr:title"]});
Handlebars.registerHelper("getOneToOneAlgorithmPercentage",function(controlPercentage,algorithmsCount,algorithmIndex){var totalAlgorithmPercentage=100-controlPercentage,algorithmPercentage;if(arguments.length<2)throw new Error("Handlebars#getOneToOneAlgorithmPercentage needs 2 parameters.");algorithmPercentage=Math.floor(totalAlgorithmPercentage/algorithmsCount);if(algorithmIndex===algorithmsCount-1)algorithmPercentage=totalAlgorithmPercentage-(algorithmsCount-1)*algorithmPercentage;return algorithmPercentage});
Handlebars.registerHelper("getItemTitleFromList",function(list,key,val,defaultTitle){var item;if(arguments.length<3)throw new Error("Handlebars#getItemTitleFromList needs 3 parameters.");item=_.filter(list,function(item){return item[key]===val})[0];return item&&item["jcr:title"]||defaultTitle||""});
Handlebars.registerHelper("getValue",function(){var keys,value=window;if(arguments.length<2)throw new Error("Handlebars#getValue needs at least 1 parameter.");keys=Array.prototype.slice.call(arguments,0,arguments.length-1);keys=keys.join(".").split(".");_.each(keys,function(key){value=value&&value[key]});return value});
Handlebars.registerHelper("ifAllEqual",function(){var params=Array.prototype.slice.call(arguments,0),options=params.pop(),length=params.length,isEqual=false,index;if(length%2!=0)throw new Error("Handlebars#ifAllEqual needs even number of arguments");for(index=0;index<length;index+=2)if(params[index]===params[index+1])isEqual=true;else{isEqual=false;break}if(isEqual)return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("confidenceIcon",function(confidence){var confidenceIcon;if(confidence>=0&&confidence<60)confidenceIcon="icon-confidenceone";else if(confidence>=60&&confidence<75)confidenceIcon="icon-confidencetwo";else if(confidence>=75&&confidence<90)confidenceIcon="icon-confidencethree";else if(confidence>=90&&confidence<=100)confidenceIcon="icon-confidencefour";else return"";return confidenceIcon});
Handlebars.registerHelper("getOSValue",function(value){var osMap={"osAndroid":"Android","osOsx":"iOS","osWindows":"Windows","osLinux":"Linux","osProprietary":"Proprietary","osSymbian":"Symbian","osRim":"Blackberry"};return TSDK.I18n.get(osMap[value]||"")});Handlebars.registerHelper("getStringWithLineBreaks",function(jsString){var escapedString=Handlebars.Utils.escapeExpression(jsString);return new Handlebars.SafeString(escapedString.replace(/\r?\n/g,"\x3cbr\x3e"))});
Handlebars.registerHelper("isBrowser",function(browserString,options){var isBrowserStringTrue;switch(browserString){case "IE":isBrowserStringTrue=ELM.BrowserDetector.isIE();break;case "FIREFOX":isBrowserStringTrue=ELM.BrowserDetector.isFirefox();break;case "CHROME":isBrowserStringTrue=ELM.BrowserDetector.isChrome();break;default:throw new Error("Handlebars#isBrowser Invalid browser string:"+browserString);}if(isBrowserStringTrue)return options.fn(this);else return options.inverse(this)});
Handlebars.registerHelper("readGlobalVar",function(globalVarName,key){if(arguments.length<1)throw new Error("Handlebars#readGlobalVar needs atleast 1 parameter.");var params=globalVarName.split("."),valueInGlobalObject=window[params[0]],length=params.length,index=1;while(index<length){if(valueInGlobalObject)valueInGlobalObject=valueInGlobalObject[params[index]];else throw new Error("Data does not exist in global object");index++}if(typeof key==="string")return valueInGlobalObject[key]||"";return valueInGlobalObject});
Handlebars.registerHelper("ifGlobalVar",function(globalVarName,value,options){if(arguments.length<2)throw new Error("Handlebars#ifGlobalVar needs atleast 1 parameter.");var valueInGlobalObject=Handlebars.helpers.readGlobalVar.call(this,globalVarName);if(typeof value==="object"){options=value;value=undefined}if(value===undefined&&valueInGlobalObject||value!==undefined&&valueInGlobalObject===value)return options.fn(this);else return options.inverse(this)});
Handlebars.registerHelper("isAnalyticsEnabled",function(activityType,options){if(arguments.length!=2)throw new Error("Handlebars#isAnalyticsEnabled needs 1 parameter");if(ELM.Activities.isAnalyticsEnabled[activityType])return options.fn(this);return options.inverse(this)});var TSDK=TSDK||{};TSDK.UI=TSDK.UI||{};TSDK.UI.Templates=TSDK.UI.Templates||{};TSDK.Enums=TSDK.Enums||{};var Granite=Granite;
TSDK.I18n=TSDK.I18n||Granite&&Granite.I18n||{get:function(str){var values=Array.prototype.slice.call(arguments,1);for(var i=0;i<values.length;i++){var key="[{]"+i+"[}]";str=str.replace(new RegExp(key,"g"),values[i])}return str},getVar:function(text){return text},getLocale:function(){return"en"}};
TSDK.UI.Util={PANEL_MESSAGE_POSITION:"pos-l-34-imp pos-t-3-1",clone:function(obj){var copy,index,objLength;if(null==obj||"object"!=typeof obj)return obj;if(obj instanceof Date){copy=new Date;copy.setTime(obj.getTime());return copy}if(obj instanceof Array){copy=[];objLength=obj.length;for(index=0;index<objLength;index+=1)copy[index]=this.clone(obj[index]);return copy}if(obj instanceof Object){copy={};for(var attr in obj)if(obj.hasOwnProperty(attr))copy[attr]=this.clone(obj[attr]);return copy}throw new Error("Unable to copy obj! Its type isn't supported.");
},addProtocolToUrl:function(url){var protocol=/^(https?:\/\/)/;if(url&&!protocol.test(url))url="http://"+url;return url},isUrlValid:function($urlField,$urlInputInvalid){var value=$urlField.val().trim();if(!value||$urlInputInvalid.length)return false;return true},UrlValidationRegex:new RegExp("^"+"(?:(?:https?|ftp)://)"+"(?:\\S+(?::\\S*)?@)?"+"(?:"+"(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])"+"(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}"+"(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))"+"|"+"(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)"+
"(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*"+"(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))?"+")"+"(?::\\d{2,5})?"+"(?:/[^\\s]*)?"+"$","i"),UrlValidationWithoutProtocolRegex:new RegExp("^"+"(?:\\S+(?::\\S*)?@)?"+"(?:"+"(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])"+"(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}"+"(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))"+"|"+"(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)"+"(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*"+"(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))?"+
")"+"(?::\\d{2,5})?"+"(?:/[^\\s]*)?"+"$","i"),getActualCSS:function($div,cssProp){var $clonedDiv=$div.clone().attr("id",false),cssValue;$clonedDiv.css({visibility:"hidden",display:"block",position:"absolute"}).appendTo("body");cssValue=$clonedDiv.css(cssProp);$clonedDiv.remove();return cssValue},getCompleteResourcePath:function(reference){return"/content/mac/"+ELM.client+"/target"+reference},sendGETRequest:function(options){return $.ajax({url:options.url,async:typeof options.async=="undefined"?true:
options.async,type:"GET"})},isInteger:function(data){return data.match(/^\d+$/)},isFloat:function(data){return data.match(/^\d*.?\d+$/)},showConfirmationDialog:function(confirmationDialog,options){confirmationDialog.set({heading:options.heading,content:options.message,buttons:[{label:TSDK.I18n.get("Cancel"),click:function(evt){evt.dialog.hide()}.bind(this)},{label:options.label,className:"primary",click:function(evt){options.callback();evt.dialog.hide()}.bind(this)}]}).show()},showErrorNotification:function(options){F.trigger("errorNotification",
{message:options.message,heading:options.heading||TSDK.I18n.get("ERROR"),className:options.className})},showSuccessNotification:function(options){F.trigger("successNotification",{message:options.message,heading:options.heading,className:options.className})},showNoticeNotification:function(options){F.trigger("noticeNotification",{message:options.message,heading:options.heading,className:options.className})},showInfoNotification:function(options){F.trigger("infoNotification",{message:options.message,
heading:options.heading,className:options.className})},hasArrayDuplicates:function(array){return _.unique(array).length!==array.length},trimArrayValues:function(obj){var array=[],index=0;if(!_.isArray(obj))return obj;_.each(obj,function(item){if(item.trim())array[index++]=item});return array},hasStringWhiteSpaces:function(string){return _.isString(string)&&/\s/g.test(string)},getFragment:function(content){var container=document.createElement("div"),fragment=document.createDocumentFragment(),i;container.innerHTML=
content;for(i=container.childNodes.length-1;i>=0;i-=1)fragment.insertBefore(container.childNodes[i],fragment.firstChild);return fragment},hasChanged:function(originalObject,backupObject,options){var arrayTypeValue,objectTypeValue;options=options||{};options.ignoreKeys=options.ignoreKeys||[];options.ignoreKeysOfArrayElements=options.ignoreKeysOfArrayElements||{};options.ignoreKeysOfObjectElements=options.ignoreKeysOfObjectElements||{};if(_.isObject(backupObject)){_.each(options.ignoreKeys,function(keyToIgnore){backupObject[keyToIgnore]=
originalObject.get(keyToIgnore)});_.each(options.ignoreKeysOfArrayElements,function(keysToIgnore,key){arrayTypeValue=originalObject.get(key)||[];_.each(arrayTypeValue,function(arrayItem,index){_.each(keysToIgnore,function(keyToIgnore){if(arrayItem.hasOwnProperty(keyToIgnore)&&backupObject[key]&&backupObject[key][index])backupObject[key][index][keyToIgnore]=arrayTypeValue[index][keyToIgnore]})})});_.each(options.ignoreKeysOfObjectElements,function(keysToIgnore,key){objectTypeValue=originalObject.get(key)||
{};_.each(keysToIgnore,function(keyToIgnore){if(objectTypeValue.hasOwnProperty(keyToIgnore)&&backupObject[key])backupObject[key][keyToIgnore]=objectTypeValue[keyToIgnore]})});return!_.isEqual(backupObject,originalObject.toJSON())}return true},updateSelectWidget:function($select,value){if(value)$select.find("select").val(value);$select.find("ul").remove();$select.removeData("select").select()},escape:function(message){return Handlebars.Utils.escapeExpression(message)},compareURLs:function(url1,url2,
options){var options=options||{},removeTrailingSlashAndEmptyHash=function(url){var lastChar=url[url.length-1];while(["/","#"].indexOf(lastChar)!==-1){url=url.substring(0,url.length-1);lastChar=url[url.length-1]}return url};if(options["strict"])return url1===url2;if(options["similar"])return removeTrailingSlashAndEmptyHash(url1)===removeTrailingSlashAndEmptyHash(url2);return url1==url2},escapeHTMLAttributes:function(attr){attr=attr||"";return attr.replace(/(\?|=|#|:|\.|\[|\]|\/)/g,"\\$1")},convertCurrencyStringToInteger:function(currencyString){var convertToIntRegEx=
/[^0-9]+/g;return Number(currencyString.replace(convertToIntRegEx,""))},getResolutionFromDates:function(startDate,endDate){var ONE_DAY=864E5,differenceOfDays=(moment(endDate)-moment(startDate))/ONE_DAY,HOURLY_TO_DAILY_THRESHOLD=3,DAILY_TO_WEEKLY_THRESHOLD=100;if(differenceOfDays<=HOURLY_TO_DAILY_THRESHOLD)return"hour";if(differenceOfDays<=DAILY_TO_WEEKLY_THRESHOLD)return"day";return"week"},isActivityImported:function(activityId){var idParts=activityId&&activityId.split("/");return idParts.length===
3&&idParts[0]==="imported"}};
F.Component.prototype.propagateEvent=function(eventName,event){var newEventObject={},eventObject=event||{};if(this.shouldPropagateEvent(eventName,eventObject)){if(this instanceof TSDK.UI.Component)if(!eventObject.name||eventObject.name!==eventName){newEventObject.name=eventName;newEventObject.data=TSDK.UI.Util.clone(eventObject);newEventObject.path=this.toString().toLowerCase();newEventObject.target=this;eventObject=newEventObject}else eventObject.path=this.toString().toLowerCase()+"/"+eventObject.path;
this.trigger(eventName,eventObject);if(this.parent&&this.parent.propagateEvent)this.parent.propagateEvent(eventName,eventObject)}};F.Component.prototype.shouldPropagateEvent=function(eventName,eventObject){return true};F.Component.prototype.destructButKeepEl=function(){if(this.view){if(this.view.$el)this.view.$el.unbind().undelegate().empty();if(this.view.model&&this.view.model.off)this.view.stopListening()}this.teardownIfSetup();this.removeComponents();this.stopListening();delete this.components};
TSDK.EnumUtil={addEnum:function(type,props){if(typeof type!=="string"||type==="")throw new Error("Cannot create enum: Invalid enum type.");if(typeof props==="object")return TSDK.Enums[type]=Object.freeze(props);else throw new Error("Cannot create enum: Enum properties should be key-value pairs.");},getProperties:function(enumType){var props=TSDK.Enums[enumType];return typeof props==="object"?Object.keys(props):[]},getValues:function(enumType,unique){var props=TSDK.Enums[enumType],values=[],uniqueValueMap=
{},val;if(typeof props==="object")for(var key in props){val=props[key];if(!unique||!uniqueValueMap[val]){values.push(val);uniqueValueMap[val]=true}}return values},removeEnum:function(enumType){delete TSDK.Enums[enumType]}};"use strict";
TSDK.UI.Component=new PseudoClass({toString:"tsdk-ui-component",extend:F.ModelComponent,construct:function(options){if(options){this.setPreprocessor(options.preprocessor);this.setPostprocessor(options.postprocessor);this.setFetchOptions(options.fetchOptions||{url:options.url});this.setData(options.data);this.configure(options.config)}this.initialize(options)},initialize:function(){this.throwError("No definition found for initialize.")},configure:function(config){this.config=_.extend({},this.config,
config);this.handleConfigChanged()},handleConfigChanged:function(){},setPreprocessor:function(callback){if(typeof callback==="function")this.preprocessor=callback},setPostprocessor:function(callback){if(typeof callback==="function")this.postprocessor=callback},setFetchOptions:function(options){this.fetchOptions=options},fetch:function(options){var that=this,fetchOptions=_.extend({},this.fetchOptions,options);if(!fetchOptions)this.throwError("Cannot fetch. Parameters are not set.");if(!fetchOptions.url)throw new Error("Cannot fetch. URL is empty.");
$.ajax({url:fetchOptions.url,type:"get",async:fetchOptions.async!==false,success:function(response){that.setData(response,fetchOptions.process);if(typeof fetchOptions.success==="function")fetchOptions.success.apply(null,arguments)},error:function(){if(typeof fetchOptions.error==="function")fetchOptions.error.apply(null,arguments)}})},loadModel:function(model){this.load(model)},setData:function(data,process){if(data&&process!==false&&this.preprocessor)data=this.preprocessor(data);this.setContext(data);
if(this.view)this.render()},getData:function(process){var data=this.getContext();if(process!==false&&this.postprocessor)return this.postprocessor(data);return data},setContext:function(context){if(context&&this.CONTEXT_TYPE_ARRAY&&_.isArray(context))context={items:context};this.loadModel(context)},getContext:function(){var context=this.model.toJSON();if(this.CONTEXT_TYPE_ARRAY)return context.items;return context},validate:function(notify){return true},throwError:function(msg){throw new Error(this.toString()+
": "+msg);}});"use strict";
TSDK.UI.ConfigurableComponent=new PseudoClass({toString:"tsdk-ui-configurableComponent",extend:TSDK.UI.Component,getConfigInModel:function(configName){var config=this.model&&this.model.get("config");return config&&config[configName]},setConfigInModel:function(configName,configValue){var config=this.model&&this.model.get("config");if(config)config[configName]=configValue},getContext:function(){var context=this.model.toJSON();if(this.CONTEXT_TYPE_ARRAY)return context.items;else return _.omit(context,
"config")},handleConfigChanged:function(){if(this.model)this.model.set("config",this.config)},getData:function(){return _.omit(this._super.apply(this,arguments),["config"])}});TSDK.EnumUtil.addEnum("SpecialMboxes",{ANY_MBOX_LOCATION:"** any mbox **",DISPLAY_MBOXES:"** display mboxes **",CLICK_FROM_DISPLAY_MBOXES:"** click from display mbox **"});"use strict";
TSDK.UI.MboxPicker=new PseudoClass({toString:"MboxPicker",extend:TSDK.UI.Component,CONTEXT_TYPE_ARRAY:true,View:F.View.extend({events:{"change coral-autocomplete":"handleMboxSelected"}}),initialize:function(options){this.initView(options)},initView:function(options){this.view=new this.View({el:options.el,component:this,template:TSDK.UI.Templates.MboxPickerComponent.MboxPicker})},loadModel:function(model){var extendedModel={};if(model){_.extend(extendedModel,this.config,model);this.updateSpecialMboxes(extendedModel)}this.load(extendedModel)},
updateSpecialMboxes:function(model){var specialMboxes=model["specialMboxes"];if(specialMboxes==="all")model["specialMboxes"]=TSDK.EnumUtil.getValues("SpecialMboxes");else if(!_.isArray(specialMboxes))delete model["specialMboxes"]},handleRenderComplete:function(){},handleMboxSelected:function(evt){var selectedListItem=evt.target,$selectedListItem=$(selectedListItem),selected=selectedListItem.value,isSpecial=$selectedListItem.find("coral-autocomplete-item[selected]").data("special");this.model.set("selected",
selected);this.trigger("mbox:selected",{value:selected,isSpecial:isSpecial})},getContext:function(){return this.model.get("selected")},handleConfigChanged:function(){if(this.model)this.model.set(this.config)}});"use strict";
TSDK.UI.MetricsComponent=new PseudoClass({toString:"Metrics",extend:TSDK.UI.Component,CONTEXT_TYPE_ARRAY:true,View:F.View.extend({events:{"click #addmetrics":"addNewMetric","change .conversion-metric-checkbox":"handleConversionMetric"}}),constants:{REPORTING_SOLUTION_ANALYTICS:"analytics"},initialize:function(options){this.initView(options);this.loadModel({reportingSolution:options.reportingSolution,config:this.config});this.registerListeners();this.registerVars(options);this.registerBinders()},loadModel:function(model){this.load(model)},
initView:function(options){this.view=new this.View({el:options.el,component:this,template:TSDK.UI.Templates.MetricsComponent.Metrics})},registerListeners:function(){this.listenTo(this.view,"renderComplete",function(){this.renderSubViews()})},registerVars:function(options){this.mboxPickerOptions=options.mboxPicker;this.reportSuite=options.reportSuite;this.analyticsMetrics=options.analyticsMetrics;this.setGoalMetricConfig()},registerBinders:function(){this.bind("updateActiveMetric");this.bind("triggerMetricChanged");
this.bind("handleConversionMetric")},renderSubViews:function(){this.destructComponents();var metrics=this.getMetrics();this.metricIndex=0;this.$goalMetricEl=this.view.$(".goal");this.$conversionMetricEl=this.view.$(".conversion");this.$adMetricEl=this.view.$(".additional");if(metrics&&metrics.length)_.each(metrics,function(metricModel,index){this.metricIndex=index;this.addMetric(metricModel)},this);else this.addMetric();this.setConversion()},addMetric:function(metricModel,shouldCollapse){var metricComponentName=
"metric"+this.metricIndex,isNewMetric=!metricModel,isGoalMetric=this.metricIndex===0,shouldCollapse=_.isBoolean(shouldCollapse)?shouldCollapse:metricModel,metric,parentElement;metricModel=metricModel||{};metricModel.activityType="A-B";metricModel.isGoalMetric=isGoalMetric;if(isGoalMetric&&this.config&&this.config.goalMetric)metricModel.config=this.config.goalMetric;else metricModel.config=this.config||{};if(isNewMetric)metricModel["title"]=metricModel.isGoalMetric?TSDK.I18n.get("MY PRIMARY GOAL"):
this.generateAdditionalMetricName();parentElement=metricModel.isGoalMetric?this.$goalMetricEl:metricModel.conversion?this.$conversionMetricEl:this.$adMetricEl;if(metricModel.conversion)this.conversionMetricIndex=this.metricIndex;this.components[metricComponentName]&&this.components[metricComponentName].destructButKeepEl();if(this.isAnalyticsMetric()){metricModel.reportSuite=this.reportSuite;metricModel.analyticsMetrics=this.analyticsMetrics;metric=this.addComponent(new TSDK.UI.MetricsComponent.MetricsItemA4T({el:$('\x3cdiv class\x3d"metric'+
this.metricIndex+'" /\x3e').appendTo(parentElement),model:metricModel,analyticsMetrics:this.analyticsMetrics,visible:true,mboxPickerOptions:this.mboxPickerOptions,collapsed:shouldCollapse}),metricComponentName).on("expand",this.updateActiveMetric).on("metricsItem:addAudience",this.delegateShowAudiencePickerEvent).on("change",this.triggerMetricChanged)}else metric=this.addComponent(new TSDK.UI.MetricsComponent.MetricsItem({el:$('\x3cdiv class\x3d"metric'+this.metricIndex+'" /\x3e').appendTo(parentElement),
model:metricModel,visible:true,mboxPickerOptions:this.mboxPickerOptions,collapsed:shouldCollapse}),metricComponentName).on("expand",this.updateActiveMetric).on("metricsItem:addAudience",this.delegateShowAudiencePickerEvent).on("change",this.triggerMetricChanged);this.propagateEvent("metric:added",metric.model.toJSON());return metric},triggerMetricChanged:function(metricModel){this.propagateEvent("metric:changed",metricModel.toJSON())},delegateShowAudiencePickerEvent:function(audiencePickerOptions){},
addNewMetric:function(){var metric;this.metricIndex+=1;metric=this.addMetric();this.updateActiveMetric(metric)},removeMetric:function(metric){this.removeComponent(metric);this.propagateEvent("metric:removed",metric)},updateActiveMetric:function(metric){this.activeMetric=metric.toString();this.collapseInactiveMetrics()},collapseInactiveMetrics:function(){for(var metric in this.components)if(metric!==this.activeMetric)this.components[metric].collapse()},setAnalyticsMetrics:function(analyticsMetrics){var analyticsGoal=
this.components.metric0;this.analyticsMetrics=analyticsMetrics;if(analyticsGoal)analyticsGoal.setAnalyticsMetrics(analyticsMetrics)},generateAdditionalMetricName:function(){var namesInUse=this.getComponentsTitle(),prefix=TSDK.I18n.get("ADDITIONAL GOAL "),index=1,metricName;do metricName=prefix+index++;while(namesInUse.indexOf(metricName)!==-1);return metricName},getComponentsTitle:function(){return _.map(this.components,function(component){return component.model.getTitle()})},getIncompleteComponentsCount:function(highlightErrors){var count=
0;_.each(this.components,function(component){if(!component.isComplete(highlightErrors))count++});return count},setGoalMetricConfig:function(){if(this.config)this.config.goalMetric=_.extend({},_.omit(this.config,"goalMetric"),this.config.goalMetric)},handleConversionMetric:function(evt){if(evt.target.checked)this.removeConversionMetric();else this.addConversionMetric()},addConversionMetric:function(){var metric;this.metricIndex+=1;this.components["metric0"].setConversion(false);metric=this.addMetric({conversion:true,
title:TSDK.I18n.get("CONVERSION METRIC")},false);this.updateActiveMetric(metric)},removeConversionMetric:function(){this.components["metric"+this.conversionMetricIndex].remove();this.components["metric0"].setConversion(true)},setConversion:function(){var conversionMetricCheckboxElement=this.view.$(".conversion-metric-checkbox").get(0),shouldEnableCheckbox=false;if(this.config.POST_GOAL_METRIC_TRACKING_ENABLED&&(this.components["metric0"].getConversion()||!this.conversionMetricIndex)){shouldEnableCheckbox=
true;this.components["metric0"].setConversion(true)}if(conversionMetricCheckboxElement)Coral.commons.ready(conversionMetricCheckboxElement,function(){conversionMetricCheckboxElement.checked=shouldEnableCheckbox?true:false})},hasChanged:function(){return _.some(this.components,function(component){return component.hasChanged()})},partialSave:function(){var metrics=Object.keys(this.components),oldMetricsCount=this.getMetrics().length,i,component;for(i=metrics.length-1;i>=oldMetricsCount;i--){component=
this.components[metrics[i]];if(!component.hasChanged()){this.removeComponent(metrics[i]);continue}break}this.saveMetrics();return true},saveMetrics:function(){var metrics=[];_.each(this.components,function(component,metricKey){metrics.push(this.filterUnwantedMetricsAttributes(component.model.toJSON()))},this);this.setMetrics(metrics);this.metricIndex=metrics.length},destructComponents:function(){for(var component in this.components){this.components[component].destruct();delete this[component];delete this.components[component]}return this},
hasMetricsToBeSaved:function(){return!_.isEmpty(this.components)&&this.hasChanged()},validate:function(highlightErrors){var partMetricsLength=this.getIncompleteComponentsCount(highlightErrors),goalMetricWorth=this.components.metric0.model.getWorth(),titles=this.getComponentsTitle(),message=partMetricsLength===1?TSDK.I18n.get("A definition is incomplete for 1 metric. Review the highlighted fields below."):TSDK.I18n.get("Metric definitions are incomplete for {0} metrics. Review the highlighted fields below.",
partMetricsLength);if(partMetricsLength){this.notifyError({message:message});return false}if(titles.length!==_.uniq(titles).length){this.notifyError({message:TSDK.I18n.get("You have duplicate metric names.")});return false}if(goalMetricWorth&&isNaN(goalMetricWorth)){this.notifyError({message:TSDK.I18n.get("Enter a valid number for estimated value.")});return false}return true},notifyError:function(options){this.propagateEvent("error",options)},filterUnwantedMetricsAttributes:function(metricData){var attributesToBeExcluded=
["mboxes","isGoalMetric","activityType","config","isAdvancedSettingsVisible","analyticsMetrics"];return _.omit(metricData,attributesToBeExcluded)},isComplete:function(){return this.validate()},getMetrics:function(){return this.metrics||[]},setMetrics:function(metrics){this.metrics=metrics},getContext:function(){this.saveMetrics();return this.getMetrics()},setContext:function(metrics){this.setMetrics(metrics)},isAnalyticsMetric:function(){return this.model.get("reportingSolution")===this.constants.REPORTING_SOLUTION_ANALYTICS},
setReportingSolution:function(reportingSolution,options){this.model.set("reportingSolution",reportingSolution,options)}});"use strict";
TSDK.UI.MetricsComponent.MetricModel=Backbone.Model.extend({defaults:{"title":"","type":"","action":"","matcher":"exact","worth":"","constraints":[],"postGoalSuccessAction":""},defaultAdvancedMetricActionType:{"incrementCountKeepUser":"COUNT_ONCE","incrementCountReleaseUserAllowEntry":"RESTART_SAME_EXPERIENCE","incrementCountBarEntry":"EXCLUDE_TO_SAME_EXPERIENCE"},getTitle:function(){return this.get("title")},getType:function(){return this.get("type")},getRevenueType:function(){return this.get("revenueType")},
getEngagementType:function(){return this.get("engagementType")},getAnalyticsMetricId:function(){return this.get("analyticsMetricId")},getAction:function(){return this.get("action")},getDisplayMboxes:function(){return this.get("displayMboxes")},getMatcher:function(){return this.get("matcher")},getConstraints:function(){return this.get("constraints")?this.get("constraints"):[]},getConstraintTerms:function(){return _.pluck(this.getConstraints(),"term")},getCompactConstraintTerms:function(){return _.compact(this.getConstraintTerms())},
getClickTrackingTerms:function(){var constraints=this.getConstraints(),result={};_.each(constraints,function(constraint){var templateId=constraint.templateId||"template_Id_1",templateSelectors=result[templateId]||[];if(constraint.term)if(!templateSelectors.length){templateSelectors.push(constraint.term);result[templateId]=templateSelectors}else templateSelectors.push(constraint.term)});return result},getWorth:function(){return this.get("worth")},getAdvancedMetricActionType:function(){return this.get("advancedMetricActionType")},
getPostGoalSuccessAction:function(){return this.get("postGoalSuccessAction")},isAdvancedSettingsVisible:function(){return this.get("isAdvancedSettingsVisible")},setTitle:function(title,options){this.set("title",$.trim(title),options)},setType:function(type,options){this.set("type",type,options)},setRevenueType:function(type,options){this.set("revenueType",type,options)},setEngagementType:function(type){this.set("engagementType",type)},setAnalyticsMetricId:function(id,options){this.set("analyticsMetricId",
id,options)},setAnalyticsMetricSource:function(source,options){this.set("analyticsMetricSource",source,options)},setAnalyticsMetricSupport:function(support,options){this.set("analyticsMetricSupport",support,options)},setAnalyticsMetrics:function(analyticsMetrics,options){this.set("analyticsMetrics",analyticsMetrics,options)},clearAnalyticsMetrics:function(options){this.unset("analyticsMetrics",options);this.unset("analyticsMetricId",options);this.unset("analyticsMetricSource",options);this.unset("analyticsMetricSupport",
options)},setAction:function(action,options){this.set("action",action,options)},setMatcher:function(value){this.silentSet("matcher",value)},setConstraints:function(constraints,options){this.set("constraints",constraints,options)},setMboxes:function(mboxes){this.silentSet("mboxes",mboxes)},setWorth:function(worth,options){worth=$.trim(worth);var locale=TSDK.I18n.getLocale(),commaDecimalSeparator=["de","es","fr","it","pt"];if(commaDecimalSeparator.indexOf(locale)!=-1)worth=worth.split(".").join("").split(",").join(".");
else worth=worth.split(",").join("");this.set("worth",worth,options)},setAdvancedMetricActionType:function(rule,options){this.set("advancedMetricActionType",rule,options)},setPostGoalSuccessAction:function(actionType,options){this.set("postGoalSuccessAction",actionType,options)},setIsAdvancedSettingsVisible:function(isVisible){this.silentSet("isAdvancedSettingsVisible",isVisible)},getConversion:function(){return this.get("conversion")},setConversion:function(conversionMetric){this.silentSet("conversion",
conversionMetric)},addConstraint:function(options){var constraints=TSDK.UI.Util.clone(this.getConstraints());constraints.push({matcher:this.getMatcher(),term:"","ref:targetingAudience":"","elm:references":{}});this.setConstraints(constraints,options)},removeConstraint:function(index){var constraints=TSDK.UI.Util.clone(this.getConstraints());constraints.splice(index,1);this.setConstraints(constraints)},updateConstraint:function(index,field,value,options){var constraints=TSDK.UI.Util.clone(this.getConstraints());
constraints[index][field]=$.trim(value);this.setConstraints(constraints,options)},updateConstraintMatcher:function(options){var matcher=this.getMatcher(),constraints=_.map(TSDK.UI.Util.clone(this.getConstraints()),function(constraint){return _.extend(constraint,{matcher:matcher})});this.setConstraints(constraints,options)},clearConstraintsSilently:function(){this.unset("constraints",{silent:true})},clearConstraints:function(){this.unset("constraints")},clearConstraintsExceptFirst:function(options){var constraints=
TSDK.UI.Util.clone(this.getConstraints());constraints.splice(1);this.setConstraints(constraints,options)},clearAttributesSilently:function(){var attributes=Array.prototype.slice.call(arguments);if(attributes.length)_.each(attributes,function(attr){this.unset(attr,{silent:true})},this);else this.clear({silent:true})},clearAllAttributesExcept:function(attrs){var keepAttributes=_.pick(this.attributes,attrs);this.clearAttributesSilently();this.set(keepAttributes,{silent:true})},isGoalMetric:function(){return this.get("isGoalMetric")},
setDefaultAdvancedMetricActionType:function(postGoalSuccessAction){var advancedMetricActionType=postGoalSuccessAction?this.defaultAdvancedMetricActionType[postGoalSuccessAction]:"COUNT_ONCE";this.setAdvancedMetricActionType(advancedMetricActionType)},derivePostGoalSuccessAction:function(advancedMetricActionType){switch(advancedMetricActionType){case "ALWAYS_CONVERT":case "COUNT_ONCE":case "COUNT_LANDINGS":return"incrementCountKeepUser";case "RESTART_SAME_EXPERIENCE":case "RESTART_RANDOM_EXPERIENCE":case "RESTART_NEW_EXPERIENCE":return"incrementCountReleaseUserAllowEntry";
case "EXCLUDE_TO_SAME_EXPERIENCE":case "BAN_FROM_CAMPAIGN":return"incrementCountBarEntry";default:return"incrementCountKeepUser"}},computePostGoalSuccessAction:function(options){var postGoalSuccessAction=this.derivePostGoalSuccessAction(this.getAdvancedMetricActionType());this.setPostGoalSuccessAction(postGoalSuccessAction,options)},setDefaultAttributes:function(attributes,options){var defaultAttributes=_.pick(this.defaults,attributes);this.set(defaultAttributes,options)},removeAttributesSilently:function(attributes){_.each(attributes,
function(attr){this.unset(attr,{silent:true})},this)},getActivityType:function(){return this.get("activityType")||""},setActivityType:function(activityType){this.silentSet({activityType:activityType})},getReportSuite:function(){return this.get("reportSuite")||""},setReportSuite:function(reportSuite,options){this.set("reportSuite",reportSuite,options)},silentSet:function(property,value,options){var settingOptions={silent:true};if(options)_.extend(settingOptions,options);this.set(property,value,settingOptions)}});
"use strict";
TSDK.UI.MetricsComponent.MetricsItem=new PseudoClass({toString:"MetricsItem",extend:F.ModelComponent,Model:TSDK.UI.MetricsComponent.MetricModel,Template:function(){return TSDK.UI.Templates.MetricsComponent.MetricsItem.apply(this,arguments)},View:F.View.extend({commonEvents:{'blur [name\x3d"metricname"]':"setTitle",'change [name\x3d"metricname"]':"setTitle","coral-selectlist:change .context-menu-option":"handleContextMenuSelection","change .metric-worth-input":"setWorth","change .select-metric-type":"handleMetricTypeSelection","change .select-advanced-metric-action-type":"setAdvancedMetricActionType",
"change .select-post-goal-success-action":"handlePostGoalSuccessAction","change .select-revenue-type":"setRevenueType","change .select-action":"handleActionSelection","change .select-engagement-type":"setEngagementType","change .terminput":"updateConstraintTermFromInput","change .select-matcher":"updateConstraintMatcher","click .additionalCondition":"addAdditionalCondition","click .appliedCondition":"removeAdditionalCondition","click .addTargetingCondition":"addTargetingAudience","click .add-constraint":"handleConstraintAddition",
"click .remove-constraint":"removeConstraint","click .select-elements":"triggerShowClickTracking","click .delete-elements":"clearClickTrackElements","click .context-menu li":"hideContextMenu","coral-accordion:change coral-accordion":"triggerCollapsibleExpandEvent"},additionalEvents:{'change [name\x3d"revenueType"]':"setRevenueType",'change [name\x3d"engagementType"]':"setEngagementType"},events:function(){return _.extend({},this.commonEvents,this.additionalEvents)}}),construct:function(options){this.initView(options.el);
this.loadModel(options.model);this.registerVars(options);this.registerBinders();this.registerListeners()},loadModel:function(model){this.load(model);if(!this.model.getPostGoalSuccessAction())this.model.computePostGoalSuccessAction({silent:true})},registerVars:function(options){this.analyticsMetrics=options.analyticsMetrics;this.mboxPickerOptions=options.mboxPickerOptions;this.currentConstraint=null;this.collapsedByDefault=options.collapsed},initView:function(el){this.view=new this.View({el:el,component:this,
template:this.Template})},registerBinders:function(){this.bind("saveSelectedAudienceToConstraint");this.bind("setClickedElements")},registerListeners:function(){this.listenTo(this.view,"renderComplete",function(){this.initializeWidgets()});this.listenTo(this.model,"change",function(){this.updateSummary();this.trigger("change",this.model)})},initializeWidgets:function(){this.initialModel=this.initialModel||TSDK.UI.Util.clone(this.model.attributes);this.initCollapsibleWidget();this.setMetricTypeIfSingle();
this.addFilters();this.updateSummary()},initCollapsibleWidget:function(){var collapsibleElement=this.view.$("coral-accordion-item").get(0),that=this;if(!collapsibleElement)return;Coral.commons.ready(collapsibleElement,function(){that.section=collapsibleElement;if(that.collapsedByDefault)collapsibleElement.selected=false})},collapse:function(){if(this.section)this.section.selected=false},triggerCollapsibleExpandEvent:function(ev){if(ev.originalEvent.detail.selection){this.collapsedByDefault=null;this.trigger("expand",
this)}},addFilters:function(){var constraints=this.model.getConstraints(),index;if(this.isMboxView()||this.isMboxClick())for(index=0;index<constraints.length;index++){this.$mboxFilter=this.view.$(".mboxLookup"+index);this.initFilter(this.$mboxFilter,index,constraints[index]["term"])}},initFilter:function($element,order,selectedMbox){var that=this,otherSelectedMboxes=this.model.getConstraintTerms(),mboxPicker,mboxPickerAttr=this.mboxPickerOptions,mboxPickerConfig=mboxPickerAttr.config,specialMboxes=
order===0&&mboxPickerConfig&&mboxPickerConfig.specialMboxes;otherSelectedMboxes.splice(order,1);mboxPicker=new TSDK.UI.MboxPicker({el:$element,visible:true,fetchOptions:{url:mboxPickerAttr.url},preprocessor:mboxPickerAttr.preprocessor,config:_.extend({},mboxPickerConfig,{specialMboxes:specialMboxes,selected:selectedMbox,exclude:otherSelectedMboxes})});this.populateMboxList(mboxPicker,mboxPickerConfig);mboxPicker.on("mbox:selected",function(selectedMbox){that.updateConstraintTermOnMboxSelection(selectedMbox,
order)})},populateMboxList:function(mboxPicker,mboxPickerConfig){var displayMboxes=[];if(this.isMboxView())if(TSDK.UI.mboxes)mboxPicker.setData(TSDK.UI.mboxes);else mboxPicker.fetch({async:false,success:function(response){TSDK.UI.mboxes=response}});else if(this.isMboxClick()){if(_.isFunction(mboxPickerConfig.fetchDisplayMbox))displayMboxes=mboxPickerConfig.fetchDisplayMbox.call();mboxPicker.setData({items:displayMboxes,specialMboxes:[]},false)}},isMboxView:function(){return this.model.getAction()===
"mboxView"},isMboxClick:function(){return this.model.getAction()==="mboxClick"},show:function(){this.addMboxes();this.view.show();return this},hideContextMenu:function(){this.view.$(".context-options-button").click()},setTitle:function(evt){var newTitle=evt.target.value;this.toggleTitleEditMode(false);if(newTitle!==this.model.getTitle())this.model.setTitle(newTitle)},enableTitleEditing:function(){var titleInputElement=this.view.$(".metric-name-input").get(0);this.toggleTitleEditMode(true);if(titleInputElement)Coral.commons.nextFrame(function(){$(titleInputElement).focus();
titleInputElement.selectionStart=titleInputElement.selectionEnd=titleInputElement.value.length})},toggleTitleEditMode:function(state){this.view.$(".metric-item").toggleClass("title-edit-mode",state)},clearAllFields:function(){var attributesToBeRetained=["title","activityType","isGoalMetric","config","conversion"];this.resetModelWithDefaults(attributesToBeRetained)},setWorth:function(evt){this.model.setWorth(evt.target.value,{silent:true});this.model.trigger("change",this.model)},handleContextMenuSelection:function(evt){if(!evt.target.selectedItem)return;
switch(evt.target.selectedItem.value){case "rename":this.enableTitleEditing();this.hideContextMenu();break;case "clear":this.clearAllFields();break;case "delete":this.remove();break;case "advancedSettings":this.showAdvancedSettings();this.disableMenuOption(evt.target.selectedItem);this.model.setIsAdvancedSettingsVisible(true);this.hideContextMenu();break;default:}},handleMetricTypeSelection:function(evt){this.setMetricType(evt.target.value)},setMetricType:function(type){this.resetModelWithDefaults(this.getRenderAttributes(),
{silent:true});if(type==="conversion")this.addMboxes();else this.setupByType(type,{silent:true});this.model.setType(type)},deriveTitleFromMetricType:function(){var type=this.view.$(".select-metric-type coral-select-item:selected").text();this.model.setTitle(type)},setMetricTypeIfSingle:function(){var metricTypeElements=this.view.$(".select-metric-type").get(0),that=this;if(this.model.getType()&&!metricTypeElements)return;Coral.commons.ready(metricTypeElements,function(){var metricTypes=metricTypeElements?
metricTypeElements.items.getAll():[];if(metricTypes.length===1)that.model.setType(metricTypes[0].value)})},resetModelWithDefaults:function(attributes,options){var attributesToBeRetained=attributes;if(this.isPostGoalMetric())attributesToBeRetained.push("targetName");this.clearUnneededAttributes(attributesToBeRetained);this.model.setDefaultAttributes(["postGoalSuccessAction"],options)},clearUnneededAttributes:function(attributesToBeRetained){var renderAttributes=attributesToBeRetained||this.getRenderAttributes();
this.model.clearAllAttributesExcept(renderAttributes)},getRenderAttributes:function(){return["title","activityType","isGoalMetric","config","isAdvancedSettingsVisible","conversion"]},isPostGoalMetric:function(){return this.model.getConversion()},setupByType:function(type,options){if(type==="revenue"){this.model.setRevenueType("rpv",options);this.addMboxes();this.setAction("mboxView",options)}},setRevenueType:function(evt){this.model.setRevenueType(evt.target.value)},handleActionSelection:function(evt){this.setAction(evt.target.value)},
setAction:function(action,options){this.model.clearConstraintsSilently();this.model.setMatcher("exact");this.model.setWorth("",{silent:true});this.view.$(".metric-worth-input").val("");if(action==="clickRecommendation")this.propagateEvent("metric:addClickTrackId");else this.propagateEvent("metric:removeClickTrackId");if(action!=="elementClick"&&action!=="clickRecommendation")this.addConstraint({silent:true});this.model.setAction(action,options)},setEngagementType:function(evt){var engagementType=
evt.target.value;this.model.setWorth("",{silent:true});this.model.setEngagementType(engagementType);this.model.clearConstraintsSilently();if(engagementType!=="customScoring")this.view.$(".metric-worth-input").val("")},getConversion:function(){return this.model.getConversion()},setConversion:function(isConversionMetric){this.model.setConversion(isConversionMetric)},setClickedElements:function(elementsMapPerPage){var constraints=[];_.each(elementsMapPerPage,function(elements,templateId){_.each(elements,
function(element){constraints.push({term:element,templateId:templateId})},this)},this);this.model.setConstraints(constraints)},updateConstraintTermFromInput:function(evt){var value=evt.target.value,condition=$(evt.target).attr("name");this.model.updateConstraint(condition,"term",value,{silent:true});this.clearIncompleteMark();this.model.trigger("change")},updateConstraintTermOnMboxSelection:function(selectedMbox,order){var value=selectedMbox.value,isSpecialMbox=selectedMbox.isSpecial,silentSetOption=
{silent:true};if(!value)return;this.model.updateConstraint(order,"term",value,silentSetOption);if(value&&isSpecialMbox){this.model.clearConstraintsExceptFirst(silentSetOption);this.model.set("specialmbox",true,silentSetOption)}else this.model.unset("specialmbox",silentSetOption);if(value===""||order)this.model.updateConstraint(order,"ref:targetingAudience","",silentSetOption);this.clearIncompleteMark();this.model.trigger("change")},updateConstraintMatcher:function(evt){this.model.setMatcher(evt.target.value);
this.model.updateConstraintMatcher({silent:true});this.model.trigger("change")},addAdditionalCondition:function(evt){var $applyConditionButton=this.view.$(evt.target),appliedCondition=$applyConditionButton.data("condition");this.view.$(".targetingAudience"+appliedCondition).show();$applyConditionButton.hide();this.view.$(".appliedCondition").show()},removeAdditionalCondition:function(evt){var $target=this.view.$(evt.target);this.model.updateConstraint($target.data("condition"),"ref:targetingAudience",
"")},addTargetingAudience:function(evt){var audiencePickerOptions={selectedAudienceConsumer:this.saveSelectedAudienceToConstraint};this.currentConstraint=this.view.$(evt.target).data("condition")},saveSelectedAudienceToConstraint:function(audiences){this.model.updateConstraint(this.currentConstraint,"ref:targetingAudience",audiences.get("reference"));this.model.updateConstraint(this.currentConstraint,"audienceTitle",audiences.get("jcr:title"));this.model.trigger("change")},handleConstraintAddition:function(){this.addConstraint()},
addConstraint:function(options){this.model.addConstraint(options)},removeConstraint:function(evt){var constraintId=parseInt(evt.currentTarget.id);if(!_.isNaN(constraintId))this.model.removeConstraint(constraintId)},addMboxes:function(){this.model.setMboxes([])},remove:function(){this.destruct();this.parent.removeMetric(this.toString())},clearClickTrackElements:function(){this.model.clearConstraints()},triggerShowClickTracking:function(){this.propagateEvent("metric:showClickTracking",{clickedElements:this.model.getClickTrackingTerms(),
successHandler:this.setClickedElements})},updateSummary:function(){var metricTitle=this.model.getTitle(),metricItemElement=this.view.$(".metric-item").get(0),metricConstraint=this.model.getConstraints()&&this.view.$(".constraint").data("display-type"),metricTerms=this.model.getCompactConstraintTerms(),that=this,metricType,metricAction;if(metricItemElement)Coral.commons.ready(metricItemElement,function(){metricType=that.model.getType()&&that.getSelectedItemText(".select-metric-type");metricAction=
that.model.getAction()&&that.getSelectedItemText(".select-action")||that.model.getEngagementType()&&that.getSelectedItemText(".select-engagement-type")||that.model.getAnalyticsMetricId()&&that.getSelectedItemText(".select-analytics-metric");that.view.$(".metric-summary").html(TSDK.UI.Templates.MetricsComponent.MetricsItemSummary({title:metricTitle,type:metricType,action:metricAction,constraint:metricConstraint,terms:metricTerms}))})},getSelectedItemText:function(selector){var coralSelectElement=this.view.$(selector).get(0);
if(coralSelectElement&&coralSelectElement.selectedItem)return $(coralSelectElement.selectedItem).text();return""},hasChanged:function(){return!_.isEqual(this.model.toJSON(),this.initialModel)},isComplete:function(highlightErrors){var title=this.model.getTitle(),criteria=this.verifyCriteria(title);if(highlightErrors&&!criteria)this.markIncomplete();return criteria?true:false},verifyCriteria:function(title){if(this.model.getType()==="engagement")return title&&this.model.getEngagementType();return this.getDefaultCriteria()},
getDefaultCriteria:function(){var terms=this.model.getConstraintTerms(),title=this.model.getTitle();if(this.model.getAction()==="clickRecommendation")return title;return title&&terms.length&&terms.indexOf("")===-1},markIncomplete:function(){this.view.$(".metric-item").addClass("incomplete")},clearIncompleteMark:function(){this.view.$(".metric-item").removeClass("incomplete")},updateTitleAttribute:function(target,value){$(target).attr("title",value)},showAdvancedSettings:function(){this.view.$(".advanced-metric-action").removeClass("hidden")},
disableMenuOption:function(menuOption){$(menuOption).prop("disabled",true)},handlePostGoalSuccessAction:function(evt){this.model.setPostGoalSuccessAction(evt.target.value,{silent:true});this.model.setDefaultAdvancedMetricActionType(evt.target.value)},setAdvancedMetricActionType:function(evt){this.model.setAdvancedMetricActionType(evt.target.value,{silent:true});this.model.trigger("change")}});"use strict";
TSDK.UI.MetricsComponent.MetricsItemA4T=new PseudoClass({toString:"MetricsItemA4T",extend:TSDK.UI.MetricsComponent.MetricsItem,Template:function(){return TSDK.UI.Templates.MetricsComponent.MetricsItemA4T.apply(this,arguments)},View:TSDK.UI.MetricsComponent.MetricsItem.prototype.View.extend({additionalEvents:{"change .select-analytics-metric":"setAnalyticsMetric"}}),clearAllFields:function(){this.resetModelWithDefaults(this.getRenderAttributes())},resetModelWithDefaults:function(attributesToBeRetained,
options){this._super(attributesToBeRetained,{silent:true});this.model.setTitle(TSDK.I18n.get("MY PRIMARY GOAL"),options)},getRenderAttributes:function(){return["activityType","reportSuite","analyticsMetrics","config"]},setupByType:function(type,options){if(type==="analytics")this.setAnalyticsMetrics(this.analyticsMetrics,options)},setAnalyticsMetric:function(evt){var analyticsMetricId=evt.target.value,analyticsMetricSource=$(evt.target).find("coral-select-item:selected").data("source"),analyticsMetricSupport=
$(evt.target).find("coral-select-item:selected").data("support"),selectedOptionText=$(evt.target).find("coral-select-item:selected").text();this.model.setTitle(TSDK.I18n.get("ANALYTICS METRIC"),{silent:true});this.model.setAnalyticsMetricId(analyticsMetricId,{silent:true});this.model.setAnalyticsMetricSource(analyticsMetricSource,{silent:true});this.model.setAnalyticsMetricSupport(analyticsMetricSupport,{silent:true});this.model.trigger("change")},setAnalyticsMetrics:function(analyticsMetrics,options){this.model.setAnalyticsMetrics(analyticsMetrics,
options)},removeAnalyticsMetrics:function(options){this.model.clearAnalyticsMetrics(options)},showAnalyticsMetricsLoader:function(){this.view.$(".select-analytics-metric").addClass("hidden");this.view.$(".rs-alert").addClass("hidden");this.view.$("coral-wait.loading").removeClass("hidden")},verifyCriteria:function(title){if(this.model.getType()==="analytics")return title&&this.model.getAnalyticsMetricId();return this.getDefaultCriteria()}});
TSDK.UI.MetricsComponent.prototype.config={"CONVERSION_ENABLED":true,"REVENUE_ENABLED":true,"ENGAGEMENT_ENABLED":true,"ANALYTICS_METRIC_ENABLED":true,"REVENUE_SALES_ENABLED":true,"REVENUE_ORDERS_ENABLED":true,"PROJECTED_EARNINGS_ENABLED":false,"CURRENCY_SYMBOL":"$","ACTION_VIEWED_MBOX_ENABLED":true,"ACTION_CLICK_MBOX_ENABLED":false,"ADVANCED_SETTINGS_ENABLED":true,"POST_GOAL_METRIC_TRACKING_ENABLED":false,"CONVERSION_METRIC_CHECKBOX_ENABLED":true,"CLICK_TRACKING_ENABLED":false,"CLICK_RECOMMENDATION_ENABLED":false};
"use strict";
TSDK.UI.GoalModel=Backbone.Model.extend({getMetrics:function(){return this.get("metrics")},setMetrics:function(metrics){this.silentSet("metrics",metrics)},setAnalyticsMetricId:function(id){this.set("analyticsMetricId",id)},setAnalyticsMetricSource:function(source){this.set("analyticsMetricSource",source)},setAnalyticsMetricSupport:function(support){this.set("analyticsMetricSupport",support)},setAnalyticsSupport:function(isSupported){this.set("isAnalyticsSupported",isSupported)},getReportingSolution:function(){return this.get("reportingSolution")||"target"},
setReportingSolution:function(reportingSolution){this.silentSet("reportingSolution",reportingSolution)},getAnalyticsCompany:function(){return this.get("analyticsCompany")},setAnalyticsCompany:function(company){this.silentSet("analyticsCompany",company)},removeAnalyticsCompany:function(options){this.unset("analyticsCompany",options)},getReportSuite:function(){return this.get("reportSuite")||""},setReportSuite:function(reportSuite){this.silentSet("reportSuite",reportSuite)},removeReportSuite:function(options){this.unset("reportSuite",
options)},setReportSuiteValidation:function(isValid){this.silentSet("isReportSuiteValid",isValid)},getReportSuiteValidation:function(){return this.get("isReportSuiteValid")},removeReportSuiteValidation:function(){this.unset("isReportSuiteValid",{silent:true})},removeAttributesSilently:function(attributes){_.each(attributes,function(attr){this.unset(attr,{silent:true})},this)},silentSet:function(property,value,options){var settingOptions={silent:true};if(options)_.extend(settingOptions,options);this.set(property,
value,settingOptions)}});"use strict";
TSDK.UI.Goals=new PseudoClass({toString:"Goals",extend:TSDK.UI.ConfigurableComponent,Model:TSDK.UI.GoalModel,View:F.View.extend({events:{"change .reporting-solution":"updateReportingSolution"}}),initialize:function(options){this.registerVars(options);this.setAnalyticsSupport();this.initView(options);this.registerListeners();this.registerBinders()},destruct:function(){},handleConfigChanged:function(){if(this.model){this.model.set("config",this.config);if(this.config.SHOW_ONLY_ANALYTICS)this.model.setReportingSolution("analytics")}},setAnalyticsSupport:function(){if(this.isAnalyticsEnabled())this.model.setAnalyticsSupport(true)},
initView:function(options){this.view=new this.View({el:options.el,component:this,template:TSDK.UI.Templates.Goals.Goals,model:this.model})},registerListeners:function(){this.listenTo(this.view,"renderComplete",function(){this.renderSubViews()})},registerVars:function(options){this.analytics=options.analytics;this.metricsOptions=options.metrics},registerBinders:function(){this.bind("delegateShowAudiencePickerEvent");this.bind("onCompaniesFetched");this.bind("updateAnalyticsCompany");this.bind("validateReportSuite");
this.bind("updateReportSuite");this.bind("fetchMetricsForReportSuite");this.bind("handleFetchMetricsError");this.bind("notifyError")},renderSubViews:function(){if(this.isAnalyticsEnabled()&&this.model.getReportingSolution()==="analytics"){this.addAnalyticsCompanyPicker();this.addReportSuitePicker();this.hideUnnecessaryAnalyticsElements(this.components.companyPicker.getCompanies());this.updateCompanyForReportingSuites()}this.addMetrics();if(this.model.getReportingSolution()!=="analytics"||!this.isAnalyticsEnabled());
},isAnalyticsEnabled:function(){var analytics=this.analytics;return analytics&&_.isFunction(analytics.fetchCompanies)&&_.isFunction(analytics.fetchReportSuites)},addMetrics:function(){var reportingSolution=this.model.getReportingSolution(),reportSuite=this.model.getReportSuite(),analyticsMetrics=this.analyticsMetrics,data=this.model.getMetrics();this.metrics&&this.metrics.destructButKeepEl();this.metrics=this.addComponent(new TSDK.UI.MetricsComponent(_.extend({},this.metricsOptions,{el:this.view.$(".tsdk-metrics"),
visible:true,reportingSolution:reportingSolution,reportSuite:reportSuite,analyticsMetrics:analyticsMetrics,data:data})),"metrics").on("metrics:addAudience",this.delegateShowAudiencePickerEvent)},addAnalyticsCompanyPicker:function(){var company=this.model.getAnalyticsCompany(),fetchCompanies=this.analytics.fetchCompanies;this.components["companyPicker"]&&this.components["companyPicker"].destructButKeepEl();this.addComponent(new TSDK.UI.Goals.SCCompanyPicker({el:this.view.$(".sc-company-picker-placeholder"),
selected:company||null,fetchCompanies:fetchCompanies}),"companyPicker").on("scCompany:fetched",this.onCompaniesFetched).on("scCompany:selected",this.updateAnalyticsCompany).on("error",this.notifyError);this.components["companyPicker"].show()},addReportSuitePicker:function(){var company=this.model.getAnalyticsCompany(),reportSuite=this.model.getReportSuite(),fetchReportSuites=this.analytics.fetchReportSuites;this.components["reportSuitePicker"]&&this.components["reportSuitePicker"].destructButKeepEl();
this.addComponent(new TSDK.UI.Goals.ReportSuitePicker({el:this.view.$(".report-suite-picker-placeholder"),company:company,selected:reportSuite||null,fetchReportSuites:fetchReportSuites}),"reportSuitePicker").on("reportSuite:selected",this.updateReportSuite).on("reportSuite:validate",this.validateReportSuite).on("error",this.notifyError);this.components["reportSuitePicker"].show();if(reportSuite)this.loadAnalyticsMetrics(reportSuite)},onCompaniesFetched:function(companiesList){if(companiesList){this.hideUnnecessaryAnalyticsElements(companiesList);
this.updateCompanyForReportingSuites()}},hideUnnecessaryAnalyticsElements:function(companiesList){if(companiesList)if(companiesList.length===1)this.view.$(".sc-company-container").addClass("read-only");else if(companiesList.length===0)this.view.$(".report-suite-container").addClass("hidden")},updateCompanyForReportingSuites:function(){var selectedCompany=this.components.companyPicker.getSelectedCompany();this.model.setAnalyticsCompany(selectedCompany);if(this.components.reportSuitePicker)this.components.reportSuitePicker.updateCompany(selectedCompany)},
updateAnalyticsCompany:function(company){var reportSuite=this.model.getReportSuite();this.model.setAnalyticsCompany(company);this.metrics.components.metric0.removeAnalyticsMetrics({silent:true});this.components.reportSuitePicker.updateCompany(company);this.components.reportSuitePicker.updateSelection(reportSuite);if(reportSuite)this.loadAnalyticsMetrics(reportSuite);this.propagateEvent("scCompany:selected",company)},loadAnalyticsMetrics:function(reportSuite){var company=this.model.getAnalyticsCompany(),
fetchMetrics=this.analytics.fetchMetrics;if(_.isFunction(fetchMetrics))fetchMetrics.call(undefined,company,reportSuite,this.fetchMetricsForReportSuite,this.handleFetchMetricsError)},fetchMetricsForReportSuite:function(response){var errorMsg,analyticsMetrics,analyticsMetricsItem;if(this.metrics)analyticsMetricsItem=this.metrics.components.metric0;if(response.errmsg){errorMsg=response.errmsg||"";this.showErrorNotification(TSDK.I18n.get("Error loading metrics from Analytics. {0}",errorMsg))}else{analyticsMetrics=
_.sortBy(_.map(response,function(value,key){return{id:key,name:value.name,frag_id:value.frag_id,type:value.type,source:value.source,support:value.support,data_group:value.data_group}}),function(metric){return metric.name});this.analyticsMetrics=analyticsMetrics;if(analyticsMetricsItem){analyticsMetricsItem.analyticsMetrics=analyticsMetrics;analyticsMetricsItem.setAnalyticsMetrics(analyticsMetrics)}}},handleFetchMetricsError:function(jqXHR,textStatus,errorThrown){var errorMsg;errorMsg=JSON.parse(jqXHR.responseText)["error.message"]||
errorThrown;this.showErrorNotification(TSDK.I18n.get("Error loading metrics from Analytics. {0}",errorMsg))},updateReportSuite:function(reportSuite){this.metrics.components["metric0"].removeAnalyticsMetrics({silent:true});this.model.setReportSuite(reportSuite);this.metrics.components["metric0"].model.setReportSuite(reportSuite,{silent:true});this.metrics.components["metric0"].showAnalyticsMetricsLoader();this.loadAnalyticsMetrics(reportSuite);this.markRSPickerInvalid(false);this.propagateEvent("reportSuite:selected",
reportSuite)},validateReportSuite:function(reportSuites){this.model.setReportSuiteValidation(false);if(reportSuites&&reportSuites[this.model.getReportSuite()])this.model.setReportSuiteValidation(true)},updateReportingSolution:function(event){var currentSolution=this.model.getReportingSolution(),selectedSolution=event.target.value;if(selectedSolution!==currentSolution){this.model.setReportingSolution(selectedSolution);this.toggleRSPickerVisibility();this.switchReportingSolution(selectedSolution,{silent:selectedSolution===
"analytics"});this.propagateEvent("reportingSolution:changed",selectedSolution);if(selectedSolution==="analytics")this.render();else{this.removeReportSuite();this.removeAnalyticsCompany()}}},markRSPickerInvalid:function(isInvalid){var reportSuitePicker=this.view.$(".report-suite-picker").get(0);if(reportSuitePicker)reportSuitePicker.invalid=isInvalid},toggleRSPickerVisibility:function(){var companyPicker=this.components["companyPicker"];if(this.model.getReportingSolution()==="analytics"&&companyPicker){this.view.$(".reporting-company-suite-container").removeClass("hidden");
this.hideUnnecessaryAnalyticsElements(companyPicker.getCompanies())}else this.view.$(".reporting-company-suite-container").addClass("hidden")},switchReportingSolution:function(selectedSolution,options){this.resetMetrics();this.metrics.setReportingSolution(selectedSolution,options)},resetMetrics:function(){this.model.setMetrics([]);this.metrics.setMetrics([])},removeReportSuite:function(){this.components["reportSuitePicker"].updateSelection("");this.model.removeReportSuite({silent:true})},removeAnalyticsCompany:function(){this.components["companyPicker"].removeSelectedCompany();
this.model.removeAnalyticsCompany({silent:true})},filterUnwantedGoalsAttributes:function(goalsData){var attributesToBeExcluded=["isAnalyticsSupported","isReportSuiteValid","config"];return _.omit(goalsData,attributesToBeExcluded)},notifyError:function(options){this.propagateEvent("error",options)},isReportSuiteValid:function(){var rsValidation=this.model.getReportSuiteValidation();if(this.model&&this.model.getReportingSolution()==="analytics"&&(!this.model.getReportSuite()||_.isBoolean(rsValidation)&&
!rsValidation)){this.notifyError({message:TSDK.I18n.get("Please select a report suite.")});this.markRSPickerInvalid(true);return false}return true},validate:function(highlightErrors){return this.isReportSuiteValid()&&this.metrics.validate(highlightErrors)},saveGoals:function(){var metrics=this.metrics.getData();this.model.setMetrics(metrics)},getGoals:function(){return this.model.toJSON()},getContext:function(){this.saveGoals();return this.filterUnwantedGoalsAttributes(this.getGoals())},setContext:function(goals){if(goals&&
goals.reportSuite)goals.reportingSolution="analytics";this.loadModel(goals)}});TSDK.UI.ItemFactory=function(options){this.items=[];this.itemsFetched=false;this.disableCache=false;this.disableFactory=false;this.url=options.url;this.pageSize=options.pageSize;this.factoryName=options.name;if(options.parse)this.parse=options.parse;if(typeof options.disableCache!=="undefined")this.disableCache=options.disableCache;if(options.disable)this.disable();if(options.fetch)this.fetchItems()};
TSDK.UI.ItemFactory.prototype.toString=function(){return this.factoryName};TSDK.UI.ItemFactory.prototype.isDisabled=function(){return this.disableFactory};TSDK.UI.ItemFactory.prototype.disable=function(){this.disableFactory=true};TSDK.UI.ItemFactory.prototype.enable=function(){this.disableFactory=false};_getItemsInDisabledState=function(callback){if(typeof callback==="function")callback.call("undefined",[])};
TSDK.UI.ItemFactory.prototype.getItems=function(options){if(this.isDisabled())return _getItemsInDisabledState(options.callback);if(this.itemsFetched){if(typeof options.callback==="function")options.callback.call(undefined,this.items)}else this.fetchItems(options)};TSDK.UI.ItemFactory.prototype.buildUrl=function(url,params){params=params||"";if(this.pageSize)params+=(!params?"":"\x26")+("pageSize\x3d"+this.pageSize);return params?url+(url.indexOf("?")!==-1?"\x26":"?")+params:url};
TSDK.UI.ItemFactory.prototype.fetchItems=function(options){if(this.isDisabled())return _getItemsInDisabledState(options.callback);var that=this,url=this.url;options=options||{};$.ajax({url:this.buildUrl(url,options.params),async:options.hasOwnProperty("async")?options.async:true,contentType:"application/json; charset\x3dutf-8",dataType:"json"}).done(function(response){if(!that.disableCache)that.itemsFetched=true;that.items=that.parse(response);if(typeof options.callback==="function")options.callback.call(undefined,
that.items)}).fail(function(jqXHR){if(typeof options.callback==="function")options.callback.call(undefined,that.items);if(typeof options.error==="function")options.error.call(undefined,jqXHR)})};TSDK.UI.ItemFactory.prototype.parse=function(response){return response.items||[]};TSDK.UI.ItemFactory.prototype.setUrl=function(url){this.url=url};"use strict";
TSDK.UI.Goals.ReportSuiteFactory=new TSDK.UI.ItemFactory({name:"reportSuiteFactory",url:"",parse:function(response){return _.isObject(response)&&this.filterTargetEnabledReportSuites(response)},disableCache:true});TSDK.UI.Goals.ReportSuiteFactory.filterTargetEnabledReportSuites=function(reportSuites){var filterCriterion="target",filteredSuites=_.pick(reportSuites,function(reportSuite){return _.contains(reportSuite.enabledSolutions,filterCriterion)});return _.size(filteredSuites)>0?filteredSuites:[]};
"use strict";
TSDK.UI.Goals.ReportSuitePicker=new PseudoClass({toString:"ReportSuitePicker",extend:F.ModelComponent,_company:null,View:F.View.extend({events:{"change .report-suite-picker":"triggerReportSuiteSelectedEvent"}}),construct:function(options){this._company=options.company;this.fetchReportSuitesCallback=options.fetchReportSuites;this.initializeModel(options.selected);this.initializeView(options.el);this.load(this.model);this.registerBinders();this.addListeners();if(options.reportSuites)this.setReportSuites(options.reportSuites);else this.fetchReportSuites(this.fetchReportSuitesCallback)},
initializeModel:function(selectedReportSuite){this.model=new Backbone.Model({selectedReportSuite:selectedReportSuite})},initializeView:function(element){this.view=new this.View({el:element,component:this,model:this.model,template:TSDK.UI.Templates.Goals.ReportSuitePicker})},registerBinders:function(){this.bind("initializeWidgets");this.bind("fetchCallback");this.bind("handleFetchError")},addListeners:function(){this.listenTo(this.view,"renderComplete",this.initializeWidgets)},initializeWidgets:function(){},
updateCompany:function(company){if(company!=this._company){this._company=company;this.clearReportSuites();this.fetchReportSuites(this.fetchReportSuitesCallback)}},updateSelection:function(reportSuite,options){this.model.set("selectedReportSuite",reportSuite,options)},fetchReportSuites:function(fetchReportSuites){if(this._company)if(_.isFunction(fetchReportSuites))fetchReportSuites.call(undefined,this._company,this.fetchCallback,this.handleFetchError)},fetchCallback:function(response){var reportSuites=
TSDK.UI.Goals.ReportSuiteFactory.parse(response);if(!reportSuites){this.showFetchErrorNotification();reportSuites=[]}this.setReportSuites(reportSuites);this.triggerValidateReportSuite()},handleFetchError:function(jqXHR){var errorMsg=JSON.parse(jqXHR.responseText)["error.message"];this.showFetchErrorNotification(errorMsg);this.setReportSuites([]);this.triggerValidateReportSuite()},triggerReportSuiteSelectedEvent:function(event){if(event.target.value.length>0){this.updateSelection(event.target.value,
{silent:true});this.trigger("reportSuite:selected",event.target.value);this.triggerValidateReportSuite()}},showFetchErrorNotification:function(message){message=message||"";this.trigger("error",{message:TSDK.I18n.get("Unable to load report suites from Adobe Analytics. ")+message})},triggerValidateReportSuite:function(){var reportSuites=this.model.get("reportSuites");this.trigger("reportSuite:validate",reportSuites)},clearReportSuites:function(options){this.model.unset("reportSuites",options)},setReportSuites:function(reportSuites){this.model.set("reportSuites",
reportSuites)}});"use strict";TSDK.UI.Goals.SCCompanyFactory=new TSDK.UI.ItemFactory({name:"sCCompanyFactory",url:"",parse:function(response){return _.isObject(response)&&this.getCompaniesList(response)}});TSDK.UI.Goals.SCCompanyFactory.getCompaniesList=function(response){var companiesList=[];_.each(response.companies,function(company){companiesList.push({name:company})});return{companiesList:companiesList,activeCompany:response.activeCompany}};"use strict";
TSDK.UI.Goals.SCCompanyPicker=new PseudoClass({toString:"SCCompanyPicker",extend:F.ModelComponent,View:F.View.extend({events:{"change .sc-company-picker":"triggerCompanySelectedEvent"}}),construct:function(options){this.initializeModel(options.selected);this.initializeView(options.el);this.load(this.model);this.registerBinders();this.addListeners();if(options.companies)this.setCompanies(options.companies);else this.fetchCompanies(options.fetchCompanies)},initializeModel:function(selectedCompany){this.model=
new Backbone.Model({selectedCompany:selectedCompany})},initializeView:function(element){this.view=new this.View({el:element,component:this,model:this.model,template:TSDK.UI.Templates.Goals.SCCompanyPicker})},registerBinders:function(){this.bind("initializeWidgets");this.bind("fetchCallback")},addListeners:function(){this.listenTo(this.view,"renderComplete",this.initializeWidgets)},initializeWidgets:function(){},updateSelection:function(company){this.model.set("selectedCompany",company)},getSelectedCompany:function(){return this.model.get("selectedCompany")},
fetchCompanies:function(fetchCompanies){if(_.isFunction(fetchCompanies))fetchCompanies.call(undefined,this.fetchCallback,this.handleFetchError)},fetchCallback:function(response){var scCompanies=TSDK.UI.Goals.SCCompanyFactory.parse(response);if(!scCompanies)scCompanies=[];this.setCompanies(scCompanies)},handleFetchError:function(){this.setCompanies([])},triggerCompanySelectedEvent:function(event){this.trigger("scCompany:selected",event.target.value)},getCompanies:function(){return this.model.get("scCompanies")},
setCompanies:function(response){var selectedCompany=this.getSelectedCompany(),newSelection;if(selectedCompany){newSelection=selectedCompany;if(response.activeCompany&&selectedCompany!=response.activeCompany){newSelection=_.find(response.companiesList,function(company){return company.name===selectedCompany});if(newSelection)newSelection=selectedCompany;else newSelection=response.activeCompany}}else newSelection=response.activeCompany;if(newSelection!=selectedCompany)this.model.set("selectedCompany",
newSelection,{silent:true});this.model.set("scCompanies",response.companiesList);this.trigger("scCompany:fetched",response.companiesList)},removeSelectedCompany:function(options){this.model.unset("selectedCompany",options)}});TSDK.UI.Goals.prototype.config={"SHOW_ONLY_ANALYTICS":false};"use strict";
TSDK.UI.GoalsAndSettingsModel=Backbone.Model.extend({getGoals:function(){return this.get("goals")},setGoals:function(goals){this.silentSet("goals",goals)},silentSet:function(property,value,options){var settingOptions={silent:true};if(options)_.extend(settingOptions,options);this.set(property,value,settingOptions)}});"use strict";
TSDK.UI.GoalsAndSettings=new PseudoClass({toString:"GoalsAndSettings",extend:TSDK.UI.Component,Model:TSDK.UI.GoalsAndSettingsModel,View:F.View.extend({events:{}}),initialize:function(options){this.initView(options);this.registerListeners();this.registerVars(options);this.registerBinders()},initView:function(options){this.view=new this.View({el:options.el,component:this,template:TSDK.UI.Templates.GoalsAndSettings.GoalsAndSettings,model:this.model})},registerListeners:function(){this.listenTo(this.view,
"renderComplete",function(){this.renderSubViews()})},registerVars:function(options){this.goalsOptions=options.goals},registerBinders:function(){},renderSubViews:function(){this.addGoals()},addGoals:function(){var data=this.model.getGoals();this.goals&&this.goals.destructButKeepEl();this.goals=this.addComponent(new TSDK.UI.Goals(_.extend({},this.goalsOptions,{el:this.view.$(".tsdk-goals"),visible:true,data:data})),"goals")},validate:function(highlightErrors){return this.goals.validate(highlightErrors)},
saveGoalsAndSettings:function(){var goalsContext=this.goals.getData();this.model.setGoals(goalsContext)},getGoalsAndSettings:function(){return this.model.toJSON()},getContext:function(){this.saveGoalsAndSettings();return this.getGoalsAndSettings()},setContext:function(goalsAndSettings){this.loadModel(goalsAndSettings)}});TSDK.UI.GoalsAndSettings.prototype.config={};"use strict";
TSDK.UI.DiagramComponent=new PseudoClass({toString:"Diagram",extend:TSDK.UI.Component,View:F.View.extend({commonEvents:{"coral-selectlist:change .tsdk-audience-box .context-menu coral-selectlist":"_handleAudienceAction","coral-selectlist:change .tsdk-experience-box .context-menu coral-selectlist":"_handleExperienceAction","click .no-audience":"_handleAudienceAdd","click .no-experience":"_handleExperienceAdd","change .experience-title-input":"_handleExperienceTitleChange","blur .experience-title-input":"_handleExperienceTitleChange"},
additionalEvents:{},events:function(){return _.extend({},this.commonEvents,this.additionalEvents)}}),initialize:function(options){this._handleBeforeInitialize(options);this._initView(options)},_handleBeforeInitialize:function(){},_initView:function(options){this.view=new this.View({el:options.el,component:this,template:this._getTemplate(),model:this.model})},_getTemplate:function(){throw new Error("No template defined for "+this.toString());},_getEmptyExperience:function(){return{}},_handleAudienceAction:function(evt){var selectedItem=
evt.target.selectedItem,action=selectedItem.value,audienceIndex=$(selectedItem).closest(".diagram-row").data("index"),audience=this.getAudience(audienceIndex);this._performActionOnAudience(action,audienceIndex,audience)},_handleAudienceAdd:function(evt){var audienceIndex=$(evt.target).closest(".diagram-row").data("index");this._performActionOnAudience("add",audienceIndex)},_performActionOnAudience:function(){},_handleExperienceAction:function(evt){var selectedItem=evt.target.selectedItem,action=selectedItem.value,
experienceIndex=$(selectedItem).closest(".diagram-row").data("index"),experience=this.getExperience(experienceIndex);if(action==="rename")this._toggleExperienceNameEditMode(experienceIndex,true);else this._performActionOnExperience(action,experienceIndex,experience)},_handleExperienceAdd:function(evt){var experienceIndex=$(evt.target).closest(".diagram-row").data("index");this._performActionOnExperience("add",experienceIndex)},_performActionOnExperience:function(){},_handleExperienceTitleChange:function(evt){var $experienceTitleInput=
$(evt.target),newName=$.trim($experienceTitleInput.val()),experienceIndex=$experienceTitleInput.closest(".diagram-row").data("index"),experience=this.getExperience(experienceIndex);if(newName==="")this.notifyError({message:TSDK.I18n.get("Experience name cannot be empty.")});else if(experience.name!==newName)this.renameExperience(experienceIndex,newName);this._toggleExperienceNameEditMode(experienceIndex,false)},_toggleExperienceNameEditMode:function(index,flag){var $experienceBox=this.view.$(".tsdk-experience-box").eq(index),
$experienceNameInput=$experienceBox.find(".experience-title-input"),experienceNameInput=$experienceNameInput.get(0);Coral.commons.nextFrame(function(){$experienceBox.toggleClass("edit-mode",flag);if(flag){$experienceBox.click();$experienceNameInput.focus();experienceNameInput.selectionStart=experienceNameInput.selectionEnd=experienceNameInput.value.length}})},renameExperience:function(experienceIndex,newName){var experiences=TSDK.UI.Util.clone(this.model.get("experiences")),experience,oldName;if(experiences&&
experiences.length&&experienceIndex<experiences.length){experience=experiences[experienceIndex];oldName=experience.name;experience.name=newName;this.model.set("experiences",experiences);this.trigger("experience:renamed",{index:experienceIndex,experience:experience,oldName:oldName,newName:newName})}},getAudience:function(index){},getExperience:function(index){},validateExperiences:function(){var experienceNames=_.map(this.model.get("experiences"),function(experience){return experience.name}),errorMessage;
if(experienceNames.length===0||_.compact(experienceNames).length!==experienceNames.length)errorMessage=TSDK.I18n.get("Some experiences are not defined.");else if(_.uniq(experienceNames).length!==experienceNames.length)errorMessage=TSDK.I18n.get("Duplicate experience names");if(errorMessage){this.notifyError({message:errorMessage});return false}return true},validate:function(){return true},notifyError:function(options){this.trigger("error",options)}});"use strict";
TSDK.UI.DiagramAB=new PseudoClass({toString:"DiagramAB",extend:TSDK.UI.DiagramComponent,View:TSDK.UI.DiagramComponent.prototype.View.extend({additionalEvents:{"keydown .visitor-percentage":"_handleVisitorPercentageKeydown","change .visitor-percentage":"_handleVisitorPercentageChange"}}),_getTemplate:function(){return TSDK.UI.Templates.DiagramComponent.DiagramAB},_handleBeforeInitialize:function(){var experiences=this.model.get("experiences");this._lockVisitorPercentage(experiences);this._calculateVisitorPercentage(experiences)},
_lockVisitorPercentage:function(experiences){_.each(experiences,function(experience){if(_.isNumber(experience.visitorPercentage))experience.isVisitorPercentageLocked=true})},_calculateVisitorPercentage:function(experiences){var remainingPercentage=100,experiencesToBeUpdated=[],experiencesToBeUpdatedCount,percentageShare;_.each(experiences,function(experience){var percentage=experience.visitorPercentage;if(_.isNumber(percentage)&&experience.isVisitorPercentageLocked)remainingPercentage-=percentage;
else experiencesToBeUpdated.push(experience)});experiencesToBeUpdatedCount=experiencesToBeUpdated.length;if(experiencesToBeUpdatedCount){remainingPercentage=remainingPercentage<0?0:remainingPercentage;percentageShare=Math.floor(remainingPercentage/experiencesToBeUpdatedCount);_.each(experiencesToBeUpdated,function(experience){experience.visitorPercentage=percentageShare;remainingPercentage-=percentageShare});if(remainingPercentage>0)for(var i=0;i<remainingPercentage;i++)experiencesToBeUpdated[i].visitorPercentage++}},
_handleVisitorPercentageKeydown:function(evt){var keyCode=evt.keyCode||evt.which;if([46,8,9,27,13].indexOf(keyCode)>-1||keyCode>=35&&keyCode<=39)return;if(evt.shiftKey||!(keyCode>=48&&keyCode<=57||keyCode>=96&&keyCode<=105))evt.preventDefault()},_handleVisitorPercentageChange:function(evt){var $visitorPercentageInput=$(evt.target),newPercentage=parseInt($.trim($visitorPercentageInput.val())),experienceIndex=$visitorPercentageInput.closest(".diagram-row").data("index"),experience=this.getExperience(experienceIndex),
errorMessage;if(_.isNaN(newPercentage))errorMessage=TSDK.I18n.get("Invalid visitor percentage.");else if(newPercentage<0||newPercentage>100)errorMessage=TSDK.I18n.get("Visitor percentage should be a valid number between 0 to 100.");else if(experience.visitorPercentage!==newPercentage)this.setVisitorPercentage(experienceIndex,newPercentage);if(errorMessage){$visitorPercentageInput.val(experience.visitorPercentage);this.notifyError({message:errorMessage})}},setVisitorPercentage:function(experienceIndex,
newPercentage){var experiences=TSDK.UI.Util.clone(this.model.get("experiences")),experience,oldPercentage;if(experiences&&experiences.length&&experienceIndex<experiences.length){experience=experiences[experienceIndex];oldPercentage=experience.visitorPercentage;experience.visitorPercentage=newPercentage;experience.isVisitorPercentageLocked=true;this._calculateVisitorPercentage(experiences);this.model.set("experiences",experiences);this.trigger("experience:visitorPercentage:changed",{index:experienceIndex,
experience:experience,oldPercentage:oldPercentage,newPercentage:newPercentage})}},_performActionOnAudience:function(action,audienceIndex,audience){var callback;if(action==="remove")this.removeAudience();else if(action==="add"||action==="edit")callback=this._setAudience.bind(this);this.trigger("audience:"+action,{index:audienceIndex,audience:audience,callback:callback})},_performActionOnExperience:function(action,experienceIndex,experience){var callback;if(action==="remove")this.removeExperience(experienceIndex);
else if(action==="add"||action==="edit"){callback=this._setExperience.bind(this);this.activeIndex=experienceIndex}this.trigger("experience:"+action,{index:experienceIndex,experience:experience,callback:callback})},_setAudience:function(audience){if(audience)this.model.set("audience",audience)},removeAudience:function(){this.model.unset("audience")},_setExperience:function(experience){if(experience){var experiences=_.clone(this.model.get("experiences"))||[];if(_.isNumber(this.activeIndex)&&this.activeIndex<
experiences.length)experiences[this.activeIndex]=experience;else experiences.push(experience);this._calculateVisitorPercentage(experiences);this.model.set("experiences",experiences)}this._resetActiveIndex()},_resetActiveIndex:function(){delete this.activeIndex},addExperience:function(experience){if(experience){this._resetActiveIndex();this._setExperience(experience)}else this._performActionOnExperience("add")},removeExperience:function(index){var experiences=_.clone(this.model.get("experiences"));
experiences.splice(index,1);this._calculateVisitorPercentage(experiences);this.model.set("experiences",experiences)},getAudience:function(){return this.model.get("audience")},getExperience:function(index){var experiences=this.model.get("experiences");return experiences&&experiences[index]},validateAudience:function(){var audience=this.getAudience();if(!audience||!audience.name){this.notifyError({message:TSDK.I18n.get("Audience is not defined.")});return false}return true},validateVisitorPercentage:function(){var totalPercentage=
_.reduce(this.model.get("experiences"),function(memo,experience){return memo+experience.visitorPercentage},0);if(totalPercentage!==100){this.notifyError({message:TSDK.I18n.get("Total visitor percentage is not equal to 100.")});return false}return true},validate:function(){return this.validateAudience()&&this.validateExperiences()&&this.validateVisitorPercentage()},getContext:function(){var context=this.model.toJSON(),experiences=TSDK.UI.Util.clone(context.experiences);if(experiences){_.each(experiences,
function(experience){delete experience.isVisitorPercentageLocked});context.experiences=experiences}return context}});"use strict";
TSDK.UI.DiagramXT=new PseudoClass({toString:"DiagramXT",extend:TSDK.UI.DiagramComponent,View:TSDK.UI.DiagramComponent.prototype.View.extend({additionalEvents:{}}),_getTemplate:function(){return TSDK.UI.Templates.DiagramComponent.DiagramXT},_performActionOnAudience:function(action,audienceIndex,audience){var callback;if(action==="remove")this.removeAudience(audienceIndex);else if(action==="add"||action==="edit"){callback=this._setAudience.bind(this);this.activeIndex=audienceIndex}this.trigger("audience:"+
action,{index:audienceIndex,audience:audience,callback:callback})},_performActionOnExperience:function(action,experienceIndex,experience){var callback;if(action==="remove")this.removeExperience(experienceIndex);else if(action==="add"||action==="edit"){callback=this._setExperience.bind(this);this.activeIndex=experienceIndex}this.trigger("experience:"+action,{index:experienceIndex,experience:experience,callback:callback})},_setAudience:function(audience){if(audience){var experiences=TSDK.UI.Util.clone(this.model.get("experiences"))||
[],experience;if(_.isNumber(this.activeIndex)&&this.activeIndex<experiences.length)experience=experiences[this.activeIndex];else{experience=this._getEmptyExperience();experiences.push(experience)}experience.audience=audience;this.model.set("experiences",experiences)}this._resetActiveIndex()},removeAudience:function(index){this.removeExperience(index)},_setExperience:function(experience){if(experience){var experiences=_.clone(this.model.get("experiences"))||[],oldAudience;if(_.isNumber(this.activeIndex)&&
this.activeIndex<experiences.length){oldAudience=experiences[this.activeIndex].audience;experiences[this.activeIndex]=experience;experience.audience=experience.audience||oldAudience}else experiences.push(experience);this.model.set("experiences",experiences)}this._resetActiveIndex()},_resetActiveIndex:function(){delete this.activeIndex},addExperienceTargeting:function(experience){var lastExperience=this._getLastExperience();if(experience){this._resetActiveIndex();this._setExperience(experience)}else if(!lastExperience||
_.size(lastExperience)!==0)this._performActionOnAudience("add")},_getLastExperience:function(){var experiences=this.model.get("experiences"),experiencesLength=experiences.length;if(experiencesLength>0)return experiences[experiencesLength-1]},removeExperience:function(index){var experiences=_.clone(this.model.get("experiences"));experiences.splice(index,1);if(experiences.length===0)experiences.push(this._getEmptyExperience());this.model.set("experiences",experiences)},getAudience:function(index){var experience=
this.getExperience(index);return experience&&experience.audience},getExperience:function(index){var experiences=this.model.get("experiences");return experiences&&experiences[index]},validateAudiences:function(){var audienceNames=_.map(this.model.get("experiences"),function(experience){return experience.audience&&experience.audience.name}),errorMessage;if(_.compact(audienceNames).length!==audienceNames.length)errorMessage=TSDK.I18n.get("Some audiences are not defined.");else if(_.uniq(audienceNames).length!==
audienceNames.length)errorMessage=TSDK.I18n.get("Duplicate audiences");if(errorMessage){this.notifyError({message:errorMessage});return false}return true},validate:function(){return this.validateAudiences()&&this.validateExperiences()}});TSDK.UI.DiagramComponent.prototype.config={};TSDK.EnumUtil.addEnum("ExperienceRailActions",{EDIT_AUDIENCE:"edit",RENAME_EXPERIENCE:"rename",DUPLICATE:"duplicate",DELETE:"delete"});"use strict";
TSDK.UI.ExperienceRailComponent=new PseudoClass({toString:"ExperienceRail",extend:TSDK.UI.ConfigurableComponent,View:F.View.extend({commonEvents:{"click .collapse-btn":"collapseRail","click .expand-btn":"expandRail","click .experience-row .menu-button":"_handleMenuButtonClick","click .experience-row":"_handleExperienceRowClick"},additionalEvents:{},events:function(){return _.extend({},this.commonEvents,this.additionalEvents)}}),MINIMUM_EXPERIENCES:0,MAXIMUM_EXPERIENCES:1E5,modes:{EXPANDING:"expanding",
EXPANDED:"expanded",COLLAPSING:"collapsing",COLLAPSED:"collapsed"},railWidth:{EXPANDED:"15.625rem",COLLAPSED:"3rem"},ANIMATION_DURATION:250,initialize:function(options){this._initConfigs();this._registerBinders();this._initView(options);this._addContextPopover()},_initConfigs:function(){this._initActions();this._initMode();this._initActiveIndex();this._initAutoAdd();this._initMinMaxExperiencesCount()},_initActions:function(){var actions=this.getConfigInModel("actions")||this._defaultActions;this.setConfigInModel("actions",
actions)},_initMode:function(){var mode=this.getConfigInModel("mode")||this.modes.EXPANDED;this.setConfigInModel("mode",mode)},_initActiveIndex:function(){this.switchExperience(this.getConfigInModel("activeIndex"))},_initAutoAdd:function(){var autoAdd=this.getConfigInModel("autoAdd");if(_.isUndefined(autoAdd))autoAdd=true;this.setConfigInModel("autoAdd",autoAdd)},_initMinMaxExperiencesCount:function(){var minExperiencesCount=this.getConfigInModel("minCount"),maxExperiencesCount=this.getConfigInModel("maxCount"),
experiencesCount=this.getExperiencesCount();if(!_.isNumber(minExperiencesCount)||minExperiencesCount<this.MINIMUM_EXPERIENCES)minExperiencesCount=this.MINIMUM_EXPERIENCES;if(!_.isNumber(maxExperiencesCount)||maxExperiencesCount<minExperiencesCount||maxExperiencesCount>this.MAXIMUM_EXPERIENCES)maxExperiencesCount=this.MAXIMUM_EXPERIENCES;this.setConfigInModel("minCount",minExperiencesCount);this.setConfigInModel("maxCount",maxExperiencesCount);while(experiencesCount<minExperiencesCount){this.addExperience({});
experiencesCount++}},_initView:function(options){this.view=new this.View({el:options.el,component:this,template:this._getTemplate(),model:this.model})},_getTemplate:function(){throw new Error("No template defined for "+this.toString());},_registerBinders:function(){this.bind("_handleContextPopoverClose");this.bind("_handleMenuAction");this.bind("_handleExperienceNameKeydown");this.bind("_handleExperienceNameSave");this.bind("_handleExperienceNameCancel")},_addContextPopover:function(){var oldContextPopover=
$(".tsdk-experiencerail-context-popover").get(0);oldContextPopover&&oldContextPopover.remove();this.contextPopover=(new Coral.Popover).set({alignMy:Coral.Overlay.align.LEFT_TOP,alignAt:Coral.Overlay.align.CENTER_BOTTOM,offset:-8});$(this.contextPopover).appendTo("body").addClass("tsdk-experiencerail-context-popover").get(0).on("coral-overlay:close",this._handleContextPopoverClose).on("coral-selectlist:change",".action-menu",this._handleMenuAction).on("keydown",".experience-title-input",this._handleExperienceNameKeydown).on("click",
".rename-save-button",this._handleExperienceNameSave).on("click",".rename-cancel-button",this._handleExperienceNameCancel)},_changeMode:function(mode,triggerModelChange){this.setConfigInModel("mode",mode);this.view.$(".tsdk-experience-rail").attr("data-mode",mode);if(triggerModelChange)this.model.trigger("change")},collapseRail:function(){var that=this,$rail=this.view.$(".tsdk-experience-rail"),$collapseBtn=$rail.find(".collapse-btn \x3e coral-icon"),noAnimation=this.getConfigInModel("noAnimation"),
isRailRightPlaced=this.getConfigInModel("placement")==="right";if(noAnimation){this._changeMode(this.modes.COLLAPSED);this.trigger("rail:collapsed",$rail.outerWidth());return}$rail.width(this.railWidth.EXPANDED);this._changeMode(this.modes.COLLAPSING);$rail.animate({width:this.railWidth.COLLAPSED},{duration:this.ANIMATION_DURATION,progress:function(a,p,remainingMs){var iconRotationDegree=(1-remainingMs/that.ANIMATION_DURATION)*180;if(isRailRightPlaced)iconRotationDegree*=-1;$collapseBtn.css({transform:"rotate("+
iconRotationDegree+"deg)"});that.trigger("rail:collapsing",$rail.outerWidth())},always:function(){$collapseBtn.css({transform:"rotate(0deg)"});that._changeMode(that.modes.COLLAPSED);that.trigger("rail:collapsed",$rail.outerWidth())}})},expandRail:function(){var that=this,$rail=this.view.$(".tsdk-experience-rail"),$expandBtn=$rail.find(".expand-btn \x3e coral-icon"),noAnimation=this.getConfigInModel("noAnimation"),isRailRightPlaced=this.getConfigInModel("placement")==="right";if(noAnimation){this._changeMode(this.modes.EXPANDED);
this.trigger("rail:expanded",$rail.outerWidth());return}$rail.width(this.railWidth.COLLAPSED);this._changeMode(this.modes.EXPANDING);$rail.animate({width:this.railWidth.EXPANDED},{duration:this.ANIMATION_DURATION,progress:function(a,p,remainingMs){var iconRotationDegree=(1-remainingMs/that.ANIMATION_DURATION)*180;if(!isRailRightPlaced)iconRotationDegree*=-1;$expandBtn.css({transform:"rotate("+iconRotationDegree+"deg)"});that.trigger("rail:expanding",$rail.outerWidth())},always:function(){$expandBtn.css({transform:"rotate(0deg)"});
that._changeMode(that.modes.EXPANDED);that.trigger("rail:expanded",$rail.outerWidth())}})},isRailCollapsed:function(){return this.getConfigInModel("mode")===this.modes.COLLAPSED},handleRenderComplete:function(){var that=this;this.view.$(".rail-body-rows").scrollTop(this._currentScrollTop||0).bind("scroll",function(){that.contextPopover.hide()})},_saveCurrentScrollPosition:function(){this._currentScrollTop=this.view.$(".rail-body-rows").scrollTop()},_handleMenuButtonClick:function(evt){var $row=$(evt.currentTarget).closest(".experience-row"),
index=$row.data("index");if($row.hasClass("no-context"))return;evt.preventDefault();evt.stopPropagation();if($row.hasClass("selected")&&this.contextPopover.open){this.contextPopover.hide();return}if(!this.isRailCollapsed()||index===this.getConfigInModel("activeIndex")){this._clearRowSelection();$row.addClass("selected");evt.noSwitching=true}this._showContextPopover(index)},_handleContextPopoverClose:function(evt){var index=evt&&$(evt.currentTarget).closest(".experience-row").data("index");this._clearRowSelection(index)},
_showContextPopover:function(index){var actions=this.getConfigInModel("actions"),actionMenuMarkup;if(this.getExperiencesCount()<=this.getConfigInModel("minCount"))actions=_.without(actions,TSDK.Enums.ExperienceRailActions.DELETE);if(this.getExperiencesCount()===this.getConfigInModel("maxCount"))actions=_.without(actions,TSDK.Enums.ExperienceRailActions.DUPLICATE);if(actions.length){actionMenuMarkup=TSDK.UI.Templates.ExperienceRailComponent.ExperienceRailActionMenu({actions:actions,experienceOnly:this.ACTION_MENU_EXPERIENCE_ONLY});
this._renderContextPopover(index,actionMenuMarkup)}},_clearRowSelection:function(index){var $selectedRow=_.isNumber(index)?this._getExperienceRow(index):this.view.$(".experience-row.selected");$selectedRow.removeClass("selected")},_handleExperienceRowClick:function(evt){if(evt.noSwitching)return;var index=$(evt.currentTarget).closest(".experience-row").data("index");if(index!==this.getConfigInModel("activeIndex"))this.switchExperience(index)},switchExperience:function(index,forceScrollToView){var numberOfExperiences=
_.size(this.getExperiences()),indexToSwitch=-1;if(_.isNumber(index)&&index>=0&&index<numberOfExperiences)indexToSwitch=index;else indexToSwitch=numberOfExperiences-1;if(indexToSwitch!==-1){this.setConfigInModel("activeIndex",indexToSwitch);if(this.view){this.view.$(".experience-row.active").removeClass("active");this._getExperienceRow(indexToSwitch).addClass("active");if(forceScrollToView)this.scrollRailToExperience(indexToSwitch)}this.trigger("tab:switched",indexToSwitch)}},scrollRailToExperience:function(index){var experienceRow=
this._getExperienceRow(index).get(0);this.view.$(".rail-body-rows").scrollTop(experienceRow.offsetTop)},_handleMenuAction:function(evt){var selectedItem=evt.target.selectedItem,action=selectedItem.value,index=this.view.$(".experience-row.selected").data("index"),experience=this.getExperience(index);this._saveCurrentScrollPosition();if(action==="rename")this._openRenameExperiencePopover(index);else if(action==="delete"){this.deleteExperience(index,experience);this.contextPopover.hide()}else{this._performAction(action,
index,experience);this.contextPopover.hide()}},_openRenameExperiencePopover:function(index){var experience=this.getExperience(index),renamePopoverContentMarkup=TSDK.UI.Templates.ExperienceRailComponent.ExperienceRailRenamePopover(experience),$experienceNameInput,experienceNameInput;this._renderContextPopover(index,renamePopoverContentMarkup);$experienceNameInput=$(this.contextPopover).find(".experience-title-input");experienceNameInput=$experienceNameInput.get(0);Coral.commons.nextFrame(function(){$experienceNameInput.focus();
experienceNameInput.selectionStart=experienceNameInput.selectionEnd=experienceNameInput.value.length})},_renderContextPopover:function(index,contentMarkup){this.contextPopover.set({content:{innerHTML:contentMarkup},target:this._getContextPopoverTarget(index)});this.contextPopover.show()},_getExperienceRow:function(index){return this.view.$(".experience-row").eq(index)},_getContextPopoverTarget:function(index){return this._getExperienceRow(index).find(".menu-button").get(0)},_handleExperienceNameSave:function(evt){var $experienceTitleInput=
$(evt.target).closest(".rename-popover").find(".experience-title-input"),newName=$.trim($experienceTitleInput.val()),experienceIndex=this.view.$(".experience-row.selected").data("index"),experience=this.getExperience(experienceIndex);if(experience.name===newName){this._handleExperienceNameCancel(evt);return}if(newName===""){$experienceTitleInput.focus().get(0).invalid=true;this.notifyError(TSDK.I18n.get("Experience name cannot be empty."))}else if(!this._isExperienceNameUnique(newName)){$experienceTitleInput.focus().get(0).invalid=
true;this.notifyError(TSDK.I18n.get("Experience name is not unique."))}else{this.renameExperience(experienceIndex,newName);this.contextPopover.hide()}evt.noSwitching=true},_isExperienceNameUnique:function(experienceName){return _.every(this.getExperiences(),function(experience){return experience.name!==experienceName})},_handleExperienceNameKeydown:function(evt){evt.target.invalid=false;if(evt.keyCode===13){this._handleExperienceNameSave(evt);evt.preventDefault();evt.stopPropagation()}else if(evt.keyCode===
27)this._handleExperienceNameCancel(evt)},_handleExperienceNameCancel:function(evt){this.contextPopover.hide();evt.noSwitching=true},renameExperience:function(experienceIndex,newName){var experiences=this.getExperiences(true),experience,oldName;if(experiences&&experiences.length&&experienceIndex<experiences.length){experience=experiences[experienceIndex];oldName=experience.name;experience.name=newName;this.setExperiences(experiences);this.trigger("experience:renamed",{index:experienceIndex,experience:experience,
oldName:oldName,newName:newName})}},deleteExperience:function(index,experience){var experiences=this.getExperiences(true),oldActiveIndex=this.getConfigInModel("activeIndex"),newActiveIndex;experiences.splice(index,1);this.setExperiences(experiences);this.trigger("experience:deleted",{index:index,oldExperience:experience});if(index===oldActiveIndex)newActiveIndex=index===experiences.length?index-1:index;else if(index<oldActiveIndex)newActiveIndex=oldActiveIndex-1;else newActiveIndex=oldActiveIndex;
this.switchExperience(newActiveIndex);if(experiences.length===0)this._handleAllExperiencesDeleted()},_handleAllExperiencesDeleted:function(){},getExperience:function(index){var experiences=this.getExperiences();return experiences&&experiences[index]},getExperiences:function(clone){var experiences=this.model.get("experiences");if(clone)experiences=TSDK.UI.Util.clone(experiences)||[];return experiences},getExperiencesCount:function(){var experiences=this.getExperiences();return experiences?experiences.length:
0},setExperiences:function(experiences){this.model.set("experiences",experiences)},_generateNewExperienceName:function(){var existingExperienceNames=_.pluck(this.getExperiences(),"name"),nextExperienceName,ctr=0;do nextExperienceName=TSDK.I18n.get("Experience")+" "+TSDK.UI.ExperienceRailComponent.Util.deriveExperienceShortNameFromIndex(ctr++);while(existingExperienceNames.indexOf(nextExperienceName)!==-1);return nextExperienceName},_generateUniqueVersionedExperienceName:function(experienceNameToBeVersioned){var existingExperienceNames=
_.pluck(this.getExperiences(),"name"),nextExperienceName,ctr=0;do nextExperienceName=experienceNameToBeVersioned+ctr++;while(existingExperienceNames.indexOf(nextExperienceName)!==-1);return nextExperienceName},validate:function(){return true},notifyError:function(message){this.trigger("error",{message:message})}});
TSDK.UI.ExperienceRailComponent.Util={deriveExperienceShortNameFromIndex:function(index){if(typeof index!=="number")return"A";if(index<26)return String.fromCharCode(65+index);return TSDK.UI.ExperienceRailComponent.Util.deriveExperienceShortNameFromIndex(Math.floor(index/26)-1)+String.fromCharCode(65+index%26)},deriveExperienceShortNameFromName:function(experienceName){var prefix=TSDK.I18n.get("Experience")+" ";if(experienceName.indexOf(prefix)===0)experienceName=experienceName.substring(prefix.length);
return experienceName.substr(0,2)}};"use strict";
TSDK.UI.ExperienceRailAB=new PseudoClass({toString:"ExperienceRailAB",extend:TSDK.UI.ExperienceRailComponent,View:TSDK.UI.ExperienceRailComponent.prototype.View.extend({additionalEvents:{"click .add-experience":"_handleAddExperience"}}),MINIMUM_EXPERIENCES:1,ACTION_MENU_EXPERIENCE_ONLY:true,_defaultActions:[TSDK.Enums.ExperienceRailActions.RENAME_EXPERIENCE,TSDK.Enums.ExperienceRailActions.DUPLICATE,TSDK.Enums.ExperienceRailActions.DELETE],_getTemplate:function(){return TSDK.UI.Templates.ExperienceRailComponent.ExperienceRailAB},_handleAddExperience:function(){if(this.getConfigInModel("autoAdd"))this.addExperience();
else this.trigger("experience:add",{callback:this.addExperience.bind(this)})},addExperience:function(newExperience){var experiences=this.getExperiences(true),newExperienceIndex=experiences.length;newExperience=newExperience||{};newExperience.name=newExperience.name||this._generateNewExperienceName();experiences.push(newExperience);this.setExperiences(experiences);this.trigger("experience:added",{index:newExperienceIndex,experience:newExperience});this.switchExperience(newExperienceIndex,true)},_performAction:function(action,
index,experience){if(action==="duplicate")this._duplicateExperience(experience)},_duplicateExperience:function(experience){var newExperience=TSDK.UI.Util.clone(experience);newExperience.name=this._generateUniqueVersionedExperienceName(newExperience.name);this.addExperience(newExperience)}});"use strict";
TSDK.UI.ExperienceRailXT=new PseudoClass({toString:"ExperienceRailXT",extend:TSDK.UI.ExperienceRailComponent,View:TSDK.UI.ExperienceRailComponent.prototype.View.extend({additionalEvents:{"click .add-experience":"_handleAddExperienceTargeting","click .add-audience":"_handleAddAudience"}}),_defaultActions:[TSDK.Enums.ExperienceRailActions.EDIT_AUDIENCE,TSDK.Enums.ExperienceRailActions.RENAME_EXPERIENCE,TSDK.Enums.ExperienceRailActions.DUPLICATE,TSDK.Enums.ExperienceRailActions.DELETE],_getTemplate:function(){return TSDK.UI.Templates.ExperienceRailComponent.ExperienceRailXT},
_handleAddExperienceTargeting:function(){var handler=this.addExperience.bind(this);if(this.getConfigInModel("autoAdd"))this._selectAudience(function(audience){handler({audience:audience})});else this.trigger("experience:add",{callback:handler})},_handleAddAudience:function(evt){var index=$(evt.currentTarget).closest(".experience-row").data("index"),experience=this.getExperience(index),that=this;this._selectAudience(function(audience){if(audience&&audience.name){experience.audience=audience;that.model.trigger("change");
that.trigger("audience:added",{index:index,experience:experience,audience:audience})}else that.notifyError(TSDK.I18n.get("Invalid audience"))})},addExperience:function(newExperience){var experiences=this.getExperiences(true),newExperienceIndex=experiences.length;newExperience=newExperience||{};newExperience.name=newExperience.name||this._generateNewExperienceName();experiences.push(newExperience);this.setExperiences(experiences);this.trigger("experience:added",{index:newExperienceIndex,experience:newExperience});
this.switchExperience(newExperienceIndex,true)},_performAction:function(action,index,experience){if(action==="duplicate")this._duplicateExperience(experience);else if(action==="edit")this._changeAudience(index,experience)},_duplicateExperience:function(experience){var handler=this.addExperience.bind(this),newExperience=TSDK.UI.Util.clone(experience);newExperience.name=this._generateUniqueVersionedExperienceName(newExperience.name);this._selectAudience(function(audience){newExperience.audience=audience;
handler(newExperience)})},_changeAudience:function(index,experience){var that=this,oldAudience=experience.audience;this._selectAudience(function(audience){if(audience&&audience.name){experience.audience=audience;that.model.trigger("change");that.trigger("audience:edited",{index:index,oldAudience:oldAudience,newAudience:audience})}},oldAudience)},_handleAllExperiencesDeleted:function(){this.addExperience({})},_selectAudience:function(callback,index,selected){this.trigger("audience:select",{callback:callback,
index:index,selected:selected})}});Handlebars.registerHelper("getExperienceShortName",function(experienceName){return TSDK.UI.ExperienceRailComponent.Util.deriveExperienceShortNameFromName(experienceName)});Handlebars.registerHelper("ifAudienceValid",function(audience,options){if(audience&&audience.name)return options.fn(this);return options.inverse(this)});
Handlebars.registerHelper("unlessSingleExperienceWithNoAudience",function(experiences,options){if(experiences&&experiences.length===1&&!(experiences[0].audience&&experiences[0].audience.name))return options.inverse(this);return options.fn(this)});TSDK.UI.ExperienceRailComponent.prototype.config={};
Handlebars.registerHelper("matchesAudienceType",function(type,typeInModel,options){var ruleInfo=TSDK.Enums.AudienceRules[typeInModel];if(type===typeInModel||_.isString(ruleInfo)&&type===ruleInfo)return options.fn(this);return options.inverse(this)});Handlebars.registerHelper("getIconForAudienceType",function(type){var ruleInfo=TSDK.Enums.AudienceRules[type];if(_.isString(ruleInfo))ruleInfo=TSDK.Enums.AudienceRules[ruleInfo];return ruleInfo&&ruleInfo.icon||"users"});
Handlebars.registerHelper("getLabelForAudienceType",function(type){var ruleInfo=TSDK.Enums.AudienceRules[type];if(_.isString(ruleInfo))ruleInfo=TSDK.Enums.AudienceRules[ruleInfo];return ruleInfo&&ruleInfo.label||type});"use strict";
TSDK.UI.AudienceWorkflow=new PseudoClass({toString:"AudienceWorkflow",extend:TSDK.UI.ConfigurableComponent,initialize:function(options){options=options||{};this.ruleOptions=options.rules;this._initConfigs();this._registerBinders();this._initDialog();if(options.visible)this.openWorkflow()},_initConfigs:function(){this.initialConfig=this.config},_registerBinders:function(){this.bind("_toggleFullscreen");this.bind("_triggerSelectedEvent");this.bind("_updateOnAudiencesSelection");this.bind("_scrollListToTop");
this.bind("_changeStepFromContent");this.bind("_changeStepFromHeader");this.bind("_createAudience");this.bind("closeWorkflow")},_initDialog:function(){this.audienceWorkflowDialog=(new Coral.Dialog).set({backdrop:"static"});$(this.audienceWorkflowDialog).addClass("tsdk-audience-workflow").appendTo("body");if(TSDK.UI.AudienceWorkflow.Util.isBrowserIE10())$(this.audienceWorkflowDialog).addClass("coral-Backdrop")},openWorkflow:function(config){var that=this;config=_.extend({},this.initialConfig,config);
if(config){this.configure(config);this._toggleFullscreen(config.fullscreen?true:false)}this._addSubComponents();Coral.commons.nextFrame(function(){that.audienceWorkflowDialog.show()});return this},closeWorkflow:function(){this.audienceWorkflowDialog.hide();this._destroySubComponents();return this},_addSubComponents:function(){this._destroySubComponents();this._addDialogHeader();this._addDialogContent()},_addDialogHeader:function(){this.addComponent(new TSDK.UI.AudienceWorkflow.DialogHeader({el:$(this.audienceWorkflowDialog).find("coral-dialog-header"),
model:{isEditMode:this.isEditMode()},visible:true}),"audienceWorkflowDialogHeader").on("fullscreen:toggle",this._toggleFullscreen).on("step:change",this._changeStepFromHeader).on("create",this._createAudience).on("cancel",this.closeWorkflow)},_addDialogContent:function(){this.addComponent(new TSDK.UI.AudienceWorkflow.DialogContent({el:$(this.audienceWorkflowDialog).find("coral-dialog-content"),visible:true,config:this.config,model:this.audienceData,ruleOptions:this.ruleOptions,noRerender:true}),"audienceWorkflowDialogContent").on("step:change",
this._changeStepFromContent)},_destroySubComponents:function(){_.each(this.components,function(component,componentName){if(component){component.destructButKeepEl();delete this.components[componentName]}},this)},reset:function(){_.each(this.components,function(component){if(typeof component.reset==="function")component.reset()})},_toggleFullscreen:function(toggleToFullscreen){this.audienceWorkflowDialog.fullscreen=toggleToFullscreen;$(this.audienceWorkflowDialog).find("coral-dialog-header").toggleClass("coral--dark",
toggleToFullscreen)},_changeStepFromHeader:function(step){if(step===1)this.components["audienceWorkflowDialogContent"].navigateToRulesCreateStep();else if(step===2)if(!this.components["audienceWorkflowDialogContent"].navigateToReviewStep()){this.notifyError(TSDK.I18n.get("Definition for one or more audience rules is incomplete."));return}this.components["audienceWorkflowDialogHeader"].setStep(step)},_changeStepFromContent:function(step){this.components["audienceWorkflowDialogHeader"].setStep(step)},
_createAudience:function(){if(this.components["audienceWorkflowDialogContent"].validateAudienceName(true))this.trigger("audience:created",this.getData(),this.closeWorkflow);else this.notifyError(TSDK.I18n.get("Please enter a valid audience name."))},setContext:function(context){this.audienceData=context;var dialogHeader=this.components["audienceWorkflowDialogHeader"],dialogContent=this.components["audienceWorkflowDialogContent"];dialogHeader&&dialogHeader.setIsEditMode(this.isEditMode());dialogContent&&
dialogContent.updateModel(context)},getContext:function(){return this.components["audienceWorkflowDialogContent"].getAudienceToBeSaved()},notifyError:function(message){this.propagateEvent("error",{message:message})},isEditMode:function(){return!!(this.audienceData&&this.audienceData.name)}});
TSDK.UI.AudienceWorkflow.Util={fetchRequest:function(url){return $.ajax({url:url,contentType:"application/json; charset\x3dutf-8",dataType:"json"})},isInteger:function(value){var regex=/^[0-9]+$/;value=value+"";return regex.test(value)},isBrowserIE10:function(){return navigator.appVersion.indexOf("MSIE 10")!==-1}};
TSDK.MapRequest=function(options,skipMapping){var fetch=options.fetch,url=options.url,ajaxOptions=options.ajax,value=options.value,content=options.content,postprocessor=options.postprocessor,that=this;if(_.isFunction(fetch))this.fetch=function(fetchOptions){var success=fetchOptions.success;return fetch(_.extend({},fetchOptions,{success:function(data){if(_.isFunction(postprocessor))data=postprocessor(data);if(!skipMapping)data=that._getMap(data,value,content);success(data)}}))};else{if(url)if(_.isFunction(url))this._getUrl=
url;else this._getUrl=function(){return url};this.fetch=function(fetchOptions){$.ajax(_.extend({},{url:this._getUrl&&this._getUrl(fetchOptions.data)},ajaxOptions)).done(function(data,textStatus,jqXHR){if(_.isFunction(fetchOptions.success)){if(_.isFunction(postprocessor))data=postprocessor(data);if(!skipMapping)data=that._getMap(data,value,content);fetchOptions.success(data,textStatus,jqXHR)}}).fail(function(jqXHR,textStatus,errorThrown){if(_.isFunction(fetchOptions.error))fetchOptions.error(jqXHR,
textStatus,errorThrown)})}}};
TSDK.MapRequest.prototype._getMap=function(data,value,content){var map=[],valueParser,contentParser;if(_.isFunction(value))valueParser=value;else if(_.isString(value))valueParser=function(data){return data[value]};if(_.isFunction(content))contentParser=content;else if(_.isString(content))contentParser=function(data){return data[content]};else contentParser=valueParser;_.each(data,function(entry){var isSimple=_.isString(entry)||_.isNumber(entry);if(isSimple)map.push({value:entry,content:entry});else if(valueParser)map.push({value:valueParser(entry),
content:contentParser(entry)})});return map};"use strict";
TSDK.UI.AudienceWorkflow.DialogHeader=new PseudoClass({toString:"AudienceWorkflowDialogHeader",extend:F.ModelComponent,View:F.View.extend({events:{"click .close-button":"triggerCancelEvent","click .fullscreen-button":"toggleFullscreenMode","click .next-button":"handleNextButtonClick","click .create-button":"triggerCreateEvent"}}),construct:function(options){this.initView(options);this.load(_.extend({step:1,totalSteps:2},options.model))},initView:function(options){this.view=(new this.View({el:options.el,
component:this,template:TSDK.UI.Templates.AudienceWorkflow.DialogHeader})).render()},toggleFullscreenMode:function(evt){var toggleToFullscreen=$(evt.currentTarget).data("toggle");this.trigger("fullscreen:toggle",toggleToFullscreen)},handleNextButtonClick:function(){var nextStep=this.getStep()+1;this.trigger("step:change",nextStep)},navigateToStep:function(step){this.setStep(step)},triggerCancelEvent:function(){this.trigger("cancel")},triggerCreateEvent:function(){this.trigger("create")},getStep:function(){return this.model.get("step")},
setStep:function(stepNumber){this.model.set("step",stepNumber)},isEditMode:function(){return this.model.get("isEditMode")},setIsEditMode:function(isEditMode){this.model.set("isEditMode",isEditMode)}});"use strict";
TSDK.UI.AudienceWorkflow.DialogContent=new PseudoClass({toString:"AudienceWorkflowDialogContent",extend:F.ModelComponent,View:F.View.extend({events:{}}),construct:function(options){this.model=new Backbone.Model(options.model);this.ruleOptions=options.ruleOptions;this.initView(options);this.registerBinders();this.addTargetingWidget();this.addRulesReviewStep();this.updateConfig(options.config)},updateConfig:function(config){this.config=config||{};_.each(this.components,function(component){if(typeof component.updateConfig===
"function")component.updateConfig(this.config)},this)},updateModel:function(model){this.model.clear().set(model)},registerBinders:function(){this.bind("navigateToReviewStep");this.bind("navigateToRulesCreateStep")},initView:function(options){this.view=(new this.View({el:options.el,component:this,template:TSDK.UI.Templates.AudienceWorkflow.DialogContent})).render()},addTargetingWidget:function(){this.addComponent(new TSDK.UI.AudienceWorkflow.TargetingWidget({el:this.view.$(".rules-create-container"),
model:this.model,ruleOptions:this.ruleOptions,visible:true}),"targetingwidget")},addRulesReviewStep:function(){this.addComponent(new TSDK.UI.AudienceWorkflow.RulesReviewStep({el:this.view.$(".rules-review-container"),model:this.model,visible:false}),"rulesReviewStep").on("navigate:rulesCreateStep",this.navigateToRulesCreateStep)},navigateToReviewStep:function(){var targetWidgetComponent=this.components["targetingwidget"];if(targetWidgetComponent.validate(true)){targetWidgetComponent.saveRules();targetWidgetComponent.hide({hideChildren:false});
this.components["rulesReviewStep"].show({model:this.model,silent:true});this.scrollToTop();return true}return false},navigateToRulesCreateStep:function(){this.components["rulesReviewStep"].hide({hideChildren:false});this.components["targetingwidget"].show({model:this.model,silent:true});this.scrollToTop();this.trigger("step:change",1)},scrollToTop:function(){this.view.$el.scrollTop(0)},getAudienceToBeSaved:function(){var audienceData=this.model.toJSON();audienceData.targets=this.components["targetingwidget"].getRulesToBeSaved();
return audienceData},validateAudienceName:function(highlight){return this.components["rulesReviewStep"].validateAudienceName(highlight)}});
TSDK.UI.AudienceWorkflow.AudienceRuleModel=Backbone.Model.extend({silentSet:function(property,value,options){var settingOptions={silent:true};if(options)_.extend(settingOptions,options);this.set(property,value,settingOptions)},setType:function(type,options){this.set("type",type,options)},getType:function(){return this.get("type")},isOfType:function(type){return this.getType()===type},setParameter:function(parameter,options){this.set("parameter",parameter,options)},getParameter:function(){return this.get("parameter")},
setOperator:function(operator,options){this.set("operator",operator,options)},getOperator:function(){return this.get("operator")},setOperands:function(operands,options){this.set("operands",operands,options)},getOperands:function(){return this.get("operands")},setSummary:function(summary,options){this.set("summary",summary,options)},getSummary:function(){return this.get("summary")},defaults:{type:"",parameter:"",operator:"",operands:[],summary:""}});"use strict";
TSDK.UI.AudienceWorkflow.AudienceRuleContainer=new PseudoClass({toString:"AudienceRuleContainer",extend:F.ModelComponent,DEFAULT_ANIMATION_DURATION:200,View:F.View.extend({events:{"click .rule-option":"handleRuleOptionClick","click .rule-delete-button":"triggerRuleDeleteEvent","click .rule-copy-button":"triggerRuleCopyEvent","click .rule-done-button":"collapseRuleContainer","click .rule-summary":"expandRuleContainer"}}),construct:function(options){this.ruleOptions=options.ruleOptions||{};this.populateEnabledRules();
this.initView(options.el);this.load(_.extend(options.model,{enabledRules:this.enabledRules}));this.registerBinders();this.registerListeners()},initView:function(el){this.view=new this.View({el:el,template:TSDK.UI.Templates.AudienceWorkflow.AudienceRuleContainer,component:this})},registerBinders:function(){this.bind("initRule");this.bind("syncRule")},registerListeners:function(){this.listenTo(this.view,"renderComplete",this.initRule)},initRule:function(){this.addRule(this.getRuleType())},populateEnabledRules:function(){this.enabledRules=
[];_.each(TSDK.Enums.AudienceRules,function(rule,key){if(_.isObject(rule)&&!rule.disabled&&(!rule.configRequired||this.ruleOptions[key]))this.enabledRules.push(key)},this)},syncRule:function(ruleData){this.setRuleData(ruleData,{silent:true});this.updateSummaryView()},updateSummaryView:function(){this.view.$(".summary-placeholder").html(TSDK.UI.Templates.AudienceWorkflow.RuleSummary(this.getRuleData()));this.clearIncompleteMark()},handleRuleOptionClick:function(evt){var $ruleOption=$(evt.currentTarget),
ruleType;if($ruleOption.attr("disabled"))return;ruleType=$ruleOption.data("value");if(ruleType!==this.getRuleType()){this.setRuleData({type:ruleType});this.triggerRuleTypeChangedEvent()}},triggerRuleTypeChangedEvent:function(){this.trigger("rule:type:changed")},getRuleData:function(){return this.model.get("rule")},setRuleData:function(rule,options){this.model.set("rule",rule,options)},getRuleType:function(){var rule=this.getRuleData();return rule&&rule.type},addRule:function(type){var $rulePlaceholder=
this.view.$(".rule-placeholder"),RuleComponent=this.getRuleComponent(type),rule;if(!RuleComponent)return;this.destructExistingRule();rule=this.addComponent(new RuleComponent({el:$rulePlaceholder,model:this.getRuleData(),ruleOptions:this.ruleOptions[type]||this.ruleOptions[TSDK.Enums.AudienceRules[type]]}),"rule").on("rule:updated",this.syncRule);rule.show()},destructExistingRule:function(){var existingRule=this.components["rule"];if(existingRule)existingRule.destructButKeepEl()},getRuleComponent:function(type){var ruleInfo=
TSDK.Enums.AudienceRules[type];if(_.isString(ruleInfo))ruleInfo=TSDK.Enums.AudienceRules[ruleInfo];return ruleInfo&&ruleInfo.component},setIndex:function(index){this.model.set("index",index)},getIndex:function(){return this.model.get("index")},triggerRuleDeleteEvent:function(){this.trigger("rule:delete")},triggerRuleCopyEvent:function(){this.trigger("rule:copy",this.getRuleData())},collapseRuleContainer:function(noAnimation){var that=this,animationDuration;if(this.isRuleContainerExpanded()){animationDuration=
noAnimation===true?0:this.DEFAULT_ANIMATION_DURATION;this.view.$(".rule-editor").hide(animationDuration,function(){that.view.$el.addClass("collapsed")})}},expandRuleContainer:function(noAnimation){var that=this,animationDuration=noAnimation===true?0:this.DEFAULT_ANIMATION_DURATION;this.trigger("rule:expand");this.view.$(".rule-editor").show(animationDuration,function(){that.view.$el.removeClass("collapsed")})},isRuleContainerExpanded:function(){return!this.view.$el.hasClass("collapsed")},markIncomplete:function(){this.view.$(".rule-definition-box").addClass("incomplete")},
clearIncompleteMark:function(){this.view.$(".rule-definition-box").removeClass("incomplete");this.components&&this.components["rule"]&&this.components["rule"].clearIncompleteMark()}});
TSDK.UI.AudienceWorkflow.AudienceRule=new PseudoClass({toString:"AudienceRule",extend:F.ModelComponent,Model:TSDK.UI.AudienceWorkflow.AudienceRuleModel,View:F.View.extend({commonEvents:{"change .parameterSelector":"updateParameter","change .operatorSelector":"updateOperator","change textarea.operandsInput":"updateOperandsFromTextArea","change coral-autocomplete.operandsInput":"updateOperandsFromFilters","change coral-select.operandsInput":"updateOperandsFromSelect"},additionalEvents:{},events:function(){return _.extend({},
this.commonEvents,this.additionalEvents)}}),construct:function(options){this.ruleOptions=options.ruleOptions;this.initVars(options);this.initSteps();this.initView(options.el);this.processModel(options.model);this.load(options.model);this.registerBinders();this.registerListeners()},initVars:function(options){},initSteps:function(){this.steps=[]},initView:function(el){this.view=new this.View({el:el,template:this.getTemplate(),component:this})},processModel:function(model){},registerBinders:function(){},
registerListeners:function(){},handleRenderComplete:function(){this.initWidgets();this.updateSummary()},initWidgets:function(){},updateParameter:function(evt){var step=$(evt.target).data("step"),stepValue=evt.target.value;if(this.steps[step].clearDependentFields)this.clearDependentAttributes(step);this.model.setParameter(stepValue)},updateOperator:function(evt){var step=$(evt.target).data("step"),stepValue=evt.target.value;if(this.steps[step].clearDependentFields)this.clearDependentAttributes(step);
this.model.setOperator(stepValue)},setOperands:function(operands){if(!_.isEqual(operands,this.model.getOperands())){this.model.setOperands(operands,{silent:true});this.updateSummary()}},updateOperandsFromTextArea:function(evt){var step=$(evt.target).data("step"),stepValue=evt.target.value;if(this.steps[step].clearDependentFields)this.clearDependentAttributes(step);this.setOperands(_.compact(stepValue.split("\n")))},updateOperandsFromFilters:function(evt){var filter=evt.target;if(evt.target.multiple)$(filter).find("input[type\x3dtext]").val("");
this.setOperands(_.clone(filter.values))},updateOperandsFromSelect:function(event){this.setOperands([event.target.value])},updateSummary:function(){var that=this;Coral.commons.nextFrame(function(){var summary={},i,step;for(i=0;i<that.steps.length;i++){step=that.steps[i];summary[step.name]=_.isFunction(step.value)?step.value():that.getStepDisplayValue(that.view.$el.find("[data-step\x3d"+i+"]"))}that.model.setSummary(summary,{silent:true});that.triggerRuleUpdatedEvent()})},triggerRuleUpdatedEvent:function(){this.trigger("rule:updated",
this.model.toJSON())},clearDependentAttributes:function(curStep){var i,defaultRule=this.getDefaultRule(),prop;for(i=curStep+1;i<this.steps.length;i++){prop=this.steps[i].name;this.model.set(prop,defaultRule[prop],{silent:true})}},getDefaultRule:function(){return(new this.Model).toJSON()},isRuleValid:function(){return true},validate:function(highlight){var step,$step,stepNumber,isStepValid;for(stepNumber=0;stepNumber<this.steps.length;stepNumber++){step=this.steps[stepNumber];$step=this.view.$("[data-step\x3d"+
stepNumber+"]");isStepValid=_.isFunction(step.validate)?step.validate():!($step.length&&_.size(this.model.get(step.name))===0);if(!isStepValid){if(highlight)$step.focus().attr("invalid",true);return false}}return this.isRuleValid()},getRule:function(){var stepAttributes=_.pluck(this.steps,"name").concat("type");return _.pick(this.model.toJSON(),stepAttributes)},getStepDisplayValue:function($stepInput){var cuiComponent=$stepInput&&$stepInput.get(0),tagName=cuiComponent&&cuiComponent.tagName;if(!cuiComponent)return"";
if(!cuiComponent._componentReady)CustomElements.upgradeAll(cuiComponent);switch(tagName){case "CORAL-SELECT":return $stepInput.find("coral-select-item[selected]").text();case "TEXTAREA":return $stepInput.val().replace(/[\n\r]/g," "+TSDK.I18n.get("OR")+" ");case "CORAL-AUTOCOMPLETE":var isCustomValuesAllowed=!cuiComponent.forceSelection,selectedItems=isCustomValuesAllowed?cuiComponent.values:$stepInput.find("coral-autocomplete-item[selected]").map(function(){return $(this).text()}).get();return selectedItems&&
selectedItems.join(", ")}return $stepInput.get(0).value||""},clearIncompleteMark:function(){var invalidStep=this.view.$("[data-step][invalid]").get(0);if(invalidStep)invalidStep.invalid=false},initAutocomplete:function(autocomplete){var that=this;if(autocomplete)Coral.commons.ready(autocomplete,function(){autocomplete.on("coral-autocomplete:showsuggestions",that.showFilterSuggestions.bind(that))})},parseAutoCompleteResults:function(results,parameter,search){return results},showFilterSuggestions:function(evt){var autocomplete=
evt.target,search=evt.detail.value,that=this,parameter=evt.target.getAttribute("data-parameter");evt.preventDefault();this.mapRequest.fetch({data:{search:search,parameter:parameter},success:function(suggestions){suggestions=that.parseAutoCompleteResults(suggestions,parameter,search);autocomplete.addSuggestions(suggestions,true)}})},notifyError:function(message){this.propagateEvent("error",{message:message})}});
TSDK.UI.AudienceWorkflow.TargetingWidget=new PseudoClass({toString:"TargetingWidget",extend:F.ModelComponent,View:F.View.extend({events:{"click .add-rule-button":"handleAddRuleButtonClick"}}),construct:function(options){this.ruleOptions=options.ruleOptions;this.view=new this.View({el:options.el,template:TSDK.UI.Templates.AudienceWorkflow.TargetingWidget,component:this});this.listenTo(this.view,"renderComplete",function(){this.initWidgets()});this.registerBinders();this.load(options.model);this.ruleCounter=
0;this.ruleContainers=[]},registerBinders:function(){this.bind("deleteRule");this.bind("addAudienceRuleContainer")},initWidgets:function(){var rules=this.getRules();this.reset();if(rules&&rules.length)_.each(rules,function(rule){this.addAudienceRuleContainer(rule,true)},this);else this.addNewRule()},reset:function(){this.removeComponents();this.ruleCounter=0;this.ruleContainers=[]},addAudienceRuleContainer:function(rule,collapse){var componentName="ruleContainer"+this.ruleCounter,$containerEl=$('\x3cdiv class\x3d"tsdk-audience-rule-container"\x3e\x3c/div\x3e'),
that=this;if(collapse)$containerEl.addClass("collapsed");this.addComponent(new TSDK.UI.AudienceWorkflow.AudienceRuleContainer({el:$containerEl.appendTo(this.view.$(".rules-placeholder")),model:{index:_.size(this.components),rule:this.transformRuleBeforeEdit(rule)},visible:true,ruleOptions:this.ruleOptions}),componentName).on("rule:delete",function(){that.deleteRule(componentName)}).on("rule:copy",function(ruleToCopy){that.collapseRuleContainersExcept();that.addAudienceRuleContainer(ruleToCopy)}).on("rule:expand",
function(){that.collapseRuleContainersExcept(componentName)}).on("rule:type:changed",function(){that.collapseRuleContainersExcept(componentName)});this.ruleContainers.push(componentName);this.ruleCounter++},transformRuleBeforeEdit:function(rule){var networkSpecificParameters=["ispName","domainName","connectionSpeed"];if(rule&&rule.type==="GEO"&&networkSpecificParameters.indexOf(rule.parameter)>-1)rule.type="NETWORK";return rule},collapseRuleContainersExcept:function(ruleContainer){var ruleContainers=
_.omit(this.components,ruleContainer);_.each(ruleContainers,function(ruleContainer){if(ruleContainer.getRuleType())ruleContainer.collapseRuleContainer()})},handleAddRuleButtonClick:function(){var lastRuleContainer=this.ruleContainers.length>0&&this.components[this.ruleContainers[this.ruleContainers.length-1]];if(lastRuleContainer&&!lastRuleContainer.getRuleType())return;this.collapseRuleContainersExcept(this.components);this.addAudienceRuleContainer({})},addNewRule:function(){this.addAudienceRuleContainer({})},
deleteRule:function(componentName){this.removeComponent(componentName);this.ruleContainers=_.without(this.ruleContainers,componentName);_.each(this.ruleContainers,function(ruleContainer,index){this.components[ruleContainer].setIndex(index)},this);if(this.ruleContainers.length===0)this.addAudienceRuleContainer({})},getRule:function(index){return this.getRules()[index]},getRules:function(){return this.model.get("targets")},setRules:function(rules){this.model.set("targets",rules,{silent:true})},saveRules:function(){var rules=
[];_.each(this.components,function(ruleContainer){if(ruleContainer.getRuleType())rules.push(ruleContainer.getRuleData())},this);this.setRules(rules)},getRulesToBeSaved:function(){var rules=[];_.each(this.components,function(ruleContainer){var ruleComponent=ruleContainer.components["rule"];if(ruleComponent)rules.push(_.omit(ruleComponent.getRule(),"summary"))},this);return rules},validate:function(highlight){var complete=true,numOfRules=_.size(this.components);_.each(this.components,function(ruleContainer){var ruleComponent=
ruleContainer.components["rule"];if(!ruleContainer.getRuleType()){if(numOfRules===1){complete=false;ruleContainer.markIncomplete()}return}if(ruleComponent&&!ruleComponent.validate(highlight)){complete=false;if(highlight)ruleContainer.markIncomplete()}});return complete}});
TSDK.UI.AudienceWorkflow.RulesReviewStep=new PseudoClass({toString:"RulesReviewStep",extend:F.ModelComponent,View:F.View.extend({events:{"click .edit-rules-button":"handleEditRulesButtonClick","change .audience-name":"handleAudienceNameInputChange","keyup .audience-name":"handleAudienceNameInputKeyup"}}),construct:function(options){this.view=new this.View({el:options.el,template:TSDK.UI.Templates.AudienceWorkflow.RulesReviewStep,component:this});this.load(options.model);this.targets=[]},handleEditRulesButtonClick:function(){this.trigger("navigate:rulesCreateStep")},
handleAudienceNameInputChange:function(evt){this.view.$(".audience-name").get(0).invalid=false;this.setAudienceName(evt.currentTarget.value)},handleAudienceNameInputKeyup:function(evt){evt.target.invalid=false},setAudienceName:function(name){this.model.set("name",name,{silent:true})},getAudienceName:function(){return this.model.get("name")},validateAudienceName:function(highlight){var audienceName=$.trim(this.getAudienceName()),$audienceNameInput=this.view.$(".audience-name");if(!audienceName){if(highlight)$audienceNameInput.focus().get(0).invalid=
true;return false}$audienceNameInput.get(0).invalid=false;return true}});
TSDK.UI.AudienceWorkflow.Browser=new PseudoClass({toString:"Browser",extend:TSDK.UI.AudienceWorkflow.AudienceRule,View:TSDK.UI.AudienceWorkflow.AudienceRule.prototype.View.extend({additionalEvents:{}}),getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.Browser},processModel:function(model){if(model&&model.type==="BROWSER"){if(model.parameter==="MSIE")model.parameter="MSIE Trident";model.type="BROWSER_PARAM";model.operands=[model.parameter];model.parameter="browserType";model.operator=
"equals"}model.helpLink=this.ruleOptions&&this.ruleOptions.helpLink},initSteps:function(){this.steps=[{name:"parameter",clearDependentFields:true},{name:"operator"},{name:"operands"}];this.SingleOperandOperators=["greater","greaterEquals","lesser","lesserEquals"]},registerBinders:function(){this.bind("handleKeyDownOnBrowserInput")},initWidgets:function(){var $browserVersionFilter=this.view.$(".browserVersionLookup"),that=this;if($browserVersionFilter.length)Coral.commons.ready($browserVersionFilter.get(0),
function(){$browserVersionFilter.find("input[type\x3dtext]").on("keydown",that.handleKeyDownOnBrowserInput)})},updateOperator:function(evt){var step=$(evt.target).data("step"),stepValue=evt.target.value;if(this.steps[step].clearDependentFields)this.clearDependentAttributes(step);if(this.SingleOperandOperators.indexOf(stepValue)!==-1)this.model.setOperands([],{silent:true});this.model.setOperator(stepValue)},handleKeyDownOnBrowserInput:function(evt){var keyCode=evt.keyCode||evt.which;if([46,8,9,27,
13].indexOf(keyCode)>-1||keyCode>=35&&keyCode<=39)return;if(evt.shiftKey||!(keyCode>=48&&keyCode<=57||keyCode>=96&&keyCode<=105))evt.preventDefault()},validateBrowserVersion:function(value){var filter=this.view.$(".browserVersionLookup").get(0);if(!TSDK.UI.Util.isInteger(value)){filter.invalid=true;$(filter).focus();this.notifyError(TSDK.I18n.get("Browser version must be an integer."))}else{filter.invalid=false;$(filter).find("input").blur()}return!filter.invalid},isRuleValid:function(){if(this.model.get("parameter")===
"browserVersion")return _.every(this.model.getOperands(),function(operand){return this.validateBrowserVersion(operand)},this);return true},getRule:function(){return _.omit(this._super(),"helpLink")}});
TSDK.UI.AudienceWorkflow.OperatingSystem=new PseudoClass({toString:"OperatingSystem",extend:TSDK.UI.AudienceWorkflow.AudienceRule,View:TSDK.UI.AudienceWorkflow.AudienceRule.prototype.View.extend({additionalEvents:{}}),getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.OperatingSystem},initSteps:function(){this.steps=[{name:"parameter"}]}});
TSDK.UI.AudienceWorkflow.SitePages=new PseudoClass({toString:"SitePages",extend:TSDK.UI.AudienceWorkflow.AudienceRule,View:TSDK.UI.AudienceWorkflow.AudienceRule.prototype.View.extend({additionalEvents:{"change .pageSelector":"updatePage"}}),getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.SitePages},processModel:function(model){var parameter=model.parameter||"",params=parameter.split(".");if(params.length>1)_.extend(model,{page:params[0],parameter:params[1]})},initSteps:function(){var that=
this;this.steps=[{name:"page",clearDependentFields:true},{name:"parameter",clearDependentFields:true,value:function(){return[that.getStepDisplayValue(that.view.$(".pageSelector")),that.getStepDisplayValue(that.view.$(".parameterSelector"))].join(" ")}},{name:"operator",clearDependentFields:true},{name:"operands"}]},updatePage:function(evt){var step=$(evt.target).data("step"),stepValue=evt.target.value;if(this.steps[step].clearDependentFields)this.clearDependentAttributes(step);this.setPage(stepValue)},
setPage:function(type,options){this.model.set("page",type,options)},getRule:function(){var attributes=this._super();attributes.parameter=attributes.page+"."+attributes.parameter;return _.omit(attributes,"page")}});
TSDK.UI.AudienceWorkflow.Geo=new PseudoClass({toString:"Geo",extend:TSDK.UI.AudienceWorkflow.AudienceRule,View:TSDK.UI.AudienceWorkflow.AudienceRule.prototype.View.extend({additionalEvents:{}}),getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.Geo},initVars:function(){this.mapRequest=new TSDK.MapRequest(this.ruleOptions)},initSteps:function(){this.steps=[{name:"parameter",clearDependentFields:true},{name:"operator"},{name:"operands"}]},initWidgets:function(){this.$invalidOperandsError=
this.view.$(".invalidOperandsError");this.initAutocomplete(this.view.$(".countryLookup").get(0));this.initAutocomplete(this.view.$(".stateLookup").get(0));this.initAutocomplete(this.view.$(".cityLookup").get(0));this.initAutocomplete(this.view.$(".metroLookup").get(0))},updateOperandsFromTextArea:function(evt){var $operandsInput=$(evt.target),patternToValidate=$operandsInput.data("pattern"),rangeMin=parseFloat($operandsInput.data("min")),rangeMax=parseFloat($operandsInput.data("max")),operandsArray=
_.compact($operandsInput.val().split("\n")),invalidOperandsArray=[],validOperandsArray=[];if(patternToValidate)_.each(operandsArray,function(operand){if(operand&&(new RegExp(patternToValidate)).test(operand))validOperandsArray.push(operand);else invalidOperandsArray.push(operand)});else if(rangeMin&&rangeMax)_.each(operandsArray,function(operand){var operandVal=parseFloat(operand);if(operandVal&&operandVal>=rangeMin&&operandVal<=rangeMax)validOperandsArray.push(operand);else invalidOperandsArray.push(operand)});
else validOperandsArray=operandsArray;if(invalidOperandsArray.length){var err=TSDK.I18n.get("Ignored invalid value(s)")+": "+invalidOperandsArray.join(", ");this.$invalidOperandsError.text(err).removeClass("hidden")}else this.$invalidOperandsError.addClass("hidden");$operandsInput.val(validOperandsArray.join("\n"));this.setOperands(validOperandsArray)}});
TSDK.UI.AudienceWorkflow.Mobile=new PseudoClass({toString:"Mobile",extend:TSDK.UI.AudienceWorkflow.AudienceRule,View:TSDK.UI.AudienceWorkflow.AudienceRule.prototype.View.extend({additionalEvents:{"change .device-type":"updateDeviceType","change coral-numberinput.operandsInput":"updateOperandsFromNumberInput"}}),getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.Mobile},initVars:function(){this.mapRequest=new TSDK.MapRequest(this.ruleOptions)},initSteps:function(){var self=this;this.steps=
[{name:"parameter",clearDependentFields:true},{name:"operator"},{name:"operands",value:function(){var $operands=self.view.$(".operandsInput");if($operands.hasClass("lower-value")||$operands.hasClass("upper-value"))return[self.view.$(".operandsInput.lower-value").get(0).value,self.view.$(".operandsInput.upper-value").get(0).value].join(TSDK.I18n.get(" to "));return self.getStepDisplayValue($operands)},validate:function(){var operator=self.model.getOperator(),operands=self.model.getOperands();if(operands.length===
0)return false;if(operator==="between")return operands[0]&&operands[1]&&TSDK.UI.AudienceWorkflow.Util.isInteger(operands[0])&&TSDK.UI.AudienceWorkflow.Util.isInteger(operands[1])&&Number(operands[1])>Number(operands[0]);if(operator==="greater"||operator==="lesser")return operands[0]&&TSDK.UI.AudienceWorkflow.Util.isInteger(operands[0])&&Number(operands[0])>=0;return true}}]},registerListeners:function(){this.listenTo(this.model,"change:parameter",this.handleParameterChanged)},initWidgets:function(){this.initAutocomplete(this.view.$(".modelLookup").get(0));
this.initAutocomplete(this.view.$(".vendorLookup").get(0))},parseAutoCompleteResults:function(results,parameter,search){var isIphoneModel,isBlackBerryDevice;if(parameter==="model")results=_.filter(results,function(resultObject){var item=resultObject["value"].toLowerCase();isIphoneModel=item.indexOf("iphone")===0;isBlackBerryDevice=item.indexOf("blackberry")!==-1;return item==="iphone"||!isIphoneModel&&!isBlackBerryDevice});if(parameter==="vendor")results=_.filter(results,function(resultObject){var item=
resultObject["value"].toLowerCase();return item.toLowerCase().indexOf("blackberry")===-1});return results},updateDeviceType:function(event){var optionDeviceType=event.target.value,deviceType=this.model.get("deviceType");this.model.set("deviceType",optionDeviceType,{silent:true})},updateOperandsFromNumberInput:function(event){var $operands=this.view.$(".operandsInput"),operands=[event.target.value];if($operands.hasClass("lower-value")||$operands.hasClass("upper-value"))operands=[this.view.$(".operandsInput.lower-value").get(0).value,
this.view.$(".operandsInput.upper-value").get(0).value];this.setOperands(operands)},getRule:function(){var stepAttributes=_.pluck(this.steps,"name").concat("type");if(this.model.getParameter()==="mobileOs")stepAttributes.push("deviceType");return _.pick(this.model.toJSON(),stepAttributes)},setDefaultOperator:function(parameterValue){var PARAMETERS_WITH_DEFAULT_OPERATOR=["mobileDevice","isMobilePhone","isTablet"];if(PARAMETERS_WITH_DEFAULT_OPERATOR.indexOf(parameterValue)!==-1)this.model.setOperator("equals")},
handleParameterChanged:function(){this.setDefaultOperator(this.model.getParameter())}});TSDK.UI.AudienceWorkflow.Network=new PseudoClass({toString:"Network",extend:TSDK.UI.AudienceWorkflow.Geo,getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.Network},initWidgets:function(){this.$invalidOperandsError=this.view.$(".invalidOperandsError");this.initAutocomplete(this.view.$(".connectionSpeedLookup").get(0))},getRule:function(){var attributes=this._super();attributes.type="GEO";return attributes}});
TSDK.UI.AudienceWorkflow.TrafficSource=new PseudoClass({toString:"TrafficSource",extend:TSDK.UI.AudienceWorkflow.AudienceRule,View:TSDK.UI.AudienceWorkflow.AudienceRule.prototype.View.extend({additionalEvents:{}}),getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.TrafficSource},initSteps:function(){this.steps=[{name:"parameter",clearDependentFields:true},{name:"operator"},{name:"operands"}]}});
TSDK.UI.AudienceWorkflow.TargetLibrary=new PseudoClass({toString:"TargetLibrary",extend:TSDK.UI.AudienceWorkflow.AudienceRule,View:TSDK.UI.AudienceWorkflow.AudienceRule.prototype.View.extend({additionalEvents:{}}),getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.TargetLibrary},initVars:function(){this.mapRequest=new TSDK.MapRequest(this.ruleOptions)},construct:function(){if(this.mapRequest)this.fetchAudiences()},initSteps:function(){this.steps=[{name:"parameter"}]},initWidgets:function(){this.parameterSelector=
this.view.$(".parameterSelector").get(0);if(!this.model.get("audiences"))this.parameterSelector.loading=true},fetchAudiences:function(){var that=this;this.model.set("loading",true);this.mapRequest.fetch({success:function(data){that.model.set("audiences",data);that.model.unset("loading")},error:function(){that.showErrorNotification(TSDK.I18n.get("Failed to fetch target library from server."));that.model.unset("loading")}})}});
TSDK.UI.AudienceWorkflow.VisitorProfile=new PseudoClass({toString:"VisitorProfile",extend:TSDK.UI.AudienceWorkflow.AudienceRule,View:TSDK.UI.AudienceWorkflow.AudienceRule.prototype.View.extend({additionalEvents:{}}),constants:{PROFILE_ATTRIBUTE_TYPES:{SCRIPT:"SCRIPT",CATEGORY_AFFINITY:"CATEGORY_AFFINITY",MBOX:"MBOX",CRS:"CRS",UNKNOWN:"UNKNOWN"},TARGETING_TYPES:{USER:"USER",CRS:"CRS"},CRS_PREFIX:"crs."},getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.VisitorProfile},initVars:function(){if(this.ruleOptions)this.mapRequest=
new TSDK.MapRequest(this.ruleOptions,true)},construct:function(options){if(this.mapRequest)this.fetchProfileParameters()},initSteps:function(){this.steps=[{name:"parameter",clearDependentFields:true},{name:"operator"},{name:"operands"}]},initWidgets:function(){this.$invalidValueError=this.view.$(".invalid-value-error")},getRule:function(){return _.omit(this.model.toJSON(),"parameters","loading")},isComplete:function(){var order,$step,stepName,modelValue;if(!this.$invalidValueError.hasClass("hidden")){this.markIncomplete();
return false}for(order=1;order<this.steps.length;order++){$step=this.view.$('.step[data-order\x3d"'+order+'"]');if($step.length){stepName=this.steps[order].name;modelValue=this.model.get(stepName);if(!modelValue||typeof modelValue==="object"&&_.size(modelValue)===0){this.markIncomplete();return false}}}return true},validateStep:function($step,value){var patternToValidate=$step.data("pattern"),errorAlert=$step.data("error-alert")||TSDK.I18n.get("Please enter valid value."),isValid=true;if(patternToValidate){isValid=
_.every([].concat(value),function(val){return(new RegExp(patternToValidate)).test(val)});if(isValid)this.$invalidValueError.addClass("hidden");else this.$invalidValueError.text(errorAlert).removeClass("hidden")}return isValid},updateOperandsFromTextArea:function(evt){var $input=$(evt.target),step=$input.data("step"),stepValue=evt.target.value;if(this.validateStep($input,stepValue)){this.model.setOperands(_.compact(stepValue.split("\n")),{silent:true});this.updateSummary()}},updateParameter:function(evt){var selector=
evt.target,step=$(selector).data("step"),stepValue=selector.value,$selectedItem=$(selector.selectedItem),type=$selectedItem.data("type")||"VISITOR_PROFILE",parametertargetid=$selectedItem.data("parametertargetid")||"";if(this.steps[step].clearDependentFields)this.clearDependentAttributes(step);this.model.setType(type,{silent:true});this.model.set("parametertargetid",parametertargetid,{silent:true});this.model.setParameter(stepValue)},fetchProfileParameters:function(){var self=this;this.model.set("loading",
true);this.mapRequest.fetch({success:function(response){var parameters=self.parseProfileParameters(response);self.model.set("parameters",parameters,{silent:true});self.model.unset("loading")},error:function(){self.showErrorNotification(TSDK.I18n.get("Failed to fetch custom parameters from server."));self.model.unset("loading")}})},parseProfileParameters:function(response){_.each(response,function(param){param.type=param.type?param.type.toUpperCase():this.constants.PROFILE_ATTRIBUTE_TYPES.UNKNOWN;
if(param.type===this.constants.PROFILE_ATTRIBUTE_TYPES.SCRIPT)param.type=this.constants.TARGETING_TYPES.USER;else if(param.type===this.constants.PROFILE_ATTRIBUTE_TYPES.CRS||param.type===this.constants.PROFILE_ATTRIBUTE_TYPES.UNKNOWN){param.type=this.constants.TARGETING_TYPES.CRS;if(_.isString(param.name)&&param.name.indexOf(this.constants.CRS_PREFIX)===0)param.name=param.name.substring(this.constants.CRS_PREFIX.length)}},this);return _.groupBy(response,function(param){return param.type})},showErrorNotification:function(msg){this.propagateEvent("error",
{message:msg})}});
TSDK.UI.AudienceWorkflow.CustomParameters=new PseudoClass({toString:"CustomParameters",extend:TSDK.UI.AudienceWorkflow.AudienceRule,View:TSDK.UI.AudienceWorkflow.AudienceRule.prototype.View.extend({additionalEvents:{"change .mboxSelector":"updateMboxAndFetchParameters","change .input-parameter":"updateParameter"}}),getTemplate:function(){return TSDK.UI.Templates.AudienceWorkflow.CustomParameters},initVars:function(){if(this.ruleOptions){if(this.ruleOptions.mboxes)this.mboxRequest=new TSDK.MapRequest(this.ruleOptions.mboxes);
if(this.ruleOptions.mboxParameters)this.mboxParameterRequest=new TSDK.MapRequest(this.ruleOptions.mboxParameters,true)}},construct:function(options){if(this.mboxRequest)this.fetchMboxes();if(this.mboxParameterRequest)this.fetchParameters(this.model.get("mbox"))},initSteps:function(){var that=this;this.steps=[{name:"mbox",clearDependentFields:true,validate:function(){return!(that.view.$(".mboxSelector").length&&_.isUndefined(that.model.get("mbox")))}},{name:"parameter",clearDependentFields:true},{name:"operator"},
{name:"operands"}]},initWidgets:function(){CustomElements.upgradeAll(this.view.el);this.$invalidValueError=this.view.$(".invalid-value-error")},isComplete:function(){var order,$step,stepName,modelValue;if(!this.$invalidValueError.hasClass("hidden")){this.markIncomplete();return false}for(order=1;order<this.steps.le;order++){$step=this.view.$('.step[data-order\x3d"'+order+'"]');if($step.length){stepName=this.steps[order].name;modelValue=this.model.get(stepName);if(!modelValue||typeof modelValue===
"object"&&_.size(modelValue)===0){this.markIncomplete();return false}}}return true},validateStep:function($step,value){var patternToValidate=$step.data("pattern"),errorAlert=$step.data("error-alert")||Granite.I18n.get("Please enter valid value."),isValid=true;if(patternToValidate){value=[].concat(value);isValid=_.every(value,function(val){return(new RegExp(patternToValidate)).test(val)});if(isValid)this.$invalidValueError.addClass("hidden");else this.$invalidValueError.text(errorAlert).removeClass("hidden")}return isValid},
updateMboxAndFetchParameters:function(evt){var step=$(evt.target).data("step"),stepValue=evt.target.value;if(this.steps[step].clearDependentFields)this.clearDependentAttributes(step);this.model.set("mbox",stepValue);this.fetchParameters(stepValue)},fetchParameters:function(mbox){var self=this;this.model.unset("parameters",{silent:!!mbox});if(mbox){this.model.set("paramsLoading",true);this.mboxParameterRequest.fetch({data:{mbox:mbox},success:function(mboxParameters){mboxParameters=_.filter(mboxParameters,
function(param){return param.parameterType==="MBOX"});self.model.set("parameters",mboxParameters,{silent:true});self.model.unset("paramsLoading")},error:function(){self.showErrorNotification(TSDK.I18n.get("Failed to fetch mbox parameters from server."));self.model.unset("paramsLoading")}})}},fetchMboxes:function(){var self=this;this.model.set("mboxesLoading",true);this.mboxRequest.fetch({success:function(mboxes){self.model.set("mboxes",mboxes,{silent:true});self.model.unset("mboxesLoading")},error:function(){self.showErrorNotification(TSDK.I18n.get("Failed to fetch mboxes from server."));
self.model.unset("mboxesLoading")}})},getRule:function(){return _.omit(this.model.toJSON(),"mboxes","parameters")},showErrorNotification:function(msg){this.propagateEvent("error",{message:msg})}});
TSDK.EnumUtil.addEnum("AudienceRules",{LIBRARY:{icon:"filingCabinet",label:TSDK.I18n.get("Target Library"),component:TSDK.UI.AudienceWorkflow.TargetLibrary,configRequired:true},GEO:{icon:"location",label:TSDK.I18n.get("Geo"),component:TSDK.UI.AudienceWorkflow.Geo,configRequired:true},NETWORK:{icon:"data",label:TSDK.I18n.get("Network"),component:TSDK.UI.AudienceWorkflow.Network,configRequired:true},MOBILE:{icon:"deviceMobile",label:TSDK.I18n.get("Mobile"),component:TSDK.UI.AudienceWorkflow.Mobile,
configRequired:true},MBOX:{icon:"gearsEdit",label:TSDK.I18n.get("Custom"),component:TSDK.UI.AudienceWorkflow.CustomParameters},OPERATING_SYSTEM:{icon:"deviceLaptop",label:TSDK.I18n.get("OS"),component:TSDK.UI.AudienceWorkflow.OperatingSystem},SITE_PAGE:{icon:"pages",label:TSDK.I18n.get("Site Pages"),component:TSDK.UI.AudienceWorkflow.SitePages},BROWSER_PARAM:{icon:"globeSearch",label:TSDK.I18n.get("Browser"),component:TSDK.UI.AudienceWorkflow.Browser},BROWSER:"BROWSER_PARAM",VISITOR_PROFILE:{icon:"imageProfile",
label:TSDK.I18n.get("Visitor Profile"),component:TSDK.UI.AudienceWorkflow.VisitorProfile},USER:"VISITOR_PROFILE",PROFILE:"VISITOR_PROFILE",CRS:"VISITOR_PROFILE",TRAFFIC_SOURCES:{icon:"merge",label:TSDK.I18n.get("Traffic Sources"),component:TSDK.UI.AudienceWorkflow.TrafficSource}});TSDK.UI.AudienceWorkflow.prototype.config={};"use strict";
TSDK.UI.AudiencePicker=new PseudoClass({toString:"AudiencePicker",extend:TSDK.UI.ConfigurableComponent,initialize:function(options){options=options||{};this.audienceWorkflowOptions=options.audienceWorkflow;this._initConfigs();this._registerBinders();this._initDialog();this._addSubComponents();if(options.visible)this.showPicker()},_initConfigs:function(){this.initialConfig=this.config},_registerBinders:function(){this.bind("_toggleFullscreen");this.bind("_triggerSelectedEvent");this.bind("_updateOnAudiencesSelection");
this.bind("_scrollListToTop");this.bind("_openAudienceWorkflow")},_initDialog:function(){this.audiencePicker=(new Coral.Dialog).set({backdrop:"static"});$(this.audiencePicker).addClass("tsdk-audience-picker").appendTo("body")},handleConfigChanged:function(){this._addOrRemoveAudienceWorkflow()},showPicker:function(config){config=_.extend({},this.initialConfig,config);if(config){this.configure(config);var audiencePickerContent=this.components["audiencePickerDialogContent"],audiencePickerHeader=this.components["audiencePickerDialogHeader"],
selectedAudiences=config.selected;this.components["audiencePickerDialogContent"].updateConfig(config);if(selectedAudiences){if(!_.isArray(selectedAudiences))selectedAudiences=[selectedAudiences];audiencePickerContent.setSelectedAudiences(selectedAudiences);audiencePickerHeader.updateCount(selectedAudiences.length)}if(config.fullscreen)this._toggleFullscreen(true)}$(this.audiencePicker).toggleClass("multi-selection-mode",this._isMultiSelectionMode());this.audiencePicker.show();Coral.commons.nextFrame(this._scrollListToTop);
return this},reload:function(){this.components["audiencePickerDialogContent"].updateList()},_scrollListToTop:function(){$(this.audiencePicker).find(".audience-picker-list").scrollTop(0)},_addSubComponents:function(){this._addDialogHeader();this._addDialogContent();this._addOrRemoveAudienceWorkflow();if(this.config.multiTenant)this._addOrRemoveTenantDropdown()},_addDialogHeader:function(){this.addComponent(new TSDK.UI.AudiencePicker.DialogHeader({el:$(this.audiencePicker).find("coral-dialog-header"),
visible:true}),"audiencePickerDialogHeader").on("fullscreen:toggle",this._toggleFullscreen).on("done",this._triggerSelectedEvent)},_addDialogContent:function(){this.addComponent(new TSDK.UI.AudiencePicker.DialogContent({el:$(this.audiencePicker).find("coral-dialog-content"),visible:true,config:this.config,fetchOptions:this.fetchOptions}),"audiencePickerDialogContent").on("audiences:selected",this._updateOnAudiencesSelection).on("audience:create",this._openAudienceWorkflow)},_addOrRemoveAudienceWorkflow:function(){var that=
this,existingAudienceWorkflowComponent=this.components["audienceWorkflow"],audienceWorkflowDialogContent=this.components["audiencePickerDialogContent"],showCreateAudienceButton=false;if(!audienceWorkflowDialogContent)return;if(this.config.create){if(!existingAudienceWorkflowComponent)this.addComponent(new TSDK.UI.AudienceWorkflow(this.audienceWorkflowOptions),"audienceWorkflow").on("audience:created",function(audience,success){that.trigger("audience:created",audience,function(){success();that.reload()})});
showCreateAudienceButton=true}else if(existingAudienceWorkflowComponent)existingAudienceWorkflowComponent.destructButKeepEl();audienceWorkflowDialogContent.toggleCreateAudienceButton(showCreateAudienceButton)},_addOrRemoveTenantDropdown:function(){var showDropdown=this.config.engine!=="tnt"&&this.config.engine!=="cq";if(this.components["audiencePickerDialogContent"])this.components["audiencePickerDialogContent"].toggleTenantDropdown(showDropdown)},_openAudienceWorkflow:function(){this.components["audienceWorkflow"].openWorkflow({fullscreen:this.audiencePicker.fullscreen})},
reset:function(){_.each(this.components,function(component){if(typeof component.reset==="function")component.reset()})},_updateOnAudiencesSelection:function(selectedAudiences){this.selectedAudiences=selectedAudiences;if(this._isMultiSelectionMode())this.components["audiencePickerDialogHeader"].updateCount(selectedAudiences.length);else this._triggerSelectedEvent()},notifyError:function(message){this.trigger("error",{message:message})},_isMultiSelectionMode:function(){var multiSelection=this.config.multiSelection;
return typeof multiSelection=="boolean"?multiSelection:false},_toggleFullscreen:function(toggleToFullscreen){this.audiencePicker.fullscreen=toggleToFullscreen;$(this.audiencePicker).find("coral-dialog-header").toggleClass("coral--dark",toggleToFullscreen)},_triggerSelectedEvent:function(){if(this.selectedAudiences)this.trigger("selected",_.map(this.selectedAudiences,function(audience){return audience.attributes}));this.audiencePicker.hide()}});"use strict";
TSDK.UI.AudiencePicker.DialogHeader=new PseudoClass({toString:"AudiencePickerDialogHeader",extend:F.ModelComponent,View:F.View.extend({events:{"click .fullscreen-button":"toggleFullscreenMode","click .done-button":"triggerDoneEvent"}}),construct:function(options){this.initView(options);this.load(options.model)},initView:function(options){this.view=(new this.View({el:options.el,component:this,template:TSDK.UI.Templates.AudiencePicker.DialogHeader})).render()},toggleFullscreenMode:function(evt){var toggleToFullscreen=
$(evt.currentTarget).data("toggle");this.trigger("fullscreen:toggle",toggleToFullscreen)},triggerDoneEvent:function(){this.trigger("done")},updateCount:function(audiencesCount){this.view.model.set("count",audiencesCount)},reset:function(){this.updateCount(0)}});"use strict";
TSDK.UI.AudiencePicker.DialogContent=new PseudoClass({toString:"AudiencePickerDialogContent",extend:F.ModelComponent,View:F.View.extend({events:{"click .add-audience-button":"handleAddAudienceButtonClick"}}),construct:function(options){this.setFetchOptions(options.fetchOptions);this.updateConfig(options.config);this.initView(options);this.addSubComponents(options)},setFetchOptions:function(fetchOptions){this.fetchOptions=fetchOptions},updateConfig:function(config){this.config=config||{};_.each(this.components,
function(component){if(_.isFunction(component.updateConfig))component.updateConfig(this.config)},this);this.handleConfigChanged()},handleConfigChanged:function(){if(this.view)this.addOrRemoveSearcher()},initView:function(options){this.view=(new this.View({el:options.el,component:this,model:{config:this.config},template:TSDK.UI.Templates.AudiencePicker.DialogContent})).render()},addSubComponents:function(options){this.addOrRemoveSearcher();this.addAudienceList(options);this.addSelectedAudiences(options);
if(this.config.multiTenant)this.addTenantDropdown()},addOrRemoveSearcher:function(){var existingSearcherComponent=this.components["searcher"];if(this.config.search){if(!existingSearcherComponent)this.addComponent(new TSDK.UI.AudiencePicker.Searcher({el:this.view.$(".audience-searcher-placeholder"),visible:true}),"searcher").on("search",this.searchAudience.bind(this))}else if(existingSearcherComponent){existingSearcherComponent.destructButKeepEl();delete this.components["searcher"]}},addTenantDropdown:function(){var tenantDropdownModel=
new TSDK.UI.AudiencePicker.TenantDropdownModel,that=this,listingParams=this._extractBrandFromParams();tenantDropdownModel.url=this.fetchOptions.listingsUrl+listingParams;this.addComponent(new TSDK.UI.AudiencePicker.TenantDropdown({el:this.view.$(".audience-tenant-dropdown-placeholder"),visible:true,config:this.config}),"tenant-dropdown").on("select",function(e){that.components["audiencelist"].updateFetchOptions({suffix:e!=null?e.path:""});that.updateList()});tenantDropdownModel.fetch({success:function(){that.components["tenant-dropdown"].setItems(tenantDropdownModel.getItems())},
error:function(){that.components["tenant-dropdown"].setItems([])}})},addAudienceList:function(){this.addComponent(new TSDK.UI.AudiencePicker.AudienceList({el:this.view.$(".audience-picker-list"),visible:true,config:this.config,fetchOptions:this.fetchOptions}),"audiencelist").on("list:itemSelected",this.audienceItemSelected.bind(this)).on("collection:loaded",this.updateListWithSelectedAudiences.bind(this));var that=this;this.view.$(".audience-picker-list").bind("scroll",function(event){that.components["audiencelist"].handleScroll(event)})},
addSelectedAudiences:function(){this.addComponent(new TSDK.UI.AudiencePicker.SelectedAudiences,"selectedAudienceList")},_extractBrandFromParams:function(){var brand=/[?&](brand=[^&]+)/.exec(this.fetchOptions.urlParams);if(brand&&brand.length>=1)return"?"+brand[1];return""},reset:function(){_.each(this.components,function(component){if(_.isFunction("function"))component.reset()})},setSelectedAudiences:function(selectedAudiences){var audienceListComponent=this.components["audiencelist"];audienceListComponent.setSelectedAudiences(selectedAudiences);
this.components["selectedAudienceList"].setSelectedAudiences(audienceListComponent.getSelectedAudiences())},handleAddAudienceButtonClick:function(){this.trigger("audience:create")},audienceItemSelected:function(params){var audienceModel=params.model;if(!this.parent._isMultiSelectionMode()){this.components["selectedAudienceList"].reset();this.components["audiencelist"].deselectAll()}audienceModel.toggleSelected();if(audienceModel.isSelected())this.selectAudience(audienceModel);else this.deselectAudience(audienceModel)},
selectAudience:function(audience){this.selectAudiences([audience])},deselectAudience:function(audience){this.deselectAudiences([audience])},selectAudiences:function(audiences){this.components["selectedAudienceList"].add(audiences);if(this.components["audiencelist"].allAudiencesAreSelected())this.checkSelectAllCheckbox()},getSelectedAudiencesCount:function(){return this.components["selectedAudienceList"].getCount()},deselectAudiences:function(audiences){this.components["selectedAudienceList"].remove(audiences)},
enableAddToReportsButton:function(){this.view.$(".addAndClosePicker").prop("disabled",false)},disableAddToReportsButton:function(){this.view.$(".addAndClosePicker").prop("disabled",true)},updateListWithSelectedAudiences:function(){var cachedAudiences=this.components["selectedAudienceList"].getSelectedAudiences();if(!cachedAudiences.length)return;this.components["audiencelist"].setSelectedAudiences(cachedAudiences)},updateList:function(){this.components["audiencelist"].updateList()},searchAudience:function(value){this.components["audiencelist"].search(value)},
toggleCreateAudienceButton:function(show){this.view.$(".add-audience-button").toggleClass("hidden",!show)},toggleTenantDropdown:function(show){this.components["tenant-dropdown"].toggleShow(show)}});
TSDK.UI.InfiniteScrollList=new PseudoClass({toString:"InfiniteScrollList",extend:F.ListComponent,options:{defaultParams:{pageSize:10,page:1}},currentPage:1,loading:false,defaultNumConsecutiveErrorCallbacks:1,numConsecutiveErrorCallbacks:1,currentSearchString:"",totalNumberOfPagesToLoad:-1,fetch:function(fetchParams,callback,update){if(this.pagination)this.fetchWithPagination.apply(this,arguments);else this.fetchWithoutPagination.apply(this,arguments)},fetchWithoutPagination:function(fetchParams,callback){this.params=
_.omit(_.extend({},this.options.defaultParams,fetchParams),"page","pageSize");this.collection.fetch({data:this.params,success:function(){this.numConsecutiveErrorCallbacks=this.defaultNumConsecutiveErrorCallbacks;this.collection.trigger("loaded");this.trigger("collection:loaded",this.collection,this.collection.models.length);this.collectionLoaded=true;if(typeof callback==="function")callback.call(this,this.collection);this.loading=false}.bind(this),error:function(model,response){if(typeof callback===
"function")if(this.numConsecutiveErrorCallbacks>0){callback.call(this,response);this.numConsecutiveErrorCallbacks--}}.bind(this)});return this},fetchWithPagination:function(fetchParams,callback,update){var appendResults=true,removeResults=false,updateResults=true,resetCollection=false;if(!update){this.currentPage=1;appendResults=false;removeResults=true;updateResults=false;resetCollection=true}if(fetchParams)this.params=_.extend({},this.options.defaultParams,fetchParams);else this.params=_.extend({},
this.options.defaultParams);this.params["page"]=this.currentPage;if(this.currentSearchString&&this.currentSearchString!="")this.params["search"]=this.currentSearchString;this.params["pageSize"]=this.getPageSize();if(this.fetchInitiator!=="scroll")this.noMorePagesAvailable=false;this.collection.fetch({data:this.params,add:appendResults,remove:removeResults,update:updateResults,reset:resetCollection,success:function(collectionRef,rawResponse){this.numConsecutiveErrorCallbacks=this.defaultNumConsecutiveErrorCallbacks;
this.totalNumberOfPagesToLoad=this.getPagesInResponse(rawResponse);this.hasMorePages=this.getHasMoreInResponse(rawResponse);if(!update)this.collection.trigger("loaded");this.trigger("collection:loaded",this.collection);this.collectionLoaded=true;if(typeof callback==="function")callback.call(this,this.collection);this.fetchNextPageCallback(this.collection);if(this.fetchInitiator==="scroll"&&this.collection.length===this.collectionLength)this.noMorePagesAvailable=true;this.collectionLength=this.collection.length;
this.fetchInitiator=void 0;this.loading=false}.bind(this),error:function(model,response){if(typeof callback==="function")if(this.numConsecutiveErrorCallbacks>0){callback.call(this,response);this.numConsecutiveErrorCallbacks--}this.fetchNextPageCallback(this.collection)}.bind(this)});return this},fetchNextPageCallback:function(collection){},handleScroll:function(event){if(this.loading)return;var scrollingElement=event.currentTarget;var SCROLL_BOTTOM_DECIDER=.8;var isScrollingElementEndReached=scrollingElement.scrollTop+
scrollingElement.clientHeight>=SCROLL_BOTTOM_DECIDER*scrollingElement.scrollHeight;if(isScrollingElementEndReached)this.fetchAvailablePage()},isNextPageAvailable:function(){if(_.isNumber(this.totalNumberOfPagesToLoad))return this.totalNumberOfPagesToLoad>0&&this.currentPage<this.totalNumberOfPagesToLoad;if(_.isBoolean(this.hasMorePages))return this.hasMorePages;return!this.noMorePagesAvailable},fetchAvailablePage:function(){if(this.isNextPageAvailable()){this.currentPage++;this.fetchInitiator="scroll";
this.loading=true;this.fetchNextPage()}},fetchNextPage:function(){this.fetch(this.fetchParams,null,true)},fillAvailableSpace:function(){if(!this.view.$el.is(":visible")||this.collection.isEmpty())return;var allContainers=this.getAllContainers(),rowHeight=$(allContainers[0]).outerHeight(true),siblingsHeight=this.getSiblingsHeight(),availableSpaceHeight=window.innerHeight-this.view.$el.closest(".scrollable").offset().top-siblingsHeight,plentySpaceForMoreList=availableSpaceHeight-rowHeight*allContainers.length>
0;if(plentySpaceForMoreList)this.fetchAvailablePage()},getSiblingsHeight:function(){return _.reduce(this.view.$el.siblings(),function(memo,sibling){return memo+$(sibling).outerHeight(true)},0)},getAllContainers:function(){return this.view.$(".listItem")},getPageSize:function(){var pageSize=this.fetchOptions&&this.fetchOptions.pageSize;return _.isNumber(pageSize)?pageSize:this.options.defaultParams.pageSize},getPagesInResponse:function(response){if(this.fetchOptions&&this.fetchOptions.pages)return response[this.fetchOptions.pages]},
getHasMoreInResponse:function(response){if(this.fetchOptions&&this.fetchOptions.hasMore)return response[this.fetchOptions.hasMore]}});
TSDK.UI.AudiencePicker.AudienceModel=Backbone.Model.extend({silentSet:function(property,value,options){var settingOptions={silent:true};if(options)_.extend(settingOptions,options);this.set(property,value,settingOptions)},setName:function(newName){this.silentSet("name",newName)},getName:function(){return this.get("name")},getId:function(){return this.get("id")},isSelected:function(){return this.get("selected")},setSelected:function(selected){this.set("selected",selected)},toggleSelected:function(){this.setSelected(!this.isSelected())},
defaults:{"selected":false,"name":"","size":0}});
TSDK.UI.AudiencePicker.AudiencesCollection=Backbone.Collection.extend({model:TSDK.UI.AudiencePicker.AudienceModel,setFetchOptions:function(fetchOptions){this.url=fetchOptions.url;this.preprocess=fetchOptions.preprocess},parse:function(response,options){var params=options.data,audienceArray=this.getAudiencesFromResponse(response),allVisitorsAudience=_.find(audienceArray,function(audience){return audience.id==="all_visitors"}),allVisitorsIndex=0;if(allVisitorsAudience)allVisitorsIndex=audienceArray.indexOf(allVisitorsAudience);
if(allVisitorsIndex){allVisitorsAudience=audienceArray[allVisitorsIndex];audienceArray.splice(allVisitorsIndex,1);audienceArray=_.sortBy(audienceArray,function(audience){return audience["name"].toLowerCase()});audienceArray.unshift(allVisitorsAudience)}if(_.isString(params.search)&&this.search&&this.search!=="server")audienceArray=_.filter(audienceArray,function(audience){var name=audience.name;return _.isString(name)&&name.toLowerCase().indexOf(params.search.toLowerCase())>-1},this);return audienceArray},
getAudiencesFromResponse:function(response){if(_.isFunction(this.preprocess))return this.preprocess(response);if(_.isArray(response))return response;return[]}});
TSDK.UI.AudiencePicker.AudienceList=new PseudoClass({toString:"AudienceList",extend:TSDK.UI.InfiniteScrollList,Collection:TSDK.UI.AudiencePicker.AudiencesCollection,options:{defaultParams:{pageSize:100}},numConsecutiveErrorCallbacks:0,ItemTemplate:function(){if(this.model.isSelected())this.$el.addClass("selected");else this.$el.removeClass("selected");if(this.model.getId()==="all_visitors")this.$el.addClass("all_visitors_container");return TSDK.UI.Templates.AudiencePicker.AudienceListItem.apply(this,
arguments)},construct:function(options){this.updateConfig(options.config);this.updateFetchOptions(options.fetchOptions);this.fetchParams={};this.registerBinders();this.registerGlobalTriggers()},destruct:function(){this.unRegisterGlobalTriggers()},registerBinders:function(){this.bind("sortAudiences")},registerGlobalTriggers:function(){F.on("audienceSorter:change",this.sortAudiences)},unRegisterGlobalTriggers:function(){F.off("audienceSorter:change",this.sortAudiences)},updateConfig:function(config){this.config=
_.extend({},this.config,config);this.pagination=this.config.pagination;this.collection.search=this.config.search},updateFetchOptions:function(fetchOptions){this.fetchOptions=_.extend({},this.fetchOptions,fetchOptions);this.collection.setFetchOptions(this.fetchOptions)},getAllAudiences:function(){return this.getAudiencesFromContainers(this.getAllAudienceContainers())},getSelectedAudiences:function(){var $selectedAudienceContainers=this.getSelectedAudienceContainers();return this.getAudiencesFromContainers($selectedAudienceContainers)},
getAudiencesFromContainers:function($containers){var audiences=[];_.each($containers,function($audienceContainer){var audience=this.getModelFromLi($audienceContainer);audiences.push(audience)},this);return audiences},setAllSelected:function(selected){_.each(this.getAllAudiences(),function(audience){audience.setSelected(selected)})},selectAll:function(){this.setAllSelected(true)},deselectAll:function(){this.setAllSelected(false)},setSelectedAudiences:function(audiences){var audiencesId=_.pluck(audiences,
"id");_.each(this.getAllAudiences(),function(audience){audience.setSelected(audiencesId.indexOf(audience.getId())>-1)})},getSelectedAudienceContainers:function(){return this.getAllAudienceContainers().filter(".selected")},getAllAudienceContainers:function(){return this.view.$("li")},getAllVisibleAudienceCount:function(){return this.getAllAudienceContainers().size()},allAudiencesAreSelected:function(){var audiences=this.getAllAudiences();var notSelectedAudience;if(!audiences.length)return false;notSelectedAudience=
_.find(audiences,function(audienceModel){return!audienceModel.isSelected()});return typeof notSelectedAudience==="undefined"},merge:function(audiences,options){this.collection.add(audiences,options)},search:function(query,searchBy){searchBy=searchBy||"search";this.fetchParams[searchBy]=query;this.updateList()},updateList:function(){var suffix=this.fetchOptions.suffix||"";var url=this.fetchOptions.baseUrl+suffix+this.fetchOptions.urlParams;this.collection.setFetchOptions({url:url,preprocess:this.collection.preprocess});
this.fetch(this.fetchParams)},sortAudiences:function(sortBy,sortOrder){this.setParameter("sortBy",sortBy);this.setParameter("sortOrder",sortOrder);this.updateList()},setParameter:function(name,value){if(typeof value!=="string"||value==="")delete this.fetchParams[name];else this.fetchParams[name]=value},reset:function(){this.deselectAll();this.view.$el.scrollTop(0);this.fetchParams={}}});
TSDK.UI.AudiencePicker.SelectedAudiences=new PseudoClass({toString:"selectedItems",extend:F.Component,options:{visible:true},construct:function(){this.cacheCollection=(new Backbone.Collection([],{model:TSDK.UI.AudiencePicker.AudienceModel})).bind("add",this.triggerSelectionEvent.bind(this)).bind("remove",this.triggerSelectionEvent.bind(this))},getSelectedAudiences:function(){return this.cacheCollection.models},getCount:function(){return this.cacheCollection.size()},triggerSelectionEvent:function(){this.parent.trigger("audiences:selected",
this.getSelectedAudiences())},add:function(audienceModels){var that=this;_.each(audienceModels,function(audienceModel){if(!audienceModel.isSelected())throw that.toString()+" trying to add non selected audience: "+audienceModel;});this.cacheCollection.add(audienceModels)},remove:function(audienceModels){this.cacheCollection.remove(audienceModels)},reset:function(){this.cacheCollection.reset()},addSelectedAudiences:function(audiences){this.cacheCollection.add(audiences)},setSelectedAudiences:function(audiences){this.reset();
this.addSelectedAudiences(audiences)}});
TSDK.UI.AudiencePicker.Searcher=new PseudoClass({toString:"Searcher",extend:F.ModelComponent,View:F.View.extend({events:{"keyup .search-input input":"triggerSearchEvent","click .search-input button":"reset"}}),SEARCH_TIMEOUT:300,construct:function(options){this.initView(options.el)},initView:function(el){this.view=(new this.View({el:el,component:this,template:TSDK.UI.Templates.AudiencePicker.Searcher})).render();this.initVars()},initVars:function(){this.searchInputElement=this.view.$(".search-input").get(0);
this.searchProcessId=null},triggerSearchEvent:function(event){var ESCAPE_KEY_CODE=27,that=this;if(this.searchProcessId)clearTimeout(this.searchProcessId);if(event.keyCode===ESCAPE_KEY_CODE||event.which===ESCAPE_KEY_CODE){$(event.currentTarget).blur();event.currentTarget.value=""}this.searchProcessId=setTimeout(function(){that.triggerChangeSearchEvent(event.currentTarget.value)},this.SEARCH_TIMEOUT)},triggerChangeSearchEvent:function(newValue){var trimmedValue=newValue.replace(/^\s+|\s+$/g,"");this.trigger("search",
trimmedValue)},reset:function(){this.searchInputElement.value="";this.triggerChangeSearchEvent("")}});
TSDK.UI.AudiencePicker.TenantDropdown=new PseudoClass({toString:"TenantDropdown",extend:F.ModelComponent,View:F.View.extend({events:{"change .tenant-dropdown":"onSelect"}}),construct:function(options){this.initView(options.el);this.initVars(options)},initView:function(el){this.view=(new this.View({el:el,component:this,template:TSDK.UI.Templates.AudiencePicker.TenantDropdown})).render()},onSelect:function(event){var value=event.target.value;var selectedIndex=parseInt(value);var selectedItem=this.items[selectedIndex];
if(!selectedItem&&value&&selectedIndex!==-1)selectedItem={path:"/"+encodeURIComponent(value)};this.trigger("select",selectedItem)},toggleShow:function(show){this.view.$el.toggle(show)},setItems:function(items){var select=this.view.$el.find(".tenant-dropdown").get(0);var config=this.config;this.items=items;select.items.clear();select.items.add({selected:false,value:-1,content:{textContent:this.view.$el.data("root-name")}});items.forEach(function(item,index){select.items.add({value:index,content:{textContent:config.multiTenantHiddenPathSegment?
item.path.replace(config.multiTenantHiddenPathSegment,""):item.path}})})},initVars:function(options){this.config=_.extend({},options.config);this.items=[]}});TSDK.UI.AudiencePicker.TenantDropdownModel=Backbone.Model.extend({getItems:function(){return this.get("items")||[]}});
Handlebars.registerHelper("getAudienceSource",function(audienceJSON){var origin=audienceJSON.origin||"--";switch(origin.toUpperCase()){case "TNT":return TSDK.I18n.get("Target");case "CLOUD":return TSDK.I18n.get("Marketing Cloud");default:return origin}});Handlebars.registerHelper("getAudienceIcon",function(audienceJSON){var ruleInfo=TSDK.Enums.AudienceRules[audienceJSON.type];return ruleInfo&&ruleInfo.icon||"users"});TSDK.UI.AudiencePicker.prototype.config={};this["TSDK"]=this["TSDK"]||{};
this["TSDK"]["UI"]=this["TSDK"]["UI"]||{};this["TSDK"]["UI"]["Templates"]=this["TSDK"]["UI"]["Templates"]||{};this["TSDK"]["UI"]["Templates"]["MboxPickerComponent"]=this["TSDK"]["UI"]["Templates"]["MboxPickerComponent"]||{};this["TSDK"]["UI"]["Templates"]["MetricsComponent"]=this["TSDK"]["UI"]["Templates"]["MetricsComponent"]||{};this["TSDK"]["UI"]["Templates"]["Goals"]=this["TSDK"]["UI"]["Templates"]["Goals"]||{};
this["TSDK"]["UI"]["Templates"]["GoalsAndSettings"]=this["TSDK"]["UI"]["Templates"]["GoalsAndSettings"]||{};this["TSDK"]["UI"]["Templates"]["DiagramComponent"]=this["TSDK"]["UI"]["Templates"]["DiagramComponent"]||{};this["TSDK"]["UI"]["Templates"]["ExperienceRailComponent"]=this["TSDK"]["UI"]["Templates"]["ExperienceRailComponent"]||{};this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]=this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]||{};
this["TSDK"]["UI"]["Templates"]["AudiencePicker"]=this["TSDK"]["UI"]["Templates"]["AudiencePicker"]||{};
Handlebars.registerPartial("AdvancedMetricActionType",this["TSDK"]["UI"]["Templates"]["MetricsComponent"]["AdvancedMetricActionType"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"hidden"},3:function(container,depth0,helpers,partials,data){return'selected\x3d"selected"'},5:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cdiv class\x3d"row fixed"\x3e\n      \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"How will the count be incremented?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n      \x3ccoral-select class\x3d"select-advanced-metric-action-type width-18"\x3e\n        \x3ccoral-select-item value\x3d"COUNT_ONCE" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.advancedMetricActionType:depth0,"COUNT_ONCE",{"name":"equals","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Once per Entrant",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"COUNT_LANDINGS" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.advancedMetricActionType:depth0,"COUNT_LANDINGS",{"name":"equals","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+
"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"On Every Impression (Excl. Page Refreshes)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"ALWAYS_CONVERT" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.advancedMetricActionType:depth0,"ALWAYS_CONVERT",{"name":"equals","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"On Every Impression",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n      \x3c/coral-select\x3e\n    \x3c/div\x3e\n"},7:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cdiv class\x3d"row fixed"\x3e\n      \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e'+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"What experience will users see if they reenter the activity?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n      \x3ccoral-select class\x3d"select-advanced-metric-action-type width-18"\x3e\n        \x3ccoral-select-item value\x3d"RESTART_SAME_EXPERIENCE" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.advancedMetricActionType:depth0,"RESTART_SAME_EXPERIENCE",{"name":"equals","hash":{},"fn":container.program(3,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Same Experience",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"RESTART_RANDOM_EXPERIENCE" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.advancedMetricActionType:depth0,"RESTART_RANDOM_EXPERIENCE",{"name":"equals","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Random Experience",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"RESTART_NEW_EXPERIENCE" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.advancedMetricActionType:depth0,"RESTART_NEW_EXPERIENCE",{"name":"equals","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Unseen Experience",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n      \x3c/coral-select\x3e\n    \x3c/div\x3e\n"},9:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cdiv class\x3d"row fixed"\x3e\n      \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"What will the users see instead of the activity content?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n      \x3ccoral-select class\x3d"select-advanced-metric-action-type width-18"\x3e\n        \x3ccoral-select-item value\x3d"EXCLUDE_TO_SAME_EXPERIENCE" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.advancedMetricActionType:depth0,"EXCLUDE_TO_SAME_EXPERIENCE",{"name":"equals","hash":{},
"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Same Experience (without Tracking)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"BAN_FROM_CAMPAIGN" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.advancedMetricActionType:depth0,"BAN_FROM_CAMPAIGN",{"name":"equals","hash":{},"fn":container.program(3,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Default/Other Activity Content",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n      \x3c/coral-select\x3e\n    \x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;
return'\x3cdiv class\x3d"advanced-metric-action '+((stack1=helpers.unless.call(alias1,depth0!=null?depth0.isAdvancedSettingsVisible:depth0,{"name":"unless","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'"\x3e\n  \x3cdiv class\x3d"coral-Accordion-label uppercase"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Advanced Settings",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n  \x3cdiv class\x3d"row fixed"\x3e\n    \x3cdiv class\x3d"grey sub-heading"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"What will happen after a user encounters this goal metric?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n\n    \x3ccoral-select class\x3d"select-post-goal-success-action width-21"\x3e\n      \x3ccoral-select-item value\x3d"incrementCountKeepUser" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.postGoalSuccessAction:depth0,"incrementCountKeepUser",{"name":"equals","hash":{},"fn":container.program(3,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Increment Count \x26 Keep User in Activity",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"incrementCountReleaseUserAllowEntry" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.postGoalSuccessAction:depth0,"incrementCountReleaseUserAllowEntry",{"name":"equals","hash":{},
"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Increment Count, Release User \x26 Allow Reentry",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"incrementCountBarEntry" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.postGoalSuccessAction:depth0,"incrementCountBarEntry",{"name":"equals",
"hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Increment Count, Release User \x26 Bar from Reentry",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n  \x3c/div\x3e\n\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.postGoalSuccessAction:depth0,"incrementCountKeepUser","",{"name":"in","hash":{},
"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.postGoalSuccessAction:depth0,"incrementCountReleaseUserAllowEntry",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.postGoalSuccessAction:depth0,"incrementCountBarEntry",
{"name":"equals","hash":{},"fn":container.program(9,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e\n"},"useData":true}));
Handlebars.registerPartial("MetricsItemElementClick",this["TSDK"]["UI"]["Templates"]["MetricsComponent"]["MetricsItemElementClick"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var stack1,alias1=container.escapeExpression;return"    \x3cspan\x3e\x26nbsp;"+alias1(container.lambda((stack1=depth0!=null?depth0.constraints:depth0)!=null?stack1.length:stack1,depth0))+"\x26nbsp;"+alias1((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||
{},"selected",{"name":"i18n","hash":{},"data":data}))+'\x26nbsp;\x3c/span\x3e\n    \x3ccoral-icon icon\x3d"edit" size\x3d"XS" class\x3d"select-elements e2e-select-elements"\x3e\x3c/coral-icon\x3e\n    \x3ccoral-icon icon\x3d"delete" size\x3d"XS" class\x3d"delete-elements e2e-delete-elements"\x3e\x3c/coral-icon\x3e\n'},3:function(container,depth0,helpers,partials,data){return'    \x3cbutton is\x3d"coral-button" type\x3d"button" class\x3d"select-elements e2e-select-elements"\x3e\n      '+container.escapeExpression((helpers.i18n||
depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Select elements",{"name":"i18n","hash":{},"data":data}))+"\n    \x3c/button\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return'\x3cdiv class\x3d"row fixed constraintsCell"\x3e\n'+((stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},(stack1=depth0!=null?depth0.constraints:depth0)!=null?stack1.length:stack1,{"name":"if","hash":{},
"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"\x3c/div\x3e\n"},"useData":true}));
Handlebars.registerPartial("MetricsItemMboxFields",this["TSDK"]["UI"]["Templates"]["MetricsComponent"]["MetricsItemMboxFields"]=Handlebars.template({1:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression,alias4="function";return'    \x3cdiv class\x3d"constraint mboxSearch row fixed" data-display-type\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"mbox",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n'+((stack1=helpers["if"].call(alias1,data&&data.index,{"name":"if","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'      \x3cdiv class\x3d"cell step mboxLookup'+alias3((helper=(helper=helpers.index||data&&data.index)!=null?helper:alias2,typeof helper===alias4?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper))+' display-inline" data-order\x3d"2" constraint-order\x3d"'+
alias3((helper=(helper=helpers.index||data&&data.index)!=null?helper:alias2,typeof helper===alias4?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper))+'"\x3e\x3c/div\x3e\n'+((stack1=(helpers.notEquals||depth0&&depth0.notEquals||alias2).call(alias1,(stack1=depths[1]!=null?depths[1].constraints:depths[1])!=null?stack1.length:stack1,1,{"name":"notEquals","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"    \x3c/div\x3e\n"},
2:function(container,depth0,helpers,partials,data){return'        \x3cspan class\x3d"cell width-2 grey"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"OR",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n"},4:function(container,depth0,helpers,partials,data){var helper;return'        \x3cdiv class\x3d"cell width-2"\x3e\n          \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"minusCircle" iconSize\x3d"S" class\x3d"remove-constraint" id\x3d'+
container.escapeExpression((helper=(helper=helpers.index||data&&data.index)!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"index","hash":{},"data":data}):helper))+"\x3e\x3c/button\x3e\n        \x3c/div\x3e\n"},6:function(container,depth0,helpers,partials,data){return'    \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"addCircle" iconSize\x3d"S" class\x3d"add-constraint padding-l-0"\x3e\n      '+
container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Add an Mbox",{"name":"i18n","hash":{},"data":data}))+"\n    \x3c/button\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'\x3cdiv class\x3d"constraintsCell"\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.constraints:
depth0,{"name":"each","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers.unless.call(alias1,depth0!=null?depth0.specialmbox:depth0,{"name":"unless","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e"},"useData":true,"useDepths":true}));
Handlebars.registerPartial("MetricsItemPageView",this["TSDK"]["UI"]["Templates"]["MetricsComponent"]["MetricsItemPageView"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"row fixed"\x3e\n  \x3ccoral-select class\x3d"select-matcher"\x3e\n    \x3ccoral-select-item value\x3d"exact" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.matcher:depth0,"exact",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"URL is",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"contains" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=
null?depth0.matcher:depth0,"contains",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"URL contains",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n  \x3c/coral-select\x3e\n\x3c/div\x3e\n"+((stack1=container.invokePartial(partials.MetricsItemUrlFields,depth0,{"name":"MetricsItemUrlFields","data":data,"helpers":helpers,"partials":partials,
"decorators":container.decorators}))!=null?stack1:"")},"usePartial":true,"useData":true}));
Handlebars.registerPartial("MetricsItemUrlFields",this["TSDK"]["UI"]["Templates"]["MetricsComponent"]["MetricsItemUrlFields"]=Handlebars.template({1:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression,alias4="function";return'  \x3cdiv class\x3d"row fixed constraint" data-display-type\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"URL",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n'+((stack1=helpers["if"].call(alias1,data&&data.index,{"name":"if","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\n    \x3cinput is\x3d"coral-textfield" placeholder\x3d"http://www." name\x3d"'+alias3((helper=(helper=helpers.index||data&&data.index)!=null?helper:alias2,typeof helper===alias4?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper))+'" value\x3d"'+
alias3((helper=(helper=helpers.term||(depth0!=null?depth0.term:depth0))!=null?helper:alias2,typeof helper===alias4?helper.call(alias1,{"name":"term","hash":{},"data":data}):helper))+'" class\x3d"terminput cell"\x3e\n\n'+((stack1=(helpers.notEquals||depth0&&depth0.notEquals||alias2).call(alias1,(stack1=depths[1]!=null?depths[1].constraints:depths[1])!=null?stack1.length:stack1,1,{"name":"notEquals","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"  \x3c/div\x3e\n"},2:function(container,depth0,helpers,partials,data){return'      \x3cdiv class\x3d"cell width-2 grey"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"OR",{"name":"i18n","hash":{},"data":data}))+"\x3c/div\x3e\n"},4:function(container,depth0,helpers,partials,data){var helper;return'      \x3cdiv class\x3d"cell width-2"\x3e\n        \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"minusCircle" iconSize\x3d"S" class\x3d"remove-constraint" id\x3d'+
container.escapeExpression((helper=(helper=helpers.index||data&&data.index)!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"index","hash":{},"data":data}):helper))+"\x3e\x3c/button\x3e\n      \x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return((stack1=helpers.each.call(alias1,
depth0!=null?depth0.constraints:depth0,{"name":"each","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\n\x3cdiv class\x3d"row fixed"\x3e\n  \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"addCircle" iconSize\x3d"S" class\x3d"add-constraint padding-l-0"\x3e\n    '+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Add another URL",{"name":"i18n","hash":{},
"data":data}))+"\n  \x3c/button\x3e\n\x3c/div\x3e"},"useData":true,"useDepths":true}));
Handlebars.registerPartial("AudienceAB",this["TSDK"]["UI"]["Templates"]["DiagramComponent"]["AudienceAB"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.AudienceBox,depth0,{"name":"AudienceBox","data":data,"indent":"  ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},3:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.NoAudienceBox,
depth0,{"name":"NoAudienceBox","data":data,"indent":"  ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.name:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:""},"usePartial":true,
"useData":true}));
Handlebars.registerPartial("AudienceBox",this["TSDK"]["UI"]["Templates"]["DiagramComponent"]["AudienceBox"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var helper;return container.escapeExpression((helper=(helper=helpers.icon||(depth0!=null?depth0.icon:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"icon","hash":{},"data":data}):helper))},3:function(container,depth0,helpers,partials,
data){return"users"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"tsdk-audience-box"\x3e\n  \x3ccoral-icon icon\x3d"'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.icon:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?
stack1:"")+'" size\x3d"XS" class\x3d"audience-icon"\x3e\x3c/coral-icon\x3e\n  \x3cstrong class\x3d"audience-title"\x3e'+alias3((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper==="function"?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'\x3c/strong\x3e\n  \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"breadcrumb" iconsize\x3d"XS" class\x3d"audience-options-button"\x3e\x3c/button\x3e\n  \x3ccoral-popover class\x3d"context-menu" placement\x3d"bottom" target\x3d"_prev"\x3e\n    \x3ccoral-popover-content\x3e\n      \x3ccoral-selectlist\x3e\n        \x3ccoral-selectlist-item value\x3d"edit"\x3e\n          \x3ccoral-icon icon\x3d"edit"\x3e\x3c/coral-icon\x3e\n          \x3cspan\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Edit",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n        \x3c/coral-selectlist-item\x3e\n        \x3ccoral-selectlist-item value\x3d"remove"\x3e\n          \x3ccoral-icon icon\x3d"delete"\x3e\x3c/coral-icon\x3e\n          \x3cspan\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Remove",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n        \x3c/coral-selectlist-item\x3e\n      \x3c/coral-selectlist\x3e\n    \x3c/coral-popover-content\x3e\n  \x3c/coral-popover\x3e\n\x3c/div\x3e"},
"useData":true}));
Handlebars.registerPartial("ExperienceAB",this["TSDK"]["UI"]["Templates"]["DiagramComponent"]["ExperienceAB"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var helper;return container.escapeExpression((helper=(helper=helpers.visitorPercentage||(depth0!=null?depth0.visitorPercentage:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"visitorPercentage","hash":{},"data":data}):helper))},3:function(container,
depth0,helpers,partials,data){return"0"},5:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.ExperienceBox,depth0,{"name":"ExperienceBox","data":data,"indent":"  ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},7:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.NoExperienceBox,depth0,{"name":"NoExperienceBox","data":data,"indent":"  ","helpers":helpers,
"partials":partials,"decorators":container.decorators}))!=null?stack1:""},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'\x3cdiv class\x3d"visitor-box"\x3e\n  \x3cinput is\x3d"coral-textfield" class\x3d"visitor-percentage" value\x3d"'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.visitorPercentage:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,
data,0),"data":data}))!=null?stack1:"")+'"\x3e\n  \x3cspan class\x3d"visitor-percentage-symbol"\x3e%\x3c/span\x3e\n\x3c/div\x3e\n\n'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.name:depth0,{"name":"if","hash":{},"fn":container.program(5,data,0),"inverse":container.program(7,data,0),"data":data}))!=null?stack1:"")},"usePartial":true,"useData":true}));
Handlebars.registerPartial("ExperienceBox",this["TSDK"]["UI"]["Templates"]["DiagramComponent"]["ExperienceBox"]=Handlebars.template({"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'\x3cdiv class\x3d"tsdk-experience-box"\x3e\n  \x3cstrong class\x3d"experience-title"\x3e'+alias4((helper=(helper=helpers.name||(depth0!=
null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'\x3c/strong\x3e\n  \x3cinput is\x3d"coral-textfield" class\x3d"experience-title-input" value\x3d"'+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'"\x3e\n  \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"breadcrumb" iconsize\x3d"XS" class\x3d"experience-options-button"\x3e\x3c/button\x3e\n  \x3ccoral-popover class\x3d"context-menu" placement\x3d"bottom" target\x3d"_prev"\x3e\n    \x3ccoral-popover-content\x3e\n      \x3ccoral-selectlist\x3e\n        \x3ccoral-selectlist-item value\x3d"edit"\x3e\n          \x3ccoral-icon icon\x3d"edit"\x3e\x3c/coral-icon\x3e\n          \x3cspan\x3e'+
alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Edit",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n        \x3c/coral-selectlist-item\x3e\n        \x3ccoral-selectlist-item value\x3d"remove"\x3e\n          \x3ccoral-icon icon\x3d"delete"\x3e\x3c/coral-icon\x3e\n          \x3cspan\x3e'+alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Remove",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n        \x3c/coral-selectlist-item\x3e\n        \x3ccoral-selectlist-item value\x3d"rename"\x3e\n          \x3ccoral-icon icon\x3d"text"\x3e\x3c/coral-icon\x3e\n          \x3cspan\x3e'+
alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Rename",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n        \x3c/coral-selectlist-item\x3e\n      \x3c/coral-selectlist\x3e\n    \x3c/coral-popover-content\x3e\n  \x3c/coral-popover\x3e\n\x3c/div\x3e"},"useData":true}));
Handlebars.registerPartial("ExperienceXT",this["TSDK"]["UI"]["Templates"]["DiagramComponent"]["ExperienceXT"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.ExperienceBox,depth0,{"name":"ExperienceBox","data":data,"indent":"  ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},3:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.NoExperienceBox,
depth0,{"name":"NoExperienceBox","data":data,"indent":"  ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.name:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:""},"usePartial":true,
"useData":true}));
Handlebars.registerPartial("NoAudienceBox",this["TSDK"]["UI"]["Templates"]["DiagramComponent"]["NoAudienceBox"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"view-mode"},3:function(container,depth0,helpers,partials,data){return'    \x3cstrong class\x3d"audience-title"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"No Audience",{"name":"i18n","hash":{},"data":data}))+"\x3c/strong\x3e\n"},
5:function(container,depth0,helpers,partials,data){return'    \x3ccoral-icon icon\x3d"add" size\x3d"S" class\x3d"audience-icon"\x3e\x3c/coral-icon\x3e\n    \x3cstrong class\x3d"audience-title"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Add Audience",{"name":"i18n","hash":{},"data":data}))+"\x3c/strong\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,
alias1=depth0!=null?depth0:container.nullContext||{};return'\x3cdiv class\x3d"tsdk-audience-box no-audience '+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.viewMode:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'"\x3e\n'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.viewMode:depth0,{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.program(5,data,0),"data":data}))!=null?stack1:"")+
"\x3c/div\x3e"},"useData":true}));
Handlebars.registerPartial("NoExperienceBox",this["TSDK"]["UI"]["Templates"]["DiagramComponent"]["NoExperienceBox"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"view-mode"},3:function(container,depth0,helpers,partials,data){return'    \x3cstrong class\x3d"experience-title"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"No Experience",{"name":"i18n","hash":{},"data":data}))+
"\x3c/strong\x3e\n"},5:function(container,depth0,helpers,partials,data){return'    \x3ccoral-icon icon\x3d"add" size\x3d"S" class\x3d"experience-icon"\x3e\x3c/coral-icon\x3e\n    \x3cstrong class\x3d"experience-title"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Add Experience",{"name":"i18n","hash":{},"data":data}))+"\x3c/strong\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,
helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'\x3cdiv class\x3d"tsdk-experience-box no-experience '+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.viewMode:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'"\x3e\n'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.viewMode:depth0,{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.program(5,data,
0),"data":data}))!=null?stack1:"")+"\x3c/div\x3e"},"useData":true}));
Handlebars.registerPartial("AudienceRule",this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["AudienceRule"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return'    \x3cspan class\x3d"message"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Add rules to define an audience.",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,
depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"targetingwidget"\x3e\n'+((stack1=helpers.unless.call(alias1,depth0!=null?depth0["jcr:title"]:depth0,{"name":"unless","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'  \x3cdiv class\x3d"rules"\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"tooltip error arrow-bottom hoverError deleteRuleConfirmationDialog"\x3e\n    \x3cspan\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Are you sure you want to delete?",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n    \x3cbutton class\x3d"icon-close white"\x3e\x3c/button\x3e\n    \x3cbutton class\x3d"icon-delete white warning"\x3e\x3c/button\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"dropdown rulesdropdown" data-init\x3d"dropdown" title\x3d\''+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Add a targeting rule",{"name":"i18n","hash":{},"data":data}))+
'\'\x3e\n    \x3cselect class\x3d"ruleselector"\x3e\n      \x3coption value\x3d""\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Add Rule",{"name":"i18n","hash":{},"data":data}))+'\x3c/option\x3e\n      \x3coption value\x3d"SITE_PAGE"\x3e\x3ci class\x3d"icon-pages"\x3e\x3c/i\x3e\x3cspan\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Site Pages",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\x3c/option\x3e\n      \x3coption value\x3d"MBOX"\x3e\x3ci class\x3d"icon-pages"\x3e\x3c/i\x3e\x3cspan\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Custom Parameters",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\x3c/option\x3e\n      \x3coption value\x3d"BROWSER_PARAM"\x3e\x3ci class\x3d"icon-unmerge"\x3e\x3c/i\x3e\x3cspan\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Browser",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\x3c/option\x3e\n      \x3coption value\x3d"OPERATING_SYSTEM"\x3e\x3ci class\x3d"icon-unmerge"\x3e\x3c/i\x3e\x3cspan\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Operating System",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\x3c/option\x3e\n      \x3coption value\x3d"VISITOR_PROFILE"\x3e\x3ci class\x3d"icon-demographic"\x3e\x3c/i\x3e\x3cspan\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Visitor Profile",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\x3c/option\x3e\n      \x3coption value\x3d"LIBRARY"\x3e\x3ci class\x3d"icon-archive"\x3e\x3c/i\x3e\x3cspan\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Target Library",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\x3c/option\x3e\n      \x3coption value\x3d"TRAFFIC_SOURCES"\x3e\x3ci class\x3d"icon-merge"\x3e\x3c/i\x3e\x3cspan\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Traffic Sources",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\x3c/option\x3e\n    \x3c/select\x3e\n  \x3c/div\x3e\n\x3c/div\x3e"},"useData":true}));
Handlebars.registerPartial("RuleSelector",this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["RuleSelector"]=Handlebars.template({1:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cdiv class\x3d"rule-option '+((stack1=(helpers.matchesAudienceType||depth0&&depth0.matchesAudienceType||alias2).call(alias1,depth0,(stack1=depths[1]!=null?depths[1].rule:
depths[1])!=null?stack1.type:stack1,{"name":"matchesAudienceType","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'" data-value\x3d"'+alias3(container.lambda(depth0,depth0))+'"\x3e\n      \x3ccoral-icon class\x3d"rule-icon" icon\x3d"'+alias3((helpers.getIconForAudienceType||depth0&&depth0.getIconForAudienceType||alias2).call(alias1,depth0,{"name":"getIconForAudienceType","hash":{},"data":data}))+'" size\x3d"M"\x3e\x3c/coral-icon\x3e\n      \x3cdiv class\x3d"rule-label"\x3e'+
alias3((helpers.getLabelForAudienceType||depth0&&depth0.getLabelForAudienceType||alias2).call(alias1,depth0,{"name":"getLabelForAudienceType","hash":{},"data":data}))+"\x3c/div\x3e\n    \x3c/div\x3e\n"},2:function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return'\x3cdiv class\x3d"tsdk-audience-rule-selector"\x3e\n'+((stack1=helpers.each.call(depth0!=null?depth0:container.nullContext||
{},depth0!=null?depth0.enabledRules:depth0,{"name":"each","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e\n\n"},"useData":true,"useDepths":true}));
Handlebars.registerPartial("RuleSummary",this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["RuleSummary"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cspan class\x3d"summary-section-label"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Attribute Type",{"name":"i18n","hash":{},"data":data}))+':\x26nbsp;\x3c/span\x3e\n    \x3cspan class\x3d"summary-rule-type"\x3e\n      \x3ccoral-icon icon\x3d"'+
alias3((helpers.getIconForAudienceType||depth0&&depth0.getIconForAudienceType||alias2).call(alias1,depth0!=null?depth0.type:depth0,{"name":"getIconForAudienceType","hash":{},"data":data}))+'"\x3e\x3c/coral-icon\x3e\n      '+alias3((helpers.getLabelForAudienceType||depth0&&depth0.getLabelForAudienceType||alias2).call(alias1,depth0!=null?depth0.type:depth0,{"name":"getLabelForAudienceType","hash":{},"data":data}))+"\n    \x3c/span\x3e\n"},3:function(container,depth0,helpers,partials,data){var stack1;
return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},(stack1=depth0!=null?depth0.summary:depth0)!=null?stack1.parameter:stack1,{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},4:function(container,depth0,helpers,partials,data){var stack1,alias1=container.escapeExpression,alias2=container.lambda;return'      \x3cspan class\x3d"summary-section-label"\x3e'+alias1((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=
null?depth0:container.nullContext||{},"When",{"name":"i18n","hash":{},"data":data}))+':\x3c/span\x3e\n      \x3cspan class\x3d"summary-rule-parameter"\x3e'+alias1(alias2((stack1=depth0!=null?depth0.summary:depth0)!=null?stack1.parameter:stack1,depth0))+'\x3c/span\x3e\n      \x3cspan class\x3d"summary-rule-operator"\x3e'+alias1(alias2((stack1=depth0!=null?depth0.summary:depth0)!=null?stack1.operator:stack1,depth0))+'\x3c/span\x3e\n      \x3cspan class\x3d"summary-rule-operands"\x3e'+alias1(alias2((stack1=
depth0!=null?depth0.summary:depth0)!=null?stack1.operands:stack1,depth0))+"\x3c/span\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'\x3cdiv class\x3d"tsdk-rule-summary-text"\x3e\n'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.type:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,
depth0!=null?depth0.summary:depth0,{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e"},"useData":true}));
Handlebars.registerPartial("MatchOperator",this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["MatchOperator"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n  \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"matches",{"name":"i18n","hash":{},
"data":data}))+'\x3c/coral-select-item\x3e\n  \x3ccoral-select-item value\x3d"doesNotEqualIgnoreCase" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotEqualIgnoreCase",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not match",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n\x3c/coral-select\x3e\n"},
"useData":true}));
Handlebars.registerPartial("MobileDeviceType",this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["MobileDeviceType"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return'checked\x3d"checked"'},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'\x3clabel class\x3d"device-type-option"\x3e\n  \x3cinput type\x3d"checkbox" name\x3d"device-type-option" data-value\x3d"'+alias4((helper=
(helper=helpers.value||(depth0!=null?depth0.value:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"value","hash":{},"data":data}):helper))+'"\n    '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.value:depth0,depth0!=null?depth0.deviceType:depth0,{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\x3e\n  \x3cspan class\x3d"cursor-pointer"\x3e\x3ci class\x3d"'+
alias4((helper=(helper=helpers.deviceIconClass||(depth0!=null?depth0.deviceIconClass:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"deviceIconClass","hash":{},"data":data}):helper))+'"\x3e\x3c/i\x3e\x26nbsp;'+alias4((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper))+"\x3c/span\x3e\n\x3c/label\x3e\n"},"useData":true}));
Handlebars.registerPartial("MobileDimension",this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["MobileDimension"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},3:function(container,depth0,helpers,partials,data){var stack1;return'  \x3ccoral-numberinput min\x3d"0" class\x3d"operandsInput" data-step\x3d"2" placeholder\x3d"Enter a number" value\x3d"'+container.escapeExpression(container.lambda((stack1=depth0!=null?depth0.operands:depth0)!=null?stack1["0"]:
stack1,depth0))+'"\x3e\x3c/coral-numberinput\x3e\n'},5:function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return'  \x3ccoral-numberinput step\x3d"1" min\x3d"0" class\x3d"operandsInput lower-value" data-step\x3d"2" placeholder\x3d"Enter a number" value\x3d"'+alias2(alias1((stack1=depth0!=null?depth0.operands:depth0)!=null?stack1["0"]:stack1,depth0))+'"\x3e\x3c/coral-numberinput\x3e\n  \x3cspan class\x3d"operandsSeparator"\x3e'+alias2((helpers.i18n||
depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"to",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n  \x3ccoral-numberinput step\x3d"1" min\x3d"1" class\x3d"operandsInput upper-value" data-step\x3d"2" placeholder\x3d"Enter a number" value\x3d"'+alias2(alias1((stack1=depth0!=null?depth0.operands:depth0)!=null?stack1["1"]:stack1,depth0))+'"\x3e\x3c/coral-numberinput\x3e\n'},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,
partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n  \x3ccoral-select-item value\x3d"greater" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:
depth0,"greater",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Greater Than",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n  \x3ccoral-select-item value\x3d"lesser" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"lesser",{"name":"equals","hash":{},"fn":container.program(1,data,
0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Less Than",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n  \x3ccoral-select-item value\x3d"between" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"between",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Between",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n\x3c/coral-select\x3e\n\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"greater","lesser",{"name":"in","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"between",
{"name":"equals","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},"useData":true}));
Handlebars.registerPartial("MobileOsOptions",this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["MobileOsOptions"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3ccoral-autocomplete-item value\x3d"osAndroid" '+((stack1=(helpers.hasValue||
depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"osAndroid",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Android",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n\x3ccoral-autocomplete-item value\x3d"osOsx" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:
depth0,"osOsx",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"iOS",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n\x3ccoral-autocomplete-item value\x3d"osWindows" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"osWindows",{"name":"hasValue","hash":{},"fn":container.program(1,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Windows",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n\x3ccoral-autocomplete-item value\x3d"osLinux" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"osLinux",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:
"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Linux",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n\x3ccoral-autocomplete-item value\x3d"osProprietary" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"osProprietary",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||
alias2).call(alias1,"Proprietary",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n\x3ccoral-autocomplete-item value\x3d"osRim" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"osRim",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Blackberry",{"name":"i18n","hash":{},"data":data}))+
'\x3c/coral-autocomplete-item\x3e\n\x3ccoral-autocomplete-item value\x3d"osSymbian" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"osSymbian",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Symbian",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-autocomplete-item\x3e\n"},"useData":true}));
this["TSDK"]["UI"]["Templates"]["MboxPickerComponent"]["MboxPicker"]=Handlebars.template({1:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return'    \x3ccoral-autocomplete-item value\x3d"'+alias2(alias1(depth0,depth0))+'" data-special\x3d"true" '+((stack1=(helpers.equals||depth0&&depth0.equals||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depths[1]!=null?depths[1].selected:depths[1],
depth0,{"name":"equals","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias2(alias1(depth0,depth0))+"\x3c/coral-autocomplete-item\x3e\n"},2:function(container,depth0,helpers,partials,data){return"selected"},4:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"    "+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||
{},depths[1]!=null?depths[1].exclude:depths[1],depth0,{"name":"hasValue","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),"data":data}))!=null?stack1:"")},5:function(container,depth0,helpers,partials,data){return""},7:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return'\n      \x3ccoral-autocomplete-item value\x3d"'+alias2(alias1(depth0,
depth0))+'" '+((stack1=(helpers.equals||depth0&&depth0.equals||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depths[2]!=null?depths[2].selected:depths[2],depth0,{"name":"equals","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias2(alias1(depth0,depth0))+"\x3c/coral-autocomplete-item\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,
alias1=depth0!=null?depth0:container.nullContext||{};return'\x3ccoral-autocomplete placeholder\x3d"Search mbox" class\x3d"tsdk-mboxpicker"\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.specialMboxes:depth0,{"name":"each","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers.each.call(alias1,depth0!=null?depth0.items:depth0,{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3c/coral-autocomplete\x3e"},"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["MetricsComponent"]["Metrics"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return'    \x3cdiv class\x3d"coral-Heading coral-Heading--3 section-heading"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Optimization Goal (Specifies goal for algorithm to optimize)*",{"name":"i18n","hash":{},"data":data}))+"\x3c/div\x3e\n"},3:function(container,depth0,
helpers,partials,data){return'    \x3cdiv class\x3d"coral-Heading coral-Heading--3 section-heading"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Goal Metric*",{"name":"i18n","hash":{},"data":data}))+"\x3c/div\x3e\n"},5:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cdiv class\x3d"conversion-block"\x3e\n      \x3cdiv class\x3d"coral-Heading coral-Heading--3 section-heading"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Conversion Metric (Specifies when to restart activity)",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n        \x3cdiv class\x3d"conversion-checkbox-container"\x3e\n        \x3ccoral-checkbox class\x3d"conversion-metric-checkbox" checked '+((stack1=helpers.unless.call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.CONVERSION_METRIC_CHECKBOX_ENABLED:stack1,{"name":"unless","hash":{},"fn":container.program(6,data,
0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e\n            \x3cspan\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Same as Optimization Goal",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n          \x3c/coral-checkbox\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"conversion"\x3e\x3c/div\x3e\n      \x3c/div\x3e\n'},6:function(container,depth0,helpers,partials,data){return"disabled"},8:function(container,depth0,helpers,partials,data){var alias1=
depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cdiv class\x3d"additional-metrics"\x3e\n      \x3cdiv class\x3d"coral-Heading coral-Heading--3 section-heading"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Additional Metrics",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n      \x3cdiv class\x3d"additional"\x3e\x3c/div\x3e\n      \x3cdiv class\x3d"grey sub-heading margin-t-1-25"\x3e'+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Configure other success metrics for reporting.",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n      \x3cdiv\x3e\n        \x3cbutton type\x3d"button" is\x3d"coral-button" iconsize\x3d"S" id\x3d"addmetrics" class\x3d"addmetrics"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Add a New Metric",{"name":"i18n","hash":{},"data":data}))+"\x3c/button\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,
depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'\x3cdiv class\x3d"tsdk-ui-metrics"\x3e\n'+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.POST_GOAL_METRIC_TRACKING_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+'  \x3cdiv class\x3d"goal"\x3e\x3c/div\x3e\n\n'+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?
depth0.config:depth0)!=null?stack1.POST_GOAL_METRIC_TRACKING_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.notEquals||depth0&&depth0.notEquals||helpers.helperMissing).call(alias1,depth0!=null?depth0.reportingSolution:depth0,"analytics",{"name":"notEquals","hash":{},"fn":container.program(8,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e"},"useData":true});
this["TSDK"]["UI"]["Templates"]["MetricsComponent"]["MetricsItem"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return'            \x3ccoral-selectlist-item value\x3d"delete" class\x3d"delete-metric"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Delete",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-selectlist-item\x3e\n"},3:function(container,depth0,helpers,partials,data){var stack1,
alias1=depth0!=null?depth0:container.nullContext||{};return'            \x3ccoral-selectlist-item value\x3d"advancedSettings" '+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.isAdvancedSettingsVisible:depth0,{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Advanced Settings",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-selectlist-item\x3e\n"},
4:function(container,depth0,helpers,partials,data){return"disabled"},6:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'            \x3ccoral-select-item value\x3d"conversion" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"conversion",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:
"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Conversion",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},7:function(container,depth0,helpers,partials,data){return"selected"},9:function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.ACTION_VIEWED_MBOX_ENABLED:stack1,{"name":"if","hash":{},
"fn":container.program(10,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},10:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"revenue" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"revenue",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Revenue",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},12:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'            \x3ccoral-select-item value\x3d"engagement" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"engagement",
{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Engagement",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},14:function(container,depth0,helpers,partials,data){return'          \x3ccoral-tooltip variant\x3d"inspect" placement\x3d"right" class\x3d"goalnote" target\x3d"#metric-selector" interaction\x3d"off" open\x3e\n            '+
container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"This metric will determine the success of your activity.",{"name":"i18n","hash":{},"data":data}))+"\n          \x3c/coral-tooltip\x3e\n"},16:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'        \x3cdiv class\x3d"row fixed"\x3e\n          \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Default View for Reporting",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n          \x3ccoral-select class\x3d"select-revenue-type"\x3e\n            \x3ccoral-select-item value\x3d"rpv" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.revenueType:depth0,"rpv",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Revenue Per Visitor (RPV)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n            \x3ccoral-select-item value\x3d"aov" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.revenueType:depth0,"aov",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Average Order Value (AOV)",
{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.REVENUE_SALES_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(17,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.REVENUE_ORDERS_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(19,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"          \x3c/coral-select\x3e\n        \x3c/div\x3e\n"},17:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"sales" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.revenueType:depth0,"sales",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Total Sales",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},19:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"conversionRate" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.revenueType:
depth0,"conversionRate",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Orders",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},21:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'        \x3cdiv class\x3d"row fixed"\x3e\n          \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"There are three ways you can measure engagement, which would you like to measure?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n          \x3ccoral-select class\x3d"select-engagement-type" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select action",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n            \x3ccoral-select-item value\x3d"pageViews" '+((stack1=(helpers.equals||depth0&&depth0.equals||
alias2).call(alias1,depth0!=null?depth0.engagementType:depth0,"pageViews",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Page Views",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n            \x3ccoral-select-item value\x3d"customScoring" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.engagementType:
depth0,"customScoring",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Custom Scoring",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n            \x3ccoral-select-item value\x3d"timeOnSite" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.engagementType:depth0,"timeOnSite",{"name":"equals","hash":{},
"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Time on Site",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n          \x3c/coral-select\x3e\n\n"+((stack1=(helpers.ifEither||depth0&&depth0.ifEither||alias2).call(alias1,depth0!=null?depth0.isGoalMetric:depth0,true,depth0!=null?depth0.conversion:depth0,true,{"name":"ifEither","hash":{},"fn":container.program(22,data,
0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"        \x3c/div\x3e\n"},22:function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.PROJECTED_EARNINGS_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(23,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},23:function(container,depth0,helpers,partials,data){var stack1;return(stack1=
(helpers["in"]||depth0&&depth0["in"]||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.engagementType:depth0,"pageViews","timeOnSite",{"name":"in","hash":{},"fn":container.program(24,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},24:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'                \x3cdiv class\x3d"row fixed metric-worth"\x3e\n                  \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e\n'+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.engagementType:depth0,"timeOnSite",{"name":"equals","hash":{},"fn":container.program(25,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.engagementType:depth0,"pageViews",{"name":"equals","hash":{},"fn":container.program(27,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'                    \x3cspan\x3e\x26nbsp;\x3ca class\x3d"coral-Link"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"What is this",{"name":"i18n","hash":{},"data":data}))+'?\x3c/a\x3e\x3c/span\x3e\n                    \x3ccoral-tooltip placement\x3d"right" target\x3d"_prev"\x3e\n                      '+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Providing a value for your goal allows Target to calculate an estimated lift in revenue.",{"name":"i18n","hash":{},"data":data}))+'\x26nbsp;\n                      \x3ca href\x3d"http://microsite.omniture.com/t2/help/en_US/target/#target-Creating_an_Activity" target\x3d"_blank"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Learn more",{"name":"i18n","hash":{},"data":data}))+'\x3c/a\x3e\n                    \x3c/coral-tooltip\x3e\n                  \x3c/div\x3e\n                  \x3cinput is\x3d"coral-textfield" placeholder\x3d"'+alias3(container.lambda((stack1=depth0!=null?depth0.config:depth0)!=null?stack1.CURRENCY_SYMBOL:stack1,depth0))+'" value\x3d"'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.worth:depth0,{"name":"if","hash":{},"fn":container.program(29,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'" class\x3d"metric-worth-input"\x3e\n                \x3c/div\x3e\n'},25:function(container,depth0,helpers,partials,data){return"                      "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Estimated value of a minute on site",{"name":"i18n","hash":{},"data":data}))+"\x26nbsp;\n"},27:function(container,depth0,helpers,partials,data){return"                      "+
container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Estimated value of a page view",{"name":"i18n","hash":{},"data":data}))+"\n"},29:function(container,depth0,helpers,partials,data){return container.escapeExpression((helpers.number||depth0&&depth0.number||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.worth:depth0,{"name":"number","hash":{},"data":data}))},31:function(container,
depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'        \x3cdiv class\x3d"row fixed"\x3e\n          \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"What action was taken by your audience to indicate your goal has been reached?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n          \x3ccoral-select class\x3d"select-action width-100p-imp" placeholder\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select action",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n            \x3ccoral-select-item value\x3d"pageView" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"pageView",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Viewed a page",{"name":"i18n",
"hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.ACTION_VIEWED_MBOX_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(32,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.ACTION_CLICK_MBOX_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(34,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.CLICK_TRACKING_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(36,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.CLICK_RECOMMENDATION_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(38,data,0),"inverse":container.noop,"data":data}))!=null?stack1:
"")+"         \x3c/coral-select\x3e\n        \x3c/div\x3e\n\n        "+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"pageView",{"name":"equals","hash":{},"fn":container.program(40,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n        "+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.action:depth0,"mboxView","mboxClick",{"name":"in","hash":{},"fn":container.program(42,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\n        "+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"elementClick",{"name":"equals","hash":{},"fn":container.program(44,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n\n"+((stack1=(helpers.ifEither||depth0&&depth0.ifEither||alias2).call(alias1,depth0!=null?depth0.isGoalMetric:depth0,true,depth0!=null?depth0.conversion:depth0,true,{"name":"ifEither","hash":{},"fn":container.program(46,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},32:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"mboxView" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"mboxView",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:
"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Viewed an mbox",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},34:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"mboxClick" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"mboxClick",
{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e\n                "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Clicked on mbox",{"name":"i18n","hash":{},"data":data}))+"\n              \x3c/coral-select-item\x3e\n"},36:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"elementClick" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"elementClick",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e\n                "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Clicked an element",{"name":"i18n","hash":{},"data":data}))+"\n              \x3c/coral-select-item\x3e\n"},38:function(container,depth0,helpers,partials,data){var stack1,
alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"clickRecommendation" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"clickRecommendation",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e\n                "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"Clicked on recommendation",{"name":"i18n","hash":{},"data":data}))+"\n              \x3c/coral-select-item\x3e\n"},40:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.MetricsItemPageView,depth0,{"name":"MetricsItemPageView","data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},42:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.MetricsItemMboxFields,
depth0,{"name":"MetricsItemMboxFields","data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},44:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.MetricsItemElementClick,depth0,{"name":"MetricsItemElementClick","data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},46:function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=
null?depth0:container.nullContext||{},(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.PROJECTED_EARNINGS_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(47,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},47:function(container,depth0,helpers,partials,data){var stack1;return(stack1=(helpers["in"]||depth0&&depth0["in"]||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.action:depth0,"pageView","mboxView","elementClick",
"clickRecommendation",{"name":"in","hash":{},"fn":container.program(48,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},48:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'              \x3cdiv class\x3d"row fixed metric-worth"\x3e\n                \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e\n                  '+alias3((helpers.i18n||depth0&&
depth0.i18n||alias2).call(alias1,"Estimated Value of one conversion",{"name":"i18n","hash":{},"data":data}))+'\x26nbsp;\n                  \x3cspan\x3e\x26nbsp;\x3ca class\x3d"coral-Link"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"What is this",{"name":"i18n","hash":{},"data":data}))+'?\x3c/a\x3e\x3c/span\x3e\n                  \x3ccoral-tooltip placement\x3d"right" target\x3d"_prev"\x3e\n                    '+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"Providing a value for your goal allows Target to calculate an estimated lift in revenue.",{"name":"i18n","hash":{},"data":data}))+'\x26nbsp;\n                    \x3ca href\x3d"http://microsite.omniture.com/t2/help/en_US/target/#target-Creating_an_Activity" target\x3d"_blank"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Learn more",{"name":"i18n","hash":{},"data":data}))+'\x3c/a\x3e\n                  \x3c/coral-tooltip\x3e\n                \x3c/div\x3e\n                \x3cinput is\x3d"coral-textfield" placeholder\x3d"'+
alias3(container.lambda((stack1=depth0!=null?depth0.config:depth0)!=null?stack1.CURRENCY_SYMBOL:stack1,depth0))+'" value\x3d"'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.worth:depth0,{"name":"if","hash":{},"fn":container.program(29,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'" class\x3d"metric-worth-input"\x3e\n              \x3c/div\x3e\n'},50:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=
helpers.helperMissing,alias3=container.escapeExpression;return'        \x3cdiv class\x3d"row fixed"\x3e\n          \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"What action was taken by your audience to indicate your goal has been reached?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n          \x3ccoral-select class\x3d"select-action width-100p-imp"\x3e\n            \x3ccoral-select-item value\x3d"mboxView" '+((stack1=
(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"mboxView",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Viewed an mbox",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.ACTION_CLICK_MBOX_ENABLED:stack1,
{"name":"if","hash":{},"fn":container.program(34,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.CLICK_RECOMMENDATION_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(38,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"          \x3c/coral-select\x3e\n        \x3c/div\x3e\n\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:
depth0,"pageView",{"name":"equals","hash":{},"fn":container.program(51,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"mboxView",{"name":"equals","hash":{},"fn":container.program(53,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},51:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,
alias3=container.escapeExpression;return'          \x3cdiv class\x3d"row fixed"\x3e\n            \x3ccoral-select class\x3d"select-matcher"\x3e\n              \x3ccoral-select-item value\x3d"exact" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.matcher:depth0,"exact",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"URL is",
{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n              \x3ccoral-select-item value\x3d"contains" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.matcher:depth0,"contains",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"URL contains",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n            \x3c/coral-select\x3e\n          \x3c/div\x3e\n\n"+
((stack1=container.invokePartial(partials.MetricsItemUrlFields,depth0,{"name":"MetricsItemUrlFields","data":data,"indent":"          ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")},53:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.MetricsItemMboxFields,depth0,{"name":"MetricsItemMboxFields","data":data,"indent":"          ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=
null?stack1:""},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'\x3ccoral-accordion class\x3d"metric"\x3e\n  \x3ccoral-accordion-item selected class\x3d"metric-item"\x3e\n    \x3cinput is\x3d"coral-textfield" name\x3d"metricname" maxlength\x3d"25" class\x3d"metric-name-input" value\x3d"'+alias4((helper=
(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper))+'"\x3e\n    \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"moreVertical" iconSize\x3d"S" class\x3d"context-options-button"\x3e\n    \x3c/button\x3e\n    \x3ccoral-popover target\x3d"_prev" class\x3d"context-menu" alignmy\x3d"left top" alignat\x3d"left bottom"\x3e\n      \x3ccoral-popover-content\x3e\n        \x3ccoral-selectlist class\x3d"container-relative context-menu-option"\x3e\n          \x3ccoral-selectlist-item value\x3d"rename" class\x3d"rename-metric"\x3e'+
alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Rename",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-selectlist-item\x3e\n          \x3ccoral-selectlist-item value\x3d"clear" class\x3d"clear-metric-fields"\x3e'+alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Clear all fields",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-selectlist-item\x3e\n"+((stack1=helpers.unless.call(alias1,depth0!=null?depth0.isGoalMetric:depth0,{"name":"unless","hash":{},"fn":container.program(1,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.ADVANCED_SETTINGS_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'        \x3c/coral-selectlist\x3e\n      \x3c/coral-popover-content\x3e\n    \x3c/coral-popover\x3e\n\n\n    \x3ccoral-accordion-item-label class\x3d"metric-header display-inline-block width-90p"\x3e\n      \x3cspan class\x3d"metric-name-label uppercase"\x3e'+
alias4((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper))+'\x3c/span\x3e\n      \x3cdiv class\x3d"metric-summary font-normal"\x3e\x3c/div\x3e\n    \x3c/coral-accordion-item-label\x3e\n\n    \x3ccoral-accordion-item-content\x3e\n      \x3cdiv class\x3d"row fixed"\x3e\n        \x3cdiv class\x3d"grey sub-heading"\x3e'+alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"What do you want to measure with this activity?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n\n        \x3ccoral-select class\x3d"select-metric-type width-100p-imp" id\x3d"metric-selector" placeholder\x3d"'+alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select success metric",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n'+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.CONVERSION_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(6,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.REVENUE_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(9,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.ENGAGEMENT_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(12,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"        \x3c/coral-select\x3e\n\n"+((stack1=helpers.unless.call(alias1,depth0!=null?depth0.type:depth0,{"name":"unless","hash":{},"fn":container.program(14,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/div\x3e\n\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"revenue",{"name":"equals","hash":{},"fn":container.program(16,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=
(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"engagement",{"name":"equals","hash":{},"fn":container.program(21,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"conversion",{"name":"equals","hash":{},"fn":container.program(31,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=helpers["if"].call(alias1,depth0!=
null?depth0.revenueType:depth0,{"name":"if","hash":{},"fn":container.program(50,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\n      \x3cdiv class\x3d"advanced-metric-action-placeholder"\x3e\n'+((stack1=container.invokePartial(partials.AdvancedMetricActionType,depth0,{"name":"AdvancedMetricActionType","data":data,"indent":"        ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"      \x3c/div\x3e\n\n    \x3c/coral-accordion-item-content\x3e\n  \x3c/coral-accordion-item\x3e\n\x3c/coral-accordion\x3e"},
"usePartial":true,"useData":true});
this["TSDK"]["UI"]["Templates"]["MetricsComponent"]["MetricsItemA4T"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return'            \x3ccoral-selectlist-item value\x3d"rename" class\x3d"rename-metric"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Rename",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-selectlist-item\x3e\n"},3:function(container,depth0,helpers,partials,
data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'            \x3ccoral-select-item value\x3d"conversion" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"conversion",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Conversion",{"name":"i18n",
"hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},4:function(container,depth0,helpers,partials,data){return"selected"},6:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'            \x3ccoral-select-item value\x3d"analytics" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"analytics",{"name":"equals","hash":{},"fn":container.program(4,data,
0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Use an Analytics metric",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},8:function(container,depth0,helpers,partials,data){return'          \x3ccoral-tooltip variant\x3d"inspect" placement\x3d"right" class\x3d"goalnote" target\x3d"#metric-selector" interaction\x3d"off" open\x3e\n            '+container.escapeExpression((helpers.i18n||
depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"This metric will determine the success of your activity.",{"name":"i18n","hash":{},"data":data}))+"\n          \x3c/coral-tooltip\x3e\n"},10:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'        \x3cdiv class\x3d"grey sub-heading"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,
"The following are metrics available from Analytics:",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n        \x3cdiv class\x3d"row fixed"\x3e\n'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.reportSuite:depth0,{"name":"if","hash":{},"fn":container.program(11,data,0,blockParams,depths),"inverse":container.program(16,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"        \x3c/div\x3e\n"},11:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,
alias1=depth0!=null?depth0:container.nullContext||{};return'          \x3ccoral-select class\x3d"select-analytics-metric width-100p-imp" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Select Metric",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.analyticsMetrics:depth0,{"name":"each","hash":{},"fn":container.program(12,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=
null?stack1:"")+'          \x3c/coral-select\x3e\n          \x3ccoral-wait class\x3d"left middle loading '+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.analyticsMetrics:depth0,{"name":"if","hash":{},"fn":container.program(14,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'"\x3e\x3c/coral-wait\x3e\n'},12:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,
alias3="function",alias4=container.escapeExpression;return'              \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper))+'" data-source\x3d"'+alias4((helper=(helper=helpers.source||(depth0!=null?depth0.source:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"source","hash":{},"data":data}):helper))+'" data-support\x3d"'+
alias4((helper=(helper=helpers.support||(depth0!=null?depth0.support:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"support","hash":{},"data":data}):helper))+'" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.id:depth0,depths[1]!=null?depths[1].analyticsMetricId:depths[1],{"name":"equals","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias4((helper=
(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+"\x3c/coral-select-item\x3e\n"},14:function(container,depth0,helpers,partials,data){return"hidden"},16:function(container,depth0,helpers,partials,data){return'          \x3cdiv class\x3d"rs-alert"\x3e\n            \x3ccoral-icon icon\x3d"alert"\x3e\x3c/coral-icon\x3e\n            \x3cspan\x3e'+container.escapeExpression((helpers.i18n||
depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Please select a report suite to see the metrics available from Analytics.",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n          \x3c/div\x3e\n          \x3ccoral-wait class\x3d"left middle loading hidden"\x3e\x3c/coral-wait\x3e\n'},18:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;
return'        \x3cdiv class\x3d"row fixed"\x3e\n          \x3cdiv class\x3d"grey sub-heading padding-t-0-6"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"What action was taken by your audience to indicate your goal has been reached?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n          \x3ccoral-select class\x3d"select-action width-100p-imp" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select action",{"name":"i18n","hash":{},
"data":data}))+'"\x3e\n            \x3ccoral-select-item value\x3d"pageView" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"pageView",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Viewed a page",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"+((stack1=helpers["if"].call(alias1,
(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.ACTION_VIEWED_MBOX_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(19,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.ACTION_CLICK_MBOX_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(21,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:
depth0)!=null?stack1.CLICK_TRACKING_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(23,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.CLICK_RECOMMENDATION_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(25,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"          \x3c/coral-select\x3e\n        \x3c/div\x3e\n\n        "+((stack1=(helpers.equals||depth0&&
depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"pageView",{"name":"equals","hash":{},"fn":container.program(27,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n        "+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.action:depth0,"mboxView","mboxClick",{"name":"in","hash":{},"fn":container.program(29,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n        "+((stack1=(helpers.equals||depth0&&depth0.equals||
alias2).call(alias1,depth0!=null?depth0.action:depth0,"elementClick",{"name":"equals","hash":{},"fn":container.program(31,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"},19:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"mboxView" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,
"mboxView",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Viewed an mbox",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},21:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"mboxClick" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"mboxClick",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e\n                "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Clicked on mbox",{"name":"i18n","hash":{},"data":data}))+"\n              \x3c/coral-select-item\x3e\n"},23:function(container,depth0,helpers,partials,data){var stack1,
alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"elementClick" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"elementClick",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e\n                "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Clicked an element",
{"name":"i18n","hash":{},"data":data}))+"\n              \x3c/coral-select-item\x3e\n"},25:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'              \x3ccoral-select-item value\x3d"clickRecommendation" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.action:depth0,"clickRecommendation",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3e\n                "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Clicked on recommendation",{"name":"i18n","hash":{},"data":data}))+"\n              \x3c/coral-select-item\x3e\n"},27:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.MetricsItemPageView,depth0,{"name":"MetricsItemPageView","data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=
null?stack1:""},29:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.MetricsItemMboxFields,depth0,{"name":"MetricsItemMboxFields","data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},31:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.MetricsItemElementClick,depth0,{"name":"MetricsItemElementClick","data":data,"helpers":helpers,"partials":partials,
"decorators":container.decorators}))!=null?stack1:""},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'\x3ccoral-accordion class\x3d"metric"\x3e\n  \x3ccoral-accordion-item selected class\x3d"metric-item"\x3e\n    \x3cinput is\x3d"coral-textfield" name\x3d"metricname" maxlength\x3d"25" class\x3d"metric-name-input" value\x3d"'+
alias4((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper))+'"\x3e\n    \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"moreVertical" iconSize\x3d"S" class\x3d"context-options-button"\x3e\n    \x3c/button\x3e\n    \x3ccoral-popover target\x3d"_prev" class\x3d"context-menu" alignmy\x3d"left top" alignat\x3d"left bottom"\x3e\n      \x3ccoral-popover-content\x3e\n        \x3ccoral-selectlist class\x3d"container-relative context-menu-option"\x3e\n'+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"conversion",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'          \x3ccoral-selectlist-item value\x3d"clear" class\x3d"clear-metric-fields"\x3e'+alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Clear all fields",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-selectlist-item\x3e\n        \x3c/coral-selectlist\x3e\n      \x3c/coral-popover-content\x3e\n    \x3c/coral-popover\x3e\n\n    \x3ccoral-accordion-item-label class\x3d"metric-header display-inline-block width-90p"\x3e\n      \x3cspan class\x3d"metric-name-label uppercase"\x3e'+
alias4((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper))+'\x3c/span\x3e\n      \x3cdiv class\x3d"metric-summary font-normal"\x3e\x3c/div\x3e\n    \x3c/coral-accordion-item-label\x3e\n\n    \x3ccoral-accordion-item-content\x3e\n      \x3cdiv class\x3d"row fixed"\x3e\n        \x3cdiv class\x3d"grey sub-heading"\x3e'+alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"What do you want to measure with this activity?",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n\n        \x3ccoral-select class\x3d"select-metric-type width-100p-imp" id\x3d"metric-selector" placeholder\x3d"'+alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select success metric",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n'+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.CONVERSION_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(3,
data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.ANALYTICS_METRIC_ENABLED:stack1,{"name":"if","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"        \x3c/coral-select\x3e\n\n"+((stack1=helpers.unless.call(alias1,depth0!=null?depth0.type:depth0,{"name":"unless","hash":{},"fn":container.program(8,data,0,
blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/div\x3e\n\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"analytics",{"name":"equals","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.type:depth0,"conversion",{"name":"equals","hash":{},"fn":container.program(18,
data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"    \x3c/coral-accordion-item-content\x3e\n  \x3c/coral-accordion-item\x3e\n\x3c/coral-accordion\x3e\n"},"usePartial":true,"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["MetricsComponent"]["MetricsItemSummary"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'  \x3cspan class\x3d"font-italic"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Metric:",{"name":"i18n","hash":{},"data":data}))+'\x26nbsp;\x3c/span\x3e\n  \x3cspan class\x3d"color-3287d2-imp"\x3e'+
alias3((helper=(helper=helpers.type||(depth0!=null?depth0.type:depth0))!=null?helper:alias2,typeof helper==="function"?helper.call(alias1,{"name":"type","hash":{},"data":data}):helper))+"\x3c/span\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.action:depth0,{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},2:function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||
{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cspan class\x3d"font-italic"\x3e\x26nbsp;'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Action:",{"name":"i18n","hash":{},"data":data}))+'\x26nbsp;\x3c/span\x3e\n    \x3cspan class\x3d"color-3287d2-imp"\x3e'+alias3((helper=(helper=helpers.action||(depth0!=null?depth0.action:depth0))!=null?helper:alias2,typeof helper==="function"?helper.call(alias1,{"name":"action","hash":{},"data":data}):helper))+"\x3c/span\x3e\n\n"+
((stack1=helpers["if"].call(alias1,depth0!=null?depth0.terms:depth0,{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},3:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'      \x3cspan class\x3d"font-italic"\x3e\n        \x26nbsp;'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.constraint:depth0,{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.program(7,
data,0),"data":data}))!=null?stack1:"")+'\x26nbsp;\n      \x3c/span\x3e\x3cspan class\x3d"color-3287d2-imp first-term"\x3e'+container.escapeExpression(container.lambda((stack1=depth0!=null?depth0.terms:depth0)!=null?stack1["0"]:stack1,depth0))+"\x3c/span\x3e\n\n"+((stack1=(helpers.gt||depth0&&depth0.gt||helpers.helperMissing).call(alias1,(stack1=depth0!=null?depth0.terms:depth0)!=null?stack1.length:stack1,1,{"name":"gt","hash":{},"fn":container.program(9,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")},4:function(container,depth0,helpers,partials,data){var stack1;return"\n          "+((stack1=(helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"{0}:",{"name":"i18n","hash":{"comment":"{0} is either mbox or URL. May need to add space before colon for some languages."},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"},5:function(container,depth0,helpers,partials,data){var helper;
return container.escapeExpression((helper=(helper=helpers.constraint||(depth0!=null?depth0.constraint:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"constraint","hash":{},"data":data}):helper))},7:function(container,depth0,helpers,partials,data){return"          "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"term:",
{"name":"i18n","hash":{},"data":data}))+"\n        "},9:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'        \x3cspan class\x3d"color-3287d2-imp"\x3e\x26nbsp;\x26\x26nbsp;'+alias3((helpers.subtract||depth0&&depth0.subtract||alias2).call(alias1,(stack1=depth0!=null?depth0.terms:depth0)!=null?stack1.length:stack1,1,{"name":"subtract","hash":{},"data":data}))+"\x26nbsp;"+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"other",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n"},11:function(container,depth0,helpers,partials,data){var helper;return'  \x3cspan class\x3d"font-bold uppercase"\x3e'+container.escapeExpression((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"title","hash":{},"data":data}):
helper))+"\x3c/span\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.type:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(11,data,0),"data":data}))!=null?stack1:""},"useData":true});
this["TSDK"]["UI"]["Templates"]["Goals"]["Goals"]=Handlebars.template({1:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'  \x3cdiv class\x3d"reporting-data"\x3e\n'+((stack1=helpers.unless.call(alias1,(stack1=depths[1]!=null?depths[1].config:depths[1])!=null?stack1.SHOW_ONLY_ANALYTICS:stack1,{"name":"unless","hash":{},"fn":container.program(2,data,
0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\n    \x3cdiv class\x3d"row fixed reporting-company-suite-container '+((stack1=(helpers.notEquals||depth0&&depth0.notEquals||alias2).call(alias1,depths[1]!=null?depths[1].reportingSolution:depths[1],"analytics",{"name":"notEquals","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'"\x3e\n      \x3cdiv class\x3d"padding-r-1 cell sc-company-container"\x3e\n        \x3cdiv class\x3d"grey sub-heading"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Company",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n        \x3cdiv class\x3d"sc-company-picker-placeholder"\x3e\x3c/div\x3e\n      \x3c/div\x3e\n      \x3cdiv class\x3d"cell report-suite-container"\x3e\n        \x3cdiv class\x3d"grey sub-heading"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Report Suite",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n        \x3cdiv class\x3d"report-suite-picker-placeholder"\x3e\x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n\n    \x3cdiv class\x3d"divider-container"\x3e\n      \x3cdiv class\x3d"divider-line"\x3e\x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n'},
2:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3cdiv class\x3d"row fixed reporting-source"\x3e\n        \x3cdiv class\x3d"grey sub-heading"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Reporting Source",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n        \x3ccoral-select class\x3d"reporting-solution"\x3e\n          \x3ccoral-select-item value\x3d"target" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depths[1]!=null?depths[1].reportingSolution:depths[1],"target",{"name":"equals","hash":{},"fn":container.program(3,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e\n            "+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Adobe Target",{"name":"i18n","hash":{},"data":data}))+'\n          \x3c/coral-select-item\x3e\n          \x3ccoral-select-item value\x3d"analytics" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depths[1]!=null?depths[1].reportingSolution:depths[1],"analytics",{"name":"equals","hash":{},"fn":container.program(3,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e\n            "+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Adobe Analytics",{"name":"i18n","hash":{},"data":data}))+"\n          \x3c/coral-select-item\x3e\n        \x3c/coral-select\x3e\n      \x3c/div\x3e\n"},
3:function(container,depth0,helpers,partials,data){return"selected"},5:function(container,depth0,helpers,partials,data){return"hidden"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.isAnalyticsSupported:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?
stack1:"")+'\n\x3cdiv class\x3d"tsdk-metrics"\x3e\x3c/div\x3e'},"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["Goals"]["ReportSuitePicker"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"  \x3ccoral-wait\x3e\x3c/coral-wait\x3e\n"},3:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return(stack1=(helpers.equals||depth0&&depth0.equals||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},(stack1=depth0!=null?depth0.reportSuites:depth0)!=null?stack1.length:stack1,0,{"name":"equals","hash":{},"fn":container.program(4,
data,0,blockParams,depths),"inverse":container.program(6,data,0,blockParams,depths),"data":data}))!=null?stack1:""},4:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cdiv class\x3d"rs-alert"\x3e\n      \x3ccoral-icon icon\x3d"alert"\x3e\x3c/coral-icon\x3e\n      \x3cspan class\x3d"alert-text"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"There are no Target-enabled report suites available.",
{"name":"i18n","hash":{},"data":data}))+'\x26nbsp;\x3ca href\x3d"https://marketing.adobe.com/resources/help/en_US/target/a4t/"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Learn more.",{"name":"i18n","hash":{},"data":data}))+"\x3c/a\x3e\x3c/span\x3e\n    \x3c/div\x3e\n"},6:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'    \x3ccoral-select class\x3d"report-suite-picker" placeholder\x3d"'+
container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Select Report Suite",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.reportSuites:depth0,{"name":"each","hash":{},"fn":container.program(7,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"    \x3c/coral-select\x3e\n"},7:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=
depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'        \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=helpers.key||data&&data.key)!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"key","hash":{},"data":data}):helper))+'" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,data&&data.key,depths[1]!=null?depths[1].selectedReportSuite:depths[1],{"name":"equals","hash":{},
"fn":container.program(8,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+"\x3c/coral-select-item\x3e\n"},8:function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;
return(stack1=(helpers.equals||depth0&&depth0.equals||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.reportSuites:depth0,undefined,{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:""},"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["Goals"]["SCCompanyPicker"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"  \x3ccoral-wait\x3e\x3c/coral-wait\x3e\n"},3:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return(stack1=(helpers.equals||depth0&&depth0.equals||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},(stack1=depth0!=null?depth0.scCompanies:depth0)!=null?stack1.length:stack1,0,{"name":"equals","hash":{},"fn":container.program(4,
data,0,blockParams,depths),"inverse":container.program(6,data,0,blockParams,depths),"data":data}))!=null?stack1:""},4:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cdiv class\x3d"sc-alert"\x3e\n      \x3ccoral-icon icon\x3d"alert"\x3e\x3c/coral-icon\x3e\n      \x3cspan class\x3d"alert-text"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"There are no Target-enabled companies available.",
{"name":"i18n","hash":{},"data":data}))+'\x26nbsp;\x3ca href\x3d"https://marketing.adobe.com/resources/help/en_US/target/a4t/"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Learn more.",{"name":"i18n","hash":{},"data":data}))+"\x3c/a\x3e\x3c/span\x3e\n    \x3c/div\x3e\n"},6:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return'    \x3ccoral-select class\x3d"sc-company-picker"\x3e\n'+((stack1=helpers.each.call(depth0!=null?depth0:container.nullContext||
{},depth0!=null?depth0.scCompanies:depth0,{"name":"each","hash":{},"fn":container.program(7,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"    \x3c/coral-select\x3e\n"},7:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'        \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=
helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.name:depth0,depths[1]!=null?depths[1].selectedCompany:depths[1],{"name":"equals","hash":{},"fn":container.program(8,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias4((helper=(helper=helpers.name||(depth0!=
null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+"\x3c/coral-select-item\x3e\n"},8:function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=(helpers.equals||depth0&&depth0.equals||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.scCompanies:
depth0,undefined,{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"\n"},"useData":true,"useDepths":true});this["TSDK"]["UI"]["Templates"]["GoalsAndSettings"]["GoalsAndSettings"]=Handlebars.template({"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){return'\x3cdiv class\x3d"tsdk-goals"\x3e\x3c/div\x3e'},"useData":true});
this["TSDK"]["UI"]["Templates"]["DiagramComponent"]["DiagramAB"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers.unless.call(depth0!=null?depth0:container.nullContext||{},data&&data.index,{"name":"unless","hash":{},"fn":container.program(2,data,0),"inverse":container.program(4,data,0),"data":data}))!=null?stack1:""},2:function(container,depth0,helpers,partials,data){var stack1;return'          \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n            \x3cdiv class\x3d"container-relative width-100p display-table"\x3e\n              \x3cdiv class\x3d"diagram-cell"\x3e\n                \x3cdiv class\x3d"lineBottom line-cell-top"\x3e\x26nbsp;\x3c/div\x3e\n                \x3cdiv class\x3d"lineTop line-cell-bottom lineLeft"\x3e\x3cdiv class\x3d"cell middle"\x3e\x3c/div\x3e\x3c/div\x3e\n              \x3c/div\x3e\n              \x3cdiv class\x3d"diagram-cell experience-column"\x3e\n'+
((stack1=container.invokePartial(partials.ExperienceAB,depth0,{"name":"ExperienceAB","data":data,"indent":"                ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"              \x3c/div\x3e\n            \x3c/div\x3e\n          \x3c/div\x3e \x3c!-- experiencesCol --\x3e\n        \x3c/div\x3e\n"},4:function(container,depth0,helpers,partials,data){var stack1,helper;return'          \x3cdiv class\x3d"diagram-row" data-index\x3d"'+container.escapeExpression((helper=
(helper=helpers.index||data&&data.index)!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"index","hash":{},"data":data}):helper))+'"\x3e\n            \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n              \x3cdiv class\x3d"display-table width-100p"\x3e\n                \x3cdiv class\x3d"diagram-cell audience-column"\x3e\x26nbsp;\x3c/div\x3e\n                \x3cdiv class\x3d"diagram-cell"\x3e\x26nbsp;\x3c/div\x3e\n              \x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n              \x3cdiv class\x3d"container-relative width-100p display-table"\x3e\n                \x3cdiv class\x3d"diagram-cell"\x3e\n                  \x3cdiv class\x3d"lineBottom line-cell-top lineLeft"\x3e\x26nbsp;\x3c/div\x3e\n                  \x3cdiv class\x3d"lineTop line-cell-bottom lineLeft"\x3e\x26nbsp;\x3c/div\x3e\n                \x3c/div\x3e\n                \x3cdiv class\x3d"diagram-cell experience-column"\x3e\n'+
((stack1=container.invokePartial(partials.ExperienceAB,depth0,{"name":"ExperienceAB","data":data,"indent":"                  ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"                \x3c/div\x3e\n              \x3c/div\x3e\n            \x3c/div\x3e \x3c!-- experiencesCol --\x3e\n          \x3c/div\x3e\n"},6:function(container,depth0,helpers,partials,data){var stack1;return'        \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n            \x3cdiv class\x3d"container-relative width-100p display-table"\x3e\n              \x3cdiv class\x3d"diagram-cell"\x3e\n                \x3cdiv class\x3d"lineBottom line-cell-top"\x3e\x26nbsp;\x3c/div\x3e\n                \x3cdiv class\x3d"lineTop line-cell-bottom"\x3e\x26nbsp;\x3c/div\x3e\n              \x3c/div\x3e\n              \x3cdiv class\x3d"diagram-cell experience-column"\x3e\n'+
((stack1=container.invokePartial(partials.ExperienceAB,depth0,{"name":"ExperienceAB","data":data,"indent":"                ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"              \x3c/div\x3e\n            \x3c/div\x3e\n          \x3c/div\x3e \x3c!-- experiencesCol --\x3e\n        \x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},
alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3csection class\x3d"tsdk-diagram diagram-ab display-table"\x3e\n  \x3cdiv class\x3d"height-1-5 display-table-row"\x3e\n    \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n      \x3cspan class\x3d"section-title"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"AUDIENCE",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n      \x3cdiv class\x3d"container-relative width-100p display-table"\x3e\n        \x3cdiv class\x3d"diagram-cell"\x3e\x26nbsp;\x3c/div\x3e\n        \x3cdiv class\x3d"diagram-cell padding-0 experience-column"\x3e\n          \x3cdiv class\x3d"visitor-box placeholder"\x3e\x26nbsp;\x3c/div\x3e\n          \x3cspan class\x3d"section-title"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"EXPERIENCES",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"display-table-row-group"\x3e\n    \x3cdiv class\x3d"diagram-row" data-index\x3d"0"\x3e\n      \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n        \x3cdiv class\x3d"display-table width-100p"\x3e\n          \x3cdiv class\x3d"diagram-cell audience-column"\x3e\n'+((stack1=
container.invokePartial(partials.AudienceAB,depth0!=null?depth0.audience:depth0,{"name":"AudienceAB","data":data,"indent":"            ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+'          \x3c/div\x3e\n          \x3cdiv class\x3d"diagram-cell"\x3e\n            \x3cdiv class\x3d"lineBottom line-cell-top"\x3e\x26nbsp;\x3c/div\x3e\n            \x3cdiv class\x3d"lineTop"\x3e\x26nbsp;\x3c/div\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e \x3c!-- audiencesCol --\x3e\n\n'+
((stack1=helpers.each.call(alias1,depth0!=null?depth0.experiences:depth0,{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.program(6,data,0),"data":data}))!=null?stack1:"")+"  \x3c/div\x3e\n\x3c/section\x3e\n"},"usePartial":true,"useData":true});
this["TSDK"]["UI"]["Templates"]["DiagramComponent"]["DiagramXT"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var stack1,helper;return'      \x3cdiv class\x3d"diagram-row" data-index\x3d"'+container.escapeExpression((helper=(helper=helpers.index||data&&data.index)!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"index","hash":{},"data":data}):helper))+'"\x3e\n        \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n          \x3cdiv class\x3d"display-table width-100p"\x3e\n            \x3cdiv class\x3d"diagram-cell audience-column"\x3e\n'+
((stack1=container.invokePartial(partials.AudienceAB,depth0!=null?depth0.audience:depth0,{"name":"AudienceAB","data":data,"indent":"              ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+'            \x3c/div\x3e\n            \x3cdiv class\x3d"diagram-cell"\x3e\n              \x3cdiv class\x3d"lineBottom line-cell-top"\x3e\x26nbsp;\x3c/div\x3e\n              \x3cdiv class\x3d"lineTop"\x3e\x26nbsp;\x3c/div\x3e\n            \x3c/div\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e \x3c!-- audiencesCol --\x3e\n\n        \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n          \x3cdiv class\x3d"container-relative width-100p display-table"\x3e\n            \x3cdiv class\x3d"diagram-cell"\x3e\n              \x3cdiv class\x3d"lineBottom line-cell-top"\x3e\x26nbsp;\x3c/div\x3e\n              \x3cdiv class\x3d"lineTop"\x3e\x3cdiv class\x3d"cell middle"\x3e\x3c/div\x3e\x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"diagram-cell experience-column"\x3e\n'+
((stack1=container.invokePartial(partials.ExperienceXT,depth0,{"name":"ExperienceXT","data":data,"indent":"              ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"            \x3c/div\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e \x3c!-- experiencesCol --\x3e\n      \x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,
alias3=container.escapeExpression;return'\x3csection class\x3d"tsdk-diagram diagram-xt display-table"\x3e\n  \x3cdiv class\x3d"height-1-5 display-table-row"\x3e\n    \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n      \x3cspan class\x3d"section-title"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"AUDIENCES",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"diagram-cell width-50p"\x3e\n      \x3cdiv class\x3d"container-relative width-100p display-table"\x3e\n        \x3cdiv class\x3d"diagram-cell"\x3e\x26nbsp;\x3c/div\x3e\n        \x3cdiv class\x3d"diagram-cell padding-0 experience-column"\x3e\n          \x3cspan class\x3d"section-title"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"EXPERIENCES",{"name":"i18n","hash":{},"data":data}))+'\x3c/span\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n\n  \x3cdiv class\x3d"display-table-row-group"\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.experiences:depth0,{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"  \x3c/div\x3e\n\x3c/section\x3e\n\n"},"usePartial":true,
"useData":true});
this["TSDK"]["UI"]["Templates"]["ExperienceRailComponent"]["ExperienceRailAB"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"right"},3:function(container,depth0,helpers,partials,data){return"left"},5:function(container,depth0,helpers,partials,data){return"chevronRight"},7:function(container,depth0,helpers,partials,data){return"chevronLeft"},9:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||
{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'      \x3cdiv class\x3d"rail-row experience-row '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,data&&data.index,(stack1=depths[1]!=null?depths[1].config:depths[1])!=null?stack1.activeIndex:stack1,{"name":"equals","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'"\n           data-index\x3d"'+alias4((helper=(helper=
helpers.index||data&&data.index)!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper))+'" title\x3d"'+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'"\x3e\n        \x3cdiv class\x3d"rail-cell label-area"\x3e\n          \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"triangleDown" iconsize\x3d"XS" class\x3d"menu-button"\x3e\x3c/button\x3e\n          \x3cspan class\x3d"rail-label"\x3e'+
alias4((helpers.getExperienceShortName||depth0&&depth0.getExperienceShortName||alias2).call(alias1,depth0!=null?depth0.name:depth0,{"name":"getExperienceShortName","hash":{},"data":data}))+'\x3c/span\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"rail-cell collapsible-area"\x3e\n          \x3cdiv class\x3d"experience-name"\x3e'+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):
helper))+"\x3c/div\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n"},10:function(container,depth0,helpers,partials,data){return"active"},12:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3cdiv class\x3d"rail-row add-experience"\x3e\n        \x3cdiv class\x3d"rail-cell label-area"\x3e\n          \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"add" iconsize\x3d"XS" title\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Add Experience",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"rail-cell collapsible-area"\x3e\n          \x3cspan\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Add Experience",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,
partials,data,blockParams,depths){var stack1,alias1=container.escapeExpression,alias2=depth0!=null?depth0:container.nullContext||{},alias3=helpers.helperMissing;return'\x3cdiv class\x3d"tsdk-experience-rail tsdk-experience-rail-ab"\n     data-mode\x3d"'+alias1(container.lambda((stack1=depth0!=null?depth0.config:depth0)!=null?stack1.mode:stack1,depth0))+'" data-placement\x3d"'+((stack1=(helpers.equals||depth0&&depth0.equals||alias3).call(alias2,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.placement:
stack1,"right",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+'"\x3e\n  \x3cdiv class\x3d"rail-label-background"\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"rail-rows-container rail-header-row"\x3e\n    \x3cdiv class\x3d"rail-row"\x3e\n      \x3cdiv class\x3d"rail-cell label-area"\x3e\n        \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" iconsize\x3d"XS"\n                icon\x3d"'+
((stack1=(helpers.equals||depth0&&depth0.equals||alias3).call(alias2,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.placement:stack1,"right",{"name":"equals","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+'"\n                class\x3d"collapse-btn hidden-in-collapsed-mode hidden-in-expanding-mode" title\x3d"'+alias1((helpers.i18n||depth0&&depth0.i18n||alias3).call(alias2,"Collapse",{"name":"i18n",
"hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n        \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" iconsize\x3d"XS"\n                icon\x3d"'+((stack1=(helpers.equals||depth0&&depth0.equals||alias3).call(alias2,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.placement:stack1,"right",{"name":"equals","hash":{},"fn":container.program(7,data,0,blockParams,depths),"inverse":container.program(5,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+'"\n                class\x3d"expand-btn hidden-in-expanded-mode hidden-in-collapsing-mode" title\x3d"'+
alias1((helpers.i18n||depth0&&depth0.i18n||alias3).call(alias2,"Expand",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n      \x3c/div\x3e\n      \x3cdiv class\x3d"rail-cell collapsible-area"\x3e\n        \x3cspan\x3e\x3cstrong\x3e'+alias1((helpers.i18n||depth0&&depth0.i18n||alias3).call(alias2,"Experiences",{"name":"i18n","hash":{},"data":data}))+'\x3c/strong\x3e\x3c/span\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n\n  \x3cdiv class\x3d"rail-rows-container rail-body-rows"\x3e\n'+
((stack1=helpers.each.call(alias2,depth0!=null?depth0.experiences:depth0,{"name":"each","hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.lt||depth0&&depth0.lt||alias3).call(alias2,(stack1=depth0!=null?depth0.experiences:depth0)!=null?stack1.length:stack1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.maxCount:stack1,{"name":"lt","hash":{},"fn":container.program(12,data,0,blockParams,depths),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"  \x3c/div\x3e\n\x3c/div\x3e"},"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["ExperienceRailComponent"]["ExperienceRailActionMenu"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'  \x3ccoral-selectlist class\x3d"action-menu"\x3e\n'+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.actions:depth0,"edit",{"name":"hasValue","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.actions:depth0,"rename",{"name":"hasValue","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.actions:depth0,"duplicate",{"name":"hasValue","hash":{},"fn":container.program(9,data,0),"inverse":container.noop,"data":data}))!=null?stack1:
"")+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.actions:depth0,"delete",{"name":"hasValue","hash":{},"fn":container.program(11,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"  \x3c/coral-selectlist\x3e\n"},2:function(container,depth0,helpers,partials,data){return'      \x3ccoral-selectlist-item value\x3d"edit"\x3e\n        \x3ccoral-icon icon\x3d"edit"\x3e\x3c/coral-icon\x3e\n        \x3cspan\x3e'+container.escapeExpression((helpers.i18n||
depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Edit Audience",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n      \x3c/coral-selectlist-item\x3e\n"},4:function(container,depth0,helpers,partials,data){var stack1;return'      \x3ccoral-selectlist-item value\x3d"rename"\x3e\n        \x3ccoral-icon icon\x3d"text"\x3e\x3c/coral-icon\x3e\n        \x3cspan\x3e'+((stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?
depth0.experienceOnly:depth0,{"name":"if","hash":{},"fn":container.program(5,data,0),"inverse":container.program(7,data,0),"data":data}))!=null?stack1:"")+"\x3c/span\x3e\n      \x3c/coral-selectlist-item\x3e\n"},5:function(container,depth0,helpers,partials,data){return container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Rename",{"name":"i18n","hash":{},"data":data}))},7:function(container,depth0,helpers,partials,
data){return container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Rename Experience",{"name":"i18n","hash":{},"data":data}))},9:function(container,depth0,helpers,partials,data){return'      \x3ccoral-selectlist-item value\x3d"duplicate"\x3e\n        \x3ccoral-icon icon\x3d"copy"\x3e\x3c/coral-icon\x3e\n        \x3cspan\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=
null?depth0:container.nullContext||{},"Duplicate",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n      \x3c/coral-selectlist-item\x3e\n"},11:function(container,depth0,helpers,partials,data){return'      \x3ccoral-selectlist-item value\x3d"delete"\x3e\n        \x3ccoral-icon icon\x3d"delete"\x3e\x3c/coral-icon\x3e\n        \x3cspan\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Delete",{"name":"i18n",
"hash":{},"data":data}))+"\x3c/span\x3e\n      \x3c/coral-selectlist-item\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},(stack1=depth0!=null?depth0.actions:depth0)!=null?stack1.length:stack1,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},"useData":true});
this["TSDK"]["UI"]["Templates"]["ExperienceRailComponent"]["ExperienceRailRenamePopover"]=Handlebars.template({"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rename-popover"\x3e\n  \x3cdiv\x3e\x3cstrong\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Rename Experience",{"name":"i18n","hash":{},
"data":data}))+'\x3c/strong\x3e\x3c/div\x3e\n  \x3cinput is\x3d"coral-textfield" class\x3d"experience-title-input" value\x3d"'+alias3((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper==="function"?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'"/\x3e\n  \x3cdiv class\x3d"align-r"\x3e\n    \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" iconsize\x3d"S" icon\x3d"close" class\x3d"rename-cancel-button" title\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Cancel",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n    \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" iconsize\x3d"S" icon\x3d"check" class\x3d"rename-save-button" title\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Save",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n  \x3c/div\x3e\n\x3c/div\x3e'},"useData":true});
this["TSDK"]["UI"]["Templates"]["ExperienceRailComponent"]["ExperienceRailXT"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"right"},3:function(container,depth0,helpers,partials,data){return"left"},5:function(container,depth0,helpers,partials,data){return"chevronRight"},7:function(container,depth0,helpers,partials,data){return"chevronLeft"},9:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return(stack1=(helpers.ifAudienceValid||depth0&&
depth0.ifAudienceValid||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.audience:depth0,{"name":"ifAudienceValid","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.program(13,data,0,blockParams,depths),"data":data}))!=null?stack1:""},10:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",
alias4=container.escapeExpression,alias5=container.lambda;return'        \x3cdiv class\x3d"rail-row experience-row '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,data&&data.index,(stack1=depths[2]!=null?depths[2].config:depths[2])!=null?stack1.activeIndex:stack1,{"name":"equals","hash":{},"fn":container.program(11,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'"\n             data-index\x3d"'+alias4((helper=(helper=helpers.index||data&&
data.index)!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper))+'" title\x3d"'+alias4(alias5((stack1=depth0!=null?depth0.audience:depth0)!=null?stack1.name:stack1,depth0))+" - "+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'"\x3e\n          \x3cdiv class\x3d"rail-cell label-area"\x3e\n            \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"triangleDown" iconsize\x3d"XS" class\x3d"menu-button"\x3e\x3c/button\x3e\n            \x3cspan class\x3d"rail-label"\x3e'+
alias4((helpers.getExperienceShortName||depth0&&depth0.getExperienceShortName||alias2).call(alias1,depth0!=null?depth0.name:depth0,{"name":"getExperienceShortName","hash":{},"data":data}))+'\x3c/span\x3e\n          \x3c/div\x3e\n          \x3cdiv class\x3d"rail-cell collapsible-area"\x3e\n            \x3cdiv class\x3d"audience-name"\x3e'+alias4(alias5((stack1=depth0!=null?depth0.audience:depth0)!=null?stack1.name:stack1,depth0))+'\x3c/div\x3e\n            \x3cdiv class\x3d"experience-name"\x3e'+alias4((helper=
(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+"\x3c/div\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n"},11:function(container,depth0,helpers,partials,data){return"active"},13:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;
return'        \x3cdiv class\x3d"rail-row experience-row no-context '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,data&&data.index,(stack1=depths[2]!=null?depths[2].config:depths[2])!=null?stack1.activeIndex:stack1,{"name":"equals","hash":{},"fn":container.program(11,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+' add-audience"\n             data-index\x3d"'+alias3((helper=(helper=helpers.index||data&&data.index)!=null?helper:alias2,typeof helper===
"function"?helper.call(alias1,{"name":"index","hash":{},"data":data}):helper))+'"\x3e\n          \x3cdiv class\x3d"rail-cell label-area"\x3e\n            \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"add" iconsize\x3d"XS" title\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Add Audience",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n          \x3c/div\x3e\n          \x3cdiv class\x3d"rail-cell collapsible-area"\x3e\n            \x3cspan\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Add Audience",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n"},15:function(container,depth0,helpers,partials,data){var stack1;return(stack1=(helpers.unlessSingleExperienceWithNoAudience||depth0&&depth0.unlessSingleExperienceWithNoAudience||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.experiences:depth0,{"name":"unlessSingleExperienceWithNoAudience",
"hash":{},"fn":container.program(16,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},16:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'        \x3cdiv class\x3d"rail-row add-experience"\x3e\n          \x3cdiv class\x3d"rail-cell label-area"\x3e\n            \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"add" iconsize\x3d"XS"\n                    title\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Add Experience Targeting",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n          \x3c/div\x3e\n          \x3cdiv class\x3d"rail-cell collapsible-area"\x3e\n            \x3cspan\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Add Experience Targeting",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,
depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.escapeExpression,alias2=depth0!=null?depth0:container.nullContext||{},alias3=helpers.helperMissing;return'\x3cdiv class\x3d"tsdk-experience-rail tsdk-experience-rail-xt"\n     data-mode\x3d"'+alias1(container.lambda((stack1=depth0!=null?depth0.config:depth0)!=null?stack1.mode:stack1,depth0))+'" data-placement\x3d"'+((stack1=(helpers.equals||depth0&&depth0.equals||alias3).call(alias2,(stack1=depth0!=null?depth0.config:depth0)!=
null?stack1.placement:stack1,"right",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.program(3,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+'"\x3e\n  \x3cdiv class\x3d"rail-label-background"\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"rail-rows-container"\x3e\n    \x3cdiv class\x3d"rail-row"\x3e\n      \x3cdiv class\x3d"rail-cell label-area"\x3e\n        \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" iconsize\x3d"XS"\n                icon\x3d"'+
((stack1=(helpers.equals||depth0&&depth0.equals||alias3).call(alias2,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.placement:stack1,"right",{"name":"equals","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+'"\n                class\x3d"collapse-btn hidden-in-collapsed-mode hidden-in-expanding-mode" title\x3d"'+alias1((helpers.i18n||depth0&&depth0.i18n||alias3).call(alias2,"Collapse",{"name":"i18n",
"hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n        \x3cbutton type\x3d"button" is\x3d"coral-button" variant\x3d"minimal" iconsize\x3d"XS"\n                icon\x3d"'+((stack1=(helpers.equals||depth0&&depth0.equals||alias3).call(alias2,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.placement:stack1,"right",{"name":"equals","hash":{},"fn":container.program(7,data,0,blockParams,depths),"inverse":container.program(5,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+'"\n                class\x3d"expand-btn hidden-in-expanded-mode hidden-in-collapsing-mode" title\x3d"'+
alias1((helpers.i18n||depth0&&depth0.i18n||alias3).call(alias2,"Expand",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n      \x3c/div\x3e\n      \x3cdiv class\x3d"rail-cell collapsible-area"\x3e\n        \x3cspan\x3e\x3cstrong\x3e'+alias1((helpers.i18n||depth0&&depth0.i18n||alias3).call(alias2,"Audiences",{"name":"i18n","hash":{},"data":data}))+"\x3c/strong\x3e\x3c/span\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n\n"+((stack1=helpers.each.call(alias2,depth0!=null?depth0.experiences:
depth0,{"name":"each","hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.lt||depth0&&depth0.lt||alias3).call(alias2,(stack1=depth0!=null?depth0.experiences:depth0)!=null?stack1.length:stack1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.maxCount:stack1,{"name":"lt","hash":{},"fn":container.program(15,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"  \x3c/div\x3e\n\x3c/div\x3e"},
"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["AudienceRuleContainer"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return'  \x3cdiv class\x3d"display-table-row"\x3e\n    \x3cdiv class\x3d"rule-label-column display-table-cell"\x3e\x3c/div\x3e\n    \x3cdiv class\x3d"rule-section-column rules-operator-cell display-table-cell"\x3e\n      \x3cspan class\x3d"rules-operator"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=
null?depth0:container.nullContext||{},"And",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n"},3:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'        \x3cdiv class\x3d"rule-section-label margin-t-1-5"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"When",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n        \x3cdiv class\x3d"rule-section"\x3e\n          \x3cdiv class\x3d"rule-placeholder"\x3e\x3c/div\x3e\n          \x3cdiv class\x3d"rule-actions"\x3e\n            \x3cbutton type\x3d"button" class\x3d"rule-delete-button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"delete" iconsize\x3d"S"\n              title\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Delete",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n            \x3cbutton type\x3d"button" class\x3d"rule-copy-button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"copy" iconsize\x3d"S"\n              title\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Copy",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n            \x3cbutton type\x3d"button" class\x3d"rule-done-button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"checkCircle" iconsize\x3d"S"\n              title\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Done",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n          \x3c/div\x3e\n        \x3c/div\x3e\n'},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return((stack1=(helpers.notEquals||depth0&&depth0.notEquals||alias2).call(alias1,depth0!=null?depth0.index:
depth0,0,{"name":"notEquals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\x3cdiv class\x3d"display-table-row"\x3e\n  \x3cdiv class\x3d"rule-heading display-table-cell rule-label-column"\x3e\n    \x3cstrong\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Rule",{"name":"i18n","hash":{},"data":data}))+"\x26nbsp;#"+alias3((helpers.add||depth0&&depth0.add||alias2).call(alias1,depth0!=null?depth0.index:depth0,1,{"name":"add",
"hash":{},"data":data}))+'\x3c/strong\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"display-table-cell rule-section-column coral-Well rule-definition-box"\x3e\n    \x3cdiv class\x3d"rule-editor"\x3e\n      \x3cdiv class\x3d"rule-section-label"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select Attribute Type",{"name":"i18n","hash":{},"data":data}))+"\x3c/div\x3e\n"+((stack1=container.invokePartial(partials.RuleSelector,depth0,{"name":"RuleSelector","data":data,"indent":"      ",
"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.rule:depth0)!=null?stack1.type:stack1,{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'    \x3c/div\x3e\n    \x3cdiv class\x3d"rule-summary" title\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Expand",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3cspan class\x3d"summary-placeholder"\x3e'+
((stack1=container.invokePartial(partials.RuleSummary,depth0!=null?depth0.rule:depth0,{"name":"RuleSummary","data":data,"helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+'\x3c/span\x3e\n      \x3ccoral-icon class\x3d"rule-expand-icon" icon\x3d"chevronDown" size\x3d"XS"\x3e\x3c/coral-icon\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n\x3c/div\x3e'},"usePartial":true,"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["DialogContent"]=Handlebars.template({"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){return'\x3cdiv class\x3d"tsdk-audience-workflow-content"\x3e\n  \x3cdiv class\x3d"rules-create-container"\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"rules-review-container"\x3e\x3c/div\x3e\n\x3c/div\x3e\n'},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["DialogHeader"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"    \x3cspan\x3e"+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Edit Audience",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n"},3:function(container,depth0,helpers,partials,data){return"    \x3cspan\x3e"+container.escapeExpression((helpers.i18n||depth0&&
depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Create New Audience",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n"},5:function(container,depth0,helpers,partials,data){var helper;return"    \x3cspan\x3e("+container.escapeExpression((helper=(helper=helpers.count||(depth0!=null?depth0.count:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"count","hash":{},"data":data}):
helper))+")\x3c/span\x3e\n"},7:function(container,depth0,helpers,partials,data){return'      \x3cbutton type\x3d"button" class\x3d"next-button" is\x3d"coral-button" variant\x3d"primary"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Next",{"name":"i18n","hash":{},"data":data}))+"\x3c/button\x3e\n"},9:function(container,depth0,helpers,partials,data){return'      \x3cbutton type\x3d"button" class\x3d"create-button" is\x3d"coral-button" variant\x3d"primary"\x3e'+
container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Save",{"name":"i18n","hash":{},"data":data}))+"\x3c/button\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"tsdk-header-content"\x3e\n'+((stack1=helpers["if"].call(alias1,
depth0!=null?depth0.isEditMode:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.count:depth0,{"name":"if","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\n  \x3cspan class\x3d"action-toolbar"\x3e\n    \x3cbutton type\x3d"button" class\x3d"fullscreen-button fullScreen-button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"fullScreen" iconsize\x3d"S"\n            data-toggle\x3d"true" title\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Fullscreen",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n    \x3cbutton type\x3d"button" class\x3d"fullscreen-button fullScreenExit-button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"fullScreenExit" iconsize\x3d"S"\n            data-toggle\x3d"false" title\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Exit Fullscreen",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n    \x3cbutton type\x3d"button" class\x3d"close-button" is\x3d"coral-button" variant\x3d"minimal"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Cancel",{"name":"i18n","hash":{},"data":data}))+"\x3c/button\x3e\n"+((stack1=(helpers.lt||depth0&&depth0.lt||alias2).call(alias1,depth0!=null?depth0.step:depth0,depth0!=null?depth0.totalSteps:depth0,{"name":"lt","hash":{},"fn":container.program(7,data,0),"inverse":container.program(9,data,0),"data":data}))!=null?stack1:"")+"  \x3c/span\x3e\n\x3c/div\x3e\n"},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["RulesReviewStep"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return((stack1=(helpers.notEquals||depth0&&depth0.notEquals||alias2).call(alias1,data&&data.index,0,{"name":"notEquals","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'    \x3cdiv\x3e\n      \x3cspan class\x3d"rule-label"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Rule",{"name":"i18n","hash":{},"data":data}))+"\x26nbsp;#"+alias3((helpers.add||depth0&&depth0.add||alias2).call(alias1,data&&data.index,1,{"name":"add","hash":{},"data":data}))+"\x3c/span\x3e\n"+((stack1=container.invokePartial(partials.RuleSummary,depth0,{"name":"RuleSummary","data":data,"indent":"      ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"    \x3c/div\x3e\n"},2:function(container,
depth0,helpers,partials,data){return'      \x3cdiv class\x3d"rules-operator"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"AND",{"name":"i18n","hash":{},"data":data}))+"\x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;
return'\x3cdiv class\x3d"audience-name-label"\x3e\n  \x3cstrong\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Audience Name",{"name":"i18n","hash":{},"data":data}))+'\x3c/strong\x3e\n\x3c/div\x3e\n\x3cinput type\x3d"text" class\x3d"audience-name width-100p" is\x3d"coral-textfield" value\x3d"'+alias3((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper==="function"?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+
'" maxlength\x3d"200"\x3e\n\n\x3cdiv class\x3d"audience-rules-summary-label"\x3e\n  \x3cstrong\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Rules",{"name":"i18n","hash":{},"data":data}))+'\x3c/strong\x3e\n\x3c/div\x3e\n\x3cdiv class\x3d"audience-rules-summary coral-Well"\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.targets:depth0,{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\x3c/div\x3e\n\n\x3cbutton type\x3d"button" class\x3d"edit-rules-button" is\x3d"coral-button"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Edit",{"name":"i18n","hash":{},"data":data}))+"\x3c/button\x3e"},"usePartial":true,"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["TargetingWidget"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"          "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Add Another Rule",{"name":"i18n","hash":{},"data":data}))+"\n"},3:function(container,depth0,helpers,partials,data){return"          "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=
null?depth0:container.nullContext||{},"Add Rule",{"name":"i18n","hash":{},"data":data}))+"\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return'\x3cdiv class\x3d"rules-placeholder"\x3e\x3c/div\x3e\n\x3cdiv class\x3d"display-table width-100p"\x3e\n  \x3cdiv class\x3d"display-table-row"\x3e\n    \x3cdiv class\x3d"rule-label-column display-table-cell"\x3e\x3c/div\x3e\n    \x3cdiv class\x3d"rule-section-column display-table-cell"\x3e\n      \x3cbutton type\x3d"button" class\x3d"add-rule-button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"addCircle" iconsize\x3d"S"\x3e\n'+
((stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},(stack1=depth0!=null?depth0.targets:depth0)!=null?stack1.length:stack1,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")+"      \x3c/button\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n\x3c/div\x3e"},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["Browser"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},3:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",
{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotEqual" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotEqual",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if",
"hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},4:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3ccoral-autocomplete data-step\x3d"2" class\x3d"operandsInput" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'" forceselection\x3d"true" multiple\x3e\n        \x3ccoral-autocomplete-item value\x3d"Chrome" '+
((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"Chrome",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Chrome",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"Firefox" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||
alias2).call(alias1,depth0!=null?depth0.operands:depth0,"Firefox",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Firefox",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"Safari" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,
"Safari",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Safari",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"MSIE Trident" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"MSIE Trident",{"name":"hasValue","hash":{},"fn":container.program(1,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Internet Explorer",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"Edge" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"Edge",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Microsoft Edge",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"Opera" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"Opera",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&
depth0.i18n||alias2).call(alias1,"Opera",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"iPad" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"iPad",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"iPad",{"name":"i18n","hash":{},
"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"iPhone" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"iPhone",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"iPhone",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-autocomplete-item\x3e\n      \x3c/coral-autocomplete\x3e\n"},
6:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.operator:depth0,"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotEqual" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotEqual",{"name":"equals",
"hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},7:function(container,depth0,helpers,
partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3ccoral-autocomplete data-step\x3d"2" class\x3d"operandsInput" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'" forceselection\x3d"true" multiple\x3e\n        \x3ccoral-autocomplete-item value\x3d"en" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,
depth0!=null?depth0.operands:depth0,"en",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"English",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"fr" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"fr",{"name":"hasValue","hash":{},
"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"French",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"de" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"de",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"German",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"ja" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"ja",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||
alias2).call(alias1,"Japanese",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"ko" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"ko",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Korean",{"name":"i18n","hash":{},"data":data}))+
'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"pt" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"pt",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Portuguese",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"ru" '+
((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"ru",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Russian",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"es" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,
depth0!=null?depth0.operands:depth0,"es",{"name":"hasValue","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Spanish",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-autocomplete-item\x3e\n        \x3ccoral-autocomplete-item value\x3d"zh-tw" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"zh-tw",{"name":"hasValue",
"hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Traditional Chinese",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-autocomplete-item\x3e\n      \x3c/coral-autocomplete\x3e\n"},9:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals",{"name":"i18n",
"hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotEqual" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotEqual",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"greater" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"greater",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is greater than",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"greaterEquals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.operator:depth0,"greaterEquals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is greater than or equal to",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"lesser" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"lesser",{"name":"equals",
"hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is less than",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"lesserEquals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"lesserEquals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is less than or equal to",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(10,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},10:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:
container.nullContext||{};return'      \x3ccoral-autocomplete data-step\x3d"2" class\x3d"operandsInput browserVersionLookup no-suggestion"\n'+((stack1=(helpers["in"]||depth0&&depth0["in"]||helpers.helperMissing).call(alias1,depth0!=null?depth0.operator:depth0,"equals","doesNotEqual",{"name":"in","hash":{},"fn":container.program(11,data,0),"inverse":container.program(13,data,0),"data":data}))!=null?stack1:"")+"\x3e\n"+((stack1=helpers.each.call(alias1,depth0!=null?depth0.operands:depth0,{"name":"each",
"hash":{},"fn":container.program(15,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/coral-autocomplete\x3e\n"},11:function(container,depth0,helpers,partials,data){return'          placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Enter major version numbers",{"name":"i18n","hash":{},"data":data}))+'" multiple\n'},13:function(container,depth0,helpers,partials,data){return'          placeholder\x3d"'+
container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Enter major version number",{"name":"i18n","hash":{},"data":data}))+'"\n        '},15:function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return'          \x3ccoral-autocomplete-item value\x3d"'+alias2(alias1(depth0,depth0))+'" selected\x3e'+alias2(alias1(depth0,depth0))+"\x3c/coral-autocomplete-item\x3e\n"},
17:function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.helpLink:depth0,{"name":"if","hash":{},"fn":container.program(18,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},18:function(container,depth0,helpers,partials,data){var helper;return'      \x3ca is\x3d"coral-anchorbutton" variant\x3d"minimal" icon\x3d"helpCircle" iconsize\x3d"XS"\n         class\x3d"help-link" href\x3d"'+
container.escapeExpression((helper=(helper=helpers.helpLink||(depth0!=null?depth0.helpLink:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"helpLink","hash":{},"data":data}):helper))+'" target\x3d"_blank"\x3e\x3c/a\x3e\n'},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;
return'\x3cdiv class\x3d"rule-content"\x3e\n  \x3ccoral-select data-step\x3d"0" class\x3d"parameterSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n    \x3ccoral-select-item value\x3d"browserType" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"browserType",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Type",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"locale" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"locale",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||
alias2).call(alias1,"Language",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"browserVersion" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"browserVersion",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Version",{"name":"i18n","hash":{},"data":data}))+
"\x3c/coral-select-item\x3e\n  \x3c/coral-select\x3e\n\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"browserType",{"name":"equals","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"locale",{"name":"equals","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"browserVersion",{"name":"equals","hash":{},"fn":container.program(9,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(17,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e\n"},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["CustomParameters"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},3:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'      \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=helpers.value||(depth0!=null?depth0.value:depth0))!=
null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"value","hash":{},"data":data}):helper))+'" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.value:depth0,depths[1]!=null?depths[1].mbox:depths[1],{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias4((helper=(helper=helpers.content||(depth0!=null?depth0.content:depth0))!=null?helper:alias2,typeof helper===
alias3?helper.call(alias1,{"name":"content","hash":{},"data":data}):helper))+"\x3c/coral-select-item\x3e\n"},5:function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3cinput data-step\x3d"1" is\x3d"coral-textfield" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Enter parameter name",{"name":"i18n","hash":{},"data":data}))+'" class\x3d"input-parameter" value\x3d"'+
alias3((helper=(helper=helpers.parameter||(depth0!=null?depth0.parameter:depth0))!=null?helper:alias2,typeof helper==="function"?helper.call(alias1,{"name":"parameter","hash":{},"data":data}):helper))+'"\x3e\n'},7:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.mbox:depth0,{"name":"if","hash":{},"fn":container.program(8,data,0,blockParams,depths),"inverse":container.noop,
"data":data}))!=null?stack1:""},8:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'      \x3ccoral-select data-step\x3d"1" class\x3d"parameterSelector" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Select parameter",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.parameters:depth0,{"name":"each",
"hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/coral-select\x3e\n"},9:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'          \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?
helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.name:depth0,depths[1]!=null?depths[1].parameter:depths[1],{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===
alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+"\x3c/coral-select-item\x3e\n"},11:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"2" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Choose evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"containsIgnoreCase" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"containsIgnoreCase",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"contains (case insensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotContainIgnoreCase" '+((stack1=(helpers.equals||
depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotContainIgnoreCase",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not contain (case insensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.operator:depth0,"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"equalsIgnoreCase" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"equalsIgnoreCase",{"name":"equals",
"hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals (case insensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotEqualIgnoreCase" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotEqualIgnoreCase",{"name":"equals","hash":{},"fn":container.program(1,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal (case insensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"greater" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"greater",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is greater than",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"greaterEquals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"greaterEquals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&
depth0.i18n||alias2).call(alias1,"is greater than or equal to",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"lesser" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"lesser",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is less than",{"name":"i18n",
"hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"lesserEquals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"lesserEquals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is less than or equal to",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"paramPresent" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"paramPresent",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"parameter is present",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"paramNotPresent" '+((stack1=(helpers.equals||depth0&&depth0.equals||
alias2).call(alias1,depth0!=null?depth0.operator:depth0,"paramNotPresent",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"parameter is not present",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"paramNotPresentValueNotPresent" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=
null?depth0.operator:depth0,"paramNotPresentValueNotPresent",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"parameter or value is not present",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"paramValuePresent" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:
depth0,"paramValuePresent",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"parameter value is present",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n"},13:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;
return'    \x3ctextarea data-step\x3d"3" is\x3d"coral-textarea" cols\x3d"30" rows\x3d"5" class\x3d"operandsInput" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Enter each value in new line.",{"name":"i18n","hash":{},"data":data}))+'"\x3e'+alias3((helpers.join||depth0&&depth0.join||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"\\n",{"name":"join","hash":{},"data":data}))+"\x3c/textarea\x3e\n"},15:function(container,depth0,helpers,partials,data){var alias1=
depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ctextarea data-step\x3d"3" is\x3d"coral-textarea" cols\x3d"30" rows\x3d"5" class\x3d"operandsInput"\n      data-pattern\x3d"^-?\\d+\\.?\\d*$" data-error-alert\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Please enter a single decimal value.",{"name":"i18n","hash":{},"data":data}))+'" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"Enter each value in new line.",{"name":"i18n","hash":{},"data":data}))+'"\x3e'+alias3((helpers.join||depth0&&depth0.join||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"\\n",{"name":"join","hash":{},"data":data}))+"\x3c/textarea\x3e\n"},17:function(container,depth0,helpers,partials,data){return'    \x3cdiv class\x3d"wait-container"\x3e\n      \x3ccoral-wait\x3e\x3c/coral-wait\x3e\n      \x3cspan\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=
null?depth0:container.nullContext||{},"Please wait",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n    \x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rule-content"\x3e\n  \x3ccoral-select data-step\x3d"0" class\x3d"mboxSelector" placeholder\x3d"'+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.mbox:depth0,"",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Create parameter",{"name":"i18n","hash":{},"data":data}))+
"\x3c/coral-select-item\x3e\n"+((stack1=helpers.each.call(alias1,depth0!=null?depth0.mboxes:depth0,{"name":"each","hash":{},"fn":container.program(3,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"  \x3c/coral-select\x3e\n\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.mbox:depth0,"",{"name":"equals","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),
"data":data}))!=null?stack1:"")+"\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.parameter:depth0,{"name":"if","hash":{},"fn":container.program(11,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"containsIgnoreCase","doesNotContainIgnoreCase","equals","equalsIgnoreCase","doesNotEqualIgnoreCase",{"name":"in","hash":{},"fn":container.program(13,data,
0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"greater","greaterEquals","lesser","lesserEquals",{"name":"in","hash":{},"fn":container.program(15,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.ifEither||depth0&&depth0.ifEither||alias2).call(alias1,depth0!=null?depth0.paramsLoading:depth0,true,depth0!=null?
depth0.mboxesLoading:depth0,true,{"name":"ifEither","hash":{},"fn":container.program(17,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\n  \x3ccoral-tooltip class\x3d"invalid-value-error hidden" variant\x3d"error" placement\x3d"right" target\x3d"_prev"\x3e\x3c/coral-tooltip\x3e\n\x3c/div\x3e'},"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["Geo"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},3:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n",
"hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"matches" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"matches",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"matches",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotMatch" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotMatch",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not match",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if",
"hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},4:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'      \x3ccoral-autocomplete data-step\x3d"2" class\x3d"operandsInput countryLookup" data-parameter\x3d"countries" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Search",{"name":"i18n","hash":{},"data":data}))+
'" forceselection\x3d"true" multiple\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.operands:depth0,{"name":"each","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/coral-autocomplete\x3e\n"},5:function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return'          \x3ccoral-autocomplete-item value\x3d"'+alias2(alias1(depth0,depth0))+'" selected\x3e'+alias2(alias1(depth0,
depth0))+"\x3c/coral-autocomplete-item\x3e\n"},7:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"matches" '+((stack1=
(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"matches",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"matches",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotMatch" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=
null?depth0.operator:depth0,"doesNotMatch",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not match",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(8,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")},8:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'      \x3ccoral-autocomplete data-step\x3d"2" class\x3d"operandsInput stateLookup" data-parameter\x3d"regions" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Search",{"name":"i18n","hash":{},"data":data}))+'" forceselection\x3d"true" multiple\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=
null?depth0.operands:depth0,{"name":"each","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/coral-autocomplete\x3e\n"},10:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"matches" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"matches",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"matches",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotMatch" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotMatch",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not match",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if",
"hash":{},"fn":container.program(11,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},11:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'      \x3ccoral-autocomplete data-step\x3d"2" class\x3d"operandsInput cityLookup" data-parameter\x3d"cities" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Search",{"name":"i18n","hash":{},"data":data}))+'" forceselection\x3d"true" multiple\x3e\n'+
((stack1=helpers.each.call(alias1,depth0!=null?depth0.operands:depth0,{"name":"each","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/coral-autocomplete\x3e\n"},13:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"contains" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"contains",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"contains",{"name":"i18n","hash":{},"data":data}))+
'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotContain" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotContain",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not contain",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"equals" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotEqual" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.operator:depth0,"doesNotEqual",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"noZipCodeRecorded" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"noZipCodeRecorded",
{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"no zip code recorded",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"anyZipCode" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"anyZipCode",{"name":"equals","hash":{},"fn":container.program(1,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"any zip code",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"contains","doesNotContain","equals","doesNotEqual",{"name":"in","hash":{},"fn":container.program(14,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")},14:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3ctextarea data-step\x3d"2" is\x3d"coral-textarea" cols\x3d"10" rows\x3d"5" class\x3d"operandsInput zipcode" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Enter each value in new line.",{"name":"i18n","hash":{},"data":data}))+'"\x3e'+alias3((helpers.join||depth0&&
depth0.join||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"\\n",{"name":"join","hash":{},"data":data}))+"\x3c/textarea\x3e\n"},16:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n",
"hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"matches" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"matches",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"matches",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotMatch" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotMatch",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not match",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if",
"hash":{},"fn":container.program(17,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},17:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'      \x3ccoral-autocomplete data-step\x3d"2" class\x3d"operandsInput metroLookup" data-parameter\x3d"metros" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Search",{"name":"i18n","hash":{},"data":data}))+'" forceselection\x3d"true" multiple\x3e\n'+
((stack1=helpers.each.call(alias1,depth0!=null?depth0.operands:depth0,{"name":"each","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/coral-autocomplete\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rule-content"\x3e\n  \x3ccoral-select data-step\x3d"0" class\x3d"parameterSelector" placeholder\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n    \x3ccoral-select-item value\x3d"country" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"country",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Country",{"name":"i18n","hash":{},
"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"region" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"region",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"State",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"city" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"city",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"City",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"zip" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?
depth0.parameter:depth0,"zip",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Zip code",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"dma" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"dma",{"name":"equals","hash":{},"fn":container.program(1,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"DMA",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n  \x3c/coral-select\x3e\n\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"country",{"name":"equals","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||
depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"region",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"city",{"name":"equals","hash":{},"fn":container.program(10,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.parameter:depth0,"zip",{"name":"equals","hash":{},"fn":container.program(13,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"dma",{"name":"equals","hash":{},"fn":container.program(16,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'  \x3ccoral-tooltip class\x3d"invalidOperandsError hidden" variant\x3d"error" placement\x3d"right" target\x3d"_prev"\x3e\x3c/coral-tooltip\x3e\n\x3c/div\x3e'},
"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["Mobile"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select class\x3d"device-type" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Device Type",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"" '+((stack1=
helpers.unless.call(alias1,depth0!=null?depth0.deviceType:depth0,{"name":"unless","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Any Device",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"isMobilePhone" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.deviceType:depth0,"isMobilePhone",
{"name":"equals","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Phone",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"isTablet" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.deviceType:depth0,"isTablet",{"name":"equals","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Tablet",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"mobileDevice" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.deviceType:depth0,"mobileDevice",{"name":"equals","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Mobile",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n"},2:function(container,depth0,helpers,partials,data){return"selected"},4:function(container,depth0,helpers,partials,data){return'selected\x3d"selected"'},6:function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.MatchOperator,depth0,{"name":"MatchOperator","data":data,"indent":"    ","helpers":helpers,
"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\n"+((stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},7:function(container,depth0,helpers,partials,data){var stack1;return'      \x3ccoral-autocomplete data-step\x3d"2" class\x3d"operandsInput osLookup" data-parameter\x3d"os" placeholder\x3d"'+container.escapeExpression((helpers.i18n||
depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Search",{"name":"i18n","hash":{},"data":data}))+'" forceselection\x3d"true" multiple\x3e\n'+((stack1=container.invokePartial(partials.MobileOsOptions,depth0,{"name":"MobileOsOptions","data":data,"indent":"        ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"      \x3c/coral-autocomplete\x3e\n"},9:function(container,depth0,helpers,partials,data){var stack1;
return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(10,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},10:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3ccoral-select data-step\x3d"2" class\x3d"operandsInput" placeholder\x3d"'+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n        \x3ccoral-select-item value\x3d"1" '+((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"1",{"name":"hasValue","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"true",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"0" '+
((stack1=(helpers.hasValue||depth0&&depth0.hasValue||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"0",{"name":"hasValue","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"false",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n      \x3c/coral-select\x3e\n"},12:function(container,depth0,helpers,partials,data){var stack1;return(stack1=container.invokePartial(partials.MobileDimension,
depth0,{"name":"MobileDimension","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:""},14:function(container,depth0,helpers,partials,data){var stack1;return((stack1=container.invokePartial(partials.MatchOperator,depth0,{"name":"MatchOperator","data":data,"indent":"    ","helpers":helpers,"partials":partials,"decorators":container.decorators}))!=null?stack1:"")+"\n"+((stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||
{},depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(15,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},15:function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'      \x3ccoral-autocomplete data-step\x3d"2" data-parameter\x3d"'+alias4((helper=(helper=helpers.parameter||(depth0!=null?depth0.parameter:
depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"parameter","hash":{},"data":data}):helper))+'" class\x3d"operandsInput '+alias4((helper=(helper=helpers.parameter||(depth0!=null?depth0.parameter:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"parameter","hash":{},"data":data}):helper))+'Lookup" placeholder\x3d"'+alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Search",{"name":"i18n","hash":{},"data":data}))+'" forceselection\x3d"true" multiple\x3e\n'+
((stack1=helpers.each.call(alias1,depth0!=null?depth0.operands:depth0,{"name":"each","hash":{},"fn":container.program(16,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/coral-autocomplete\x3e\n"},16:function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return'          \x3ccoral-autocomplete-item value\x3d"'+alias2(alias1(depth0,depth0))+'" selected\x3e'+alias2(alias1(depth0,depth0))+"\x3c/coral-autocomplete-item\x3e\n"},
"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rule-content"\x3e\n'+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"mobileOs",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\n  \x3ccoral-select data-step\x3d"0" class\x3d"parameterSelector" placeholder\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n    \x3ccoral-select-item value\x3d"model" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"model",{"name":"equals","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Device Model",{"name":"i18n","hash":{},
"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"vendor" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"vendor",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Device Vendor",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"mobileDevice" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"mobileDevice",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Is Mobile Device",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"isMobilePhone" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.parameter:depth0,"isMobilePhone",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Is Mobile Phone",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"isTablet" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"isTablet",{"name":"equals",
"hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Is Tablet",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"mobileOs" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"mobileOs",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"OS",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"displayHeight" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"displayHeight",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&
depth0.i18n||alias2).call(alias1,"Screen Height (px)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"displayWidth" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"displayWidth",{"name":"equals","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Screen Width (px)",
{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n  \x3c/coral-select\x3e\n\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"mobileOs",{"name":"equals","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"mobileDevice","isTablet","isMobilePhone",{"name":"in","hash":{},
"fn":container.program(9,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"displayHeight",{"name":"equals","hash":{},"fn":container.program(12,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"displayWidth",{"name":"equals","hash":{},"fn":container.program(12,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"vendor","model",{"name":"in","hash":{},"fn":container.program(14,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e"},"usePartial":true,"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["Network"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},3:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",
{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"contains" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"contains",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"contains",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotContain" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotContain",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not contain",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.operator:depth0,"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotEqual" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotEqual",{"name":"equals",
"hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},4:function(container,depth0,helpers,
partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3ctextarea data-step\x3d"2" is\x3d"coral-textarea" cols\x3d"10" rows\x3d"5" class\x3d"operandsInput ispName textInput" title\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"ISP Name",{"name":"i18n","hash":{},"data":data}))+'"\x3e'+alias3((helpers.join||depth0&&depth0.join||alias2).call(alias1,depth0!=null?depth0.operands:depth0,
"\\n",{"name":"join","hash":{},"data":data}))+"\x3c/textarea\x3e\n"},6:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"contains" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"contains",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"contains",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotContain" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.operator:depth0,"doesNotContain",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not contain",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"equals",{"name":"equals",
"hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotEqual" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotEqual",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},7:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||
{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3ctextarea data-step\x3d"2" is\x3d"coral-textarea" cols\x3d"10" rows\x3d"5" class\x3d"operandsInput domainName textInput" title\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Domain Name",{"name":"i18n","hash":{},"data":data}))+'"\x3e'+alias3((helpers.join||depth0&&depth0.join||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"\\n",{"name":"join","hash":{},"data":data}))+"\x3c/textarea\x3e\n"},
9:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"matches" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.operator:depth0,"matches",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"matches",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotMatch" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotMatch",{"name":"equals",
"hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not match",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n    \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.operator:depth0,{"name":"if","hash":{},"fn":container.program(10,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")},10:function(container,depth0,
helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'      \x3ccoral-autocomplete data-step\x3d"2" class\x3d"operandsInput connectionSpeedLookup" data-parameter\x3d"connection_speed" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Search",{"name":"i18n","hash":{},"data":data}))+'" forceselection\x3d"true" multiple\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.operands:depth0,
{"name":"each","hash":{},"fn":container.program(11,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/coral-autocomplete\x3e\n"},11:function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return'          \x3ccoral-autocomplete-item value\x3d"'+alias2(alias1(depth0,depth0))+'" selected\x3e'+alias2(alias1(depth0,depth0))+"\x3c/coral-autocomplete-item\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,
helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rule-content"\x3e\n  \x3ccoral-select data-step\x3d"0" class\x3d"parameterSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n    \x3ccoral-select-item value\x3d"ispName" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.parameter:depth0,"ispName",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"ISP",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"domainName" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"domainName",{"name":"equals","hash":{},
"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Domain Name",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"connectionSpeed" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"connectionSpeed",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Connection Speed",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n  \x3c/coral-select\x3e\n\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"ispName",{"name":"equals","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||
alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"domainName",{"name":"equals","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"connectionSpeed",{"name":"equals","hash":{},"fn":container.program(9,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'  \x3ccoral-tooltip class\x3d"invalidOperandsError hidden" variant\x3d"error" placement\x3d"right" target\x3d"_prev"\x3e\x3c/coral-tooltip\x3e\n\x3c/div\x3e\n\n'},
"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["OperatingSystem"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rule-content"\x3e\n  \x3ccoral-select data-step\x3d"0" class\x3d"parameterSelector" placeholder\x3d"'+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n    \x3ccoral-select-item value\x3d"Linux" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"Linux",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Linux",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"Macintosh" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"Macintosh",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Macintosh",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"Windows" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.parameter:depth0,"Windows",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Windows",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n  \x3c/coral-select\x3e\n\x3c/div\x3e"},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["SitePages"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},3:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"1" class\x3d"parameterSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n",
"hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"url" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"url",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"URL",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"domain" '+((stack1=
(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"domain",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Domain",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"query" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:
depth0,"query",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Query",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.page:depth0,"currentPage","landingPage",{"name":"in","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"    \x3c/coral-select\x3e\n"},4:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing;return'        \x3ccoral-select-item value\x3d"fragment" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"fragment",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+container.escapeExpression((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Hash (#) fragment",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},6:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ccoral-select data-step\x3d"2" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},
"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"contains" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"contains",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"contains",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotContain" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotContain",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not contain",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.operator:depth0,"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals (case sensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"doesNotEqual" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotEqual",
{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"fragment",{"name":"equals","hash":{},"fn":container.program(7,data,0),"inverse":container.noop,"data":data}))!=null?stack1:
"")+"    \x3c/coral-select\x3e\n"},7:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'        \x3ccoral-select-item value\x3d"present" data-unary\x3d"true" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"present",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is present",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"notPresent" data-unary\x3d"true" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"notPresent",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"is not present",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"empty" data-unary\x3d"true" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"empty",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is empty",
{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"notEmpty" data-unary\x3d"true" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"notEmpty",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is not empty",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n"},
9:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ctextarea data-step\x3d"3" is\x3d"coral-textarea" class\x3d"operandsInput" cols\x3d"30" rows\x3d"5" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Enter each value in new line.",{"name":"i18n","hash":{},"data":data}))+'"\x3e'+alias3((helpers.join||depth0&&depth0.join||alias2).call(alias1,
depth0!=null?depth0.operands:depth0,"\\n",{"name":"join","hash":{},"data":data}))+"\x3c/textarea\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rule-content"\x3e\n  \x3ccoral-select data-step\x3d"0" class\x3d"pageSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n    \x3ccoral-select-item value\x3d"currentPage" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.page:depth0,"currentPage",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Current Page",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"previousPage" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.page:depth0,"previousPage",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Previous Page",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"landingPage" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.page:depth0,"landingPage",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Landing Page",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n  \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.page:depth0,{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.parameter:depth0,{"name":"if","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"contains","doesNotContain","equals","equals","doesNotEqual",{"name":"in","hash":{},"fn":container.program(9,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e"},
"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["Social"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rule-content"\x3e\n \x3ccoral-select name\x3d"0" class\x3d"step0 parameterSelector" placeholder\x3d"'+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n   \x3ccoral-select-item value\x3d"Digg" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"Digg",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"From Digg",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n   \x3ccoral-select-item value\x3d"Facebook" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"Facebook",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"From Facebook",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n   \x3ccoral-select-item value\x3d"Myspace" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.parameter:depth0,"Myspace",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"From Myspace",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n   \x3ccoral-select-item value\x3d"Twitter" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"Twitter",{"name":"equals","hash":{},
"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"From Twitter",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n   \x3ccoral-select-item value\x3d"Pinterest" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"Pinterest",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"From Pinterest",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n   \x3ccoral-select-item value\x3d"UrlShortener" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"UrlShortener",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||
alias2).call(alias1,"From Url Shorteners",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n \x3c/coral-select\x3e\n\x3c/div\x3e"},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["TargetLibrary"]=Handlebars.template({1:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'      \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=helpers.value||(depth0!=null?depth0.value:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"value",
"hash":{},"data":data}):helper))+'" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.value:depth0,depths[1]!=null?depths[1].parameter:depths[1],{"name":"equals","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias4((helper=(helper=helpers.content||(depth0!=null?depth0.content:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"content","hash":{},"data":data}):
helper))+"\x3c/coral-select-item\x3e\n"},2:function(container,depth0,helpers,partials,data){return"selected"},4:function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.parameter:depth0,{"name":"if","hash":{},"fn":container.program(5,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},5:function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:container.nullContext||
{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'        \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=helpers.parameter||(depth0!=null?depth0.parameter:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"parameter","hash":{},"data":data}):helper))+'" selected\x3e'+alias4((helper=(helper=helpers.parameter||(depth0!=null?depth0.parameter:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"parameter",
"hash":{},"data":data}):helper))+"\x3c/coral-select-item\x3e\n"},7:function(container,depth0,helpers,partials,data){return'    \x3cdiv class\x3d"wait-container"\x3e\n      \x3ccoral-wait\x3e\x3c/coral-wait\x3e\n      \x3cspan\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Please wait",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n    \x3c/div\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,
depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return'\x3cdiv class\x3d"rule-content"\x3e\n  \x3ccoral-select data-step\x3d"0" class\x3d"parameterSelector" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n'+((stack1=helpers.each.call(alias1,depth0!=null?depth0.audiences:depth0,{"name":"each","hash":{},"fn":container.program(1,
data,0,blockParams,depths),"inverse":container.program(4,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"  \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.loading:depth0,{"name":"if","hash":{},"fn":container.program(7,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e"},"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["TrafficSource"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},3:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return((stack1=helpers["if"].call(alias1,depths[1]!=null?depths[1].parameter:depths[1],{"name":"if","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?
stack1:"")+"\n"+((stack1=helpers["if"].call(alias1,depths[1]!=null?depths[1].operator:depths[1],{"name":"if","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")},4:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Select evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n        \x3ccoral-select-item value\x3d"contains" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depths[1]!=null?depths[1].operator:depths[1],"contains",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"contains",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"doesNotContain" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depths[1]!=null?depths[1].operator:depths[1],"doesNotContain",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not contain",{"name":"i18n",
"hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depths[1]!=null?depths[1].operator:depths[1],"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals (case sensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"doesNotEqual" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depths[1]!=null?depths[1].operator:depths[1],"doesNotEqual",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n      \x3c/coral-select\x3e\n"},6:function(container,depth0,helpers,partials,data,
blockParams,depths){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3ctextarea data-step\x3d"2" is\x3d"coral-textarea" class\x3d"operandsInput" cols\x3d"30" rows\x3d"3" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Enter each value in new line.",{"name":"i18n","hash":{},"data":data}))+'"\x3e'+alias3((helpers.join||depth0&&depth0.join||alias2).call(alias1,depths[1]!=null?depths[1].operands:
depths[1],"\\n",{"name":"join","hash":{},"data":data}))+"\x3c/textarea\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rule-content"\x3e\n  \x3ccoral-select data-step\x3d"0" class\x3d"parameterSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n    \x3ccoral-select-item value\x3d"baidu.com" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"baidu.com",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"From Baidu",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"bing.com" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"bing.com",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"From Bing",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"google.com" '+((stack1=(helpers.equals||depth0&&depth0.equals||
alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"google.com",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"From Google",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"yahoo.com" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:
depth0,"yahoo.com",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"From Yahoo",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"landingPageReferrer.url" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"landingPageReferrer.url",
{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Referring Landing Page: URL",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"landingPageReferrer.domain" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"landingPageReferrer.domain",
{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Referring Landing Page: Domain",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n    \x3ccoral-select-item value\x3d"landingPageReferrer.query" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"landingPageReferrer.query",
{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Referring Landing Page: Query",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n  \x3c/coral-select\x3e\n\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"landingPageReferrer.url","landingPageReferrer.domain","landingPageReferrer.query",
{"name":"in","hash":{},"fn":container.program(3,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3c/div\x3e\n"},"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["AudienceWorkflow"]["VisitorProfile"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return"selected"},3:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{};return((stack1=helpers.each.call(alias1,(stack1=depth0!=null?depth0.parameters:depth0)!=null?stack1.USER:stack1,{"name":"each","hash":{},"fn":container.program(4,data,0,blockParams,depths),"inverse":container.noop,
"data":data}))!=null?stack1:"")+"\n"+((stack1=helpers.each.call(alias1,(stack1=depth0!=null?depth0.parameters:depth0)!=null?stack1.PROFILE:stack1,{"name":"each","hash":{},"fn":container.program(9,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=helpers.each.call(alias1,(stack1=depth0!=null?depth0.parameters:depth0)!=null?stack1.CRS:stack1,{"name":"each","hash":{},"fn":container.program(11,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=
null?stack1:"")},4:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'          \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'" data-parametertargetid\x3d"'+
alias4((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper))+'" data-type\x3d"USER"\n'+((stack1=helpers["if"].call(alias1,depths[2]!=null?depths[2].parametertargetid:depths[2],{"name":"if","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"\x3e"+alias4((helper=(helper=helpers.name||(depth0!=
null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+"\n          \x3c/coral-select-item\x3e\n"},5:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"              "+((stack1=(helpers.equals||depth0&&depth0.equals||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.id:depth0,depths[2]!=null?depths[2].parametertargetid:depths[2],{"name":"equals",
"hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"},7:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"              "+((stack1=(helpers.equals||depth0&&depth0.equals||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.name:depth0,depths[2]!=null?depths[2].parameter:depths[2],{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,
depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n            "},9:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'          \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name",
"hash":{},"data":data}):helper))+'" data-type\x3d"PROFILE" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.name:depth0,depths[2]!=null?depths[2].parameter:depths[2],{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},
"data":data}):helper))+"\x3c/coral-select-item\x3e\n"},11:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'          \x3ccoral-select-item value\x3d"'+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):
helper))+'" data-parametertargetid\x3d"'+alias4((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},"data":data}):helper))+'" data-type\x3d"CRS"\n'+((stack1=helpers["if"].call(alias1,depths[2]!=null?depths[2].parametertargetid:depths[2],{"name":"if","hash":{},"fn":container.program(5,data,0,blockParams,depths),"inverse":container.program(7,data,0,blockParams,depths),"data":data}))!=null?stack1:"")+"\x3e"+
alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+"\n          \x3c/coral-select-item\x3e\n"},13:function(container,depth0,helpers,partials,data){var stack1;return(stack1=(helpers.notEquals||depth0&&depth0.notEquals||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.type:depth0,"VISITOR_PROFILE",{"name":"notEquals","hash":{},
"fn":container.program(14,data,0),"inverse":container.noop,"data":data}))!=null?stack1:""},14:function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'      \x3ccoral-select data-step\x3d"1" class\x3d"operatorSelector" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Choose evaluator",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n        \x3ccoral-select-item value\x3d"containsIgnoreCase" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"containsIgnoreCase",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"contains (case insensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"doesNotContainIgnoreCase" '+((stack1=(helpers.equals||
depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotContainIgnoreCase",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not contain (case insensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"equals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,
depth0!=null?depth0.operator:depth0,"equals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"equalsIgnoreCase" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"equalsIgnoreCase",{"name":"equals",
"hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"equals (case insensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"doesNotEqualIgnoreCase" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"doesNotEqualIgnoreCase",{"name":"equals","hash":{},"fn":container.program(1,
data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"does not equal (case insensitive)",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"greater" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"greater",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=
null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is greater than",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"greaterEquals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"greaterEquals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&
depth0.i18n||alias2).call(alias1,"is greater than or equal to",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"lesser" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"lesser",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is less than",{"name":"i18n",
"hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"lesserEquals" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"lesserEquals",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"is less than or equal to",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"paramPresent" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"paramPresent",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"parameter is present",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"paramNotPresent" '+((stack1=(helpers.equals||depth0&&depth0.equals||
alias2).call(alias1,depth0!=null?depth0.operator:depth0,"paramNotPresent",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"parameter is not present",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"paramNotPresentValueNotPresent" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=
null?depth0.operator:depth0,"paramNotPresentValueNotPresent",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"parameter or value is not present",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n        \x3ccoral-select-item value\x3d"paramValuePresent" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.operator:
depth0,"paramValuePresent",{"name":"equals","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"parameter value is present",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n      \x3c/coral-select\x3e\n"},16:function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;
return'    \x3ctextarea data-step\x3d"2" is\x3d"coral-textarea" cols\x3d"30" rows\x3d"5" class\x3d"operandsInput" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Enter each value in new line.",{"name":"i18n","hash":{},"data":data}))+'"\x3e'+alias3((helpers.join||depth0&&depth0.join||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"\\n",{"name":"join","hash":{},"data":data}))+"\x3c/textarea\x3e\n"},18:function(container,depth0,helpers,partials,data){var alias1=
depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'    \x3ctextarea data-step\x3d"2" is\x3d"coral-textarea" cols\x3d"30" rows\x3d"5" class\x3d"operandsInput" placeholder\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Enter each value in new line.",{"name":"i18n","hash":{},"data":data}))+'"\n      data-pattern\x3d"^-?\\d+\\.?\\d*$" data-error-alert\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,
"Please enter a single decimal value.",{"name":"i18n","hash":{},"data":data}))+'"\x3e'+alias3((helpers.join||depth0&&depth0.join||alias2).call(alias1,depth0!=null?depth0.operands:depth0,"\\n",{"name":"join","hash":{},"data":data}))+"\x3c/textarea\x3e\n"},20:function(container,depth0,helpers,partials,data){return'    \x3cspan class\x3d"wait-container"\x3e\n      \x3ccoral-wait\x3e\x3c/coral-wait\x3e\n      \x3cspan\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=
null?depth0:container.nullContext||{},"Please wait",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n    \x3c/span\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"rule-content"\x3e\n  \x3ccoral-select data-step\x3d"0" class\x3d"parameterSelector" placeholder\x3d"'+alias3((helpers.i18n||
depth0&&depth0.i18n||alias2).call(alias1,"Select",{"name":"i18n","hash":{},"data":data}))+'"\x3e\n      \x3ccoral-select-item value\x3d"New Visitor" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"New Visitor",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"New Visitor",{"name":"i18n",
"hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"Returning Visitor" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"Returning Visitor",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Returning Visitor",{"name":"i18n","hash":{},"data":data}))+
'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"In other tests" '+((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"In other tests",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"In other tests",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"First page of session" '+
((stack1=(helpers.equals||depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"First page of session",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"First page of session",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"Not in other tests" '+((stack1=(helpers.equals||
depth0&&depth0.equals||alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"Not in other tests",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Not in other tests",{"name":"i18n","hash":{},"data":data}))+'\x3c/coral-select-item\x3e\n      \x3ccoral-select-item value\x3d"Not first page of session" '+((stack1=(helpers.equals||depth0&&depth0.equals||
alias2).call(alias1,depth0!=null?depth0.parameter:depth0,"Not first page of session",{"name":"equals","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\x3e"+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Not first page of session",{"name":"i18n","hash":{},"data":data}))+"\x3c/coral-select-item\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.parameters:depth0,{"name":"if","hash":{},"fn":container.program(3,
data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"  \x3c/coral-select\x3e\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.parameter:depth0,{"name":"if","hash":{},"fn":container.program(13,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"containsIgnoreCase","doesNotContainIgnoreCase","equals","equalsIgnoreCase",
"doesNotEqualIgnoreCase",{"name":"in","hash":{},"fn":container.program(16,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+((stack1=(helpers["in"]||depth0&&depth0["in"]||alias2).call(alias1,depth0!=null?depth0.operator:depth0,"greater","greaterEquals","lesser","lesserEquals",{"name":"in","hash":{},"fn":container.program(18,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+"\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.loading:
depth0,{"name":"if","hash":{},"fn":container.program(20,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\n  \x3ccoral-tooltip class\x3d"invalid-value-error hidden" variant\x3d"error" placement\x3d"right" target\x3d"_prev"\x3e\x3c/coral-tooltip\x3e\n\x3c/div\x3e'},"useData":true,"useDepths":true});
this["TSDK"]["UI"]["Templates"]["AudiencePicker"]["AudienceListItem"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return'checked\x3d"checked"'},3:function(container,depth0,helpers,partials,data){return"          "+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"by {0}",depth0!=null?depth0.modifiedBy:depth0,{"name":"i18n","hash":{},"data":data}))+"\n"},"compiler":[7,"\x3e\x3d 4.0.0"],
"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'\x3cdiv class\x3d"row fixed audienceListRow"\x3e\n  \x3cdiv class\x3d"cell middle select-item"\x3e\n    \x3ccoral-checkbox value\x3d"'+alias4((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"id","hash":{},
"data":data}):helper))+'" '+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.selected:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\x3e\x3c/coral-checkbox\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"cell middle type"\x3e\x3ccoral-icon icon\x3d"'+alias4((helpers.getAudienceIcon||depth0&&depth0.getAudienceIcon||alias2).call(alias1,depth0,{"name":"getAudienceIcon","hash":{},"data":data}))+'" size\x3d"S"\x3e\x3c/coral-icon\x3e\x3c/div\x3e\n\n  \x3cdiv class\x3d"cell middle name ellipsis-text" title\x3d"'+
alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'"\x3e'+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"name","hash":{},"data":data}):helper))+'\x3c/div\x3e\n\n  \x3cdiv class\x3d"cell middle path ellipsis-text" title\x3d"'+alias4((helper=(helper=helpers.path||(depth0!=null?
depth0.path:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"path","hash":{},"data":data}):helper))+'"\x3e'+alias4((helper=(helper=helpers.path||(depth0!=null?depth0.path:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{"name":"path","hash":{},"data":data}):helper))+'\x3c/div\x3e\n\n  \x3cdiv class\x3d"cell middle source"\x3e'+alias4((helpers.getAudienceSource||depth0&&depth0.getAudienceSource||alias2).call(alias1,depth0,{"name":"getAudienceSource",
"hash":{},"data":data}))+'\x3c/div\x3e\n\n  \x3cdiv class\x3d"cell middle change-log"\x3e\n    \x3cdiv class\x3d"updateInfoContainer"\x3e\n      \x3cdiv\x3e'+alias4((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Updated",{"name":"i18n","hash":{},"data":data}))+"\x26nbsp;"+alias4((helpers.getDate||depth0&&depth0.getDate||alias2).call(alias1,depth0!=null?depth0.modifiedAt:depth0,{"name":"getDate","hash":{"comment":"Date format pattern for moment.js. e.g. Nov 13 2013 (http://momentjs.com/docs)",
"format":"DD MMM YYYY"},"data":data}))+"\x3c/div\x3e\n      \x3cdiv\x3e\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.modifiedBy:depth0,{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"      \x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n\x3c/div\x3e\n"},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudiencePicker"]["DialogContent"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){return'    \x3cspan class\x3d"audience-tenant-dropdown-placeholder" data-root-name\x3d"/"\x3e\x3c/span\x3e\n'},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return'\x3cdiv class\x3d"audience-picker-toolbar"\x3e\n  \x3cspan class\x3d"audience-searcher-placeholder"\x3e\x3c/span\x3e\n'+
((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.config:depth0)!=null?stack1.multiTenant:stack1,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'  \x3cbutton type\x3d"button" class\x3d"add-audience-button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"addCircle" iconsize\x3d"S"\x3e\n    '+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Create audience",{"name":"i18n","hash":{},"data":data}))+'\n  \x3c/button\x3e\n\x3c/div\x3e\n\x3cul class\x3d"list audience-picker-list-header"\x3e\n  \x3cli class\x3d"header"\x3e\n    \x3cdiv class\x3d"row fixed audienceListRow"\x3e\n      \x3cdiv class\x3d"cell middle select-item"\x3e\x26nbsp;\x3c/div\x3e\n      \x3cdiv class\x3d"cell middle type"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Type",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n      \x3cdiv class\x3d"cell middle name"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Name",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n      \x3cdiv class\x3d"cell middle path"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Path",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n      \x3cdiv class\x3d"cell middle source"\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Source",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n      \x3cdiv class\x3d"cell change-log middle"\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Change Log",{"name":"i18n","hash":{},"data":data}))+'\x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/li\x3e\n\x3c/ul\x3e\n\x3cul class\x3d"list audience-picker-list"\x3e\x3c/ul\x3e\n'},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudiencePicker"]["DialogHeader"]=Handlebars.template({1:function(container,depth0,helpers,partials,data){var helper;return"    \x3cspan\x3e("+container.escapeExpression((helper=(helper=helpers.count||(depth0!=null?depth0.count:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{"name":"count","hash":{},"data":data}):helper))+")\x3c/span\x3e\n"},3:function(container,depth0,helpers,partials,
data){return'      \x3cbutton type\x3d"button" class\x3d"done-button" is\x3d"coral-button" variant\x3d"primary"\x3e'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Done",{"name":"i18n","hash":{},"data":data}))+"\x3c/button\x3e\n"},"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,
alias3=container.escapeExpression;return'\x3cdiv class\x3d"tsdk-header-content"\x3e\n  \x3cspan\x3e'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Choose Audience",{"name":"i18n","hash":{},"data":data}))+"\x3c/span\x3e\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.count:depth0,{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+'\n  \x3cspan class\x3d"action-toolbar"\x3e\n    \x3cbutton type\x3d"button" class\x3d"fullscreen-button fullScreen-button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"fullScreen" iconsize\x3d"S"\n            data-toggle\x3d"true" title\x3d"'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Fullscreen",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n    \x3cbutton type\x3d"button" class\x3d"fullscreen-button fullScreenExit-button" is\x3d"coral-button" variant\x3d"minimal" icon\x3d"fullScreenExit" iconsize\x3d"S"\n            data-toggle\x3d"false" title\x3d"'+alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Exit Fullscreen",{"name":"i18n","hash":{},"data":data}))+'"\x3e\x3c/button\x3e\n    \x3cbutton type\x3d"button" class\x3d"close-button" is\x3d"coral-button" variant\x3d"minimal" coral-close\x3e'+
alias3((helpers.i18n||depth0&&depth0.i18n||alias2).call(alias1,"Cancel",{"name":"i18n","hash":{},"data":data}))+"\x3c/button\x3e\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.count:depth0,{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")+"  \x3c/span\x3e\n\x3c/div\x3e\n"},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudiencePicker"]["Searcher"]=Handlebars.template({"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){return'\x3ccoral-search class\x3d"search-input" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Search",{"name":"i18n","hash":{},"data":data}))+'" name\x3d"field"\x3e\x3c/coral-search\x3e\n'},"useData":true});
this["TSDK"]["UI"]["Templates"]["AudiencePicker"]["TenantDropdown"]=Handlebars.template({"compiler":[7,"\x3e\x3d 4.0.0"],"main":function(container,depth0,helpers,partials,data){return'\x3ccoral-autocomplete name\x3d"Select" class\x3d"tenant-dropdown" placeholder\x3d"'+container.escapeExpression((helpers.i18n||depth0&&depth0.i18n||helpers.helperMissing).call(depth0!=null?depth0:container.nullContext||{},"Audience Folder",{"name":"i18n","hash":{},"data":data}))+'" match\x3d"contains"\x3e\x3c/coral-autocomplete\x3e\r\n'},
"useData":true});
(function(document,$){window.AudiencePickerHelper=window.AudiencePickerHelper||function(){var _self={PROFILE_ATTRIBUTES_LOADED_EVENT:"profile-attributes-loaded"};var engineTnt="tnt";var buildParams=function(configObj){var params="?path\x3d"+configObj.path;params+="\x26engine\x3d"+configObj.engine;if(configObj.engine==engineTnt){var clientCode=$("coral-select-item[value\x3d'"+configObj.tntConfigPath+"']").attr("itemprop");params+="\x26clientcode\x3d"+clientCode;if(configObj.isAbActivity)params+="\x26allAudiences\x3dtrue"}else params+=
"\x26brand\x3d"+configObj.brand;return params};_self.getAudienceWorkflowConfigRules=function(engineType,tntConfigPath){var workflowConfigRules=undefined;if(engineType==engineTnt){var profileAttributesUrl=tntConfigPath+"/jcr:content.profileattributes.json";var mobileConfigUrl=tntConfigPath+"/jcr:content.mobile.json";workflowConfigRules={VISITOR_PROFILE:{url:profileAttributesUrl,postprocessor:function(data){$(document).trigger(_self.PROFILE_ATTRIBUTES_LOADED_EVENT);return data}},MOBILE:{url:function(data){return mobileConfigUrl+
"?paramName\x3d"+data.parameter+"\x26term\x3d"+data.search+"\x26limit\x3d100"},ajax:{dataType:"json"},postprocessor:function(response){return response.results}}}}return workflowConfigRules};_self.getAudiencePicker=function(audiencePickerConfig){var audiencesEndpoint=audiencePickerConfig.url;var audiencesListingsEndpoint=audiencePickerConfig.listingUrl;var params=buildParams(audiencePickerConfig);var createAudienceEnabled=!!audiencePickerConfig.createEnabled&&audiencePickerConfig.engine==engineTnt;
var workflowConfigRules=_self.getAudienceWorkflowConfigRules(audiencePickerConfig.engine,audiencePickerConfig.tntConfigPath);var picker=new TSDK.UI.AudiencePicker({config:{search:"server",create:createAudienceEnabled,pagination:true,engine:audiencePickerConfig.engine,multiTenant:true,multiTenantHiddenPathSegment:"/etc/segmentation"},fetchOptions:{url:audiencesEndpoint+params,listingsUrl:audiencesListingsEndpoint,baseUrl:audiencesEndpoint,urlParams:params,preprocess:function(response){return response.items},
hasMore:"hasMore",pageSize:100},audienceWorkflow:{rules:workflowConfigRules}});return picker};return _self}()})(document,Granite.$);
(function($,channel,window){window.TargetingUI=window.TargetingUI||{};window.TargetingUI.MultiSiteTargeting=function(){var self={};self.INHERITANCE_SELECT_TEMPLATE='\x3cdiv class\x3d"inheritance-select-container" hidden\x3e'+'\x3ccoral-select id\x3d"InheritanceSelect"\x3e'+'\x3ccoral-select-item value\x3d"broken-inheritance"\x3e\x3ccoral-icon icon\x3d"multipleExclude"\x3e\x3c/coral-icon\x3e'+Granite.I18n.get("Suspended Live Copy")+"\x3c/coral-select-item\x3e"+'\x3ccoral-select-item value\x3d"valid-inheritance"\x3e\x3ccoral-icon icon\x3d"multipleCheck"\x3e\x3c/coral-icon\x3e'+
Granite.I18n.get("In Sync with Blueprint")+' \x3cspan class\x3d"valid-plus"\x3e+\x3c/span\x3e\x3c/coral-select-item\x3e'+'\x3ccoral-select-item value\x3d"break"\x3e'+Granite.I18n.get("Suspend Live Copy")+"\x3c/coral-select-item\x3e"+'\x3ccoral-select-item value\x3d"restore"\x3e'+Granite.I18n.get("Resume Live Copy")+"\x3c/coral-select-item\x3e"+'\x3ccoral-select-item value\x3d"remove"\x3e'+Granite.I18n.get("Detach Live Copy")+"\x3c/coral-select-item\x3e"+"\x3c/coral-select\x3e"+"\x3c/div\x3e";self.contentManagerUI=
undefined;self.activityProperties=undefined;var _inheritanceActionHandler=function(operation,successCallback){self.inheritanceSelector.val(self.inheritanceSelectValue);var actionProps=INHERITANCE_ACTION_PROPERTIES[operation];if(!actionProps)return;var foundationUI=$(window).adaptTo("foundation-ui");var promptTitle=actionProps.promptConfig.title;var promptMsg=actionProps.promptConfig.message;var confirmButtonId=actionProps.promptConfig.confirmation.buttonId;var confirmButtonText=actionProps.promptConfig.confirmation.buttonText;
foundationUI.prompt(promptTitle,promptMsg,undefined,[{id:"cancel",text:Granite.I18n.get("Cancel")},{id:confirmButtonId,text:confirmButtonText,primary:true}],function(btnId){if(btnId===confirmButtonId)_sendToggleInheritanceXhr(operation,_inheritanceToggleSuccessHandler(operation,successCallback))})};var _inheritanceToggleSuccessHandler=function(operation,successCallback){return function(){if(self.activityProperties){PersonalizationHelper.postMessage("targeting-editor-cmd",{"cmd":"wizard-inheritance-update",
"payload":operation});if(operation=="restore")PersonalizationHelper.refreshWizard()}else self.contentManagerUI.MessageListener.postMessage("personalization-wizard-cmd",{"cmd":"wizard:inheritance-update","payload":operation});if(successCallback)successCallback.call()}};var INHERITANCE_ACTION_PROPERTIES={"break":{"successMessage":Granite.I18n.get("Successfully suspended the live copy inheritance!"),"failMessage":Granite.I18n.get("An error occured while suspending the inheritance."),"promptConfig":{"title":Granite.I18n.get("Suspend Live Copy Inheritance?"),
"message":Granite.I18n.get("The inheritance will have to be suspended to be able to edit the activity."),"confirmation":{"buttonId":"break","buttonText":Granite.I18n.get("Suspend")}},"postData":{"msm:status/msm:isCancelled":true,"msm:status/msm:isCancelledForChildren":true}},"restore":{"successMessage":Granite.I18n.get("Successfully resumed the live copy inheritance!"),"failMessage":Granite.I18n.get("An error occured while restoring the inheritance."),"promptConfig":{"title":Granite.I18n.get("Resume Live Copy Inheritance?"),
"message":Granite.I18n.get("Resuming the inheritance will permanently discard your modifications to the current activity."),"confirmation":{"buttonId":"restore","buttonText":Granite.I18n.get("Resume")}},"postData":{"msm:status/msm:isCancelled":false,"msm:status/msm:isCancelledForChildren":false}},"remove":{"successMessage":Granite.I18n.get("Successfully detached live copy from its blueprint!"),"failMessage":Granite.I18n.get("An error occured while detaching the live copy."),"promptConfig":{"title":Granite.I18n.get("Detach Live Copy?"),
"message":Granite.I18n.get("This action will permanently detach the current activity from its blueprint."),"confirmation":{"buttonId":"remove","buttonText":Granite.I18n.get("Detach")}},"postData":{"removeLCMarkers":true}}};var _sendToggleInheritanceXhr=function(operation,successCallback){var xhrProps=INHERITANCE_ACTION_PROPERTIES[operation];var postData=xhrProps.postData;var postUrl=self.getActivityPath()+"/jcr:content.msm.conf";if(operation=="remove")postUrl=self.getActivityPath()+".msm.conf";else if(operation==
"restore")postUrl=self.getActivityPath()+"/jcr:content.msmrestore.conf";$.ajax({type:"post",url:postUrl,contentType:"application/x-www-form-urlencoded",data:postData}).done(function(html){_showOperationResult(xhrProps.successMessage,false);if(self.getActivityProperties()){self.getActivityProperties().inheritanceCancelled=postData["msm:status/msm:isCancelled"]==true;self.getActivityProperties().isLiveCopy=postData["removeLCMarkers"]!=true}self.setupInheritanceHooks();if(successCallback)successCallback.call()}).fail(function(xhr,
error,errorThrown){_showOperationResult(xhrProps.failMessage,true,errorThrown)})};var _setupInheritanceSelect=function(){var activityProperties=self.getActivityProperties();var inheritanceSelectContainer=$(".inheritance-select-container");if(activityProperties&&activityProperties.isLiveCopy)inheritanceSelectContainer.prop("hidden",false);else inheritanceSelectContainer.prop("hidden",true);inheritanceSelectContainer.removeClass("broken-inheritance");inheritanceSelectContainer.removeClass("valid-inheritance");
self.inheritanceSelector.find("[value\x3d'broken-inheritance']").prop("hidden",true);self.inheritanceSelector.find("[value\x3d'valid-inheritance']").prop("hidden",true);if(activityProperties&&activityProperties.inheritanceCancelled){self.inheritanceSelector.val("broken-inheritance");self.inheritanceSelector.find("[value\x3d'break']").prop("hidden",true);self.inheritanceSelector.find("[value\x3d'restore']").prop("hidden",false);inheritanceSelectContainer.addClass("broken-inheritance")}else{self.inheritanceSelector.val("valid-inheritance");
self.inheritanceSelector.find("[value\x3d'break']").prop("hidden",false);self.inheritanceSelector.find("[value\x3d'restore']").prop("hidden",true);inheritanceSelectContainer.addClass("valid-inheritance")}self.inheritanceSelectValue=self.inheritanceSelector.val()};var _isLocalContent=function(domElement){return $(domElement).closest(".msm-is-local").length>0};self.showDiagramLocalOfferMarkers=function(jqDiagramContainer,isAb){var activityProps=self.getActivityProperties();if(activityProps&&activityProps.isLiveCopy&&
!activityProps.inheritanceCancelled){var hasLocalExperiences=false;$(".msm-target-local-marker").remove();var experienceRows=jqDiagramContainer.find(".diagram-row");var diagramWidget=jqDiagramContainer.data("diagram");var experienceArray=diagramWidget.getData().experiences;$.each(experienceRows,function(index,experienceRow){var currentExperience=experienceArray[index];if(currentExperience.msmIsLocal){var typeStyle=isAb?"ab":"xt";var localExpIcon=$("\x3cdiv class\x3d'msm-target-local-marker "+typeStyle+
" '\x3e\x3ccoral-icon icon\x3d'multipleAdd' size\x3d'S'\x3e\x3c/coral-icon\x3e\x3c/div\x3e");$(experienceRow).find(".container-relative .diagram-cell:first").prepend(localExpIcon);$(experienceRow).addClass("msm-is-local");hasLocalExperiences=true}});if(hasLocalExperiences)self.inheritanceSelector.find(".valid-plus").show()}};self.showExperiencesListLocalOfferMarkers=function(){var activityProps=self.getActivityProperties();if(activityProps&&activityProps.isLiveCopy&&!activityProps.inheritanceCancelled)if(self.contentManagerUI){$(".msm-target-local-marker").remove();
var hasLocalExperiences=false;var experienceElements=$(".rail-row.experience-row");$.each(experienceElements,function(index,experienceElement){var experienceObj=self.contentManagerUI.contentManager.experiences[index];if(experienceObj&&experienceObj["msmIsLocal"]==true){var localExpIcon=$("\x3cdiv class\x3d'msm-target-local-marker'\x3e\x3ccoral-icon icon\x3d'multipleAdd' size\x3d'S'\x3e\x3c/coral-icon\x3e\x3c/div\x3e");$(experienceElement).append(localExpIcon);$(experienceElement).addClass("msm-is-local");
hasLocalExperiences=true}});if(hasLocalExperiences)self.inheritanceSelector.find(".valid-plus").show()}};self.setupInheritanceHooks=function(){_setupInheritanceSelect();if(self.isValidInheritance()){$(".rail-row.experience-row button[icon\x3d'triangleDown']").off("click.disable-editing").on("click.disable-editing",function(e){if(_isLocalContent(e.target))return true;self.ensureInheritanceBroken(function(){$(".rail-row.experience-row button[icon\x3d'triangleDown']").off("click.disable-editing")});
return false});$(".create-activity-wizard .foundation-layout-wizard2-contents").find(".audience-options-button,.experience-options-button").off("click.disable-editing").on("click.disable-editing",function(e){if(_isLocalContent(e.target))return true;self.ensureInheritanceBroken(function(){$(".create-activity-wizard .foundation-layout-wizard2-contents").find(".audience-options-button,.experience-options-button").off("click.disable-editing")});return false});$(".create-activity-wizard .foundation-layout-wizard2-contents").find("input[type\x3d'text'],button[icon\x3d'calendar'],.visitor-percentage,textarea,coral-select,.goals-container").off("focusin.disable-editing").on("focusin.disable-editing",
function(e){if(_isLocalContent(e.target))return true;$(e.target).blur();self.ensureInheritanceBroken(function(){$(".create-activity-wizard .foundation-layout-wizard2-contents").find("input[type\x3d'text'],button[icon\x3d'calendar'],.visitor-percentage,textarea,coral-select,.goals-container").off("focusin.disable-editing");$(".create-activity-wizard coral-slider").prop("disabled",false)})})}$(".create-activity-wizard coral-slider").prop("disabled",self.isValidInheritance())};var _showOperationResult=
function(text,isError,cause){var foundationUI=$(window).adaptTo("foundation-ui");var message=isError==false?text:Granite.I18n.get(text+". Reason: {0}",[cause]);var type=isError==false?"success":"error";foundationUI.notify(type,message,type)};self.getActivityPath=function(){if(self.contentManagerUI)return self.contentManagerUI.contentManager.currentActivity;else if(self.activityProperties)return self.activityProperties.path;return undefined};self.getActivityProperties=function(){if(self.contentManagerUI)return self.contentManagerUI.contentManager.currentActivityProperties;
else if(self.activityProperties)return self.activityProperties;return undefined};self._isSelectedExperienceLocal=function(){var selectedExperience=$(".rail-row.experience-row.active");return self._isExperienceLocal(selectedExperience)};self._isExperienceLocal=function(experience){if(experience.length>0)return experience.hasClass("msm-is-local");return false};self.isValidInheritance=function(){var activityProps=self.getActivityProperties();return activityProps&&activityProps.isLiveCopy&&!activityProps.inheritanceCancelled};
self.isExperienceEditable=function(experience){var isLocalExperience=experience?self._isExperienceLocal(experience):self._isSelectedExperienceLocal();var isExpLocked=self.isValidInheritance()&&!isLocalExperience;return!isExpLocked};self.ensureInheritanceBroken=function(callback,experience){if(!self.isExperienceEditable(experience))_inheritanceActionHandler("break",callback);else if(callback)callback.call()};self.loadActivityInheritanceStatus=function(){$.get(Granite.HTTP.externalize(self.getActivityPath()+
"/jcr:content.msm.conf"),{"advancedStatus":true}).done(function(data){var isLiveCopy=false;var inheritanceCancelled=false;var inheritancePlus=false;var isLiveCopyManuallyCreated=false;if(data["msm:status"]){isLiveCopy=true;inheritanceCancelled=data["msm:status"]["msm:isCancelled"]==true;isLiveCopyManuallyCreated=data["msm:status"]["msm:isTargetManuallyCreated"]==true}if(isLiveCopyManuallyCreated){isLiveCopy=false;inheritanceCancelled=false}var activityPropertiesObj=self.getActivityProperties();if(activityPropertiesObj){activityPropertiesObj.isLiveCopy=
isLiveCopy;activityPropertiesObj.inheritanceCancelled=inheritanceCancelled;activityPropertiesObj.inheritancePlus=inheritancePlus}channel.trigger("activity-inheritance-status-updated")}).fail(function(){})};self.initialize=function(initObj){if(initObj.contentManagerUI)self.contentManagerUI=initObj.contentManagerUI;else if(initObj.activityPath)self.activityProperties={path:initObj.activityPath};if($("#InheritanceSelect").length==0){var wizardHeading=$(".foundation-layout-wizard2-title.coral-Heading");
var existingHeading=wizardHeading.html();wizardHeading.html("\x3cdiv class\x3d'selected-activity standalone'\x3e"+existingHeading+"\x3c/div\x3e"+self.INHERITANCE_SELECT_TEMPLATE)}self.inheritanceSelector=$("#InheritanceSelect");self.inheritanceSelector.on("change",function(event){var inheritanceSelectValue=self.inheritanceSelector.val();setTimeout(function(){_inheritanceActionHandler(inheritanceSelectValue)},15)});channel.off("activity-inheritance-status-updated").on("activity-inheritance-status-updated",
function(e){self.setupInheritanceHooks()})};return self}()})(jQuery,jQuery(document),this);
(function(document,$,Granite){window.CQ=window.CQ||{};CQ.TargetedDialogHelper={generateUUID:function(){var d=(new Date).getTime();var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=="x"?r:r&3|8).toString(16)});return uuid}};function setUUID(){var defaultValue=CQ.TargetedDialogHelper.generateUUID();$("form.cq-dialog input[name\x3d'location']").val(defaultValue)}function run(){if(window.location.href.indexOf("/libs/cq/personalization/touch-ui/content/v2/commons/targeteddialog")>
-1)$("body").on("submit","form.cq-dialog",function(e){var $form=$(this);$form.attr("action",$form.attr("action")+".target.json");$("input[name\x3d'resourceType']",$form).val(CQ.TargetingConstants.TARGET_COMPONENT_RTYPE)})}if($("body").length)run();else $(run);$(document).on("dialog-ready",setUUID);$(document).on("foundation-contentloaded",setUUID)})(document,Granite.$,Granite);CQ=window.CQ||{};
(function($,ns,nsAuthor,$document,window){var debugMode=window.location.href.indexOf("?debug-target-mode\x3dtrue")>=0||window.location.href.indexOf("\x26debug-target-mode\x3dtrue")>=0;function _debug(args){if(debugMode)console.log(args)}$document.on("cq-content-frame-loaded",function(event){var libChecker=setInterval(function(){if(typeof ns.TargetedContentManager!=="undefined"){_debug("[Target Editor Loader] Checking if dependencies are available...");ns.TargetedContentManager.ClientContext=event.frame.contentWindow.ClientContext;
ns.TargetedContentManager.ContextHub=event.frame.contentWindow.ContextHub;clearInterval(libChecker);nsAuthor.layerManager.updateLayerSelector()}},100);if(!$("#TargetEditorContent").get(0))$.ajax({url:"/libs/cq/personalization/touch-ui/content/targeteditor.html"}).done(function(data,textStatus,jqXHR){var content=$(data);nsAuthor.ui.globalBar.addBarToPanelHeader(content,0);content.trigger("foundation-contentloaded");ns.ui.TargetedContentManagerUi.initialize(ns.TargetedContentManager)})})})(jQuery,CQ,
Granite.author,jQuery(document),this);
(function(ns,CQ,$){ns.store.onTypeReady(CQ.TargetingConstants.TARGET_COMPONENT_RTYPE,function(editable){function createEditable($configNode){var editable=ns.edit.createEditable($configNode);if(editable.type!==CQ.TargetingConstants.TARGET_PARSYS_END_RTYPE){ns.store.add(editable);ns.overlayManager.create(editable)}}var refreshTargetParsys=function(editable){if(editable&&editable.dom){var $configNodes=editable.dom.find(".targetparsys").find("cq");$($configNodes.get().reverse()).each(function(i,$configNode){createEditable($configNode)})}};
CQ.TargetedContentManager.rememberEditable(editable);editable.beforeChildrenRefresh=function(){var dfd=$.Deferred();if(editable.dom)editable.dom[0].addEventListener("target-dom-loaded",function(e){refreshTargetParsys(editable);dfd.reject()},false);return dfd};if(ns.layerManager.getCurrentLayer()==="Preview")return;if(editable.dom)editable.dom[0].addEventListener("target-dom-loaded",function(e){refreshTargetParsys(editable)},false)})})(Granite.author,CQ,jQuery);window.CQ=window.CQ||{};
(function($,ns,channel,window,undefined){ns.target={}})(jQuery,Granite.author,jQuery(document),this);window.CQ.ui=window.CQ.ui||{};(function($,ns){ns.target.TargetingActions={}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window){var debugMode=false;var _debug=function(args){if(debugMode)console.log(args)};ns.TargetedContentEventingManager=function(){var self={};var allowSetUp=true;var allowTearDown=true;var EventDependenciesMap={"setUp":["targeting-layer-teardown-complete","targeted-editables-reset"],"tearDown":["targeting-layer-on","targeted-editables-initialized"]};var waitForEvents=function(eventDepKey,triggerEvent,callBackFunc){var eventDeps=EventDependenciesMap[eventDepKey];var eventCount=
eventDeps.length;if(eventCount>0)for(var i=0;i<eventCount;i++)channel.one(eventDeps[i],function(){eventCount--;if(eventCount==0){callBackFunc();channel.trigger(triggerEvent)}});else{callBackFunc();channel.trigger(triggerEvent)}};self.isSetupAllowed=function(){return allowSetUp==true};self.isTearDownAllowed=function(){return allowTearDown==true};self.setUpStart=function(){if(allowTearDown){allowTearDown=false;waitForEvents("tearDown","targeting-layer-teardown-allowed",function(){allowTearDown=true})}};
self.tearDownStart=function(){if(allowSetUp){allowSetUp=false;waitForEvents("setUp","targeting-layer-setup-allowed",function(){allowSetUp=true})}};return self}()})(jQuery,Granite.author,jQuery(document),this);
(function(ns,window){var factory=function(){if(factory.instance)return factory.instance;var instance={};instance.props={TITLE:"title",NAME:"name",PATH:"path",OFFER:"offer"};instance.getExperience=function(title,name,path,offer){var newObject=new Object,that=this;newObject[this.props.TITLE]=title;newObject[this.props.NAME]=name;newObject[this.props.PATH]=path;newObject[this.props.OFFER]=offer;newObject.getPath=function(){return this[that.props.PATH]};return newObject};return instance};ns.ExperienceFactory=
factory()})(CQ,this);
(function($,ns){ns.ui.TargetingTemplates={"main-template":'\x3cdiv id\x3d"ExperienceChooser"\x3e'+'\x3cdiv class\x3d"foundation-layout-wizard2 foundation-wizard coral--dark" data-foundation-layout\x3d"{\x26quot;name\x26quot;: \x26quot;foundation-layout-wizard2\x26quot;}"\x3e'+'\x3cdiv class\x3d"foundation-layout-wizard2-header coral--dark"\x3e'+'\x3cdiv class\x3d"foundation-layout-wizard2-title coral-Heading coral-Heading--2"\x3e'+'\x3cdiv class\x3d"selected-activity"\x3e\x3cdiv class\x3d"selected-activity-description"\x3e\x3cdiv class\x3d"selected-activity-description-content"\x3e\x3cspan\x3e'+Granite.I18n.get("ACTIVITY:")+
"\x3c/span\x3e"+'\x3cspan id\x3d"SelectedActivityDescription"\x3e'+Granite.I18n.get("Selected Activity")+"\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"+TargetingUI.MultiSiteTargeting.INHERITANCE_SELECT_TEMPLATE+"\x3c/div\x3e"+'\x3ccoral-steplist class\x3d"foundation-layout-wizard2-steplist"\x3e'+"\x3ccoral-step selected\x3e"+Granite.I18n.get("Create")+"\x3c/coral-step\x3e"+"\x3ccoral-step\x3e"+Granite.I18n.get("Target")+"\x3c/coral-step\x3e"+"\x3ccoral-step\x3e"+Granite.I18n.get("Goals \x26amp; Settings")+
"\x3c/coral-step\x3e"+"\x3c/coral-steplist\x3e"+'\x3ccoral-panelstack class\x3d"foundation-layout-wizard2-controls"\x3e'+"\x3ccoral-panel selected\x3e"+'\x3ccoral-panel-content class\x3d"foundation-layout-inline2 foundation-layout-inline2-gap"\x3e'+'\x3cdiv class\x3d"foundation-layout-inline2 foundation-layout-inline2-gap"\x3e'+'\x3cbutton id\x3d"WizardBack" class\x3d"foundation-layout-inline2-item foundation-wizard-control" coral-wizardview-previous data-foundation-wizard-control-action\x3d"prev" type\x3d"button" autocomplete\x3d"off" is\x3d"coral-button"\x3e'+
Granite.I18n.get("Back")+"\x3c/button\x3e"+'\x3cbutton id\x3d"WizardNext" class\x3d"foundation-layout-inline2-item foundation-wizard-control" coral-wizardview-next data-foundation-wizard-control-action\x3d"next" type\x3d"button" autocomplete\x3d"off" is\x3d"coral-button" variant\x3d"primary"\x3e'+Granite.I18n.get("Next")+"\x3c/button\x3e"+"\x3c/div\x3e"+"\x3c/coral-panel-content\x3e"+"\x3c/coral-panel\x3e"+"\x3c/coral-panelstack\x3e"+"\x3c/div\x3e"+'\x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e'+"\x3c/div\x3e"+
'\x3cdiv id\x3d"ExperienceRailContainerAB"\x3e\x3c/div\x3e'+'\x3cdiv id\x3d"ExperienceRailContainerXT"\x3e\x3c/div\x3e'+"\x3c/div\x3e"}})(jQuery,CQ);
(function($,ns,channel,window){var debugMode=window.location.href.indexOf("?debug-target-mode\x3dtrue")>=0||window.location.href.indexOf("\x26debug-target-mode\x3dtrue")>=0;var _debug=function(args){if(debugMode)console.log(args)};_debug("[TargetedContentManagerUI] Script loaded");var targetingLayerOnTriggered=false;var targetedEditablesInitializedTriggered=false;channel.on("targeting-layer-on.targeted-content-manager-ui",function(event){_debug("[TargetedContentManagerUI] Caught 'targeting-layer-off' event, setting targetingLayerOnTriggered\x3dtrue!");
targetingLayerOnTriggered=true}).on("targeted-editables-initialized.targeted-content-manager-ui",function(event){_debug("[TargetedContentManagerUI] Caught 'targeted-editables-initialized' event, setting targetedEditablesInitializedTriggered\x3dtrue!");targetedEditablesInitializedTriggered=true}).off("cui-contentloaded.targeted-content-manager-ui").on("cui-contentloaded.targeted-content-manager-ui",function(event){if(ns.ui.TargetedContentManagerUi&&$("#"+ns.ui.TargetedContentManagerUi.CAMPAIGN_SELECTOR_ELEMENT_ID).data("select")){if(targetingLayerOnTriggered){_debug("[TargetedContentManagerUI] Detected that 'targeting-layer-on' has already been triggered, re-triggering...");
ns.ui.TargetedContentManagerUi.targetingLayerOnHandler();targetingLayerOnTriggered=false}if(targetedEditablesInitializedTriggered){_debug("[TargetedContentManagerUI] Detected that 'targeted-editables-initialized' has already been triggered, re-triggering...");ns.ui.TargetedContentManagerUi.targetedEditablesInitializedHandler();targetedEditablesInitializedTriggered=false}}});ns.ui.TargetedContentManagerUi=function(){var self={},experienceCount,contentFrameContainer=$("#ContentWrapper").parent().get(0),
initialTop=$(contentFrameContainer).css("top"),currentExperienceIndex,experienceRailVisible=false,mainTemplate=$(ns.ui.TargetingTemplates["main-template"]);self.ELEMENT_ID="TargetEditorContent";self.EXP_CHOOSER_ELEMENT_ID="ExperienceChooser";self.CAMPAIGN_SELECTOR_ELEMENT_ID="CampaignSelector";self.LOCAL_STORAGE_BRAND_KEY="mode.target.brand";self.LOCAL_STORAGE_ACTIVITY_KEY="mode.target.activity";self.targetingWizardStarted=false;self.contentManager={};self.selectedExperience={};self.initialize=function(contentManager){var pagePropsUrl=
location.href;pagePropsUrl=pagePropsUrl.replace(/.*?\.html(\/.*\/.*?)\..*/,"$1.targetingconfig.json");_debug("[TargetedContentManagerUI] Loading config...");$.get(Granite.HTTP.externalize(pagePropsUrl)).done(function(data){self.forceLocation=data["forceLocation"];self.pageAmbits=data["ambits"];self.targetingConfigLoaded=true;_debug("[TargetedContentManagerUI] Triggering 'target-config-loaded'");channel.trigger("target-config-loaded")}).fail(function(){self.targetingConfigLoaded=true;_debug("[TargetedContentManagerUI] Could not load config!");
if(window.console)console.error("Unable to load targeting config for page {}.",pagePropsUrl)});self.contentManager=contentManager;self.contentManager.ui=self;self.experienceWizardDialog=false;self.audiencePicker=false;self.layerInitialized=false;self.wizardStarted=false;self.experienceRailWidgets={landingPage:{selector:"#ExperienceRailContainerXT",widget:undefined},abn:{selector:"#ExperienceRailContainerAB",widget:undefined}};self.editorLeftContainerHidden=[];$("#"+self.ELEMENT_ID).append(mainTemplate);
self.$elements={content:$("#"+self.ELEMENT_ID),campaignToolbar:$(".campaigntoolbar"),campaignSelector:$("#"+self.CAMPAIGN_SELECTOR_ELEMENT_ID),brandSelector:$("#BrandSelector"),experienceChooserContainer:$("#"+self.EXP_CHOOSER_ELEMENT_ID),experienceTabs:$(".experience-rail"),buttonCreateActivity:$(".create-activity-button"),buttonExperienceWizardNext:$("#WizardNext"),buttonExperienceWizardBack:$("#WizardBack"),buttonStartWizard:$(".targeting-wizard-start")};bindEventsListeners();TargetingUI.MultiSiteTargeting.initialize({contentManagerUI:self});
self.$elements.experienceChooserContainer.hide();channel.on("cq-page-info-loaded",function(event){if(event.info.isTargetable&&event.info.isTargetable==="true"&&"Targeting"===Granite.author.layerManager.getCurrentLayer()){self.$elements.content.show();updateWizardStartButtonState();updateAddExperienceModalButtonState();if(self.layerInitialized)if(self.targetingConfigLoaded)restoreCachedValues();else channel.on("target-config-loaded",function(){restoreCachedValues()})}else self.$elements.content.hide()})};
self.MessageListener=function(){var _selfMessageListener={};(new Granite.author.MessageChannel("cqauthor",window)).mixin(_selfMessageListener);var _wizardReady=function(){self.experienceWizardDialog.show();$(window).adaptTo("foundation-ui").clearWait();_initializeWizardInsideEditor();self.experienceWizardDialog.fullscreen=true};var _wizardDone=function(){closeWizardDialog();toggleEditorGlobalBarSidepanel(true);restoreBrandActivitySelectionStep();updateWizardNextButton(0);self.wizardStarted=false};
var _wizardNotification=function(payload){Granite.author.ui.helpers.notify({content:payload.content,type:payload.type})};var _wizardValidation=function(payload){if(payload)self.$elements.buttonExperienceWizardNext.removeAttr("disabled");else self.$elements.buttonExperienceWizardNext.attr("disabled","true")};var _wizardInheritanceUpdate=function(){TargetingUI.MultiSiteTargeting.loadActivityInheritanceStatus()};var _wizardWait=function(){$(window).adaptTo("foundation-ui").wait()};var _wizardClearWait=
function(){$(window).adaptTo("foundation-ui").clearWait()};var _wizardBlockNavigation=function(){self.$elements.buttonExperienceWizardNext.attr("disabled","true");self.$elements.buttonExperienceWizardBack.attr("disabled","true")};var _wizardAllowNavigation=function(){self.$elements.buttonExperienceWizardNext.removeAttr("disabled");self.$elements.buttonExperienceWizardBack.removeAttr("disabled")};var commands={};commands["wizard-ready"]=_wizardReady;commands["wizard-done"]=_wizardDone;commands["wizard-validation"]=
_wizardValidation;commands["wizard-notification"]=_wizardNotification;commands["wizard-inheritance-update"]=_wizardInheritanceUpdate;commands["wizard-wait"]=_wizardWait;commands["wizard-clear-wait"]=_wizardClearWait;commands["wizard-block-navigation"]=_wizardBlockNavigation;commands["wizard-allow-navigation"]=_wizardAllowNavigation;_selfMessageListener.subscribeRequestMessage("targeting-editor-cmd",function(message){if(typeof message==="undefined")return;if(message.data&&message.data.cmd)if(commands[message.data.cmd])commands[message.data.cmd].apply(undefined,
[message.data.payload])});return _selfMessageListener}();var updateAddExperienceModalButtonState=function(){if(self.getCurrentBrand()!==""||self.contentManager.currentBrand!==""){$("[href\x3d'#create-activity-modal']").css("display","");self.$elements.buttonCreateActivity.removeAttr("disabled")}else{$("[href\x3d'#create-activity-modal']").css("display","none");self.$elements.buttonCreateActivity.attr("disabled","disabled")}};var updateWizardStartButtonState=function(){var selectedActivity=self.$elements.campaignSelector.val();
if(selectedActivity===undefined||selectedActivity===""||self.contentManager.currentActivity==="")self.$elements.buttonStartWizard.attr("disabled","disabled");else self.$elements.buttonStartWizard.removeAttr("disabled","disabled")};var restoreCachedValues=function(){var cachedBrand=localStorage.getItem(self.LOCAL_STORAGE_BRAND_KEY);var cachedActivity=localStorage.getItem(self.LOCAL_STORAGE_ACTIVITY_KEY);var selectBrand=undefined;if(!cachedBrand){selectBrand=self.getCurrentBrand();_debug("[TargetedContentManagerUI] No cached brand, using default selected "+
selectBrand)}else{selectBrand=cachedBrand;_debug("[TargetedContentManagerUI] Restoring cached brand "+cachedBrand)}if(cachedActivity&&cachedActivity.indexOf(selectBrand+"/"+self.getAmbit())==-1)cachedActivity=false;var restoreStatus={brand:!!cachedBrand,activity:!!cachedActivity};if(selectBrand){_debug("[TargetedContentManagerUI] Restoring cached brand "+selectBrand);try{self.$elements.brandSelector.val(selectBrand);brandChooserSelectHandler({target:self.$elements.brandSelector,selectFirstActivity:cachedActivity!==
undefined});restoreStatus.brand=true}catch(error){_debug("[TargetedContentManagerUI] Can't restore cached value for the brand! "+error)}}if(cachedActivity){_debug("[TargetedContentManagerUI] Restoring cached activity "+cachedActivity);var cachedActivityEntry=self.$elements.campaignSelector.find("[value\x3d'"+cachedActivity+"']");if(cachedActivityEntry.length>0&&cachedActivityEntry.css("display")!="none")try{self.$elements.campaignSelector.val(cachedActivity);activityChooserSelectHandler({target:self.$elements.campaignSelector});
restoreStatus.activity=true;self.contentManager.currentActivity=cachedActivity}catch(error$0){_debug("[TargetedContentManagerUI] Can't restore cached value for the activity! "+error$0)}else _debug("[TargetedContentManagerUI] Cached activity not found in dropdown")}if(!restoreStatus.brand){selectFirstBrand();filterActivities()}if(!restoreStatus.activity)selectFirstActivity();updateAddExperienceModalButtonState()};var openCreateActivityDialog=function(event){var modalContainer=$("#create-activity-modal");
if(modalContainer.length>0){var ccEnginePresent=!!(Granite.author.ContentFrame.contentWindow.CQ_Analytics&&Granite.author.ContentFrame.contentWindow.CQ_Analytics.StoreRegistry&&Granite.author.ContentFrame.contentWindow.CQ_Analytics.StoreRegistry.getStore("segments"));var chEnginePresent=!!(Granite.author.ContentFrame.contentWindow.ContextHub&&Granite.author.ContentFrame.contentWindow.ContextHub.getStore("segmentation"));var targetingEngineSelect=$("coral-select.targeting-engine",modalContainer).get(0);
if(!chEnginePresent)targetingEngineSelect.items.getAll().forEach(function(element,index){if(element&&element.value===CQ.TargetingConstants.ENGINE_CONTEXTHUB)element.remove()});if(!ccEnginePresent)targetingEngineSelect.items.getAll().forEach(function(element,index){if(element&&element.value==="cq")element.remove()});targetingEngineSelect.value=targetingEngineSelect.items.first.value;if(Granite.author&&Granite.author.pageInfo&&!Granite.author.pageInfo.tntConfigPath){$("coral-dialog-content form coral-alert").remove();
$("coral-dialog-content form",modalContainer).prepend((new Coral.Alert).set({variant:"warning",content:{innerHTML:Granite.I18n.get("No Adobe Target cloud service configuration\x3cbr\x3eis associated with this site.")}}))}_initializeActivityTypes(modalContainer.find("form"));_bindActivityFormEngineSelectionHandler(modalContainer.find("form"));_bindActivityFormTargetConfigSelectionHandler(modalContainer.find("form"));modalContainer[0].show()}};var _initializeActivityTypes=function(activityForm){var tntConfigWidget=
activityForm.find(".targeting-config"),activityTypeWidget=activityForm.find(".targeting-activity-type")[0];if(tntConfigWidget!==null&&activityTypeWidget!==null){var tntConfig=tntConfigWidget.val();if(tntConfig)_populateActivityTypes(tntConfig,activityTypeWidget)}};var openAddExperienceDialog=function(experienceOptions,experiencesWidget){var modalContainer=$("#create-experience-modal");if(modalContainer.length>0){modalContainer[0].show();$(".add-experience-cancel").off("click.delete-experience").on("click.delete-experience",
function(e){experiencesWidget.deleteExperience(experienceOptions.index,experienceOptions.experience)});$(document).off("click",".add-experience-submit-button").on("click",".add-experience-submit-button",function(e){e.preventDefault();handleAddExperience(modalContainer,experienceOptions)});var defaultExperienceTitle=experienceOptions.experience.title||experienceOptions.experience.name;var defaultExperienceName=experienceOptions.experience.name;if(experienceOptions.experience&&experienceOptions.experience.audience){modalContainer.find("#experienceSegments").val(experienceOptions.experience.audience.path);
defaultExperienceTitle=experienceOptions.experience.audience.name;defaultExperienceName=experienceOptions.experience.audience.name}else modalContainer.find("#experienceSegments").val("");$("#experienceTitleInput").val(defaultExperienceTitle.substr(0,20));$("#experienceNameInput").val(defaultExperienceName.toLowerCase().replace(/[^a-zA-Z0-9_\-,]/gi,"-"));if(experienceOptions.experience.name!="")modalContainer.find(".add-experience-submit-button").prop("disabled",false);else modalContainer.find(".add-experience-submit-button").prop("disabled",
true);$("#experienceNameInput").on("input change",function(event){var saveBtn=modalContainer.find(".add-experience-submit-button");var validator=$(window).adaptTo("foundation-registry").get("foundation.validation.validator").filter(function(data){if(data.selector==='[data-foundation-validation~\x3d"cq.personalization.pagename"]')return true});var isInvalid=validator?validator[0].validate(event.target)!==undefined:false;if(isInvalid)saveBtn.attr("disabled",true);else saveBtn.attr("disabled",false)});
var evt=new Event({target:$("#experienceNameInput").get(0)});$("#experienceNameInput").trigger("input",evt)}};var closeWizardDialog=function(){$("#PersonalizationWizardDialog").remove();self.experienceWizardDialog=false;var wizardStepList=$("coral-steplist")[0];wizardStepList.previous();wizardStepList.previous();$(".experience-rail").show();$(".editor-panel-header").css("z-index","");self.$elements.brandSelector.find("button").removeAttr("disabled");self.$elements.campaignSelector.find("button").removeAttr("disabled");
self.$elements.buttonExperienceWizardNext.removeAttr("disabled");self.contentManager.onActivitySelected(self.contentManager.currentActivity);channel.trigger("dialog-closed")};var updateWizardNextButton=function(stepIndex){if(stepIndex==2)self.$elements.buttonExperienceWizardNext.get(0).label.innerHTML=Granite.I18n.get("Save");else self.$elements.buttonExperienceWizardNext.get(0).label.innerHTML=Granite.I18n.get("Next")};var handleExperienceWizardNext=function(event){var lastStepItem=$("#ExperienceChooser").find("coral-step").last();
var isLastStep=$(lastStepItem).is(".is-selected");var prevIndex=-1;if(!self.experienceWizardDialog){var ambitPath=self.$elements.brandSelector.val()+"/"+self.getAmbit();var wizardSrc=Granite.HTTP.externalize("/libs/cq/personalization/touch-ui/content/v2/activities/createactivitywizard.html"+ambitPath+"?mode\x3deditor"+"\x26path\x3d"+Granite.author.pageInfo.status.path+"\x26activity\x3d"+self.contentManager.currentActivity);self.experienceWizardDialog=(new Coral.Dialog).set({id:"PersonalizationWizardDialog",
content:{innerHTML:"\x3ciframe id\x3d'PersonalizationWizardFrame' name\x3d'PersonalizationWizardFrame' src\x3d'"+wizardSrc+"'\x3e\x3c/iframe\x3e"},backdrop:"none"});$(window).adaptTo("foundation-ui").wait();document.body.appendChild(self.experienceWizardDialog);Granite.author.SidePanel.close();toggleEditorGlobalBarSidepanel(false);$(".editor-panel-header").css("z-index",10020);var experiencesWidgetObj=self.experienceRailWidgets[self.contentManager.currentActivityProperties.type];if(experiencesWidgetObj)$(experiencesWidgetObj.selector).hide();
$(".experience-rail").hide();$("#BrandSelector").find("button").attr("disabled","disabled");$("#CampaignSelector").find("button").attr("disabled","disabled");$(".editor-EmulatorBar").removeClass("is-visible")}else if(isLastStep)self.MessageListener.postMessage("personalization-wizard-cmd",{"cmd":"wizard:save"});else prevIndex=experienceWizardNext();if(!isLastStep)updateWizardNextButton(prevIndex+1)};var handleExperienceWizardBack=function(event){var prevIndex=experienceWizardBack();updateWizardNextButton(prevIndex-
1)};var experienceWizardNext=function(){_debug("[TargetedContentManagerUI] Advancing the wizard to the next step.");self.MessageListener.postMessage("personalization-wizard-cmd",{"cmd":"wizard:next"});var previousWizardIndex=getCurrentWizardStep();$("#ExperienceChooser").find("coral-steplist")[0].next();return previousWizardIndex};var getCurrentWizardStep=function(){var steps=$("#ExperienceChooser").find("coral-step");var currentIndex=-1;for(var idx=0;idx<steps.length;idx++){var currentStep=steps[idx];
if($(currentStep).is(".is-selected")){currentIndex=idx;break}}return currentIndex};var toggleEditorGlobalBarLeftContainer=function(visible){var items=$(".editor-GlobalBar coral-actionbar-primary .editor-GlobalBar-item");if(!visible)$.each(items,function(idx,elm){if(!$(elm).hasClass("toggle-sidepanel")&&$(elm).is(":visible")){self.editorLeftContainerHidden.push(elm);$(elm).attr("disabled","disabled")}});else{$.each(self.editorLeftContainerHidden,function(idx,elm){$(elm).removeAttr("disabled")});self.editorLeftContainerHidden=
[]}};var toggleEditorGlobalBarSidepanel=function(visible){var toggle=$(".editor-GlobalBar coral-actionbar-primary .editor-GlobalBar-item.toggle-sidepanel");if(visible)toggle.removeAttr("disabled");else toggle.attr("disabled","disabled")};var restoreBrandActivitySelectionStep=function(){self.$elements.campaignToolbar.show();self.$elements.experienceChooserContainer.hide();toggleEditorGlobalBarLeftContainer(true);channel.trigger("targeting-ui-experience-rail-hidden");_toggleModeChange(true)};var experienceWizardBack=
function(){var previousWizardIndex=getCurrentWizardStep();$("#ExperienceChooser").find("coral-steplist")[0].previous();if(self.experienceWizardDialog)self.MessageListener.postMessage("personalization-wizard-cmd",{"cmd":"wizard:previous"});if(previousWizardIndex==1){closeWizardDialog();var experiencesWidgetObj=self.experienceRailWidgets[self.contentManager.currentActivityProperties.type];if(experiencesWidgetObj)$(experiencesWidgetObj.selector).show();toggleEditorGlobalBarSidepanel(true)}else if(previousWizardIndex==
0){restoreBrandActivitySelectionStep();self.wizardStarted=false}return previousWizardIndex};var selectFirstOption=function(el){var value=undefined;el.find("[value]").each(function(index,element){if($(element).css("display")!="none"){value=$(element).attr("value");return false}});if(value)el.val(value);return value};var filterActivities=function(){var currentBrand=self.$elements.brandSelector.val();self.contentManager.currentBrand=currentBrand;var ambitPath=currentBrand+"/"+self.getAmbit();$.each(self.$elements.campaignSelector.find("coral-selectlist coral-selectlist-item"),
function(index,option){var campaign=$(option).attr("value");if(campaign&&campaign.indexOf(ambitPath+"/")!=0)$(option).hide()});var $nativeSelect=self.$elements.campaignSelector.find("select");if($nativeSelect.data("html")===undefined)$nativeSelect.data("html",$nativeSelect.html());$.each(self.$elements.campaignSelector.find("select option"),function(index,option){var campaign=$(option).attr("value");if(campaign&&campaign.indexOf(ambitPath+"/")!==0)$(option).remove()})};var selectFirstBrand=function(){selectFirstOption(self.$elements.brandSelector)};
var selectFirstActivity=function(){var selectedActivity=selectFirstOption(self.$elements.campaignSelector);self.contentManager.onActivitySelected(selectedActivity);updateSelectedActivityRail(selectedActivity);updateWizardStartButtonState()};var brandChooserSelectHandler=function(event){self.$elements.campaignSelector.find("coral-selectlist coral-selectlist-item").show();var $nativeSelect=self.$elements.campaignSelector.find("select"),nativeHTML=$nativeSelect.data("html");if(nativeHTML!==undefined)$nativeSelect.html(nativeHTML);
var currentBrand=$(event.target).val();if(currentBrand!=""){localStorage.setItem(self.LOCAL_STORAGE_BRAND_KEY,currentBrand);filterActivities()}if(!event.selectFirstActivity)selectFirstActivity();updateAddExperienceModalButtonState()};var updateSelectedActivityRail=function(selectedActivity){if(selectedActivity!=""){var selectedOption=self.$elements.campaignSelector.find("[role\x3d'option'][value\x3d'"+selectedActivity+"']");var selectedActivityDescription=$(".selected-activity-description-content").contents()[1];
if(selectedOption.length>0&&selectedActivityDescription)selectedActivityDescription.innerHTML=selectedOption[0].innerHTML;TargetingUI.MultiSiteTargeting.loadActivityInheritanceStatus()}};var activityChooserSelectHandler=function(event){var currentActivity="";try{currentActivity=$(event.target)[0].selectedItem.value}catch(error){currentActivity=$(event.target)[0].value}_debug("[TargetedContentManagerUI] Selected activity ["+currentActivity+"]");if(currentActivity!==self.contentManager.currentActivity){self.contentManager.onActivitySelected(currentActivity);
if(currentActivity===""){self.$elements.experienceChooserContainer.hide();channel.trigger("targeting-ui-experience-rail-hidden")}if(currentActivity!="")localStorage.setItem(self.LOCAL_STORAGE_ACTIVITY_KEY,currentActivity)}updateSelectedActivityRail(currentActivity);updateWizardStartButtonState()};var _toggleModeChange=function(visible){var state=visible?"visible":"hidden";var layerSwitch=$(".editor-GlobalBar-item.js-editor-LayerSwitcherTrigger[data-layer\x3d'Targeting']"),container=layerSwitch.parents("coral-actionbar-secondary");
$(container).css({"visibility":state});var emulatorButton=$(".js-editor-EmulatorBar-toggle");emulatorButton.css({"visibility":state})};var bindEventsListeners=function(){$(".create-activity-button").on("click",openCreateActivityDialog);self.$elements.buttonExperienceWizardNext.on("click",handleExperienceWizardNext);self.$elements.buttonExperienceWizardBack.on("click",handleExperienceWizardBack);self.$elements.buttonStartWizard.on("click",function(e){if(self.contentManager.experiences.length>0){self.showExperienceRail();
self.$elements.campaignToolbar.hide();toggleEditorGlobalBarLeftContainer(false);channel.trigger("targeting-ui-experience-rail-shown");_toggleModeChange(false);self.wizardStarted=true;var createEnabled=$("#CanCreateAudience").val()=="true";var brandPath=self.getCurrentBrand();var splitBrand=brandPath.split("/");var brand=splitBrand[splitBrand.length-1];var pickerConfig={path:Granite.author.pageInfo.status.path,engine:self.contentManager.currentActivityProperties.engineType,brand:brand,tntConfigPath:self.contentManager.currentActivityProperties.tntConfigPath,
url:brandPath+"/"+self.getAmbit()+"/jcr:content.audiences.json",listingUrl:brandPath+"/"+self.getAmbit()+"/jcr:content.audienceslistings.json",isAbActivity:self.contentManager.currentActivityProperties.type=="abn",createEnabled:createEnabled};self.audiencePicker=AudiencePickerHelper.getAudiencePicker(pickerConfig)}});channel.off("targeting-layer-on.targeted-content-manager-ui").off("targeted-editables-initialized.targeted-content-manager-ui");self.targetingLayerOnHandler=function(event){self.show();
self.layerInitialized=true};self.$elements.campaignSelector.on("change",function(event){_debug("[TargetedContentManagerUI] Detected change on "+event.target);activityChooserSelectHandler(event)});self.$elements.brandSelector.on("change",function(event){brandChooserSelectHandler(event)});self.targetedEditablesInitializedHandler=function(event){if(self.targetingConfigLoaded){_debug("[TargetedContentManagerUI] Restoring cache immediately");restoreCachedValues()}else{_debug("[TargetedContentManagerUI] Waiting for 'target-config-loaded' event to restore cache");
channel.one("target-config-loaded",function(){restoreCachedValues()})}};_debug("[TargetedContentManagerUI] Listening for events [targeting-ui-experience-rail-shown,"+" targeting-ui-experience-rail-hidden,"+" targeting-layer-off,"+" targeting-layer-on,"+" targeted-editables-initialized"+" cq-sidepanel-resized] ...");channel.on("targeting-ui-experience-rail-shown.experience-rail-visible",function(event){if(!experienceRailVisible){$(contentFrameContainer).css("top",$(".editor-panel-header").height());
experienceRailVisible=true}self.targetingWizardStarted=true}).on("targeting-ui-experience-rail-hidden.experience-rail-hidden",function(event){if(experienceRailVisible){$(contentFrameContainer).css("top",$(".editor-panel-header").height());experienceRailVisible=false;self.targetingWizardStarted=false;if(self.contentManager.experiences[0])self.contentManager.switchExperience(self.contentManager.experiences[0].path)}}).on("targeting-layer-off",function(event){_debug("[TargetedContentManagerUI] Caught 'targeting-layer-off' event, tearing down...");
self.tearDown()}).on("targeting-layer-on.targeted-content-manager-ui",function(event){_debug("[TargetedContentManagerUI] Caught 'targeting-layer-on' event, showing Targeted Content Manager UI...");self.targetingLayerOnHandler(event)}).on("targeted-editables-initialized.targeted-content-manager-ui",function(event){_debug("[TargetedContentManagerUI] Caught 'targeted-editables-initialized' event");self.targetedEditablesInitializedHandler(event)}).on("cq-sidepanel-resized",function(e){var experiencesWidgetObj=
self.experienceRailWidgets[self.contentManager.currentActivityProperties.type].widget;if(experiencesWidgetObj)if(Granite.author.ui.SidePanel.isOpened())experiencesWidgetObj.collapseRail();else experiencesWidgetObj.expandRail()})};var handleAddExperience=function(addExperienceDialog,experienceOptions){var $form=addExperienceDialog.find("#create-experience-form");var experienceTitle=$form.find("#experienceTitleInput").val();var experienceName=$form.find("#experienceNameInput").val();$form.find("#experienceName").attr("value",
experienceName);$form.find("#experienceTitle").attr("value",experienceTitle);var windowUI=$(window).adaptTo("foundation-ui");windowUI.wait();$form.find("#experienceTitleInput").val("");addExperienceDialog[0].hide();$.ajax({type:"post",url:ns.TargetedContentManager.currentActivity+"/*",contentType:"application/x-www-form-urlencoded",data:$form.serialize()}).done(function(html){var $html=$(html);var path=$html.find("#Location").attr("href");var addedExperience=ns.ExperienceFactory.getExperience(experienceTitle,
experienceName,path,null);addedExperience["msmIsLocal"]=true;if(experienceOptions.experience&&experienceOptions.experience.audience)addedExperience.audience=experienceOptions.experience.audience;var promises=self.contentManager.addExperience(addedExperience);var postProcess=function(){self.buildExperienceTabs(self.contentManager.experiences);var experiencesWidgetObj=self.experienceRailWidgets[self.contentManager.currentActivityProperties.type];if(typeof experiencesWidgetObj!=="undefined")experiencesWidgetObj.widget.switchExperience(self.contentManager.experiences[self.contentManager.experiences.length-
1],true);self.contentManager.switchExperience(self.contentManager.experiences[self.contentManager.experiences.length-1].path);TargetingUI.MultiSiteTargeting.showExperiencesListLocalOfferMarkers();windowUI.clearWait()};if(promises.length>0)$.when.apply(promises).then(function(){postProcess()});else postProcess()}).fail(function(xhr,error,errorThrown){windowUI.clearWait()})};var _bindActivityFormEngineSelectionHandler=function(activityForm){var activityFormEngineSelectionHandler=function(event){var selectedEngine=
$(event.target).val();var isTarget=CQ.TargetingConstants.ENGINE_TARGET==selectedEngine;var targetingConfigWidget=activityForm.find(".targeting-config");var activityTypeWidget=activityForm.find(".targeting-activity-type");if(targetingConfigWidget.length>0)targetingConfigWidget[0].disabled=!isTarget;if(activityTypeWidget.length>0)activityTypeWidget[0].disabled=!isTarget};var targetingEngineWidget=activityForm.find(".targeting-engine");var targetingEngineSelect=targetingEngineWidget;if(targetingEngineSelect){targetingEngineSelect.off("change").on("change",
activityFormEngineSelectionHandler);activityFormEngineSelectionHandler({"target":targetingEngineSelect})}};var _bindActivityFormTargetConfigSelectionHandler=function(activityForm){var tntSelectHandler=function(event){var tntConfigSelect=$(event.target);var tntConfig=$(event.target).val();var activityTypeWidget=activityForm.find(".targeting-activity-type")[0];if(activityTypeWidget!==null)_populateActivityTypes(tntConfig,activityTypeWidget)};var tntConfigSelect=activityForm.find(".targeting-config");
if(tntConfigSelect)tntConfigSelect.off("change").on("change",tntSelectHandler)};var _getActivityFormTargetConfig=function(activityForm){try{var targetConfigWidget=activityForm.find(".targeting-config");if(targetConfigWidget.length>0&&targetConfigWidget[0].disabled==false)return targetConfigWidget.val()}catch(error){_debug("[TargetedContentManagerUI] Error getting target configuration from activity form!"+error)}return""};var _initializeWizardInsideEditor=function(){if(self.experienceWizardDialog){_debug("[TargetedContentManagerUI] Initializing Personalization wizard inside the editor...");
_debug("[TargetedContentManagerUI] Advancing the wizard to the diagram step.");experienceWizardNext();_debug("[TargetedContentManagerUI] Initializing Personalization wizard inside the editor completed.")}};var _showAudiencePicker=function(audienceOptions){self.audiencePicker.reset();self.audiencePicker.showPicker({multiSelection:false}).off("selected").on("selected",function(selectedAudiences){if(selectedAudiences.length>0){var audience={name:selectedAudiences[0].name,path:selectedAudiences[0].id};
audienceOptions.callback(audience)}}).off("audience:created").on("audience:created",function(audience,success){_debug("[TargetedContentManagerUI] Successfully created audience: "+audience.name);var tntConfig=self.contentManager.currentActivityProperties.tntConfigPath;AudienceManagement.createTargetAudience(audience,tntConfig,function(){self.showOperationResult(Granite.I18n.get("Successfully created new audience"),0);success()},function(xhr){var message=Granite.I18n.get("Your audience could not be saved successfully. Please try again.");
if(xhr&&xhr.responseJSON&&xhr.responseJSON.errorMessage)message=Granite.I18n.get("Your audience could not be saved successfully.\x3cbr\x3eReason: {0}",xhr.responseJSON.errorMessage);$(window).adaptTo("foundation-ui").prompt(Granite.I18n.get("Error"),message,"error",[{id:"ok",text:Granite.I18n.get("Close")}])})})};var _resizeExperiencesSideRail=function(){var experiencesWidgetObj=self.experienceRailWidgets[self.contentManager.currentActivityProperties.type];var emulatorToolbar=$(".editor-EmulatorBar");
if(emulatorToolbar.is(":visible"))$(experiencesWidgetObj.selector).addClass("emulator-visible");else $(experiencesWidgetObj.selector).removeClass("emulator-visible");$(experiencesWidgetObj.selector).height($(contentFrameContainer).height());TargetingUI.MultiSiteTargeting.showExperiencesListLocalOfferMarkers()};var _buildExperiencesSideRail=function(widgetConfig){var widget=undefined;if(self.contentManager.currentActivityProperties.type=="abn")widget=new TSDK.UI.ExperienceRailAB(widgetConfig);else widget=
(new TSDK.UI.ExperienceRailXT(widgetConfig)).on("audience:select",function(options){_showAudiencePicker(options)}).on("audience:edited",function(options){_debug("[TargetedContentManagerUI] Changed audience at index "+options.index+" from ["+options.oldAudience.name+"] to ["+options.newAudience.name+"]");var updatedExperience=self.contentManager.experiences[options.index].path;$.ajax({type:"post",url:updatedExperience+"/jcr:content",contentType:"application/x-www-form-urlencoded",data:{"cq:segments":[options.newAudience.path]}}).done(function(html){}).fail(function(xhr,
error,errorThrown){self.showOperationResult(Granite.I18n.getMessage("Error updating audience!"),true)})});widget.on("rail:expanded",function(options){Granite.author.ui.SidePanel.close()});return widget};var _populateActivityTypes=function(tntConfig,activityTypeWidget){var activityTypesUrl=tntConfig+"/_jcr_content.activitytypes.json";$.ajax(activityTypesUrl).done(function(response){activityTypeWidget.items.clear();if(response["allowedActivities"]&&response["allowedActivities"].length>0)$.each(response["allowedActivities"],
function(idx,act){activityTypeWidget.items.add({"content":{innerHTML:act["typeLabel"]},"value":act["type"]})})}).fail(function(response){console.log("Error: ",response)})};$(document).on("cui-contentloaded",function(e){var createActivityForm=$("#create-activity-form",e.target);if(createActivityForm.length){var dialog=createActivityForm.closest("coral-dialog")[0];createActivityForm.off("submit");createActivityForm.on("submit",function(e){e.preventDefault();var currentBrand=self.$elements.brandSelector.val();
var ambit=self.getAmbit();createActivityForm.find('input[name\x3d"parentPath"]').val(currentBrand+"/"+ambit);var activityTitle=createActivityForm.find('input[name\x3d"./jcr:title"]').val();var activityName=createActivityForm.find('input[name\x3d"name"]').val();var endpoint=currentBrand+"/"+ambit+"/jcr:content.activityupdate.json";var engineType=createActivityForm.find(".targeting-engine").val();var tntConfig=_getActivityFormTargetConfig(createActivityForm);var activityType=createActivityForm.find(".targeting-activity-type").val();
var activityPath=currentBrand+"/"+ambit+"/"+activityName;var postData={"activityPath":activityPath,"activityTitle":activityTitle,"activityTemplate":"/libs/cq/personalization/templates/campaign","activityResourceType":"cq/personalization/components/campaignpage","targetingEngine":engineType,"_charset_":"utf-8"};var activityTypeMarker="AEM";if(engineType==CQ.TargetingConstants.ENGINE_TARGET)if(typeof tntConfig!="undefined"&&tntConfig!=""){$.extend(postData,{"activityCloudConfigs":tntConfig,"campaignType":activityType});
activityTypeMarker=activityType=="landingPage"?"XT":"A/B"}else return false;$.ajax({type:createActivityForm.prop("method"),url:endpoint,contentType:createActivityForm.prop("enctype"),data:postData}).done(function(html){if(self.contentManager&&self.contentManager.ClientContext){var campaignStore=self.contentManager.ClientContext.get("campaign");var triggerCampaignSelection=function(){self.$elements.campaignSelector.trigger($.Event("selected",{selected:activityPath}));campaignStore.removeListener("update",
triggerCampaignSelection)};campaignStore.addListener("update",triggerCampaignSelection);campaignStore.reload()}dialog.hide();self.showOperationResult(Granite.I18n.get("The activity was created successfully"),0);updateWizardStartButtonState();createActivityForm.find('input[name\x3d"./jcr:title"]').val("");createActivityForm.find('input[name\x3d"name"]').val("");var aType=activityTypeMarker=="AEM"?"aem":activityTypeMarker=="XT"?"xt":"ab";var activitySelect=self.$elements.campaignSelector;activitySelect[0].items.add({value:activityPath,
content:{innerHTML:'\x3cspan class\x3d"badge" data-activity-type\x3d"'+aType+'"\x3e'+activityTypeMarker+"\x3c/span\x3e"+activityTitle}});activitySelect.val(activityPath);activitySelect.trigger("change");self.contentManager.currentActivityProperties={type:activityType,engineType:engineType,tntConfigPath:tntConfig,isLiveCopy:false}}).fail(function(xhr,error,errorThrown){var cause=undefined;if(xhr.responseJSON)cause=xhr.responseJSON.message;else if(xhr.responseText){var $html=$(xhr.responseText);if($html.find("#Message").length>
0){var message=$html.find("#Message").text();if(message)cause=message}}dialog.hide();createActivityForm.find('input[name\x3d"./jcr:title"]').val("");createActivityForm.find('input[name\x3d"name"]').val("");self.showOperationResult(Granite.I18n.get("An error occured while creating the activities"),1,cause)})})}});self.selectExperience=function(index,experience){if(self.selectedExperience&&experience[ns.ExperienceFactory.props.PATH]===self.selectedExperience[ns.ExperienceFactory.props.PATH])return;
$(".experience-row").removeClass("active");$(".experience-row[data-index\x3d"+index+"]").addClass("active");if(window.Granite&&Granite.author&&Granite.author.EditorFrame&&Granite.author.EditorFrame.editableToolbar)Granite.author.EditorFrame.editableToolbar.close();self.selectedExperience=experience};self.show=function(){self.$elements.content.show();updateWizardStartButtonState();updateAddExperienceModalButtonState();$(contentFrameContainer).css("top",parseInt(initialTop,10)+self.$elements.content.height())};
self.tearDown=function(){self.selectedExperience=null;self.$elements.experienceChooserContainer.hide();self.$elements.content.hide();var restoredTop=initialTop?initialTop:"auto";$(contentFrameContainer).css("top",restoredTop);self.$elements.campaignSelector.val("").change();try{self.contentManager.reset()}catch(e){}restoreBrandActivitySelectionStep()};self.buildExperienceTabs=function(experiences){_debug("[TargetedContentManagerUI] Rebuilding experience tabs...");var tsdkExperiences=experiences.map(function(exp){exp.name=
exp.title;exp._name=exp.name;return exp});self.selectedExperience={};try{if(TSDK.UI.Templates.ExperienceRailComponent.ExperienceRailRenamePopover&&!TSDK.UI.Templates.ExperienceRailComponent.ExperienceRailRenamePopoverOverlaid){TSDK.UI.Templates.ExperienceRailComponent.ExperienceRailRenamePopoverOverlaid=true;var oldPopoverRenderer=TSDK.UI.Templates.ExperienceRailComponent.ExperienceRailRenamePopover;TSDK.UI.Templates.ExperienceRailComponent.ExperienceRailRenamePopover=function(context,options){var output=
oldPopoverRenderer.call(oldPopoverRenderer,context,options);var jqOutput=$(output);jqOutput.find(".experience-title-input").attr("maxlength",20);return jqOutput[0].outerHTML}}}catch(e){}var experiencesWidgetObj=self.experienceRailWidgets[self.contentManager.currentActivityProperties.type];if(!experiencesWidgetObj){console.warn("Unsupported activity type "+self.contentManager.currentActivityProperties.type);return}for(var actType in self.experienceRailWidgets)if(self.experienceRailWidgets.hasOwnProperty(actType))$(self.experienceRailWidgets[actType].selector).hide();
if(!experiencesWidgetObj.widget){var actionArray=[];var widgetDataCfg={};if(self.contentManager.currentActivityProperties.type=="abn"){widgetDataCfg={audience:"All Visitors",experiences:tsdkExperiences};actionArray=[TSDK.Enums.ExperienceRailActions.RENAME_EXPERIENCE,TSDK.Enums.ExperienceRailActions.DUPLICATE,TSDK.Enums.ExperienceRailActions.DELETE]}else{widgetDataCfg={experiences:tsdkExperiences};actionArray=[TSDK.Enums.ExperienceRailActions.EDIT_AUDIENCE,TSDK.Enums.ExperienceRailActions.RENAME_EXPERIENCE,
TSDK.Enums.ExperienceRailActions.DUPLICATE,TSDK.Enums.ExperienceRailActions.DELETE]}var widgetConfig={el:experiencesWidgetObj.selector,visible:true,data:widgetDataCfg,config:{autoAdd:true,activeIndex:0,noAnimation:false,placement:"right",mode:"expanded",actions:actionArray,minCount:0,maxCount:50}};experiencesWidgetObj.widget=_buildExperiencesSideRail(widgetConfig);experiencesWidgetObj.widget.on("error",function(options){console.log("ERROR: "+options.message)}).on("rail:collapsing rail:collapsed rail:expanding rail:expanded",
function(railWidth){_debug("[TargetedContentManagerUI] Rail expand/collapse event!")}).on("tab:switched",function(index){_debug("[TargetedContentManagerUI] Switching to experience idx\x3d"+index);var currentExperience=experiencesWidgetObj.widget.getExperiences()[index];CQ.TargetedContentManager.switchExperience(currentExperience.path);TargetingUI.MultiSiteTargeting.showExperiencesListLocalOfferMarkers()}).on("experience:add",function(options){_debug("[TargetedContentManagerUI] Experience add called!")}).on("experience:added",
function(options){openAddExperienceDialog(options,experiencesWidgetObj.widget);_debug("[TargetedContentManagerUI] Added experience ["+options.experience.name+"] at index "+options.index)}).on("experience:deleted",function(options){var deletedExperience=options.oldExperience;self.contentManager.deleteExperience(deletedExperience[ns.ExperienceFactory.props.PATH],function(experiences,scope){scope.showOperationResult(Granite.I18n.getMessage("The experience has been deleted"),0,"");scope.buildExperienceTabs(experiences);
CQ.TargetedContentManager.switchExperience("DEFAULT")},self)}).on("experience:renamed",function(options){_debug("[TargetedContentManagerUI] Renamed experience at index "+options.index+" from ["+options.oldName+"] to ["+options.newName+"]");$.ajax({type:"post",url:options.experience.path+"/jcr:content",contentType:"application/x-www-form-urlencoded",data:{"jcr:title":options.newName,"_charset_":"utf-8"}}).done(function(html){self.showOperationResult(Granite.I18n.getMessage("The experience has been successfully renamed"),
false);var experienceStore=self.contentManager.experiences;$.each(experienceStore,function(expIdx,currentExperienceObject){if(currentExperienceObject.path==options.experience.path){currentExperienceObject.title=options.newName;return false}})}).fail(function(xhr,error,errorThrown){self.showOperationResult(Granite.I18n.getMessage("Error renaming experience!"),true)})})}else{experiencesWidgetObj.widget.setExperiences([]);experiencesWidgetObj.widget.setExperiences(tsdkExperiences);if(tsdkExperiences&&
tsdkExperiences.length>0)experiencesWidgetObj.widget.switchExperience(0,true)}$(experiencesWidgetObj.selector).on("click",".experience-row .menu-button",function(evt){var experience=$(this).closest(".experience-row");if(TargetingUI.MultiSiteTargeting.isValidInheritance()&&!TargetingUI.MultiSiteTargeting._isExperienceLocal(experience)){evt.preventDefault();evt.stopPropagation();var t=evt.target;TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){experiencesWidgetObj.widget._handleMenuButtonClick(evt)},
experience);return false}return true});$(experiencesWidgetObj.selector).show();_resizeExperiencesSideRail();if(self.wizardStarted)self.$elements.buttonStartWizard.trigger("click");TargetingUI.MultiSiteTargeting.setupInheritanceHooks()};self.showExperienceRail=function(){self.$elements.experienceChooserContainer.show();_resizeExperiencesSideRail()};self.showOperationResult=function(text,isError,cause){var message=isError==0?text:Granite.I18n.get(text+". Reason: {0}",[cause]),type=isError==0?"success":
"error";var ui=$(window).adaptTo("foundation-ui");ui.notify(null,message,type)};self.getCurrentBrand=function(){return self.$elements.brandSelector.val()};self.getAmbit=function(){var brand=self.getCurrentBrand();var ambit=CQ.TargetingConstants.AMBIT_DEFAULT_NAME;var ambitReferences=self.pageAmbits||[];for(var i=0;i<ambitReferences.length;i++){var ambitReference=ambitReferences[i].path;if(ambitReference.slice(0,brand.length)==brand){ambit=ambitReference.replace(/.*\/(.*?)/,"$1");break}}return ambit};
self.doSaveToOfferLibrary=function(editable){var targetComponent=self.contentManager.getTargetParent(editable),currentBrand=self.getCurrentBrand(),ambit=self.getAmbit();var offerLibraryPath=currentBrand+"/"+ambit+"/"+CQ.TargetingConstants.OFFER_LIBRARY_DEFAULT_NAME;var offerPath=self.contentManager.offers[targetComponent.path],url="/libs/cq/personalization/touch-ui/content/v2/commons/savetolibrarymodal.html"+offerLibraryPath+"/jcr:content"+"?rootPath\x3d"+offerLibraryPath+"\x26offerSource\x3d"+offerPath;
var dialog=new Granite.author.ui.Dialog({getConfig:function(){return{src:url,loadingMode:"auto",layout:"auto"}},refresh:function(){var deferred=$.Deferred();return deferred.promise()}});Granite.author.DialogFrame.openDialog(dialog);channel.on("dialog-fail",function(event,xhr){var response=xhr.responseJSON;self.showOperationResult("Failed to save offer",true,response.message)});channel.one("dialog-success",function(event,xhr){channel.off("dialog-fail");self.showOperationResult("Offer saved successfully",
false);self.contentManager.loadOffers(targetComponent,self.contentManager.selectedExperience)})};return self}()})(jQuery,CQ,jQuery(document),this);
(function(ns,channel,window){var targetedContentManager=function(ns){var debugMode=window.location.href.indexOf("?debug-target-mode\x3dtrue")>=0||window.location.href.indexOf("\x26debug-target-mode\x3dtrue")>=0;var CAMPAIGN_PROP="campaign/path",EXPERIENCE_PROP="campaign/recipe/path",OFFER_INNER_PATH="jcr:content/par",DEFAULT_COMPONENT="default",DEFAULT_EXPERIENCE=DEFAULT_COMPONENT.toUpperCase(),DEFAULT_ACTIVITY_TYPE="landingPage",LOCATION_NAME_PARAM="location",COMMAND_SERVLET="/bin/wcmcommand",CMD_DELETE_OP=
"deletePage",campaignStore;var instance={};instance.ClientContext=null;instance.ContextHub=null;if(this.constructor==targetedContentManager.prototype)throw"This is a singleton!";if(targetedContentManager.instance)return targetedContentManager.instance;var noCache=function(url){return url+"?ck\x3d"+(new Date).getTime()};var startWith=function(str,prefix){return str.indexOf(prefix)===0};var debug=function(){if(debugMode)console.log.apply(console,arguments)};var _isEditMode=function(){return Granite.author.layerManager.getCurrentLayerName()===
"Edit"};var _isTargetMode=function(){return Granite.author.layerManager.getCurrentLayerName()==="Targeting"};var getElementName=function(path){var pathElements=path.split("/");return pathElements[pathElements.length-1]};var getExperienceName=function(experience){return getElementName(experience[ns.ExperienceFactory.props.PATH])};var forgetEditable=function(forgettable){var keyToRemove="",offerToRemove;$.each(instance.editables,function(key,editable){if(forgettable.path===editable.path)keyToRemove=
key});if(instance.offers.hasOwnProperty(forgettable.path))offerToRemove=forgettable.path;delete instance.editables[keyToRemove];delete instance.offers[offerToRemove]};var loadContent=function(editable,url,createEditables){debug("[TargetedContentManager] Loading content of "+editable.path+" from "+url);Granite.author.edit.actions.loadContent(editable,url).done(function(){if(!createEditables)return;var parentDiv=Granite.author.ContentFrame.getEditableNode(editable.path),newOnes=[];$.each(parentDiv.find("cq"),
function(i,configNode){var newEditable=Granite.author.edit.createEditable(configNode);if(newEditable.type!==CQ.TargetingConstants.TARGET_PARSYS_END_RTYPE&&newEditable.path!==editable.path)newOnes.push(newEditable)});newOnes.sort(function(editable1,editable2){return editable1.path.localeCompare(editable2.path)});$.each(newOnes,function(i,newEditable){Granite.author.store.add(newEditable)});$.each(newOnes,function(i,newEditable){Granite.author.overlayManager.create(newEditable)});if(editable.overlay!=
null)editable.overlay.removeDropTarget()})};var destroyChildren=function(editable){var kids=editable.getChildren();if(kids&&kids.length>0)$.each(kids,function(i,k){debug("[TargetedContentManager] Destroying "+k.path);k.destroy();Granite.author.store.remove(k)})};var _applyOverlayStyling=function(editable){if(editable&&editable.overlay&&(CQ.TargetedContentManager.isTargetComponent(editable.type)||CQ.TargetedContentManager.isTargetedContainerComponent(editable.type))){var $overlayDom=$(editable.overlay.dom);
$overlayDom.toggleClass("targeted",true);var icon=(new Coral.Icon).set({icon:"targeted"});var $tabLabel=$("\x3cdiv class\x3d'targeting-icon-overlay targeting-icon-overlay--top'\x3e\x3c/div\x3e");$tabLabel.append(icon);$overlayDom.append($tabLabel)}};var _removeChildren=function(editable){var children=editable.getChildren();if(children.length>0){debug("[TargetedContentManager] Removing children of component at "+editable.path);$.each(children,function(idx,editable){editable.destroy()})}};var _prepareEditMode=
function(){var editables=Granite.author.editables;$.each(editables,function(idx,editable){if(CQ.TargetedContentManager.isTargetComponent(editable.type)){_removeChildren(editable);_applyOverlayStyling(editable)}})};var _loadExperiences=function(activity,callback){debug("[TargetedContentManager] Loading experiences for campaign "+activity);var self=this,defaultExperience=ns.ExperienceFactory.getExperience(Granite.I18n.get("DEFAULT"),"DEFAULT","DEFAULT",null);defaultExperience.audience={path:"DEFAULT",
name:Granite.I18n.get("DEFAULT")};$.ajax(activity+noCache("/jcr:content.experiences.json")).done(function(data,jqXHR){delete instance.experiences;instance.experiences=new Array;instance.experiences.push(defaultExperience);var experiences=data;$.each(experiences,function(path,title){var name=path.replace(/^.*\/(.*)$/,"$1");var newExperience=ns.ExperienceFactory.getExperience(title,name,path,null);instance.experiences.push(newExperience)});debug("[TargetedContentManager] Experiences loaded from server: "+
instance.experiences.length);_updateExperienceAudiences(activity)})};var _tearDownMsmAuthoringHelper=function(){if(Granite&&Granite.author&&Granite.author.MsmAuthoringHelper)if(MSM.MSMCommons.isLiveCopyPage(Granite.author))var disableMsmAuthoringHelper=setInterval(function(){if(Granite.author.MsmAuthoringHelper.isInitialized){debug("[TargetedContentManagerUI] Ensure MsmAuthoringHelper tear down");Granite.author.MsmAuthoringHelper.tearDown();clearInterval(disableMsmAuthoringHelper)}},300)};channel.on("editor-frame-mode-changed",
function(){if(_isEditMode())setTimeout(function(){if(instance.ContextHub)try{instance.ContextHub.resetAllStores()}catch(error){console.log(error)}if(instance.ClientContext)instance.ClientContext.reset()},1E3)});channel.on("cq-reusableoffer-dropped",function(event){var editable=event.editable;instance.loadOffers(editable,instance.selectedExperience)});instance.SHOW_TARGETED_OVERLAY_IN_EDIT_MODE=true;if(instance.SHOW_TARGETED_OVERLAY_IN_EDIT_MODE)channel.on("cq-editor-loaded",function(event){if(Granite.author.layerManager.getCurrentLayerName()===
"Edit")setTimeout(_prepareEditMode,500)}).on("cq-layer-activated",function(event){var currentLayer=event["layer"],prevLayer=event["prevLayer"];if(currentLayer=="Edit"&&prevLayer!=="Edit")setTimeout(_prepareEditMode,500);if(currentLayer=="Preview"&&prevLayer==="Targeting")$.each(instance.editables,function(i,e){Granite.author.edit.EditableActions.REFRESH.execute(e)})});instance.offers={};instance.currentActivity="";instance.currentActivityProperties={type:DEFAULT_ACTIVITY_TYPE,engineType:"aem",tntConfigPath:undefined,
isLiveCopy:false,inheritanceCancelled:false,inheritancePlus:false};instance.currentBrand="";instance.selectedExperience={};instance.experiences=[];instance.editables={};instance.ui={};instance.rememberEditable=function(editableToStore){if(!instance.editables[editableToStore.path])return $.ajax(editableToStore.path+".json").done(function(response,jqXHR){var editableKey=response[LOCATION_NAME_PARAM]?response[LOCATION_NAME_PARAM]:editableToStore.path;instance.editables[editableKey]=editableToStore;channel.trigger("targeted-editable-loaded")})};
instance.isLoadingOffers=false;instance.isTargetRequest=false;$(document).on("editable-refreshed",function(event){debug("[TargetedContentManager] Editable refreshed after edit "+event["path"]);var path=event["path"],url=path+".json";if(_isEditMode()){var editables=Granite.author.store.find(path);if(editables.length>0)setTimeout(function(){_applyOverlayStyling(editables[0])},200);$.each(editables,function(idx,editable){if(CQ.TargetedContentManager.isTargetComponent(editable.type))_removeChildren(editable)})}if(_isTargetMode())$.ajax(url).done(function(response){for(var l in instance.editables)if(instance.editables.hasOwnProperty(l)){var editable=
instance.editables[l];if(editable.path===path){delete instance.editables[l];var editableKey=response[LOCATION_NAME_PARAM]?response[LOCATION_NAME_PARAM]:editable.path;instance.editables[editableKey]=editable}instance.loadOffers(editable,instance.selectedExperience)}}).fail(function(response){console.error("Error refreshing targeted content: ",response)})});var _getJsonPageProperty=function(rootJson,propName,defaultValue){var propValue=defaultValue;if(rootJson["jcr:content"]&&rootJson["jcr:content"][propName])propValue=
rootJson["jcr:content"][propName];return propValue};var _updateExperienceAudiences=function(activity){$.ajax(activity+noCache(".2.json")).done(function(data,jqXHR){var resultJson=data;if(instance.currentActivity!=activity)return;instance.currentActivityProperties.type=_getJsonPageProperty(resultJson,"campaignType",DEFAULT_ACTIVITY_TYPE);instance.currentActivityProperties.engineType=_getJsonPageProperty(resultJson,"cq:targetEngine","aem");var cloudConfigs=resultJson["jcr:content"]["cq:cloudserviceconfigs"];
if(cloudConfigs)if(typeof cloudConfigs=="object"&&cloudConfigs.length>0)instance.currentActivityProperties.tntConfigPath=cloudConfigs[0];else instance.currentActivityProperties.tntConfigPath=cloudConfigs;else instance.currentActivityProperties.tntConfigPath=undefined;$.each(instance.experiences,function(index,experience){var pageName=experience.path.replace(/.*\/(.*$)/i,"$1");if(resultJson[pageName]&&resultJson[pageName]["jcr:content"]){var visitorPercentage=resultJson[pageName]["jcr:content"]["visitorPercentage"];
experience["visitorPercentage"]=visitorPercentage;var experienceMixins=resultJson[pageName]["jcr:content"]["jcr:mixinTypes"];var hasLcMarker=false;if(experienceMixins&&experienceMixins.length>0)$.each(experienceMixins,function(mixinIdx,mixin){if(mixin=="cq:LiveRelationship"){hasLcMarker=true;return false}});experience["msmIsLocal"]=hasLcMarker?false:true}else experience["visitorPercentage"]=undefined});var url=noCache(activity+"/jcr:content.segments.json");$.ajax(url).done(function(data,jqXHR){$.each(instance.experiences,
function(index,experience){var segmentData=data[experience.path];if(segmentData){var audienceName=segmentData["title"];audienceName=audienceName.replace(/-[0-9]{13}/gi,"");experience.audience={path:segmentData["path"],name:audienceName};experience["visitorPercentage"]=segmentData["visitorPercentage"]}});instance.ui.buildExperienceTabs(instance.experiences);instance.ui.selectExperience(0,instance.experiences[0]);instance.switchExperience(DEFAULT_EXPERIENCE)})})};instance.onActivitySelected=function(activity,
callback){if(!activity){debug("[TargetedContentManager] No activity selected");return}else{debug("[TargetedContentManager] Activity selected "+activity);this.currentActivity=activity;_loadExperiences(activity,callback)}};instance.showOfferActions=function(){return!instance.isLoadingOffers&&!instance.isTargetRequest};instance.switchExperience=function(experiencePath,scrollIntoView,forceReload){if(typeof experiencePath==="undefined")return;if(experiencePath===instance.selectedExperience.path&&!forceReload)return;
debug("[TargetedContentManager] Switching to experience "+experiencePath);var experience;$.each(instance.experiences,function(i,o){if(experiencePath===o.getPath())experience=o});if(!experience)return;this.selectedExperience=experience;_tearDownMsmAuthoringHelper();instance.offers={};$.each(instance.editables,function(index,editable){instance.loadOffers(editable,experience)});$.each(instance.experiences,function(i,e){if(e.path===experiencePath)instance.ui.selectExperience(i,e,scrollIntoView)})};instance.targetComponent=
function(editable,revert,initialResourceType){var useResourceType=editable&&editable.getChildren().length>0?editable.getChildren()[0].type:initialResourceType;var url=editable.path+(revert?".untarget":".target")+".json",opMsg=revert?Granite.I18n.getMessage("Component is no longer targeted"):Granite.I18n.getMessage("Component is now targeted"),opMsgError=Granite.I18n.getMessage("An error occurred");var createAllOffers=function(editable){var promises=[];$.each(instance.experiences,function(idx,experience){var experienceName=
getExperienceName(experience);if(experienceName!==DEFAULT_EXPERIENCE)promises.push(instance.createOffer(editable,null,experience["path"]))});return promises};var classes="";if(editable.dom)classes=$(editable.dom).attr("class").split(" ").filter(function(e){return e.startsWith("aem-GridColumn")});var doTargetRequest=function(location){var type=revert?useResourceType:ns.TargetingConstants.TARGET_COMPONENT_RTYPE;instance.isTargetRequest=true;$.post(url,{"resourceType":type,"location":location||"","_charset_":"utf-8"}).done(function(data,
status,xhr){if(!data.success){instance.ui.showOperationResult(opMsgError,true,data.error||Granite.I18n.getMessage("Unknown"));return}editable.type=type;if(revert){debug("[TargetedContentManager] Untargeting editable at ",editable.path);forgetEditable(editable);var children=editable.getChildren();if(children&&children.length>0)Granite.author.store.remove(children[0])}debug("[TargetedContentManager] Refreshing editable at ",editable.path);Granite.author.target.TargetingActions.REFRESH.execute(editable).done(function(){if(!revert){instance.rememberEditable(editable).done(function(){$.when.apply($,
createAllOffers(editable)).always(function(){debug("[TargetedContentManager] All offers created");instance.isTargetRequest=false})});instance.loadOffers(editable,instance.selectedExperience);Granite.author.EditorFrame.editableToolbar.enable()}else Granite.author.overlayManager.recreate(editable);if(editable.dom)$(editable.dom).addClass(classes.join(" "))});instance.ui.showOperationResult(opMsg,false)}).fail(function(xhr,status,error){instance.isTargetRequest=false;instance.ui.showOperationResult(opsMsgError,
true,xhr.statusText)})};if(!revert)if(instance.ui.forceLocation===true){debug("[TargetedContentManager] Enforcing location");var dlgUrl="/libs/cq/personalization/touch-ui/content/v2/commons/targeteddialog.html"+editable.path;dlgUrl=Granite.HTTP.externalize(dlgUrl);var dlg=new Granite.author.ui.Dialog({getConfig:function(){return{src:dlgUrl,loadingMode:"auto",layout:"auto"}}});Granite.author.DialogFrame.openDialog(dlg);$(document).on("click","form.cq-dialog .cq-dialog-submit",function(e){e.preventDefault();
e.stopPropagation();var $form=$(e.target).closest("form");$.each($("input, textarea, select",$form),function(k,v){var el=$(v);el.checkValidity();el.updateErrorUI()});if($.validator.isValid($form)){var location=$form?$("input[name\x3d'location']",$form).val():"";doTargetRequest.call(this,location);Granite.author.DialogFrame.closeDialog()}})}else{var location=ns.TargetedDialogHelper.generateUUID();doTargetRequest.call(this,location)}else doTargetRequest.call(this)};instance.addExperience=function(addedExperience){instance.experiences.push(addedExperience);
var promises=[];$.each(instance.editables,function(location,editable){promises.push(instance.createOffer(editable,null,addedExperience["path"]))});return promises};instance.deleteExperience=function(path,callback,scope){$.post(COMMAND_SERVLET,{"path":path,"cmd":CMD_DELETE_OP}).done(function(data,jqXHR){var indexToRemove=-1;$.each(instance.experiences,function(index,experience){if(experience[ns.ExperienceFactory.props.PATH]===path)indexToRemove=index});if(indexToRemove>-1)instance.experiences.splice(indexToRemove,
1);if(callback&&typeof callback=="function")callback(instance.experiences,scope)})};instance.getOfferUrl=function(editable,experience){var offerPath=null;var experienceName=getExperienceName(experience);if(experienceName===DEFAULT_EXPERIENCE)offerPath=editable.path+"."+DEFAULT_COMPONENT+".html";else if(instance.offers[editable.path]){var path=instance.offers[editable.path];if(path.indexOf("|")!==-1)offerPath=path.split("|")[1]+"/"+OFFER_INNER_PATH+".html";else offerPath=instance.offers[editable.path]+
"/"+OFFER_INNER_PATH+".html"}return offerPath};instance.loadOffers=function(editable,currentExperience){debug("[TargetedContentManager] Loading offers for "+editable.path);if(instance.currentActivity==="")return;var teasersUrl=editable.path+".teasers.json"+instance.currentActivity,editableName=getElementName(editable.path),currentExperienceName=getExperienceName(currentExperience);instance.isLoadingOffers=true;$.ajax(teasersUrl).done(teasersUrl,function(teasers,jqXHR){var refreshUrl,createEditables=
false;Granite.author.selection.deselectAll();destroyChildren(editable);if(teasers[currentExperienceName]){instance.offers[editable.path]=teasers[currentExperienceName];refreshUrl=instance.getOfferUrl(editable,currentExperience);refreshUrl+=(refreshUrl.indexOf("?")<0?"?":"\x26")+"contentPolicyDelegatePath\x3d"+encodeURIComponent(teasers.DEFAULT);if(currentExperienceName!==DEFAULT_EXPERIENCE){if(teasers[currentExperienceName].indexOf("|")===-1)createEditables=true}else createEditables=true}else refreshUrl=
editable.path+".default.html";loadContent(editable,refreshUrl,createEditables);setTimeout(function(){if(teasers[currentExperienceName]){if(currentExperienceName!==DEFAULT_EXPERIENCE)if(editable.overlay&&teasers[currentExperienceName].indexOf("|")!==-1)editable.overlay.setLockedOffer(true);else editable.overlay.setLockedOffer(false);else if(editable.overlay)editable.overlay.toggleOverlayIcon(false);if(editable.overlay)editable.overlay.setEmptyOverlay(false)}else{if(editable.overlay&&editable.overlay.toggleOverlayIcon)editable.overlay.toggleOverlayIcon(false);
if(editable.overlay&&editable.overlay.setEmptyOverlay)editable.overlay.setEmptyOverlay(true)}},200)}).always(function(data,status,xhr){instance.isLoadingOffers=false})};instance.getTargetParent=function(editable){var targetEditable=editable;while(targetEditable&&!CQ.TargetedContentManager.isTargetComponent(targetEditable.type))targetEditable=targetEditable.getParent();return targetEditable};instance.createOffer=function(editable,location,selectedExperience){var self=this;var selectedExperience=typeof selectedExperience!==
"undefined"?selectedExperience:instance.selectedExperience[ns.ExperienceFactory.props.PATH];if(typeof location==="undefined"||location===null)$.each(instance.editables,function(k,e){if(e.path===editable.path)location=k});var params={"experiencePath":selectedExperience,"jcr:content/location":location};$.post(editable.path+".createoffer.json",params).done(function(response){instance.switchExperience(instance.selectedExperience[ns.ExperienceFactory.props.PATH],undefined,true)}).fail(function(response){instance.ui.showOperationResult("Adding the offer failed",
1,response.statusText)})};instance.deleteOffer=function(editable){var path=instance.offers[editable.path];if(path.indexOf("|")!==-1)path=path.split("|")[0];if(typeof path==="undefined"||path===null)return;var params={"path":path,"cmd":CMD_DELETE_OP};$.post(COMMAND_SERVLET,params).done(function(response){instance.offers[editable.path]=null;instance.ui.showOperationResult(Granite.I18n.get("The offer was deleted successfully"),0);instance.loadOffers(editable,instance.selectedExperience)}).fail(function(response){instance.ui.showOperationResult("An error occured while deleting the offer",
1,response.statusText)})};instance.isDefaultExperienceSelected=function(){var experienceName=getExperienceName(instance.selectedExperience);return experienceName===DEFAULT_EXPERIENCE};instance.hasOffer=function(editable){var refEditable;if(this.isTargetedContainerComponent(editable.type))refEditable=editable;else refEditable=instance.getTargetParent(editable);var hasOffer=instance.offers.hasOwnProperty(refEditable.path)&&instance.offers[refEditable.path]!==null;return hasOffer};instance.isTargetComponent=
function(type){return type===CQ.TargetingConstants.TARGET_COMPONENT_RTYPE||type===CQ.TargetingConstants.TARGET_RESPONSIVEGRID_COMPONENT_RTYPE};instance.isTargetedContainerComponent=function(type){return type===CQ.TargetingConstants.TARGET_PARSYS_RTYPE||type===CQ.TargetingConstants.TARGET_RESPONSIVEGRID_RTYPE};instance.isParSys=function(type){return type===CQ.TargetingConstants.PARSYS_RT||type===CQ.TargetingConstants.PARSYS_NEW_RT||type===CQ.TargetingConstants.RESPONSIVEGRID_RT||type===CQ.TargetingConstants.RESPONSIVEGRID_NEW_RT};
instance.isInParsys=function(editable){if(this.isTargetComponent(editable.type)||this.isTargetedContainerComponent(editable.type))return false;var parentEditable=editable.getParent();while(parentEditable){if(this.isTargetedContainerComponent(parentEditable.type))break;parentEditable=parentEditable.getParent()}return parentEditable&&this.isTargetedContainerComponent(parentEditable.type)};instance.reset=function(){debug("[TargetedContentManager][reset] Starting reset...");if(ns.TargetedContentManager.ClientContext){var campaignStore=
ns.TargetedContentManager.ClientContext.get("campaign");if(campaignStore){debug("[TargetedContentManager][reset] Removing ClientContext campaign update listener!");campaignStore.setCampaign("")}}if(instance.currentActivity!==""){var targetedEditables=typeof instance.editables!=="undefined"?Object.keys(instance.editables).length:0;debug("[TargetedContentManager][reset] Resetting "+targetedEditables+" editables...");if(targetedEditables>0)$.each(instance.editables,function(i,e){var editableRefreshPromise=
Granite.author.target.TargetingActions.REFRESH.execute(e);editableRefreshPromise.done(function(){targetedEditables--;if(targetedEditables==0){debug("[TargetedContentManager][reset] All editables were reset, triggering 'targeted-editables-reset' event!");channel.trigger("targeted-editables-reset")}})});else{debug("[TargetedContentManager][reset] No targeted editables to reset, triggering 'targeted-editables-reset' event!");channel.trigger("targeted-editables-reset")}}else{debug("[TargetedContentManager][reset] Not simulating, triggering 'targeted-editables-reset' event!");
channel.trigger("targeted-editables-reset")}instance.offers={};instance.currentActivity="";instance.selectedExperience={};instance.experiences=[];debug("[TargetedContentManager][reset] Reset done.")};instance.getEditableLocationName=function(editable){var location="";$.each(instance.editables,function(k,e){if(e.path===editable.path)location=k});return location};instance.hasLockedOffer=function(editable){if(instance.offers&&instance.offers[editable.path])if(instance.offers[editable.path].indexOf("|")!==
-1)return true;return false};instance.convertInlineOffer=function(editable){var offerPath=instance.offers[editable.path],offers=offerPath.split("|"),url=offers[0]+"/jcr:content.fromreusable.json";$.post(url,{source:offers[1]}).done(function(data,status,xhr){instance.loadOffers(editable,instance.selectedExperience)}).fail(function(data){instance.ui.showOperationResult("Error converting to inline offer",1,data["message"])})};instance.editOfferNewTab=function(editable){var offerPath=instance.offers[editable.path],
offers=offerPath.split("|"),urlToOpen=Granite.HTTP.externalize("/editor.html"+offers[1]+".html");window.open(urlToOpen)};instance.getCurrentBrand=function(){if(instance.currentBrand==="")return instance.ui.getCurrentBrand();return instance.currentBrand};instance.isSimulation=function(){return instance.currentActivity===""};instance.targetedContentMoved=function(){debug("[TargetedContentManager] Targeted component moved: "+this.path);var editable=this;_removeChildren(editable);setTimeout(function(){_applyOverlayStyling(editable)},
100)};return instance};ns.TargetedContentManager=targetedContentManager(ns)})(CQ,jQuery(document),this);
(function($,ns,channel,window,undefined){var _isLiveCopyCancelled=function(editable){if(MSM&&MSM.MSMCommons&&MSM.MSMCommons.isLiveCopyPage(ns)){var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);var editableToCheck=targetEditable||editable;return MSM.MSMCommons.isInheritanceCancelled(editableToCheck)||MSM.MSMCommons.isManuallyCreated(editableToCheck)}return true};var _isPageOwnedContent=function(editable){var currentPagePath=ns.pageInfo.status.path;var editablePath=editable.path;
return editablePath.startsWith(currentPagePath)};var _renderInheritanceToggleCondition=function(editable,actionName){if(!_isPageOwnedContent(editable))return false;if(ns.MsmAuthoringHelper.isLiveCopy(editable)&&ns.pageInfoHelper.canModify()){var addMSMAction=ns.MsmAuthoringHelper.isInheritanceCancelled(editable)?"MSM_REENABLE_INHERITANCE":"MSM_CANCEL_INHERITANCE";var defaultBeforeDeleteFunc=editable.config.editConfig.listeners["beforedelete"];editable.config.editConfig.listeners["beforedelete"]=function(){ns.persistence.deleteParagraph(editable).done(function(){editable.refresh(false).then(function(){ns.overlayManager.recreate(editable);
if(ns.layerManager.getCurrentLayer()==="msm")$(editable.overlay.dom[0]).addClass("is-bordered")})});editable.config.editConfig.listeners["beforedelete"]=defaultBeforeDeleteFunc;return false};return addMSMAction==actionName}return false};var _sendInheritanceToggleXHR=function(editable,target,cancelInheritance,callback){var parent=CQ.TargetedContentManager.getTargetParent(editable);if(parent!==undefined)editable=parent;var params={};params[MSM.MSMCommons.Constants.PARAM_STATUS+"/"+MSM.MSMCommons.Constants.PARAM_IS_CANCELLED]=
cancelInheritance;params[MSM.MSMCommons.Constants.PARAM_STATUS+"/"+MSM.MSMCommons.Constants.PARAM_IS_CANCELLED_FOR_CHILDREN]=!editable.config.isContainer;$.ajax({type:"POST",url:editable.path+".msm.conf",data:params}).done(function(data,textStatus,jqXHR){if(!_g.HTTP.isOkStatus(jqXHR.status))return;ns.edit.actions.doRefresh(editable).then(function(){ns.overlayManager.recreate(editable)}).then(function(){CQ.TargetedContentManager.loadOffers(editable,CQ.TargetedContentManager.selectedExperience)});if(callback)callback.call(this)})};
var _showConfirmationModal=function(editable,target){var cancelInheritance=!ns.MsmAuthoringHelper.isInheritanceCancelled(editable);var modalHeader=cancelInheritance?Granite.I18n.get("Cancel inheritance"):Granite.I18n.get("Revert inheritance");var modalMessage=cancelInheritance?Granite.I18n.get("Do you really want to cancel the inheritance?"):Granite.I18n.get("Do you really want to revert the inheritance?");var $message=$(document.createElement("div"));$(document.createElement("p")).text(modalMessage).appendTo($message);
if(!cancelInheritance)MSM.MSMCommons.buildSyncAfterRevertOption(false).appendTo($message);var modalConfirmationHandler=function(){if(!cancelInheritance&&MSM.MSMCommons.checkDoSyncPageAfterRevert()){var blueprintPath=ns.MsmAuthoringHelper.getBlueprintPath(editable);var livecopyPath=ns.MsmAuthoringHelper.getLiveCopyPath(editable);if(blueprintPath&&livecopyPath)_sendInheritanceToggleXHR(editable,target,cancelInheritance,function(){MSM.MSMCommons.syncPage(blueprintPath,livecopyPath,false)});else ns.ui.alert(Granite.I18n.get("Error"),
Granite.I18n.get("An error occurred while"+" synchronizing the Live Copy."),"error")}else _sendInheritanceToggleXHR(editable,target,cancelInheritance)};var promptConfig={title:modalHeader,message:$message.html(),type:ns.ui.helpers.PROMPT_TYPES["NOTICE"],actions:[{id:"OK",text:Granite.I18n.get("Yes"),primary:true},{id:"CANCEL",text:Granite.I18n.get("No"),primary:false}],callback:function(actionId){if("OK"===actionId)modalConfirmationHandler()}};ns.ui.helpers.prompt(promptConfig)};var selectParentAction=
new ns.ui.ToolbarAction({name:"SELECT_PARENT",icon:"selectContainer",text:Granite.I18n.getMessage("Parent"),execute:function(editable,param,target){target.addClass("is-active");ns.edit.actions.doSelectParent(editable,target);return false},condition:function(editable){return editable.hasAction("PARENT")&&ns.editables.getSelectableParents(editable).length>0}});var targetParsysActions={"TARGET_COMPONENT_OPTIONS":new ns.ui.ToolbarAction({icon:"gear",text:Granite.I18n.getMessage("Target component settings"),
execute:function(editable){var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);ns.DialogFrame.openDialog(new ns.edit.Dialog(targetEditable))},condition:function(editable){if(!_isLiveCopyCancelled(editable))return false;var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);return typeof targetEditable!=="undefined"}}),"DELETE_OFFER":new ns.ui.ToolbarAction({icon:"closeCircle",text:Granite.I18n.getMessage("Remove offer from activity"),execute:function(editable){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){var targetEditable=
CQ.TargetedContentManager.getTargetParent(editable);CQ.TargetedContentManager.deleteOffer(targetEditable)})},condition:function(editable){if(!_isLiveCopyCancelled(editable))return false;var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);return typeof targetEditable!=="undefined"&&!CQ.TargetedContentManager.isDefaultExperienceSelected()&&CQ.TargetedContentManager.showOfferActions()&&CQ.TargetedContentManager.hasOffer(targetEditable)}}),"ADD_OFFER":new ns.ui.ToolbarAction({icon:"add",
text:Granite.I18n.getMessage("Add offer"),execute:function(editable){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);if(typeof targetEditable!=="undefined")CQ.TargetedContentManager.createOffer(targetEditable)})},condition:function(editable){if(!_isLiveCopyCancelled(editable))return false;if(CQ.TargetedContentManager.isSimulation())return false;var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);
return typeof targetEditable!=="undefined"&&CQ.TargetedContentManager.showOfferActions()&&!CQ.TargetedContentManager.hasOffer(targetEditable)}}),"SAVE_OFFER":new ns.ui.ToolbarAction({icon:"upload",text:Granite.I18n.getMessage("Save offer to offer library"),execute:function(editable){CQ.ui.TargetedContentManagerUi.doSaveToOfferLibrary(editable)},condition:function(editable){if(!_isLiveCopyCancelled(editable))return false;if(CQ.TargetedContentManager.isSimulation())return false;return!CQ.TargetedContentManager.isDefaultExperienceSelected()&&
CQ.TargetedContentManager.showOfferActions()&&editable.getChildren().length>1}}),"SELECT_PARENT":selectParentAction};var targetResponsiveGridActions=$.extend({},targetParsysActions);var targetComponentActions={"MSM_CANCEL_INHERITANCE":new ns.ui.ToolbarAction({icon:MSM.MSMCommons.Constants.ICON_LOCKED,text:Granite.I18n.getMessage("Cancel Inheritance"),execute:function(editable,param,target){_showConfirmationModal(editable,target)},condition:function(editable){return _renderInheritanceToggleCondition(editable,
"MSM_CANCEL_INHERITANCE")}}),"MSM_REENABLE_INHERITANCE":new ns.ui.ToolbarAction({icon:MSM.MSMCommons.Constants.ICON_UNLOCKED,text:Granite.I18n.getMessage("Re-enable Inheritance"),execute:function(editable,param,target){_showConfirmationModal(editable,target)},condition:function(editable){return _renderInheritanceToggleCondition(editable,"MSM_REENABLE_INHERITANCE")}}),"DISABLE_TARGET":new ns.ui.ToolbarAction({icon:"exclude",text:Granite.I18n.getMessage("Disable targeting"),execute:function(editable){var targetParent=
CQ.TargetedContentManager.getTargetParent(editable);if(typeof targetParent!=="undefined")$.get(targetParent.path+"/default.json").done(function(data,jqXHR){CQ.TargetedContentManager.targetComponent(targetParent,true,data["sling:resourceType"])}).fail(function(reason){CQ.TargetedContentManager.ui.showOperationResult("Failed to disable targeting",true,reason.statusText)})},condition:function(editable){if(!ns.pageInfoHelper.canModify())return false;if(!_isLiveCopyCancelled(editable))return false;if(CQ.TargetedContentManager.isInParsys(editable))return false;
var targetParent=CQ.TargetedContentManager.getTargetParent(editable);return typeof targetParent!=="undefined"||CQ.TargetedContentManager.isTargetComponent(editable["type"])}}),"DELETE_OFFER":new ns.ui.ToolbarAction({icon:"closeCircle",text:Granite.I18n.getMessage("Remove offer from activity"),execute:function(editable){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);CQ.TargetedContentManager.deleteOffer(targetEditable)})},
condition:function(editable){return!CQ.TargetedContentManager.isDefaultExperienceSelected()&&CQ.TargetedContentManager.showOfferActions()&&CQ.TargetedContentManager.hasOffer(editable)&&editable.dom&&(editable.dom.hasClass("target")||editable.dom.hasClass("targeted"))}}),"ADD_OFFER":new ns.ui.ToolbarAction({icon:"add",text:Granite.I18n.getMessage("Add offer"),execute:function(editable){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);
if(typeof targetEditable!=="undefined")CQ.TargetedContentManager.createOffer(targetEditable)})},condition:function(editable){return CQ.TargetedContentManager.currentActivity!==null&&CQ.TargetedContentManager.showOfferActions()&&!CQ.TargetedContentManager.hasOffer(editable)&&editable.dom&&(editable.dom.hasClass("target")||editable.dom.hasClass("targeted"))}}),"CHOOSE_OFFER":new ns.ui.ToolbarAction({icon:"folder",text:Granite.I18n.getMessage("Choose from offer library"),execute:function(editable,whatever,
element){CQ.OfferPicker.loadOfferPicker(CQ.TargetedContentManager.getCurrentBrand(),editable,element)},condition:function(editable){if(!_isLiveCopyCancelled(editable))return false;return CQ.TargetedContentManager.currentActivity!==null&&CQ.TargetedContentManager.showOfferActions()&&!CQ.TargetedContentManager.hasOffer(editable)&&editable.dom&&(editable.dom.hasClass("target")||editable.dom.hasClass("targeted"))}}),"TARGET_COMPONENT_OPTIONS":new ns.ui.ToolbarAction({icon:"gear",text:Granite.I18n.getMessage("Target component settings"),
execute:function(editable){ns.DialogFrame.openDialog(new ns.edit.Dialog(editable))},condition:function(editable){if(!_isLiveCopyCancelled(editable))return false;return true}}),"MAKE_INLINE_OFFER":new ns.ui.ToolbarAction({icon:"linkOff",text:Granite.I18n.getMessage("Convert to inline offer"),execute:function(editable){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){CQ.TargetedContentManager.convertInlineOffer(editable)})},condition:function(editable){if(!_isLiveCopyCancelled(editable))return false;
return CQ.TargetedContentManager.hasLockedOffer(editable)}}),"EDIT_IN_NEW_TAB":new ns.ui.ToolbarAction({icon:"edit",text:Granite.I18n.getMessage("Open in new tab for editing"),execute:function(editable){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){CQ.TargetedContentManager.editOfferNewTab(editable)})},condition:function(editable){if(_isPageOwnedContent(editable)&&!_isLiveCopyCancelled(editable))return false;return CQ.TargetedContentManager.hasLockedOffer(editable)}}),"SELECT_PARENT":selectParentAction};
var defaultEditableActions={"MSM_CANCEL_INHERITANCE":new ns.ui.ToolbarAction({icon:MSM.MSMCommons.Constants.ICON_LOCKED,text:Granite.I18n.getMessage("Cancel Inheritance"),execute:function(editable,param,target){_showConfirmationModal(editable,target)},condition:function(editable){if(CQ.TargetedContentManager.isInParsys(editable))return false;return _renderInheritanceToggleCondition(editable,"MSM_CANCEL_INHERITANCE")}}),"MSM_REENABLE_INHERITANCE":new ns.ui.ToolbarAction({icon:MSM.MSMCommons.Constants.ICON_UNLOCKED,
text:Granite.I18n.getMessage("Re-enable Inheritance"),execute:function(editable,param,target){_showConfirmationModal(editable,target)},condition:function(editable){if(CQ.TargetedContentManager.isInParsys(editable))return false;return _renderInheritanceToggleCondition(editable,"MSM_REENABLE_INHERITANCE")}}),"INSERT":new ns.ui.ToolbarAction({name:"INSERT",icon:"add",text:Granite.I18n.get("Insert component"),execute:function openInsertDialog(editable){ns.edit.ToolbarActions.INSERT.execute.call(this,
editable)},condition:function(editable){if(_isPageOwnedContent(editable)&&!_isLiveCopyCancelled(editable))return false;return ns.edit.ToolbarActions.INSERT.condition(editable)&&CQ.TargetedContentManager.isInParsys(editable)},isNonMulti:true}),"TARGET":new ns.ui.ToolbarAction({icon:"targeted",text:Granite.I18n.getMessage("Target"),execute:function(editable,param,target){CQ.TargetedContentManager.targetComponent(editable,false)},condition:function(editable){if(!ns.pageInfoHelper.canModify())return false;
if(!_isLiveCopyCancelled(editable))return false;if(CQ.TargetedContentManager.isInParsys(editable))return false;return!editable.config.editConfig["disableTargeting"]&&CQ.TargetedContentManager.currentActivity!==null&&!CQ.TargetedContentManager.isParSys(editable["type"])&&editable.config.editConfig["actions"]&&editable.config.editConfig["actions"].length>0&&!CQ.TargetedContentManager.getTargetParent(editable)}}),"DISABLE_TARGET":new ns.ui.ToolbarAction({icon:"exclude",text:Granite.I18n.getMessage("Disable targeting"),
execute:function(editable,param,target){var targetParent=CQ.TargetedContentManager.getTargetParent(editable);if(typeof targetParent!=="undefined")CQ.TargetedContentManager.targetComponent(targetParent,true)},condition:function(editable){if(!ns.pageInfoHelper.canModify())return false;if(!_isLiveCopyCancelled(editable))return false;if(CQ.TargetedContentManager.isInParsys(editable))return false;var targetParent=CQ.TargetedContentManager.getTargetParent(editable);return typeof targetParent!=="undefined"||
CQ.TargetedContentManager.isTargetComponent(editable["type"])}}),"DELETE_OFFER":new ns.ui.ToolbarAction({icon:"closeCircle",text:Granite.I18n.getMessage("Remove offer from activity"),execute:function(editable){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);CQ.TargetedContentManager.deleteOffer(targetEditable)})},condition:function(editable){if(CQ.TargetedContentManager.isInParsys(editable))return false;return typeof CQ.TargetedContentManager.getTargetParent(editable)!=
"undefined"&&CQ.TargetedContentManager.showOfferActions()&&!CQ.TargetedContentManager.hasLockedOffer(editable)&&!CQ.TargetedContentManager.isDefaultExperienceSelected()}}),"SAVE_OFFER":new ns.ui.ToolbarAction({icon:"upload",text:Granite.I18n.getMessage("Save offer to offer library"),execute:function(editable){CQ.ui.TargetedContentManagerUi.doSaveToOfferLibrary(editable)},condition:function(editable){if(CQ.TargetedContentManager.isInParsys(editable))return false;var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);
return typeof targetEditable!=="undefined"&&!CQ.TargetedContentManager.isDefaultExperienceSelected()&&CQ.TargetedContentManager.showOfferActions()&&CQ.TargetedContentManager.hasOffer(editable)}}),"ADD_OFFER":new ns.ui.ToolbarAction({icon:"add",text:Granite.I18n.getMessage("Add offer"),execute:function(editable){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);if(typeof targetEditable!=="undefined")CQ.TargetedContentManager.createOffer(targetEditable)})},
condition:function(editable){if(CQ.TargetedContentManager.isInParsys(editable))return false;if(CQ.TargetedContentManager.currentActivity===null)return false;var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);return typeof targetEditable!=="undefined"&&CQ.TargetedContentManager.showOfferActions()&&!CQ.TargetedContentManager.hasOffer(targetEditable)}}),"EDIT":new ns.ui.ToolbarAction({icon:"edit",text:Granite.I18n.get("Edit"),execute:function(editable,param,target){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){ns.edit.actions.doInPlaceEdit(editable)});
if(editable.config.editConfig.inplaceEditingConfig.editorType==="hybrid")return false},condition:function(editable){if(_isPageOwnedContent(editable)&&!_isLiveCopyCancelled(editable))return false;return ns.pageInfoHelper.canModify()&&editable.hasAction("EDIT")&&editable.canInPlaceEdit()},isNonMulti:true}),"CONFIGURE":new ns.ui.ToolbarAction({icon:"wrench",text:Granite.I18n.get("Configure"),execute:function(editable,param,target){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){ns.edit.actions.doConfigure(editable)})},
condition:function(editable){if(_isPageOwnedContent(editable)&&!_isLiveCopyCancelled(editable))return false;return ns.pageInfoHelper.canModify()&&editable.hasAction("CONFIGURE")&&!!editable.config.dialog},isNonMulti:true}),"DELETE":new ns.ui.ToolbarAction({icon:"delete",text:Granite.I18n.getMessage("Delete"),execute:function(editable,param,target){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){ns.selection.deselectAll();ns.edit.actions.doDelete([editable])})},condition:function(editable){if(_isPageOwnedContent(editable)&&
!_isLiveCopyCancelled(editable))return false;return CQ.TargetedContentManager.isInParsys(editable)&&!CQ.TargetedContentManager.isParSys(editable["type"])}}),"TARGET_COMPONENT_OPTIONS":new ns.ui.ToolbarAction({icon:"gear",text:Granite.I18n.getMessage("Target component settings"),execute:function(editable){var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);ns.DialogFrame.openDialog(new ns.edit.Dialog(targetEditable))},condition:function(editable){if(!_isLiveCopyCancelled(editable))return false;
if(CQ.TargetedContentManager.isInParsys(editable))return false;var targetEditable=CQ.TargetedContentManager.getTargetParent(editable);return typeof targetEditable!=="undefined"}}),"SELECT_PARENT":selectParentAction,"LAYOUT":new ns.ui.ToolbarAction({name:"LAYOUT",icon:"switch",order:"last",text:Granite.I18n.get("Layout"),execute:function(editable){ns.edit.ToolbarActions.LAYOUT.execute.call(this,editable)},condition:function(editable){if(_isPageOwnedContent(editable)&&!_isLiveCopyCancelled(editable))return false;
return ns.edit.ToolbarActions.LAYOUT.condition.call(this,editable)&&CQ.TargetedContentManager.isInParsys(editable)},render:function(dom){return ns.edit.ToolbarActions.LAYOUT.render.call(this,dom)},isNonMulti:true})};ns.TargetingActions={};ns.TargetingActions[CQ.TargetingConstants.TARGET_PARSYS_RTYPE]=targetParsysActions;ns.TargetingActions[CQ.TargetingConstants.TARGET_RESPONSIVEGRID_RTYPE]=targetResponsiveGridActions;ns.TargetingActions[CQ.TargetingConstants.TARGET_COMPONENT_RTYPE]=targetComponentActions;
ns.TargetingActions[CQ.TargetingConstants.TARGET_RESPONSIVEGRID_COMPONENT_RTYPE]=targetComponentActions;ns.TargetingActions["default"]=defaultEditableActions})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var actions={};ns.TargetingToolbar=function(){ns.TargetingToolbar.super_.constructor.call(this,arguments);this.isDisabled=false};ns.util.inherits(ns.TargetingToolbar,ns.ui.Toolbar);ns.TargetingToolbar.prototype.init=function(){return ns.TargetingToolbar.super_.init.call(this,{actions:actions})};ns.TargetingToolbar.prototype.render=function(editable){this.dom.empty();if(CQ.TargetedContentManager.isTargetedContainerComponent(editable.type)||CQ.TargetedContentManager.isTargetComponent(editable.type))this.config.actions=
ns.TargetingActions[editable.type];else this.config.actions=ns.TargetingActions["default"];var self=this;$.each(this.config.actions,function(actionId,actionObject){ns.TargetingToolbar.super_.appendButton.call(self,editable,actionId,actionObject)});return this};ns.TargetingToolbar.prototype.destroy=function(){ns.TargetingToolbar.super_.destroy.apply(this,arguments)};ns.TargetingToolbar.prototype.registerAction=function(){ns.TargetingToolbar.super_.registerAction.apply(this,arguments)};ns.TargetingToolbar.prototype.checkActionCondition=
function(actionName,editable){var actionObj=this.config.actions[actionName]||$.grep(editable.config.editConfig.actions,function(item){return item&&item.name===action})[0];return actionObj&&actionObj.condition&&actionObj.condition(editable)};ns.TargetingToolbar.prototype.position=function(editable){return ns.TargetingToolbar.super_.position.apply(this,arguments)}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var debugMode=window.location.href.indexOf("?debug-target-mode\x3dtrue")>=0||window.location.href.indexOf("\x26debug-target-mode\x3dtrue")>=0;function _debug(args){if(debugMode)console.log(args)}var overlayClass="cq-Overlay",overlayComponentClass="cq-Overlay--component",overlayContainerClass="cq-Overlay--container",overlayPlaceholderClass="cq-Overlay--placeholder",overlayParsysNewPlaceholder="cq-Overlay--placeholder--targetparsys",overlayDropTargetClass="cq-droptarget",
overlayDraggableClass="cq-draggable",overlayTargetedClass="targeted",dropTargetClass="cq-droptarget",subDropTargetClass="cq-subdroptarget cq-Overlay-subdroptarget";var CUSTOM_OFFER_TEXT=Granite.I18n.get("Custom offer"),LOCKED_OFFER_TEXT=Granite.I18n.get("Library offer"),ADD_OFFER_TEXT=Granite.I18n.get("Add offer");function _getOverlayIcon($refDom){var $icon=$refDom.find(".targeting-icon-overlay");if($icon.size()===0){$icon=$("\x3cdiv\x3e\x3c/div\x3e");$icon.addClass("targeting-icon-overlay")}else $icon.empty();
return $icon}function getLockedIconOverlay($refDom){var $icon=_getOverlayIcon($refDom);var icon=(new Coral.Icon).set({icon:"folder"});$icon.append(icon).append($("\x3cspan\x3e").html(LOCKED_OFFER_TEXT));$refDom.append($icon);return $icon}function getCustomOfferOverlay($refDom){var $icon=_getOverlayIcon($refDom);var icon=(new Coral.Icon).set({icon:"linkOff"});$icon.append(icon).append($("\x3cspan\x3e").html(CUSTOM_OFFER_TEXT));$refDom.append($icon);return $icon}ns.TargetingOverlay=function(editable,
container){ns.TargetingOverlay.super_.constructor.call(this,editable,container)};ns.util.inherits(ns.TargetingOverlay,ns.ui.Overlay);ns.TargetingOverlay.prototype.prepareRendering=function(editable){var disabled=!editable.hasActionsAvailable();var orderable=editable.config.editConfig&&editable.config.editConfig.orderable;var def={disabled:disabled,container:editable.config.isContainer,orderable:orderable,draggable:orderable,dropTarget:!disabled&&editable.config.isDropTarget,placeholder:editable.hasPlaceholder()};
return def};ns.TargetingOverlay.prototype.render=function(editable,container){_debug("[TargetingOverlay] Rendering overlay for "+editable.path);var placeholder;var cssClass=overlayClass+" "+overlayComponentClass;var attr={"data-type":editable.getTypeName(),"data-path":editable.path,"tabindex":0};var isTarget=CQ.TargetedContentManager.isTargetComponent(editable.type);var renderDef=this.prepareRendering(editable);cssClass=renderDef.container?cssClass+" "+overlayContainerClass:cssClass;cssClass=renderDef.orderable?
cssClass+" "+overlayDraggableClass:cssClass;cssClass=renderDef.disabled?cssClass+" is-disabled":cssClass;attr.draggable=renderDef.draggable;cssClass=renderDef.dropTarget?cssClass+" "+overlayDropTargetClass:cssClass;cssClass=isTarget?cssClass+" "+overlayTargetedClass:cssClass;placeholder=renderDef.placeholder;if(placeholder){cssClass+=" "+overlayPlaceholderClass;if(editable.getParent()&&CQ.TargetedContentManager.isTargetedContainerComponent(editable.getParent().type)){placeholder+=" (targeted)";cssClass+=
" "+overlayParsysNewPlaceholder}attr["data-text"]=placeholder}attr["class"]=cssClass;var dom=$("\x3cdiv/\x3e",attr);this.renderName(editable,dom);this.renderDropTargets(editable,dom);this.renderLayoutHandles(editable,dom);return dom};ns.TargetingOverlay.prototype.renderDropTargets=function(editable,container){var targetComponent=CQ.TargetedContentManager.getTargetParent(editable);if(targetComponent===null)return;var dropTarget=editable.getDropTarget();if(dropTarget)$.each(dropTarget,function(i,target){target.overlay=
$("\x3cdiv/\x3e",{"class":dropTargetClass+" "+subDropTargetClass,"draggable":true,"data-asset-accept":JSON.stringify(target.accept),"data-asset-groups":JSON.stringify(target.groups),"data-asset-id":target.id,"data-path":editable.path}).appendTo(container)})};ns.TargetingOverlay.prototype.renderLayoutHandles=function(editable,container){var parent=ns.editables.getParent(editable);if(parent&&ns.responsive.isResponsiveGrid(parent)){if(!editable.isNewSection())var handleLeft=$("\x3cdiv/\x3e",{"class":"editor-ResponsiveGrid-overlay-resizeHandle editor-ResponsiveGrid-overlay-resizeHandle--left",
"data-edge":"left"}),handleRight=$("\x3cdiv/\x3e",{"class":"editor-ResponsiveGrid-overlay-resizeHandle editor-ResponsiveGrid-overlay-resizeHandle--right","data-edge":"right"});container.append(handleLeft).append(handleRight)}};ns.TargetingOverlay.prototype.position=function(editable,parent){var estate=editable.getArea();if(estate){if(this.currentPos&&this.currentPos.top===estate.top&&this.currentPos.left===estate.left&&this.currentPos.width===estate.width&&this.currentPos.height===estate.height&&
this.currentPos.parent.top===(parent&&parent.overlay&&parent.overlay.currentPos?parent.overlay.currentPos.top:0)&&this.currentPos.parent.left===(parent&&parent.overlay&&parent.overlay.currentPos?parent.overlay.currentPos.left:0))return;var width=estate.width;if(parent&&CQ.TargetedContentManager.isTargetedContainerComponent(parent.type))width=estate.width-4;this.dom.css({top:parent&&parent.overlay&&parent.overlay.currentPos?estate.top-parent.overlay.currentPos.top:estate.top,left:parent&&parent.overlay&&
parent.overlay.currentPos?estate.left-parent.overlay.currentPos.left:estate.left,width:width,height:estate.height});this.currentPos=estate;this.currentPos.parent={top:parent&&parent.overlay&&parent.overlay.currentPos?parent.overlay.currentPos.top:0,left:parent&&parent.overlay&&parent.overlay.currentPos?parent.overlay.currentPos.left:0}}this.positionDropTargets(editable,this);return this.dom};ns.TargetingOverlay.prototype.positionDropTargets=function(editable,parent){var self=this,dropTarget=editable.getDropTarget();
if(dropTarget){$.each(dropTarget,function(i,target){if(!target.dom)return;var offset=target.dom.offset();offset.width=this.dom.outerWidth();offset.height=this.dom.outerHeight();target.overlay.css({top:offset.top-parent.currentPos.top,left:offset.left-parent.currentPos.left,width:offset.width>parent.currentPos.width?parent.currentPos.width:offset.width,height:offset.height>parent.currentPos.height?parent.currentPos.height:offset.height})});this.dropTargets=dropTarget}};ns.TargetingOverlay.prototype.remove=
function(){if(this.dropTargets)$.each(this.dropTargets,function(i,target){if(target.overlay)target.overlay.remove()});ns.TargetingOverlay.super_.remove.apply(this,arguments)};ns.TargetingOverlay.prototype.setEmptyOverlay=function(empty){this.dom.toggleClass("no-offer",empty);if(empty)$(this.dom).attr("empty-content",ADD_OFFER_TEXT)};ns.TargetingOverlay.prototype.setLockedOffer=function(lock){var $thisDom=$(this.dom),$icon;if(lock)$icon=getLockedIconOverlay($thisDom);else $icon=getCustomOfferOverlay($thisDom);
$icon.show()};ns.TargetingOverlay.prototype.toggleOverlayIcon=function(show){var $icon=_getOverlayIcon($(this.dom));if(show)$icon.show();else $icon.hide()};ns.TargetingOverlay.prototype.setTargeted=function(){this.dom.toggleClass("targeted")};ns.TargetingOverlay.prototype.removeDropTarget=function(){this.dom.removeClass(overlayDropTargetClass);$(this.dom).find("\x3e .cq-Overlay-subdroptarget").remove()}})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var debugMode=window.location.href.indexOf("?debug-target-mode\x3dtrue")>=0||window.location.href.indexOf("\x26debug-target-mode\x3dtrue")>=0;function setUpSidePanel(){ns.ui.SidePanel.showContent("js-SidePanel-content--edit");ns.ui.SidePanel.restore()}function _debug(args){if(debugMode)console.log(args)}ns.LAYER_CONFIG={name:"Targeting",iconClass:"targeted",title:Granite.I18n.get("Targeting","title of authoring layer"),toolbarConstructor:ns.TargetingToolbar,
overlayConstructor:ns.TargetingOverlay,sidePanel:{setUp:setUpSidePanel},interactions:ns.edit.Interactions};var bindEventListeners=function(){return this};var unbindEventListeners=function(){return this};var _overrideComponentController=function(){var componentController=ns.dropController.get(ns.Component.prototype.getTypeName());componentController.handleDrop=function(event){var components=ns.components.find($(event.origin).attr("data-path")),editableNeighbor=event.currentDropTarget.targetEditable,
insertBehavior=event.currentDropTarget.insertBehavior;var targetEditable=editableNeighbor;if(CQ.TargetedContentManager.isTargetComponent(editableNeighbor.type)){var children=editableNeighbor.getChildren();$.each(children,function(i,e){if(e.type==="foundation/components/parsys/new"){targetEditable=e;insertBehavior="before"}})}if(components.length>0)ns.edit.actions.doInsert(components[0],insertBehavior,targetEditable)}};var oldImageHandleDrop=undefined;var oldImageIsInsertAllowed=undefined;var _overrideImageDropController=
function(){var assetController=ns.dropController.get("Images");assetController.isInsertAllowed=function(event){var target=$(event.target);var editablePath=target.data("path");if(oldImageIsInsertAllowed){var isTargetedComponent=false;$.each(ns.editables,function(index,editable){if(editable.path===editablePath){var targetParent=CQ.TargetedContentManager.getTargetParent(editable);isTargetedComponent=!!targetParent;return false}});var allowCheck=isTargetedComponent||CQ.TargetedContentManager.isDefaultExperienceSelected();
if(!allowCheck)return false;return oldImageIsInsertAllowed.call(assetController,event)}return false};assetController.handleDrop=function(event){TargetingUI.MultiSiteTargeting.ensureInheritanceBroken(function(){if(oldImageHandleDrop)oldImageHandleDrop.call(assetController,event)})}};var _overrideStoreGetParent=function(scope){ns.editables.getParent=function(inspectable,all){if(CQ.TargetedContentManager.isTargetComponent(inspectable.type)||inspectable.type===CQ.TargetingConstants.TEASER_RT)return scope.oldGetParent.apply(this,
arguments);var foundParent=scope.oldGetParent.apply(this,arguments);if(!foundParent||Array.isArray(foundParent)&&foundParent.length==0){var $editable=$(inspectable.dom);if($editable){var parent;if(inspectable.type===CQ.TargetingConstants.TARGET_PARSYS_RTYPE||inspectable.type===CQ.TargetingConstants.TARGET_RESPONSIVEGRID_RTYPE)parent=$editable.parents(".target").get(0);else{parent=$editable.parents(".targetparsys").get(0);if(!parent)parent=$editable.parents(".target").get(0)}if(parent){var parentEditablePath=
$(parent).children("cq");var storeEditables=this.find({path:parentEditablePath.attr("data-path")});return all?storeEditables:storeEditables[0]}}}return foundParent}};var _overrideStoreGetChildren=function(scope){ns.editables.getChildren=function(inspectable){if(!CQ.TargetedContentManager.isTargetComponent(inspectable.type))return scope.oldGetChildren.apply(this,arguments);var innerEditables=inspectable&&inspectable.dom?inspectable.dom.find("cq"):undefined,kids=[],store=this;if(innerEditables&&innerEditables.length>
0)$.each(innerEditables,function(i,e){var dataPath=$(e).attr("data-path");if(dataPath!==inspectable.path){var kidEditable=store.find({path:$(e).attr("data-path")});if(kidEditable&&kidEditable.length>0)kids.push(kidEditable[0])}});return kids}};var dropControllerEnabled=false;var enableDropController=function(ns){if(!dropControllerEnabled){ns.dropController.enable();dropControllerEnabled=true}};var disableDropController=function(ns){ns.dropController.disable();dropControllerEnabled=false};ns.TargetingLayer=
ns.util.extendClass(ns.Layer,{constructor:function TargetingLayer(){var config;if(arguments[0]===undefined||typeof arguments[0]==="object")config=arguments[0];else config={name:arguments[0],iconClass:arguments[1],overlayConstructor:arguments[2],toolbarConstructor:arguments[3],title:arguments[4]};var actualConfig=$.extend({},ns.LAYER_CONFIG,config);ns.TargetingLayer.super_.constructor.call(this,actualConfig)},isAvailable:function(){_debug("[Targeting Layer] Determining if Target mode is available...");
var canEdit=true,canTarget=true,hasClientContext=true,hasContextHub=true;if(ns.page&&ns.pageInfo){if(ns.pageInfo.status&&ns.pageInfo.status.isLocked){canEdit=ns.ContentFrame&&ns.ContentFrame.contentWindow.CQ.shared.User.data.userID===ns.pageInfo.status.lockOwner;_debug("[Targeting Layer] User has edit privileges..."+canEdit)}if(ns.pageInfo.isTargetable){canTarget=ns.pageInfo.isTargetable=="true";_debug("[Targeting Layer] Page is targetable as per page info..."+canTarget)}}var cc=CQ.TargetedContentManager.ClientContext;
hasClientContext=cc!==null&&typeof cc!=="undefined";_debug("[Targeting Layer] Client context available (optional)..."+hasClientContext);var ch=CQ.TargetedContentManager.ContextHub;hasContextHub=ch!==null&&typeof ch!=="undefined";_debug("[Targeting Layer] ContextHub available (mandatory)..."+hasContextHub);var layerName=ns.preferences.cookie.get("cq-editor-layer");var isScaffolding=typeof layerName!=="undefined"&&layerName==="Scaffolding";return canEdit&&canTarget&&(hasClientContext||hasContextHub||
isScaffolding)},setUp:function(){var that=this;disableDropController(ns);ns.selection.unbindEvents(this.interactions);if(!ns.TargetedContentEventingManager.isSetupAllowed()){_debug("[TargetingLayer][setUp] Set up not allowed, waiting for 'targeting-layer-setup-allowed' event");channel.one("targeting-layer-setup-allowed",function(){that.setUp()});return}else _debug("[TargetingLayer][setUp] Set up is allowed");ns.TargetedContentEventingManager.setUpStart();_debug("[TargetingLayer][setUp] Starting set up");
$("#TargetEditorContent").show();this.oldGetParent=ns.editables.getParent;this.oldGetChildren=ns.editables.getChildren;this.oldHandleDrop=ns.dropController.get(ns.Component.prototype.getTypeName()).handleDrop;oldImageHandleDrop=ns.dropController.get("Images").handleDrop;oldImageIsInsertAllowed=ns.dropController.get("Images").isInsertAllowed;_overrideStoreGetParent(that);_overrideStoreGetChildren(that);_overrideComponentController();_overrideImageDropController();var targetedEditables=0;ns.overlayManager.teardown();
$.each(ns.editables,function(index,editable){if(CQ.TargetedContentManager.isTargetComponent(editable.type)){editable.overlay=null;CQ.TargetedContentManager.rememberEditable(editable);targetedEditables++}});ns.overlayManager.setup();if(targetedEditables>0)channel.on("targeted-editable-loaded",function(e){targetedEditables--;if(targetedEditables==0){_debug("[TargetingLayer][setUp] All targeted editables initialized, triggering 'targeted-editables-initialized' event");channel.trigger("targeted-editables-initialized")}});
else{_debug("[TargetingLayer][setUp] All targeted editables initialized, triggering 'targeted-editables-initialized' event");channel.trigger("targeted-editables-initialized")}channel.off("targeting-ui-experience-rail-shown.layer-setup").on("targeting-ui-experience-rail-shown.layer-setup",function(event){ns.selection.bindEvents(that.interactions);enableDropController(ns)});channel.off("targeting-ui-experience-rail-hidden.layer-teardown").on("targeting-ui-experience-rail-hidden.layer-teardown",function(event){ns.selection.unbindEvents(that.interactions);
disableDropController(ns)});_debug("[TargetingLayer][setUp] Triggering 'targeting-layer-on' event");channel.trigger("targeting-layer-on");_debug("[TargetingLayer][setUp] Set up complete!")},tearDown:function(){var that=this;_debug("[TargetingLayer][tearDown] Starting tear down...");if(!ns.TargetedContentEventingManager.isTearDownAllowed()){_debug("[TargetingLayer][tearDown] Tear down not allowed, waiting for 'targeting-layer-teardown-allowed' event");channel.one("targeting-layer-teardown-allowed",
function(){that.tearDown()});return}else _debug("[TargetingLayer][tearDown] Tear down is allowed");ns.TargetedContentEventingManager.tearDownStart();$("#TargetEditorContent").show();_debug("[TargetingLayer][tearDown] Triggering 'targeting-layer-off' event");channel.trigger("targeting-layer-off");ns.editables.getParent=this.oldGetParent;ns.editables.getChildren=this.oldGetChildren;ns.dropController.get(ns.Component.prototype.getTypeName()).handleDrop=this.oldHandleDrop;ns.dropController.get("Images").handleDrop=
oldImageHandleDrop;ns.dropController.get("Images").isInsertAllowed=oldImageIsInsertAllowed;enableDropController(ns);_debug("[TargetingLayer][tearDown] Tear down complete, triggering 'targeting-layer-teardown-complete' event!");channel.trigger("targeting-layer-teardown-complete")}});_debug("[TargetingLayer] Script loaded");ns.layerManager.registerLayer(new ns.TargetingLayer)})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window){ns.target.TargetingActions.REFRESH=new ns.ui.EditableAction({execute:function doRefresh(editable,config){function process(editable){var deferred=$.Deferred(),curComponent;ns.persistence.readParagraph(editable,config).done(function(dom){curComponent=ns.components.find({resourceType:editable.type});dom=ns.editableHelper.updateDom(curComponent[0],dom,editable);ns.ContentFrame.executeCommand(editable.path,"replace",dom).done(function(){var newDom=ns.ContentFrame.getEditableNode(editable.path);
var newEditables=ns.ContentFrame.getEditables(newDom);var newChildren=newEditables.filter(function(newEditable){return newEditable.path!==editable.path});editable.dom=newDom;editable.updateConfig(ns.configParser(ns.ContentFrame.getEditableConfigNode(editable.path).data("config")));ns.editables.remove(ns.editables.getChildren(editable));ns.editables.add(newChildren,{editableNeighbor:editable});ns.overlayManager.recreate(editable);return deferred.resolve()})});return deferred.promise(editable)}return ns.editableHelper.overlayCompleteRefresh(process(editable))}})})(jQuery,
Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){function createOffer(editable,offerPath,location,experienceUrl){var params={"location":location,"parentPath":experienceUrl,"offerPath":offerPath};$.post("/libs/cq/personalization/touch-ui/content/targeteditor",params).success(function(res){channel.trigger($.Event("cq-reusableoffer-dropped",{"editable":editable}))}).fail(function(res){console.error("Fail to add the offer -\x3e ",res.responseText)})}channel.on("offerpicker-offer-chosen",function(event){var editable=
event.currentEditable,targetParent=ns.TargetedContentManager.getTargetParent(editable),experienceUrl=ns.TargetedContentManager.selectedExperience[ns.ExperienceFactory.props.PATH];if(!targetParent)return;var sourceOffer=event.offerPath,location=ns.TargetedContentManager.getEditableLocationName(targetParent);createOffer(targetParent,sourceOffer,location,experienceUrl)})})(jQuery,window.CQ,jQuery(document),this);
(function($,ns,channel){var OFFER_PICKER_PATH="/mnt/overlay/cq/personalization/touch-ui/content/commons/offerpicker/picker.html";var offerPicker=function($,ns,channel){var instance={currentEditable:null};function handleSelections(control,state,selections){if(selections&&selections.length>0)selections.forEach(function(element){channel.trigger($.Event("offerpicker-offer-chosen",{offerPath:element.value,currentEditable:instance.currentEditable}))})}function show(control,state){state.api.attach(this);
state.api.pick(control[0],[]).then(function(selections){state.api.detach();state.open=false;state.el=null;handleSelections(control,state,selections)},function(){cancel(control,state)});if("focus"in state.api)state.api.focus(last);else state.el.focus();state.open=true}function cancel(control,state){state.api.detach();state.open=false;state.el=null}function getState(control){var KEY_STATE="personalization-offer-picker-control.internal.state";var state=control.data(KEY_STATE);if(!state){state={el:null,
open:false,loading:false};control.data(KEY_STATE,state)}return state}function loadOfferPicker(offerLibraryPath,element){var control=$(element);var state=getState(control);if(state.loading)return;if(state.el)if(state.open){state.api.cancel();cancel(control,state)}else show(control,state);else{var src=OFFER_PICKER_PATH+"?root\x3d"+offerLibraryPath+"\x26filter\x3d\x26selectionCount\x3dsingle";state.loading=true;$.ajax({url:src,cache:false}).then(function(html){return $(window).adaptTo("foundation-util-htmlparser").parse(html)}).then(function(fragment){return $(fragment).children()[0]}).then(function(pickerEl){state.loading=
false;state.el=pickerEl;state.api=$(pickerEl).adaptTo("foundation-picker");show(control,state)},function(){state.loading=false})}}instance.loadOfferPicker=function(brandPath,editable,element){if(!brandPath||typeof brandPath==="undefined")return;var currentPagePath=editable.path.replace(/^(.*?)\/jcr:content.*$/,"$1");$.get(brandPath+"/jcr:content.offerlibrary.json",{currentPagePath:currentPagePath}).done(function(data,status,xhr){if(data["path"]!==""){instance.currentEditable=editable;loadOfferPicker(data["path"],
editable,element)}else{var error="Error opening the offer picker",msg="There's no offer library defined under brand "+brandPath+". Define an offer library using the Personalization console.";ns.ui.TargetedContentManagerUi.showOperationResult(error,true,msg)}}).fail(function(response){var error="Error opening the offer picker",msg="Server error ("+response+")";ns.ui.TargetedContentManagerUi.showOperationResult(error,true,msg)})};return instance};ns.OfferPicker=offerPicker($,ns,channel)})(jQuery,window.CQ,
jQuery(document));
(function($,ns,channel,window,undefined){var self={},name="Design Packages";self.searchRoot="/content/dam";var searchPath=self.searchRoot,servlet="/bin/wcm/contentfinder/asset/view.html",itemResourceType="wcm/designimporter/components/asset";self.loadAssets=function(query,lowerLimit,upperLimit){var param={"_dc":(new Date).getTime(),"query":query.concat('order:"-jcr:content/jcr:lastModified" '),"mimeType":"application/zip,application/x-zip,application/x-zip-compressed","itemResourceType":itemResourceType,"limit":lowerLimit+
".."+upperLimit,"_charset_":"utf-8"};return $.ajax({type:"GET",dataType:"html",url:Granite.HTTP.externalize(servlet)+searchPath,data:param})};self.setServlet=function(servlet){servlet=servlet};self.setSearchPath=function(spath){searchPath=spath};self.setItemResourceType=function(rt){itemResourceType=rt};self.resetSearchPath=function(){searchPath=self.searchRoot};ns.ui.assetFinder.register(name,self)})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var name="Design Packages";function DesignPackageDragAndDrop(){this.constructor.super_.constructor.apply(this,arguments)}ns.util.inherits(DesignPackageDragAndDrop,ns.ui.assetFinder.AssetDragAndDrop);DesignPackageDragAndDrop.prototype.handleDrop=function(event){channel.trigger("cq-designimporter-drop");var editable=event.currentDropTarget.targetEditable;ns.wcm.DesignImporter.importDesignPackage(editable.path,event.path)};DesignPackageDragAndDrop.prototype.handleDragEnter=
function(event){channel.trigger("cq-designimporter-dragenter")};DesignPackageDragAndDrop.prototype.handleDragLeave=function(event){channel.trigger("cq-designimporter-dragleave")};ns.ui.dropController.register(name,new DesignPackageDragAndDrop)})(jQuery,Granite.author,jQuery(document),this);
(function($,author,channel,window,undefined){author.afUtils=author.afUtils||{};author.afUtils.constants=author.afUtils.constants||{};author.afUtils.constants.FM_DAM_ROOT="/content/dam/formsanddocuments/";author.afUtils.constants.FM_AF_ROOT="/content/forms/af/";author.afUtils.getSearchStringAndFilters=function(){var $sidePanel=author.ui.SidePanel.$el,selectedFilters=author.ui.assetFinder.TagList.getSelectedTags(),$sidePanelAsset=$sidePanel.find(".sidepanel-tab-assets"),$search=$sidePanelAsset.find("#assetsearch"),
assetType="",tags="",searchString="";if($search.length&&$search[0].value.length)searchString=$search[0].value.trim();if(selectedFilters["assetType"]){$.map(selectedFilters["assetType"],function(value,key){assetType=assetType.concat(key);assetType=assetType.concat(",")});if(assetType.length>0)assetType=assetType.substring(0,assetType.lastIndexOf(","))}if(selectedFilters["jcr:content/metadata/cq:tags"]){$.map(selectedFilters["jcr:content/metadata/cq:tags"],function(value,key){tags=tags.concat(key);
tags=tags.concat(",")});if(tags.length>0)tags=tags.substring(0,tags.lastIndexOf(","))}return{query:searchString,assetType:assetType,tags:tags}};author.afUtils.isCurrentPageDeprecatedAD=function(){var deprecatedAdPageResourceType="fd/adaddon/components/page/base",isDeprecatedAdaptiveDocument=false;if(author.pageInfo&&author.pageInfoHelper)isDeprecatedAdaptiveDocument=_.isUndefined(author.pageInfoHelper.hasEditableTemplate())&&author.pageInfo.pageResourceType===deprecatedAdPageResourceType;return isDeprecatedAdaptiveDocument}})(jQuery,
Granite.author,jQuery(document),this);
(function($,author,channel,window,undefined){var self={},afAssetsEndPoint="/libs/fd/af/components/info.json",registryName="Adaptive Forms",isAfAuthoring=function(){var urlRe=new RegExp("/(?:editor\\.html|cf#)/content/(?:forms/af|dam/formsanddocuments)/");return urlRe.test(window.location.pathname)}(),isAppsAuthoring=function(){var urlRe=new RegExp("/(?:editor\\.html|cf#)/content/(?:phonegap|mobileapps)");return urlRe.test(window.location.pathname)}(),data_group='"General" ',requiredComponentType=
"";if(isAfAuthoring){requiredComponentType="panel";data_group='"Adaptive Form" '}else if(isAppsAuthoring){requiredComponentType="aemappsform";data_group='"PhoneGap" '}self.viewInAdminRoot="/editor.html{+item}.html";var searchPath=self.searchRoot="/content/dam/formsanddocuments";self.setSearchPath=function(spath){searchPath=spath};function formTemplate(data){var xssResourceType=CQ.shared.XSS.getXSSValue(data["sling:resourceType"]),xssFormRef=CQ.shared.XSS.getXSSValue(data.path),xssPath=xssFormRef!=
null?xssFormRef.replace(author.afUtils.constants.FM_DAM_ROOT,author.afUtils.constants.FM_AF_ROOT):"",xssImage=CQ.shared.HTTP.externalize(CQ.shared.XSS.getXSSValue(data.image)),xssAssetName=CQ.shared.XSS.getXSSValue(data.name);if(!_.isEmpty(window.guidelib)&&guidelib.author.formInfo.dataModelType===guidelib.touchlib.constants.FORM_DATA_MODEL_TYPE_XFA)return"";return"\x3ccoral-card class\x3d'editor-Card-asset card-asset cq-draggable u-coral-openhand' draggable\x3d'true' data-path\x3d'"+xssPath+"' data-resourceType\x3d'"+
xssResourceType+"' data-type\x3d'"+registryName+"' data-formRef\x3d'"+xssFormRef+"' data-title\x3d'"+xssAssetName+"' data-group\x3d'"+data_group+"'\x3e"+"\x3ccoral-card-asset\x3e\x3cimg  class\x3d'show-grid cq-dd-image' src\x3d'"+xssImage+"' alt\x3d'"+xssAssetName+"'\x3e\x3c/coral-card-asset\x3e"+"\x3ccoral-card-content\x3e  \x3ccoral-card-title class\x3d'foundation-collection-item-title' title\x3d'"+xssAssetName+"' \x3e"+xssAssetName+"\x3c/coral-card-title\x3e"+"\x3ccoral-icon class\x3d'editor-Card-viewInAdmin' icon\x3d'edit' size\x3d'XS' aria-label\x3d'Edit' title\x3d'Edit'\x3e \x3c/coral-icon\x3e "+
"\x3c/coral-card-content\x3e \x3c/coral-card\x3e"}self.loadAssets=function(query,lowerLimit,upperLimit){var def=$.Deferred(),data=author.afUtils.getSearchStringAndFilters();$.getJSON(Granite.HTTP.externalize(afAssetsEndPoint),{format:"json",type:"guide",start:lowerLimit,limit:upperLimit,query:data.query,assetType:data.assetType,tags:data.tags,filterPath:searchPath,requiredComponentType:requiredComponentType}).done(function(data){var output="",i;if(data!=null)for(i=0;i<data.fragRefs.length;i++)output+=
formTemplate(data.fragRefs[i]);def.resolve(output)});return def.promise()};self.abort=function(){};author.ui.assetFinder.register(registryName,self)})(jQuery,Granite.author,jQuery(document),this);
(function($,author,channel,window,undefined){var registryname="Adaptive Forms",isAfAuthoring=function(){var urlRe=new RegExp("/(?:editor\\.html|cf#)/content/(?:forms/af|dam/formsanddocuments)/");return urlRe.test(window.location.pathname)}();var FormDnD=function(){FormDnD.super_.constructor.apply(this,[arguments])};author.util.inherits(FormDnD,author.ui.ComponentDragAndDrop);FormDnD.prototype.isInsertAllowed=function(event){var resourceType=$(event.origin).attr("data-resourceType"),component=author.components.find({resourceType:resourceType})[0],
componentPath=component.getPath(),componentGroup="group:"+component.getGroup();return author.edit.EditableActions.INSERT.condition(event.currentDropTarget.targetEditable,componentPath,componentGroup)};FormDnD.prototype.handleDrop=function(event){var formRef=event.origin.getAttribute("data-formRef"),resourceType=$(event.origin).attr("data-resourceType"),options,components=author.components.find({resourceType:resourceType}),editableNeighbor=event.currentDropTarget.targetEditable,insertBehavior=event.currentDropTarget.insertBehavior;
if(isAfAuthoring)options={"./fragRef":formRef,"./formType":"adaptiveForm","./isForm":true};else options={"./formRef":formRef};if(components.length>0){var oldParams=components[0].getExtraParams();components[0].setExtraParams(options);author.editableHelper.doInsert(components[0],insertBehavior,editableNeighbor);components[0].setExtraParams(oldParams)}};author.ui.dropController.register(registryname,new FormDnD)})(jQuery,Granite.author,jQuery(document),this);
(function($,author,channel,window,undefined){var self={},afAssetsEndPoint="/libs/fd/af/components/info.json",name="Interactive Communications",isAppsAuthoring=function(){var urlRe=new RegExp("^/(?:editor\\.html|cf#)/content/phonegap");return urlRe.test(window.location.pathname)}(),data_group='"General" ';if(isAppsAuthoring){afAssetsEndPoint+="\x26requiredComponentType\x3daemappsform";data_group='"PhoneGap" '}function formTemplate(data){var xssResourceType=CQ.shared.XSS.getXSSValue(data["sling:resourceType"]),
xssDocRef=CQ.shared.XSS.getXSSValue(data.path),xssPath=xssDocRef!=null?xssDocRef.replace(author.afUtils.constants.FM_DAM_ROOT,author.afUtils.constants.FM_AF_ROOT):"",xssImage=CQ.shared.HTTP.externalize(CQ.shared.XSS.getXSSValue(data.image)),xssAssetName=CQ.shared.XSS.getXSSValue(data.name);return"\x3ccoral-card class\x3d'editor-Card-asset card-asset cq-draggable u-coral-openhand' draggable\x3d'true' data-path\x3d'"+xssPath+"' data-resourceType\x3d'"+xssResourceType+"' data-type\x3d'"+name+"' data-docRef\x3d'"+
xssDocRef+"' data-title\x3d'"+xssAssetName+"' data-group\x3d'"+data_group+"'\x3e"+"\x3ccoral-card-asset\x3e\x3cimg  class\x3d'show-grid cq-dd-image' src\x3d'"+xssImage+"' alt\x3d'"+xssAssetName+"'\x3e\x3c/coral-card-asset\x3e"+"\x3ccoral-card-content\x3e  \x3ccoral-card-title class\x3d'foundation-collection-item-title' title\x3d'"+xssAssetName+"' \x3e"+xssAssetName+"\x3c/coral-card-title\x3e"+"\x3ccoral-icon class\x3d'editor-Card-viewInAdmin' icon\x3d'edit' size\x3d'XS' aria-label\x3d'Edit' title\x3d'Edit'\x3e \x3c/coral-icon\x3e "+
"\x3c/coral-card-content\x3e \x3c/coral-card\x3e"}var searchPath=self.searchRoot="/content/dam/formsanddocuments";self.setSearchPath=function(spath){searchPath=spath};self.loadAssets=function(query,lowerLimit,upperLimit){var def=$.Deferred(),data=author.afUtils.getSearchStringAndFilters();$.getJSON(Granite.HTTP.externalize(afAssetsEndPoint),{format:"json",type:"mcdocument",start:lowerLimit,limit:upperLimit,query:data.query,tags:data.tags,filterPath:searchPath}).done(function(data){var output="",i;
if(data!=null)for(i=0;i<data.fragRefs.length;i++)output+=formTemplate(data.fragRefs[i]);def.resolve(output)});return def.promise()};self.abort=function(){};author.ui.assetFinder.register(name,self)})(jQuery,Granite.author,jQuery(document),this);
(function($,author,channel,window,undefined){var name="Interactive Communications";var DocumentDnD=function(){DocumentDnD.super_.constructor.apply(this,[arguments])};author.util.inherits(DocumentDnD,author.ui.ComponentDragAndDrop);DocumentDnD.prototype.isInsertAllowed=function(event){var resourceType=$(event.origin).attr("data-resourceType"),component=author.components.find({resourceType:resourceType})[0],componentPath=component.getPath(),componentGroup="group:"+component.getGroup();return author.edit.EditableActions.INSERT.condition(event.currentDropTarget.targetEditable,
componentPath,componentGroup)};DocumentDnD.prototype.handleDrop=function(event){var docRef=event.origin.getAttribute("data-docRef"),resourceType=$(event.origin).attr("data-resourceType"),options,components=author.components.find({resourceType:resourceType}),editableNeighbor=event.currentDropTarget.targetEditable,insertBehavior=event.currentDropTarget.insertBehavior,options={"./docRef":docRef,"./formType":"adaptiveDocument"};if(components.length>0){var oldParams=components[0].getExtraParams();components[0].setExtraParams(options);
author.editableHelper.doInsert(components[0],insertBehavior,editableNeighbor);components[0].setExtraParams(oldParams)}};author.ui.dropController.register(name,new DocumentDnD)})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var self={};var name="UGC";self.searchRoot="/content/dam";var searchPath=self.searchRoot;var imageServlet="/bin/wcm/contentfinder/asset/view.html";var itemResourceType="cq/gui/components/authoring/livefyre/asset";self.tearDown=function(){};self.loadAssets=function(query,lowerLimit,upperLimit){var param={"_dc":(new Date).getTime(),"query":query.concat('order:"-jcr:content/jcr:lastModified" '),"mimeType":"text/html","itemResourceType":itemResourceType,"limit":lowerLimit+
".."+upperLimit,"_charset_":"utf-8"};return $.ajax({type:"GET",dataType:"html",url:Granite.HTTP.externalize(imageServlet)+searchPath,data:param})};self.setServlet=function(imgServlet){imageServlet=imgServlet};self.setSearchPath=function(spath){searchPath=spath};self.setItemResourceType=function(rt){itemResourceType=rt};self.resetSearchPath=function(){searchPath=self.searchRoot};ns.ui.assetFinder.register(name,self)})(jQuery,Granite.author,jQuery(document),this);
(function($,window){var rel=".currently-selected-strategy";$(document).on("dialog-ready",function(){if(window.Granite&&Granite.author&&window.ContextHub&&ContextHub.SegmentEngine){var form=$(Granite.author.DialogFrame.currentFloatingDialog);var contextHubTab=form.find('[data-showhidetargetvalue\x3d"cq_contexthub"]');var strategyChooser=contextHubTab.find('select[name\x3d"./strategyName"]');if(strategyChooser.length){strategyChooser=strategyChooser.closest(".coral-Select");var select=strategyChooser.data("select");
var previouslySelected=contextHubTab.find(rel);if(select){$.each(ContextHub.SegmentEngine.PageInteraction.StrategyManager.getAllStrategies(),function(id,strategy){select.addOption({value:id,display:strategy.displayName})});select.setValue(previouslySelected.val());previouslySelected.remove()}}}})})(jQuery,window);
(function($,window){var rel=".segment-reference-autocomplete";$(document).on("dialog-ready",function(){if(!(window.Granite&&Granite.author&&window.ContextHub&&ContextHub.SegmentEngine))return;$(rel).each(function(idx,element){var autocomplete=$(element).data("autocomplete");if(autocomplete)$.each(ContextHub.SegmentEngine.SegmentManager.getAllSegments(),function(segmentPath){autocomplete.addOption({value:segmentPath,display:segmentPath})})})})})(jQuery,window);
(function($,window){var rel=".script-reference-autocomplete";$(document).on("dialog-ready",function(){if(!(window.Granite&&Granite.author&&window.ContextHub&&ContextHub.SegmentEngine))return;var registeredScripts=ContextHub.SegmentEngine.ScriptManager.getAllScripts();$(rel).each(function(idx,element){var autocomplete=$(element).data("autocomplete");if(autocomplete)$.each(registeredScripts,function(scriptName){autocomplete.addOption({value:scriptName,display:scriptName})})})})})(jQuery,window);
(function($,window){var rel=".property-reference-autocomplete";$(document).on("dialog-ready",function(){if(!(window.Granite&&Granite.author&&window.ContextHub&&ContextHub.SegmentEngine))return;var allProperties=[];$.each(ContextHub.getAllStores(),function(idx,store){var storeKeys=store.getKeys();for(var x=0;x<storeKeys.length;x++)allProperties.push(store.name+storeKeys[x])});$(rel).each(function(idx,element){var autocomplete=$(element).data("autocomplete");if(autocomplete)for(var x=0;x<allProperties.length;x++){var key=
allProperties[x];autocomplete.addOption({value:key,display:key})}})})})(jQuery,window);
(function($,window){var rel=".comparison-data-type-autocomplete";$(document).on("dialog-ready",function(){if(!(window.Granite&&Granite.author&&window.ContextHub&&ContextHub.SegmentEngine))return;var hash={};$.each(ContextHub.SegmentEngine.OperatorManager.getAllOperators(),function(idx,operator){var chunks=operator.operatorName.split(/\./);chunks.shift();var dataType=chunks.shift();if(dataType)hash[dataType]=true});var allDataTypes=[];$.each(hash,function(dataType){allDataTypes.push(dataType)});allDataTypes.sort();
$(rel).each(function(idx,element){var autocomplete=$(element).data("autocomplete");if(autocomplete){autocomplete.addOption({value:"",display:"(auto detect)"});for(var x=0;x<allDataTypes.length;x++){var key=allDataTypes[x];autocomplete.addOption({value:key,display:key})}}})})})(jQuery,window);
(function($,window){var rel=".comparison-operator-autocomplete";$(document).on("dialog-ready",function(){if(!(window.Granite&&Granite.author&&window.ContextHub&&ContextHub.SegmentEngine))return;var skipOperators={and:true,or:true};var whitelist=null;var operatorFilter=$(rel).closest("form").find("#operator-filter").data("whitelist");if(operatorFilter){whitelist={};$.each(operatorFilter.split(/ /),function(idx,operatorName){whitelist[operatorName]=true})}var hash={};$.each(ContextHub.SegmentEngine.OperatorManager.getAllOperators(),
function(idx,operator){var chunks=operator.operatorName.split(/\./);var operatorName=chunks.shift();if(operatorName&&!skipOperators[operatorName]&&(!whitelist||whitelist[operatorName]))hash[operatorName]=true});var allOperators=[];$.each(hash,function(dataType){allOperators.push(dataType)});allOperators.sort();$(rel).each(function(idx,element){var autocomplete=$(element).data("autocomplete");if(autocomplete)for(var x=0;x<allOperators.length;x++){var name=allOperators[x];autocomplete.addOption({value:name,
display:name})}})})})(jQuery,window);
(function($,window){var updateEvents=["cq-persistence-after-create","cq-persistence-after-move","cq-persistence-after-copy","cq-persistence-after-update","cq-persistence-after-delete","dialog-success"];var segmentEditorLoaded="contexthub-segment-editor-loaded";var segmentSelector=".segment-condition";var fetchSegmentDefinition=function(fetchAll){if(window.Granite&&Granite.author&&window.ContextHub&&ContextHub.SegmentEngine){var definition=$(segmentSelector,window.Granite.author.ContentFrame.getDocument());var segmentPath=
definition.data("segment-path");if(fetchAll===true){var containerPath=segmentPath.split(/\//);containerPath.pop();segmentPath=containerPath.join("/")}if(typeof segmentPath!=="undefined"){segmentPath+=".segment.js";$.ajax({url:_g.XSS.getXSSValue(segmentPath),dataType:"script"})}}};var waitForContextHub=function(callback){if(typeof window.ContextHub!=="undefined")callback();else requestAnimationFrame(waitForContextHub.bind(null,callback))};var modificationWatcher=function(){$(document).on(updateEvents.join(" "),
fetchSegmentDefinition);waitForContextHub(fetchSegmentDefinition.bind(null,true))};$(window.document).one(segmentEditorLoaded,modificationWatcher)})(jQuery,window);
(function($,window){var segmentEditorLoaded="contexthub-segment-editor-loaded";var segmentSelector=".segment-condition";var segmentPathAttribute="segment-path";var segmentResolution="segment-resolution-status";var traitResolvedClass="trait-resolved";var segmentResolvedClass="segment-resolved";var traitNode=".section:not(.operator-and, .operator-or, .new) \x3e .indent";var highlightCondition=function(){var definition=$(segmentSelector,window.Granite.author.ContentFrame.getDocument());var segmentPath=
definition.data(segmentPathAttribute);var traits=definition.find(traitNode);var segment=ContextHub.SegmentEngine.SegmentManager.getSegment(segmentPath);if(segment){var conditionNodes=segment.getCondition().traverse(null,function(node){return!/^(and|or)$/.test((node||{}).operatorName)});$.each(conditionNodes,function(idx,node){var element=$(this.traits[idx]);var isNodeResolved=false;if(node&&typeof node.isResolved==="function")isNodeResolved=node.isResolved();element.toggleClass(traitResolvedClass,
isNodeResolved)}.bind({traits:traits}));var isSegmentResolved=segment.isResolved();var status=isSegmentResolved?Granite.I18n.get("Data loaded in the ContextHub resolve the current segment."):Granite.I18n.get("Data loaded in the ContextHub do not resolve the current segment.");definition.toggleClass(segmentResolvedClass,isSegmentResolved).attr(segmentResolution,status)}else traits.removeClass(traitResolvedClass)};var initializeHighlighter=function(){var segmentUpdateEvents=[ContextHub.Constants.EVENT_SEGMENT_REGISTERED,
ContextHub.Constants.EVENT_SEGMENT_UPDATED];var authoringUpdateEvents=["cq-persistence-after-create","cq-persistence-after-move","cq-persistence-after-update","cq-persistence-after-delete","dialog-success"];ContextHub.eventing.on(segmentUpdateEvents,highlightCondition,"segment-condition-highlighter",true);$(window.document).on(authoringUpdateEvents.join(" "),function(){window.setTimeout(highlightCondition,100)})};var watcher=function(){var isReady=typeof window.ContextHub!=="undefined";if(isReady)initializeHighlighter();
else window.setTimeout(watcher,256)};$(window.document).one(segmentEditorLoaded,function(){if(window.Granite&&Granite.author)watcher()})})(jQuery,window);
(function($,window){var segmentEditorLoaded="contexthub-segment-editor-loaded";var layerActivated="cq-layer-activated";var sidePanelResized="cq-sidepanel-resized";var displayContainer=function(){ContextHub.UI.Properties.set("HIDE_CONTAINER_DRAWER",true);ContextHub.UI.Properties.set("VISIBLE",true);ContextHub.UI.Container.toggle({state:true})};var openSidepanel=function(){if(!Granite.author.SidePanel.isOpened())Granite.author.SidePanel.open()};var containerResizeHandler=function(){ContextHub.UIFrame.css("left",
Granite.author.SidePanel.getWidth()||0)};var watcher=function(){var isReady=typeof window.ContextHub!=="undefined";if(isReady){displayContainer();openSidepanel();$(window.document).on(sidePanelResized,containerResizeHandler);containerResizeHandler()}else window.setTimeout(watcher,256)};$(window.document).one(segmentEditorLoaded,function(){$(window).off(layerActivated);watcher()})})(jQuery,window);
(function($,window){var layerActivated="editor-frame-mode-changed";$(window.document).on(layerActivated,function(){if(window.ContextHub&&ContextHub.SegmentEngine)ContextHub.SegmentEngine.PageInteraction.TeaserManager.refreshAllTeasers()})})(jQuery,window);
(function($,window){var segmentEditorLoaded="contexthub-segment-editor-loaded";var tabListSelector="#SidePanel coral-tablist";var allowedTabs=[Granite.I18n.get("Components")];$(window.document).one(segmentEditorLoaded,function(){var tabList=$(tabListSelector)[0];Coral.commons.ready(tabList,function(){var items=tabList.items.getAll();for(var i=0;i<items.length;i++){var element=items[i];if(allowedTabs.indexOf(element.getAttribute("title"))===-1)element.hidden=true;else element.selected=true}})})})(jQuery,
window);(function($,window){var segmentEditorLoaded="contexthub-segment-editor-loaded";var layerActivated="cq-layer-activated";$(window.document).one(segmentEditorLoaded,function(){$(window.document).on(layerActivated,function(){window.setTimeout(function(){Granite.author.overlayManager.reposition()},32)})})})(jQuery,window);
(function($,window){var segmentEditorLoaded="contexthub-segment-editor-loaded";var segmentCondition="segment-condition";var overlayEditActions=function(){var deleteAction=Granite.author.edit.Actions.DELETE;var originalDelete=deleteAction.condition;deleteAction.condition=function(editable){var isConditionRoot=$(editable.dom).parent().hasClass(segmentCondition);return isConditionRoot?false:originalDelete.call(this,editable)}};$(window.document).one(segmentEditorLoaded,function(){overlayEditActions()})})(jQuery,
window);
(function($,window){var segmentEditorLoaded="contexthub-segment-editor-loaded";var popoverId="#pageinfo-popover";var menuOptions=popoverId+" [is\x3dcoral-button]";var popoverData=popoverId+" .editor-PageInfo";var segmentPropertiesURITemplate="/mnt/overlay/cq/contexthub/components/edit-properties.html{+item}";var allowedOptions=[".properties-activator",".editor-shell-onboarding-trigger"];function overlayPageInfoMenu(){$(menuOptions).not(allowedOptions.join(", ")).hide();$(popoverData).removeAttr("id")}function setActionPath(selector,
path){var propertiesActivator=document.querySelector(selector);propertiesActivator.setAttribute("data-path",path)}function adjustPageInfoActions(){var path=Granite.URITemplate.expand(segmentPropertiesURITemplate,{item:Granite.author.pageInfo.status.path});setActionPath(".properties-activator",path)}$(window.document).one(segmentEditorLoaded,function(){if(Granite.author&&Granite.author.pageInfo){overlayPageInfoMenu();adjustPageInfoActions()}else $(document).one("cq-page-info-loaded",function(){overlayPageInfoMenu();
adjustPageInfoActions()})})})(jQuery,window);
(function($,window){var segmentEditorLoaded="contexthub-segment-editor-loaded";var headerSelector=".editor-GlobalBar.editor-panel-header .header-main";var annotationButton=".js-editor-GlobalBar-badge";var targetingLayer='#selectlayer-popover .js-editor-LayerSwitcherTrigger[data-layer\x3d"Targeting"]';var designLayer='#selectlayer-popover .js-editor-LayerSwitcherTrigger[data-layer\x3d"Design"]';$(window.document).one(segmentEditorLoaded,function(){var header=$(headerSelector);header.find(annotationButton).hide();
$(window.document).on("click",'[href\x3d"#selectlayer-popover"]',function(){header.find(targetingLayer).hide();header.find(designLayer).hide()})})})(jQuery,window);(function($,window){var segmentEditorLoaded="contexthub-segment-editor-loaded";var pagePropertiesTweak=function(){$(document).on("dialog-ready",function(){$('.cq-dialog a:contains("Cloud Services")').hide()})};$(window.document).one(segmentEditorLoaded,pagePropertiesTweak)})(jQuery,window);
(function(document,Granite,$){CUI.ACTemplatePicker=new Class({toString:"ACTemplatePicker",extend:CUI.Widget,path:null,pageSize:null,url:null,next:null,done:false,construct:function(){this.$element.addClass("ac-TemplatePicker");this.path=this.$element.data("path");this.pageSize=parseInt(this.$element.data("pagesize"));this.url=Granite.HTTP.externalize(this.path+".campaign.templates.json");this.$element.autocomplete({selectlistConfig:{datapagesize:this.pageSize,loadData:this._loadData.bind(this)}});
this.autoComplete=this.$element.data("autocomplete");this.$input=this.$element.find(".js-coral-Autocomplete-textfield");this.$selectList=this.$element.find(".coral-SelectList");this.selectList=this.$selectList.data("selectList");this.$labelInput=this.$element.find(".ac-TemplatePicker-label");this._adjustValue();$(document).on("foundation-mode-change",this._adjustValue.bind(this));this.$selectList.on("selected",function(event){this.$labelInput.val(event.displayedValue)}.bind(this));this.autoComplete.disable();
$.get(this.url,{start:0,limit:2}).done(function(){this.autoComplete.enable()}.bind(this))},_adjustValue:function(){var label=this.$labelInput.val();if(label){this.$input.val(label);this.autoComplete._lastSelectedDisplay=label}},_loadData:function(start,end){if(start==0){this.next=null;this.done=false}var limit=end-start;var parameters={};if(this.next)parameters.url=this.next.href;else{parameters.start=start;parameters.limit=limit}parameters.query=this.selectList.options.dataadditional.query;var ajax=
$.get(this.url,parameters);var promise=ajax.then(function(json){if(json&&json.templates){for(var i=0;i<json.templates.length;i++){var template=json.templates[i];var li='\x3cli class\x3d"coral-SelectList-item coral-SelectList-item--option" data-text\x3d"'+template.label+'" data-value\x3d"'+template.name+'"\x3e'+template.label+"\x3c/li\x3e";this.$selectList.append(li)}if(json.next||this.next){this.next=json.next;this.done=json.templates.length==0||!json.next||!json.next.href}else{var count=this.$selectList.find(".coral-SelectList-item--option").length;
this.done=json.templates.length==0||json.total&&count==json.total}if(this.$selectList.find("li").length==0)this.selectList.hide();return this.done}}.bind(this));promise.abort=function(){ajax.abort()};return promise}});CUI.Widget.registry.register("actemplatepicker",CUI.ACTemplatePicker);if(CUI.options.dataAPI)$(document).on("cui-contentloaded.data-api",function(event){CUI.ACTemplatePicker.init($("[data-init~\x3dactemplatepicker]",event.target))})})(document,Granite,Granite.$);
(function(document,Granite,$){CUI.ACMetadataPicker=new Class({toString:"ACMetadataPicker",extend:CUI.Widget,pickerHTML:'\x3ccoral-dialog class\x3d"ac-MetadataPicker-dialog"\x3e'+"    \x3ccoral-dialog-header\x3e"+"        \x3cdiv\x3e"+'            \x3cbutton is\x3d"coral-button" icon\x3d"check" iconsize\x3d"S" class\x3d"js-ac-metadatapicker-confirm u-coral-pullRight" variant\x3d"primary" title\x3d"'+Granite.I18n.get("Confirm")+'" disabled\x3e\x3c/button\x3e'+'            \x3cbutton is\x3d"coral-button" icon\x3d"close" iconsize\x3d"S" class\x3d"js-ac-metadatapicker-cancel u-coral-pullLeft" title\x3d"'+
Granite.I18n.get("Cancel")+'"\x3e\x3c/button\x3e'+Granite.I18n.get("Select Adobe Campaign Variable")+"        \x3c/div\x3e"+"    \x3c/coral-dialog-header\x3e"+"    \x3ccoral-dialog-content\x3e"+"        \x3cdiv\x3e"+'            \x3cdiv class\x3d"coral-ColumnView"\x3e\x3c/div\x3e'+"        \x3c/div\x3e"+"    \x3c/coral-dialog-content\x3e"+"\x3c/coral-dialog\x3e",currentSelectedItem:null,selectedItem:null,$targetInput:null,caretPosition:null,mode:"insert",targetInput:null,filter:null,construct:function(){this.$element.addClass("ac-MetadataPicker");
this.setDisabled(true);this._parseOptions();this.$targetInput=$(this.targetInput);if(this.mode=="select"){this.$targetInput.attr("readonly","readonly");this.$targetInput.addClass("ac-MetadataPicker-targetInput")}if(window.top.ContextHub)this._waitForMetadata();else $(window.top).on("ch-ui-initialized",this._waitForMetadata.bind(this))},_parseOptions:function(){var mode=this.options.mode||this.$element.data("mode");if(mode!==undefined&&mode=="select")this.mode=mode;var targetInput=this.options.targetinput||
this.$element.data("targetinput");if(targetInput!==undefined)this.targetInput=targetInput;var filterCondition=this.options.filtercondition||this.$element.data("filtercondition");if(filterCondition){var body="return ("+filterCondition+");";this.filter=new Function(["variable"],body)}},_waitForMetadata:function(){var storeName="metadata";var ContextHub=window.top.ContextHub;this.metadataStore=ContextHub.getStore(storeName);if(!this.metadataStore)return;if(this.metadataStore.isDataAvailable())this._initialize();
else ContextHub.eventing.once(ContextHub.Constants.EVENT_STORE_READY+":"+storeName,function(){if(this.metadataStore.isDataAvailable())this._initialize()}.bind(this))},_initialize:function(){this.setDisabled(false);this.$element.on("click",this.togglePicker.bind(this));this.$element.on("selected",this._handleSelected.bind(this));var $picker=$(this.pickerHTML);$("body").append($picker);this.modal=$picker.get(0);$picker.on("coral-overlay:beforeclose",function(){if(this.selectedItem==null)this.$element.trigger("canceled")}.bind(this));
var $columnView=$(".coral-ColumnView",$picker);this.columnView=new CUI.ColumnView({element:$columnView});var metadata=this.filter?this.metadataStore.getFilteredTree(this.filter):this.metadataStore.getTree();var columnViewData=this.metadataStore.convertToColumnViewFormat(metadata);this.columnView.setData(columnViewData,true);$columnView.on("coral-columnview-item-select",this._itemSelected.bind(this));this.$cancelButton=$(".js-ac-metadatapicker-cancel",$picker);this.$cancelButton.on("click",this.togglePicker.bind(this));
this.$confirmButton=$(".js-ac-metadatapicker-confirm",$picker);this.$confirmButton.on("click",this._confirmSelection.bind(this));if(this.mode=="insert"){this.$targetInput.off("keyup mouseup change",this._trackCaretPosition.bind(this));this.$targetInput.on("keyup mouseup change",this._trackCaretPosition.bind(this))}else if(this.mode=="select")this._initializeSelectMode()},_initializeSelectMode:function(){var name=this.$targetInput.attr("name");this.$targetInput.removeAttr("name");this.$valueField=
$('\x3cinput type\x3d"hidden" name\x3d"'+name+'"/\x3e');this.$element.after(this.$valueField);var id=this.$targetInput.val();if(!id)return;var variable=this.metadataStore.getMetadataVariable(id);if(!variable)return;this.$targetInput.val(variable.label);this.$valueField.val(id);var segments=id.split(".");var id=segments[0];segments.splice(0,1);this.columnView.navigate(function(columnData,$column){var res;$column.find(".coral-ColumnView-item").each(function(){if($(this).data("href")==id)res=$(this)});
id+="."+segments[0];segments.splice(0,1);return res})},setDisabled:function(disabled){if(disabled){this.$element.addClass("is-disabled");this.$element.attr("disabled","disabled")}else{this.$element.removeClass("is-disabled");this.$element.removeAttr("disabled","disabled")}},togglePicker:function(){this.modal.open=!this.modal.open},_itemSelected:function(e,data,$item){if($item.hasClass("is-active")&&data&&data.value){this.$confirmButton.removeClass("is-disabled");this.$confirmButton.removeAttr("disabled");
this.currentSelectedItem={id:data._links.self.href,label:data._links.self.title,value:data.value}}else{this.$confirmButton.addClass("is-disabled");this.$confirmButton.attr("disabled","disabled");this.currentSelectedItem=null}},_confirmSelection:function(e){this.selectedItem=this.currentSelectedItem;this.modal.hide();this.$element.trigger("selected",this.selectedItem)},_trackCaretPosition:function(e){function getCaretPosition(element){if(element.selectionStart)return element.selectionStart;else if(document.selection){element.focus();
var r=document.selection.createRange();if(r==null)return 0;var re=element.createTextRange(),rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint("EndToStart",re);return rc.text.length}return 0}this.caretPosition=getCaretPosition(e.target)},_handleSelected:function(e,selectedItem){if(this.$targetInput&&this.$targetInput.length)if(this.mode=="select"){this.$targetInput.val(selectedItem.label);this.$valueField.val(selectedItem.id)}else{var pos=this.caretPosition==null?this.$targetInput.val().length:
this.caretPosition;var text=this.$targetInput.val();var newText=text.slice(0,pos)+selectedItem.value+text.slice(pos);this.$targetInput.val(newText);this.caretPosition=pos+selectedItem.value.length;if(this.$targetInput.get(0).setSelectionRange)this.$targetInput.get(0).setSelectionRange(this.caretPosition,this.caretPosition);this.$targetInput.focus();this.$targetInput.trigger("change")}}});CUI.Widget.registry.register("acmetadatapicker",CUI.ACMetadataPicker);if(CUI.options.dataAPI)$(document).on("cui-contentloaded.data-api",
function(event){CUI.ACMetadataPicker.init($("[data-init~\x3dacmetadatapicker]",event.target))})})(document,Granite,Granite.$);
(function(document,Granite,$){CUI.ACPlaintextGenerator=new Class({toString:"ACPlaintextGenerator",extend:CUI.Widget,$targetInput:null,url:null,construct:function(){this.$element.addClass("ac-PlaintextGenerator");this.$element.click(this._handleClick.bind(this));var targetInput=this.options.targetinput||this.$element.data("targetinput");if(targetInput!==undefined)this.$targetInput=$(targetInput);this.url=this.options.href||this.$element.data("href")},_handleClick:function(){if(this.$targetInput.val()){var title=
Granite.I18n.get("Warning");var message=Granite.I18n.get("This action will override the content already entered in the plain text field.");$(window).adaptTo("foundation-ui").prompt(title,message,"notice",[{text:Granite.I18n.get("No"),handler:function(){}},{text:Granite.I18n.get("Yes"),primary:true,handler:this._getAndInsertPlaintext.bind(this)}])}else this._getAndInsertPlaintext()},_getAndInsertPlaintext:function(){var url=Granite.HTTP.externalize(this.url);$.get(url).done(function(data){this.$targetInput.val(this._convertToPlaintext(data))}.bind(this)).fail(function(xhr){var title=
Granite.I18n.get("Error");var text=Granite.I18n.get("Plain text version could not be created. The server responded with status code {0}.",[xhr.status]);$(window).adaptTo("foundation-ui").alert(title,text,"error")}.bind(this))},_convertToPlaintext:function(html){var text=html;var patterns=[[/<(?:script|style|title)[\s\S]*?<\/(?:script|style|title)>/g,""],[/<[\s\S]*?>/g,""],[/&nbsp;/g," "],[/\n\s*\n/g,"\n\n"],[/^[ \t]+/mg,""],[/[ \t]+/g," "],[/&acute;/g,"\u00b4"],[/&amp;/g,"\x26"],[/&(?:#x27|apos);/g,
"'"],[/&asymp;/g,"\u2248"],[/&bdquo;/g,"\u201e"],[/&circ;/g,"\u02c6"],[/&copy;/g,"\u00a9"],[/&deg;/g,"\u00b0"],[/&divide;/g,"\u00f7"],[/&euro;/g,"\u20ac"],[/&gt;/g,"\x3e"],[/&hellip;/g,"\u2026"],[/&infin;/g,"\u221e"],[/&laquo;/g,"\u00ab"],[/&ldquo;/g,"\u201c"],[/&lsquo;/g,"\u2018"],[/&lt;/g,"\x3c"],[/&mdash;/g,"\u2014"],[/&ndash;/g,"\u2013"],[/&Oslash;/g,"\u00d8"],[/&oslash;/g,"\u00f8"],[/&para;/g,"\u00b6"],[/&pound;/g,"\u00a3"],[/&Prime;/g,"\u2033"],[/&prime;/g,"\u2032"],[/&quot;/g,'"'],[/&raquo;/g,
"\u00bb"],[/&rdquo;/g,"\u201d"],[/&reg;/g,"\u00ae"],[/&rsquo;/g,"\u2019"],[/&sbquo;/g,"\u201a"],[/&sect;/g,"\u00a7"],[/&sim;/g,"\u223c"],[/&szlig;/g,"\u00df"],[/&tilde;/g,"\u02dc"],[/&trade;/g,"\u2122"]];for(var i=0;i<patterns.length;i++)text=text.replace(patterns[i][0],patterns[i][1]);return text.trim()}});CUI.Widget.registry.register("acplaintextgenerator",CUI.ACPlaintextGenerator);if(CUI.options.dataAPI)$(document).on("cui-contentloaded.data-api",function(event){CUI.ACPlaintextGenerator.init($("[data-init~\x3dacplaintextgenerator]",
event.target))})})(document,Granite,Granite.$);
(function($){CUI.rte.plugins.ACMetadataPlugin=new Class({toString:"ACMetadataPlugin",extend:CUI.rte.plugins.Plugin,PLUGIN_ID:"personalizationplugin",CMD_INSERT_VARIABLE:"insertvariable",button:null,isInitialized:false,savedRange:null,getFeatures:function(){return[this.CMD_INSERT_VARIABLE]},initializeUI:function(tbGenerator){if(this.isFeatureEnabled(this.CMD_INSERT_VARIABLE)){this.button=tbGenerator.createElement(this.CMD_INSERT_VARIABLE,this,false,this.getTooltip(this.CMD_INSERT_VARIABLE));tbGenerator.addElement(this.PLUGIN_ID,
CUI.rte.plugins.Plugin.SORT_LINKS+1,this.button,10);tbGenerator.registerIcon(this.PLUGIN_ID+"#"+this.CMD_INSERT_VARIABLE,"adobeCampaign")}},updateState:function(){if(this.isFeatureEnabled(this.CMD_INSERT_VARIABLE)&&!this.isInitialized){this.isInitialized=true;var $button=this.button.$ui;new CUI.ACMetadataPicker({element:$button});$button.on("selected",function(e,selectedItem){this.editorKernel.focus();CUI.rte.Selection.selectRangeBookmark(this.editorKernel.getEditContext(),this.savedRange);var value=
CUI.rte.Utils.htmlEncode(selectedItem.value);this.editorKernel.relayCmd("inserthtml",value)}.bind(this));$button.on("selected canceled",function(){setTimeout(function(){this.editorKernel.unlock()}.bind(this),50)}.bind(this))}},execute:function(cmd,value,env){this.savedRange=CUI.rte.Selection.createRangeBookmark(this.editorKernel.getEditContext());this.editorKernel.lock()},isHeadless:function(cmd,value){return false}});CUI.rte.plugins.PluginRegistry.register("personalizationplugin",CUI.rte.plugins.ACMetadataPlugin)})(window.jQuery);
(function($,ns,channel,window){ns.mcm=ns.mcm||{};ns.mcm.Campaign=ns.mcm.Campaign||{};ns.mcm.Campaign.ACPersonalization=function(){var self={};self.CLASS="ac-personalize";self.STYLE={"background-color":"#dddddd"};self.PATTERN_VARIABLE=/((&lt;|<)%=\s*([^\s]*?)\s*%(&gt;|>))/g;self.PATTERN_VARIABLE_ENCODED=function(){var left="(%26lt%3B|%3C)%25%3D|%7B";var spaces="\\s|\\+|%20";var right="%25(%26gt%3B|%3E)|%7D";return new RegExp("("+left+")("+spaces+")*([^"+spaces+"]*?)("+spaces+")*("+right+")","g")}();
self.getTextElements=function(){return ns.ContentFrame.getDocument().find("."+self.CLASS+":not(img, input, textarea)")};self.getImages=function(){return ns.ContentFrame.getDocument().find("img."+self.CLASS)};self.getTextfields=function(){return ns.ContentFrame.getDocument().find("input[type\x3dtext]."+self.CLASS+", input[type\x3ddate]."+self.CLASS+", textarea."+self.CLASS)};self.getCheckboxes=function(){return ns.ContentFrame.getDocument().find("input[type\x3dcheckbox]."+self.CLASS)};self.getSelects=
function(){return ns.ContentFrame.getDocument().find("select."+self.CLASS)};self.wrapMetadataTags=function(element){$(element).find("*:contains(\x3c%\x3d)").each(function(){var htmlString=$(this).html();htmlString=htmlString.replace(self.PATTERN_VARIABLE,function(match,g1,g2,g3,g4){return'\x3cspan class\x3d"ac-metadata-variable"\x3e'+match+"\x3c/span\x3e"});$(this).html(htmlString);$(this).find(".ac-metadata-variable").css(self.STYLE)})};var enableVariablePreview=function(){ns.ContentFrame.getDocument().find(".ac-metadata-variable").each(function(){var $variable=
$(this);var tag=$variable.text();var key=tag.replace(self.PATTERN_VARIABLE,function(match,g1,g2,g3,g4){return"/seeddata/"+g3.replace(/\./g,"/")});$variable.attr({"data-contexthub-property":key,"data-default-value":tag})})};var previewImages=function(){self.getImages().each(function(){var $image=$(this);var url=$image.data("ac-original-src");url=url.replace(self.PATTERN_VARIABLE_ENCODED,function(match,g1,g2,g3,g4){var key=g4.replace(/\./g,"/");var replacement=ContextHub.getStore("seeddata").getItem(key);
if(replacement)return encodeURIComponent(replacement);return match});$image.attr("src",url)})};var previewTextfields=function(){self.getTextfields().each(function(){var $input=$(this);var key=$input.data("ac-seeddata-key");var value=key?ContextHub.getStore("seeddata").getItem(key):"";$input.val(value)})};var previewCheckboxes=function(){self.getCheckboxes().each(function(){var $checkbox=$(this);var key=$checkbox.data("ac-seeddata-key");var value=key?ContextHub.getStore("seeddata").getItem(key):"0";
$checkbox.prop("checked",value=="1")})};var previewSelects=function(){self.getSelects().each(function(){var $select=$(this);var key=$select.data("ac-seeddata-key");var value=key?ContextHub.getStore("seeddata").getItem(key):"";$select.val(value)})};var isEnabled=false;self.enablePreview=function(){if(isEnabled)return;isEnabled=true;self.getImages().each(function(){$(this).data("ac-original-src",$(this).attr("src"))});self.getTextfields().each(function(){$(this).data("ac-original-val",$(this).val())});
self.getCheckboxes().each(function(){$(this).data("ac-original-val",$(this).is(":checked"))});self.getSelects().each(function(){$(this).data("ac-original-val",$(this).val())});enableVariablePreview();self.refreshPreview();ContextHub.eventing.on(ContextHub.Constants.EVENT_STORE_UPDATED+":"+"seeddata.ac-personalization",self.refreshPreview.bind(this))};self.refreshPreview=function(){previewImages();previewTextfields();previewCheckboxes();previewSelects()};self.disablePreview=function(){if(!isEnabled)return;
isEnabled=false;var $variables=ns.ContentFrame.getDocument().find(".ac-metadata-variable");$variables.each(function(){$(this).text($(this).attr("data-default-value"));$(this).removeAttr("data-contexthub-property data-default-value")});self.getImages().each(function(){$(this).attr("src",$(this).data("ac-original-src"))});self.getTextfields().each(function(){$(this).val($(this).data("ac-original-val"))});self.getCheckboxes().each(function(){$(this).prop("checked",$(this).data("ac-original-val"))});
self.getSelects().each(function(){$(this).val($(this).data("ac-original-val"))});ContextHub.eventing.off(ContextHub.Constants.EVENT_STORE_UPDATED+":"+"seeddata.ac-personalization")};self.initialize=function(){self.getTextElements().each(function(){self.wrapMetadataTags(this)});channel.off("cq-layer-activated.ac-personalization");ContextHub.eventing.on(ContextHub.Constants.EVENT_UI_CONTAINER_OPENED,self.enablePreview.bind(this));channel.on("cq-layer-activated.ac-personalization",function(event){if(event.layer==
"Preview"&&event.prevLayer!="Preview"&&ContextHub.UI.Container.isExpanded())self.enablePreview()});ContextHub.eventing.on(ContextHub.Constants.EVENT_UI_CONTAINER_CLOSED,self.disablePreview.bind(this));channel.on("cq-layer-activated.ac-personalization",function(event){if(event.prevLayer=="Preview"&&event.layer!="Preview"&&ContextHub.UI.Container.isExpanded())self.disablePreview()})};return self}();$(window).on("ch-ui-initialized",function(){if(ContextHub.getStore("seeddata"))ns.mcm.Campaign.ACPersonalization.initialize()})})(jQuery,
Granite.author,jQuery(document),this);(function(document,$){var pageNamePattern=/^[a-zA-Z0-9_\-,]+$/;$(window).adaptTo("foundation-registry").register("foundation.validation.validator",{selector:'[data-foundation-validation~\x3d"cq.personalization.pagename"]',validate:function(el){var valid=pageNamePattern.test(el.value)||el.value==="";if(!valid)return Granite.I18n.get("This field must only contain letters, numbers, dashes, commas and underscores.")}})})(document,Granite.$);
(function(window,document,$,i18n,dcc){var foundationValidator=$(window).adaptTo("foundation-registry");foundationValidator.register("foundation.validation.validator",{selector:'[data-validation~\x3d"screens.cssunit"]',validate:function(el){var valid=dcc.validation.isValidCSSUnit(el.value);if(!valid)return i18n.get("Invalid CSS unit.");return null}})})(window,document,Granite.$,Granite.I18n,window.CQ.screens.dcc);
(function(window,document,$,i18n){var foundationValidator=$(window).adaptTo("foundation-registry");foundationValidator.register("foundation.validation.validator",{selector:'[data-validation~\x3d"screens.dates"]',validate:function(el){var startDate=$('.coral-Form-field[name\x3d"./startDate"]').adaptTo("foundation-field").getValue();var endDate=$('.coral-Form-field[name\x3d"./endDate"]').adaptTo("foundation-field").getValue();if(startDate&&endDate&&startDate>endDate)return i18n.get('"Active from" date needs to be before "active until" date.');
var eventsValidation=$('coral-select[name\x3d"./events"]').adaptTo("foundation-validation");if(eventsValidation){eventsValidation.checkValidity();eventsValidation.updateUI()}return null}})})(window,document,Granite.$,Granite.I18n);
(function(window,document,$,i18n){var foundationValidator=$(window).adaptTo("foundation-registry");foundationValidator.register("foundation.validation.validator",{selector:'[data-validation~\x3d"screens.events"]',validate:function(el){var startDate=$('.coral-Form-field[name\x3d"./startDate"]').adaptTo("foundation-field").getValue();var endDate=$('.coral-Form-field[name\x3d"./endDate"]').adaptTo("foundation-field").getValue();var schedule=$('.coral-Form-field[name\x3d"./schedule"]').adaptTo("foundation-field").getValue();
if((startDate||endDate||schedule)&&el.values.indexOf("timer")===-1)return i18n.get('Missing "timer" event on assignment.');return null}})})(window,document,Granite.$,Granite.I18n);
(function(window,document,$,i18n,dcc){var foundationValidator=$(window).adaptTo("foundation-registry");foundationValidator.register("foundation.validation.validator",{selector:'[data-validation~\x3d"screens.resourcetype"]',validate:function(el){var $el=$(el);var $field=$el.closest(".coral-Form-field");var resource=$field.adaptTo("foundation-field").getValue();if(!resource)return null;var resourceTypes=$field.data("screens-resourcetype");if(!resourceTypes)return null;var valid=dcc.validation.isResourceType(resource,
resourceTypes);if(!valid){var errorMessage=$field.data("screens-errormessage");return Granite.I18n.get(errorMessage||"Please select a valid entity.")}return null}})})(window,document,Granite.$,Granite.I18n,window.CQ.screens.dcc);
(function(window,document,$,i18n,dcc){var foundationValidator=$(window).adaptTo("foundation-registry");foundationValidator.register("foundation.validation.validator",{selector:'[data-validation~\x3d"screens.schedule"]',validate:function(el){var valid=dcc.validation.isValidSchedule(el.value);if(!valid)return i18n.get("Invalid schedule expression.");var eventsValidation=$('coral-select[name\x3d"./events"]').adaptTo("foundation-validation");eventsValidation.checkValidity();eventsValidation.updateUI();
return null}})})(window,document,Granite.$,Granite.I18n,window.CQ.screens.dcc);
(function(window,document,$,i18n,dcc){var TEMPLATE_SELECTOR='[data-validation~\x3d"screens.templatereference"] ~ .cq-RichText-editable, [data-validation~\x3d"screens.templatereference"] ~ div:last-of-type';var foundationValidator=$(window).adaptTo("foundation-registry");foundationValidator.register("foundation.validation.validator",{selector:'[data-validation~\x3d"screens.templateplaceholder"]',validate:function(el){var valid=dcc.validation.isValidPlaceholderName(el.value);if(!valid)return i18n.get('Invalid placeholder name. Please only use alphanumerical characters, "." and "_"');
var templateValidation=$(TEMPLATE_SELECTOR).adaptTo("foundation-validation");templateValidation.checkValidity();templateValidation.updateUI();return null}})})(window,document,Granite.$,Granite.I18n,window.CQ.screens.dcc);
(function(window,document,$,i18n,dcc){var PLACEHOLDER_DEFINITION_SELECTOR='[name*\x3d"./placeholder"]';var foundationValidator=$(window).adaptTo("foundation-registry");foundationValidator.register("foundation.validation.validator",{selector:'[data-validation~\x3d"screens.templatereference"] ~ .cq-RichText-editable, [data-validation~\x3d"screens.templatereference"] ~ div:last-of-type',validate:function(el){var template=$(el).prevAll('[name\x3d"./textOverlay"]').val();var fields=$(PLACEHOLDER_DEFINITION_SELECTOR).get().map(function(f){return f.value});
var unMappedPlaceholders=dcc.validation.validateTemplate(template,fields);if(unMappedPlaceholders.length)return i18n.get("Missing placeholder definition for: {0}",unMappedPlaceholders.join(","));return null}})})(window,document,Granite.$,Granite.I18n,window.CQ.screens.dcc);
(function(window,$,i18n){var foundationValidator=$(window).adaptTo("foundation-registry");foundationValidator.register("foundation.validation.validator",{selector:'[data-validation~\x3d"screens.uploading"]',validate:function(el){var valid=!(el.dataset.uploading==="true");return valid?null:i18n.get("Data upload still in progress.")}})})(window,Granite.$,Granite.I18n);
(function($,ns,i18n){ns.screens=ns.screens||{};ns.screens.textOverlayComponent=ns.screens.textOverlayComponent||{};ns.screens.textOverlayComponent.DATA_BINDING_FIELD_SELECTOR='coral-multifield[data-granite-coral-multifield-name\x3d"./dataBinding"] .coral-Form-field[role\x3d"combobox"]';ns.screens.textOverlayComponent.DATA_BINDING_TAB_SELECTOR='coral-tab[data-foundation-tracking-event*\x3d"contexthub"]';ns.screens.textOverlayComponent.populateAutocompleteWithContextHubVariables=function(autoComplete,
contexthub){if(!autoComplete||!contexthub||autoComplete.getItems().length)return;var stores=Object.keys(contexthub.getAllStores());var keys;for(var i in stores){keys=contexthub.getStore(stores[i]).getKeys();for(var j in keys)autoComplete.addOption({value:stores[i]+keys[j],display:stores[i]+keys[j]})}return};ns.screens.textOverlayComponent.getDataBindingTab=function(element){return element?element.querySelector(ns.screens.textOverlayComponent.DATA_BINDING_TAB_SELECTOR):null};ns.screens.textOverlayComponent.disableDataBindingTab=
function(tabElement){if(!tabElement)return tabElement;tabElement.disabled=true;tabElement.title=i18n.get("Data binding disabled because Personalization is not configured for this channel");return tabElement};ns.screens.textOverlayComponent.getAutoCompleteComponent=function(element){return $(element).data("autocomplete")};ns.screens.textOverlayComponent.activate=function(){if(ns.ContentFrame.contentWindow.ContextHub)$(document).on("query",ns.screens.textOverlayComponent.DATA_BINDING_FIELD_SELECTOR,
function(ev){ns.screens.textOverlayComponent.populateAutocompleteWithContextHubVariables(ns.screens.textOverlayComponent.getAutoCompleteComponent(ev.target),ns.ContentFrame.contentWindow.ContextHub)});else $(document).on("coral-overlay:open",function(ev){var tabEl=ns.screens.textOverlayComponent.getDataBindingTab(ev.target);ns.screens.textOverlayComponent.disableDataBindingTab(tabEl)})};$(document).on("cq-content-frame-loaded",ns.screens.textOverlayComponent.activate)})(window.Granite.$,window.Granite.author,
window.Granite.I18n);window.Granite=window.Granite||{};window.Granite.author=window.Granite.author||{};window.Granite.author.screens=window.Granite.author.screens||{};window.Granite.author.screens.actions=window.Granite.author.screens.actions||{};
(function(ns){var ONE_MINUTE_IN_MS=6E4;ns.screens.util={};ns.screens.util.toLocalTime=function(utcDate,timezoneOffset){if(!timezoneOffset)timezoneOffset=(new Date).getTimezoneOffset()*ONE_MINUTE_IN_MS;return new Date((utcDate.getTime?utcDate.getTime():utcDate)+timezoneOffset)}})(window.Granite.author);
(function($,ns,http,channel){ns.screens.isChannel=function(pageInfo){return pageInfo&&(pageInfo.pageResourceType==="screens/core/components/channel"||pageInfo.pageResourceType==="screens/core/components/appchannel"||pageInfo.pageResourceType==="screens/core/components/sequencechannel"||pageInfo.pageResourceSuperType==="screens/core/components/channel"||pageInfo.pageResourceSuperType==="screens/core/components/appchannel"||pageInfo.pageResourceSuperType==="screens/core/components/sequencechannel")};
channel.on("cq-layer-activated.screens",function(ev){if(!ns.screens.isChannel(ns.pageInfo))return;var currentLocation=ns.ContentFrame.currentLocation();var path=http.getPath(currentLocation);if(ev.layer==="Preview")path+=".html";else path+=".edit.html";path=http.externalize(path);if(currentLocation!==path){ns.ContentFrame.setHeight(0);ns.ContentFrame.load(path)}})})(window.Granite.$,window.Granite.author,window.Granite.HTTP,window.Granite.$(document));
(function(ns,i18n,$doc){var EDIT_LAYER_NAME="Edit";ns.screens.componentsActivation={};function getLocalizedDateTimeString(date){var ft=document.createElement("foundation-time");ft.makeModel&&ft.makeModel();ft.format="short";ft.type="datetime";ft.value=date.toISOString();document.body.appendChild(ft);return new Promise(function(resolve){window.requestAnimationFrame(function(){resolve(ft.innerText);ft.remove()})})}function renderTooltip(editableEl,tooltipComponents){var existingTooltips=editableEl.querySelectorAll("coral-tooltip");
existingTooltips.forEach(function(tooltipEl){tooltipEl.remove()});if(tooltipComponents.length){var tooltipEl=document.createElement("coral-tooltip");editableEl.appendChild(tooltipEl);tooltipEl.alignAt="left center";tooltipEl.alignMy="right center";tooltipEl.target="_prev";tooltipEl.variant="inspect";if(tooltipEl.content)tooltipEl.content.innerHTML=tooltipComponents.join("\x3cbr/\x3e")}}function renderDefault(activationEl,editableEl){activationEl.title=i18n.get("Scheduled now")}function renderStartDate(activationEl,
editableEl,startDate){if(!startDate)return Promise.resolve();if(startDate>new Date){activationEl.title=i18n.get("Scheduled in the future");editableEl.classList.add("is-early")}return getLocalizedDateTimeString(startDate).then(function(str){return i18n.get("Start - {0}",str)})}function renderEndDate(activationEl,editableEl,endDate){if(!endDate)return Promise.resolve();if(endDate<new Date){activationEl.title=i18n.get("Scheduled in the past");editableEl.classList.add("is-late")}return getLocalizedDateTimeString(endDate).then(function(str){return i18n.get("End - {0}",
str)})}function renderSchedule(activationEl,editableEl,schedule){if(!schedule)return Promise.resolve();activationEl.title=i18n.get("Dynamic schedule");editableEl.classList.add("has-dayparting");return Promise.resolve()}ns.screens.componentsActivation.decorateEditables=function(editables){var sequenceItemEditables=editables.filter(function(editable){return editable.dom[0].classList.contains("cq-Sequence-item")||editable.dom[0].classList.contains("section")});sequenceItemEditables.forEach(function(editable){var el=
editable.dom[0];var scheduledEl=el.querySelector("[data-startdate],[data-enddate],[data-schedule]");if(!scheduledEl)return;var startDate=typeof scheduledEl.dataset.startdate==="undefined"?null:ns.screens.util.toLocalTime(Number(scheduledEl.dataset.startdate));var endDate=typeof scheduledEl.dataset.enddate==="undefined"?null:ns.screens.util.toLocalTime(Number(scheduledEl.dataset.enddate));var schedule=scheduledEl.dataset.schedule;var editableEl=editable.overlay?editable.overlay.dom[0]:document.querySelector('[data-type\x3d"Editable"][data-path\x3d"'+
editable.path+'"]');editableEl.classList.add("has-activation");var previousActivationEl=editableEl.querySelector(".cq-Overlay--component-activation");if(previousActivationEl)previousActivationEl.remove();var activationEl=document.createElement("span");activationEl.classList.add("cq-Overlay--component-activation");var iconEl=document.createElement("coral-icon");iconEl.icon="clock";activationEl.appendChild(iconEl);editableEl.appendChild(activationEl);renderDefault(activationEl,editableEl);Promise.all([renderStartDate(activationEl,
editableEl,startDate),renderEndDate(activationEl,editableEl,endDate),renderSchedule(activationEl,editableEl,schedule)]).then(function(tooltipComponents){renderTooltip(editableEl,tooltipComponents.filter(Boolean))})});return sequenceItemEditables};$doc.on("cq-editor-loaded",function(){if(!ns.screens.isChannel(ns.pageInfo))return;if(ns.layerManager.getCurrentLayer()===EDIT_LAYER_NAME)ns.screens.componentsActivation.decorateEditables(ns.ContentFrame.getEditables());$doc.on("cq-layer-activated",function(ev){if(ev.layer===
EDIT_LAYER_NAME)ns.screens.componentsActivation.decorateEditables(ns.ContentFrame.getEditables())});$doc.on("dialog-beforeclose",function(ev){function updateHandler(){ns.screens.componentsActivation.decorateEditables(ns.ContentFrame.getEditables())}if(ev.target.nodeName==="CORAL-DIALOG"&&ns.layerManager.getCurrentLayer()===EDIT_LAYER_NAME){$doc.one("cq-overlays-repositioned",updateHandler);ns.ContentFrame.reload()}})})})(window.Granite.author,window.Granite.I18n,window.Granite.$(document));
(function($,ns,http,i18n,channel,window){var ACTION_NAME="EDIT_PAGE";var RESOURCE_PATH_ATTR="editpath";var EDIT_WRAPPER_SELECTOR=".aem-Screens-editWrapper";var CHANNEL_RESOURCE_TYPES=["screens/core/components/channel","screens/core/components/appchannel","screens/core/components/sequencechannel"];var editAction=new ns.ui.ToolbarAction({name:ACTION_NAME,icon:"edit",text:i18n.get("Edit"),index:0,condition:function(editable){return typeof editable.dom.contents(EDIT_WRAPPER_SELECTOR).data(RESOURCE_PATH_ATTR)===
"string"},execute:function(editable){window.open(http.externalize("/editor.html"+editable.dom.contents(EDIT_WRAPPER_SELECTOR).data(RESOURCE_PATH_ATTR)+".edit.html"))}});function isChannel(){return ns.pageInfo&&CHANNEL_RESOURCE_TYPES.indexOf(ns.pageInfo.pageResourceType)>-1||CHANNEL_RESOURCE_TYPES.indexOf(ns.pageInfo.pageResourceSuperType)>-1}channel.one("cq-editor-loaded",function(){channel.on("cq-layer-activated",function(){if(isChannel()){ns.EditorFrame.editableToolbar.registerAction(ACTION_NAME,
editAction);ns.config.toolbarActionOrder.unshift(ACTION_NAME)}})})})(window.Granite.$,window.Granite.author,window.Granite.HTTP,window.Granite.I18n,window.Granite.$(document),this);
(function($,ns,i18n,document,window){var TEXT_OVERLAY_SIZE_MODE_TOGGLE_SELECTOR=".cq-screens-TextOverlay-size";var TEXT_OVERLAY_SIZE_SIMPLE_PANEL_SELECTOR=".cq-screens-TextOverlay-size--quick";var TEXT_OVERLAY_SIZE_ADVANCED_PANEL_SELECTOR=".cq-screens-TextOverlay-size--full";function toggleSettings(el){var quickSettings=!el.querySelector(".coral-Form-field").checked;document.querySelector(TEXT_OVERLAY_SIZE_SIMPLE_PANEL_SELECTOR).style.display=quickSettings?"block":"none";document.querySelector(TEXT_OVERLAY_SIZE_ADVANCED_PANEL_SELECTOR).style.display=
!quickSettings?"block":"none"}$(document).on("change",TEXT_OVERLAY_SIZE_MODE_TOGGLE_SELECTOR,function(ev){toggleSettings(ev.currentTarget)});$(document).on("coral-overlay:open",function(ev){var sizeField=document.querySelector(TEXT_OVERLAY_SIZE_MODE_TOGGLE_SELECTOR);if(sizeField)toggleSettings(document.querySelector(TEXT_OVERLAY_SIZE_MODE_TOGGLE_SELECTOR))})})(window.Granite.$,window.Granite.author,window.Granite.I18n,document,this);
(function($,ns,i18n,http,$doc){var ACTION_NAME="EDIT_ACTIVATION";var ACTIVATION_PROPERTIES=["startDate","endDate","schedule"];var EDIT_LAYER_NAME="Edit";var SUPPORTED_COMPONENTS=["screens/core/components/content/channel","screens/core/components/content/dynamicsubsequence","screens/core/components/content/image","screens/core/components/content/page","screens/core/components/content/subsequence","screens/core/components/content/video"];ns.screens.actions.multiEditActivation={};ns.screens.actions.multiEditActivation.fetchResourceProperties=
function(path){return new Promise(function(resolve,reject){$.ajax(path+".json",{success:resolve,error:reject})})};ns.screens.actions.multiEditActivation.filterActivationProperties=function(resourceProperties){return Object.keys(resourceProperties).filter(function(key){return ACTIVATION_PROPERTIES.indexOf(key)>-1}).reduce(function(activationProperties,key){activationProperties[key]=key==="startDate"||key==="endDate"?new Date((new Date(resourceProperties[key])).getTime()+(new Date).getTimezoneOffset()*
6E4):resourceProperties[key];return activationProperties},{})};ns.screens.actions.multiEditActivation.aggregateActivationProperties=function(activationPropertiesArray){return activationPropertiesArray.reduce(function(props,activationProperties,index){ACTIVATION_PROPERTIES.forEach(function(key){if(props[key]===activationProperties[key]||props[key]===null)return;if(typeof props[key]==="undefined"||typeof activationProperties[key]==="undefined")props[key]=null;else if(props[key].getTime&&props[key].getTime()!==
activationProperties[key].getTime())props[key]=null;else if(!props[key].getTime&&props[key]!==activationProperties[key])props[key]=null});return props},activationPropertiesArray[0]||{})};ns.screens.actions.multiEditActivation.showActivationDialog=function(activationProperties){var dialog=new ns.ui.Dialog({getConfig:function(){return{src:http.externalize("/mnt/overlay/screens/dcc/content/activationdialog.html"),loadingMode:"auto",layout:"auto"}}});return new Promise(function(resolve){dialog.onReady=
function(){resolve(activationProperties)};ns.DialogFrame.openDialog(dialog)})};ns.screens.actions.multiEditActivation.updateDialogFields=function(resources,activationProperties){var headerEl=ns.DialogFrame.currentFloatingDialog.get(0).header;var selectionCountEl=document.createElement("small");selectionCountEl.classList.add("screens-ActivationDialog-selectionCount");selectionCountEl.innerText=i18n.get("{0} selected",resources.length);headerEl.append(selectionCountEl);ACTIVATION_PROPERTIES.forEach(function(key){var field=
document.querySelector('form.cq-dialog .coral-Form-field[name\x3d"./'+key+'"]');if(activationProperties[key]===null)field.placeholder=i18n.get("\x3cmultiple values\x3e");else if(typeof activationProperties[key]!=="undefined")field.value=activationProperties[key];else field.placeholder=""})};ns.screens.actions.multiEditActivation.updateComponents=function(resources){var datastring=ns.DialogFrame.currentFloatingDialog.find("form.cq-dialog").serialize();var promises=resources.reduce(function(promise,
resource){return promise.then(function(){return new Promise(function(resolve,reject){$.ajax(resource,{success:resolve,error:reject,type:"POST",data:datastring})})})},Promise.resolve());return promises.then(function(){ns.DialogFrame.currentFloatingDialog.trigger("foundation-form-submitted",true);return Promise.resolve()})["catch"](function(err){ns.DialogFrame.currentFloatingDialog.trigger("foundation-form-submitted",false);return Promise.resolve(err)}).then(function(err){ns.DialogFrame.closeDialog();
$(ns.EditorFrame.$doc).off("submit","coral-dialog.cq-Dialog",ns.screens.actions.multiEditActivation.submitHandler);return err?Promise.reject(err):Promise.resolve()})};ns.screens.actions.multiEditActivation.submitHandler=function(resources){var ui=$(window).adaptTo("foundation-ui");ui.wait();ns.screens.actions.multiEditActivation.updateComponents(resources).then(function(err){ui.notify(null,i18n.get("Successfully updated activation times."),"success")})["catch"](function(err){ui.notify(null,i18n.get("Failed to update activation times: {0}",
err),"error")}).then(function(err){ui.clearWait()});return false};ns.screens.actions.multiEditActivation.execute=function(resources){$(ns.EditorFrame.$doc).one("submit","coral-dialog.cq-Dialog",function(){return ns.screens.actions.multiEditActivation.submitHandler(resources)});return Promise.all(resources.map(ns.screens.actions.multiEditActivation.fetchResourceProperties)).then(function(resourcePropertiesArray){return resourcePropertiesArray.map(ns.screens.actions.multiEditActivation.filterActivationProperties)}).then(ns.screens.actions.multiEditActivation.aggregateActivationProperties).then(ns.screens.actions.multiEditActivation.showActivationDialog).then(function(activationProperties){ns.screens.actions.multiEditActivation.updateDialogFields(resources,
activationProperties)})};ns.screens.actions.multiEditActivation.isEnabled=function(editable,selectedEditables){return selectedEditables.length>1&&SUPPORTED_COMPONENTS.indexOf(editable.type)>-1};ns.screens.actions.multiEditActivation.init=function(){var editActivationAction=new ns.ui.ToolbarAction({name:ACTION_NAME,icon:"clock",text:i18n.get("Edit Activation"),index:0,condition:function(editable){return ns.screens.actions.multiEditActivation.isEnabled(editable,ns.selection.getAllSelected())},execute:function(editable){var selected=
ns.selection.getAllSelected();var resources=selected.map(function(ed){return ed.path});return ns.screens.actions.multiEditActivation.execute(resources)}});return editActivationAction};$doc.one("cq-editor-loaded",function(){if(!ns.screens.isChannel(ns.pageInfo))return;if(ns.layerManager.getCurrentLayer()===EDIT_LAYER_NAME){ns.EditorFrame.editableToolbar.registerAction(ACTION_NAME,ns.screens.actions.multiEditActivation.init());ns.config.toolbarActionOrder.unshift(ACTION_NAME)}$doc.on("cq-layer-activated",
function(ev){if(ev.layer===EDIT_LAYER_NAME){ns.EditorFrame.editableToolbar.registerAction(ACTION_NAME,ns.screens.actions.multiEditActivation.init());ns.config.toolbarActionOrder.unshift(ACTION_NAME)}})})})(window.Granite.$,window.Granite.author,window.Granite.I18n,window.Granite.HTTP,window.Granite.$(document));(function(window){window.CQ=window.CQ||{}})(this);(function(ns){ns.activitymap={}})(Granite.author);
(function($,ns,channel,window,undefined){ns.activitymap.CONFIG={name:"Activity Map",iconClass:"adobeAnalytics",title:Granite.I18n.get("Activity Map","Title of Activity Map layer"),sidePanel:{setUp:function(){ns.ui.SidePanel.close(true);ns.ui.SidePanel.showEmptyContent()}}};ns.activitymap.LOGIN_TIMEOUT=3E4;ns.activitymap.SETTINGS_URL="/mnt/override/libs/cq/activitymap/content/settings.json";ns.activitymap.url=undefined;ns.activitymap.isAvailable=undefined;var debugMode=window.location.href.match(/[?&]debug-activitymap=true/gi);
var isTearedDown=false;var debug=function(args){if(window.console&&debugMode)if(typeof args==="string")console.log("[Activity Map] "+args);else if(Array.isArray(args)){var message=args.splice(0,1);console.log("[Activity Map] "+message,args)}};var warn=function(args){if(window.console)if(typeof args==="string")console.warn("[Activity Map] "+args);else if(Array.isArray(args)){var message=args.splice(0,1);console.warn("[Activity Map] "+message,args)}};ns.activitymap.Layer=ns.util.extendClass(ns.Layer,
{script:null,config:ns.activitymap.CONFIG,constructor:function Layer(config){ns.activitymap.Layer.super_.constructor.apply(this,arguments)},isAvailable:function(){if(ns.activitymap.isAvailable!==undefined)return ns.activitymap.isAvailable;else ns.activitymap.isAvailable=false;var settingsUrl=Granite.HTTP.externalize(ns.activitymap.SETTINGS_URL);settingsUrl+="?path\x3d"+ns.ContentFrame.getContentPath();var response=$.ajax({url:settingsUrl,async:false,success:function(data,status,xhr){try{ns.activitymap.url=
data.activityMapUrl;ns.activitymap.trustedOrigin=data.trustedOrigin;ns.activitymap.integrationtype=data.integrationtype;if("analytics"===data.integrationtype)ns.activitymap.analytics=data.analytics;if(data.integrationtype==="analytics"||data.integrationtype==="dtm"||data.integrationtype==="launch")ns.activitymap.isAvailable=true}catch(e){debug("Unable to parse response.",e)}},error:function(xhr,status,err){debug("Requesting settings failed with status code {}.",status)}});return ns.activitymap.isAvailable},
setUp:function(){debug("Setting up Layer");isTearedDown=false;ns.ui.dropController.disable();this._appendActivityMap(ns.activitymap.analytics?false:true)},tearDown:function(){debug("Tearing down Layer");isTearedDown=true;ns.ui.dropController.enable();this._closeActivityMap();this._removeActivityMap()},_closeActivityMap:function(){debug("Closing Activity Map");var doc=ns.ContentFrame.getDocument().get(0)||window.document,iframe=doc.getElementById("clickmapAdobeAnalyticsiframe"),win=iframe?iframe.contentWindow:
undefined;if(win!==undefined)win.postMessage(JSON.stringify({type:"adobeClickMapClose"}),"*")},_appendActivityMap:function(showLogin){debug("Appending Activity Map tag");Granite.author.ui.helpers.wait();var self=this,doc=ns.ContentFrame.getDocument().get(0)||window.document;self._registerMessageListener();this.script=doc.createElement("script");this.script.src=ns.activitymap.url+"?displayLogin\x3d"+showLogin+"\x26_\x3d"+Date.now();this.script.async=true;this.script.type="text/javascript";this.script.id=
"aem-activitymap";this.script.onerror=function(){ns.ui.helpers.clearWait();ns.ui.helpers.notify(Granite.I18n.get("The Activity Map application is not accessible.","Initialization error."))};this.script.onload=function(){var iframe=doc.getElementById("clickmapAdobeAnalyticsiframe");if(iframe===undefined){ns.ui.helpers.clearWait();warn('iFrame "clickmapAdobeAnalyticsiframe" not found')}};doc.getElementsByTagName("head")[0].appendChild(this.script)},_registerMessageListener:function(){var self=this,
win=ns.ContentFrame.contentWindow,msgTimeout=undefined;win.addEventListener("message",function(event){var msg={};try{msg=JSON.parse(event.data)}catch(ex){warn("Parsing incoming message failed.",event.data,ex);return}if(msg.type==="showLoginIframe"&&ns.activitymap.analytics!==undefined){debug("Init messaging timeout");msgTimeout=win.setTimeout(function(){ns.ui.helpers.clearWait();ns.ui.helpers.notify(Granite.I18n.get("An unknown error occurred during authentication.","Unknown authentication error."))},
ns.activitymap.LOGIN_TIMEOUT)}if(msg.type==="adobeActivityMapStandardLoginReady"&&ns.activitymap.analytics!==undefined){debug("Login ready.");ns.ui.helpers.clearWait();self._postCredentials()}if(msg.type==="connected"){ns.ui.helpers.clearWait();if(msgTimeout!=undefined){debug("Clearing messaging timeout");win.clearTimeout(msgTimeout)}}if(msg.type==="closeClickMap"&&!isTearedDown){debug("Toolbar has been closed, auto-switching mode to Edit.");ns.layerManager.loadLayer(ns.edit.CONFIG.name)}},false)},
_postCredentials:function(){if(!ns.activitymap.analytics){warn("No credentials available, authentication not possible.");return}if(ns.activitymap.analytics.password&&ns.activitymap.analytics.password.match(/^\{.*/))warn("Password might not be decrypted. Authentication might fail with an origin error.");debug("Posting credentials");var doc=ns.ContentFrame.getDocument().get(0)||window.document;var iframe=doc.getElementById("clickmapAdobeAnalyticsiframelogin"),win=iframe?iframe.contentWindow:undefined;
if(win!==undefined)win.postMessage(JSON.stringify({type:"adobeActivityMapStandardLogin",data:{company:ns.activitymap.analytics.company,username:ns.activitymap.analytics.username,password:ns.activitymap.analytics.password}}),ns.activitymap.trustedOrigin)},_removeActivityMap:function(){debug("Removing Activity Map elements");var doc=ns.ContentFrame.getDocument().get(0)||window.document;if(this.script&&this.script.parentNode)this.script.parentNode.removeChild(this.script);["clickmapAdobeAnalyticslogin",
"clickmapAdobeAnalyticsiframelogin"].forEach(function(id){var el=doc.getElementById(id);if(el)el.parentNode.removeChild(el)})}});ns.layerManager.registerLayer(new ns.activitymap.Layer)})(jQuery,Granite.author,jQuery(document),this);
(function(){window.fd=window.fd||{};window.fd.constants=window.fd.constants||{};window.fd.constants={"AEM_FORM_SELECTOR":"[data-form-page-path]"};window.fd.openFormForEditing=function(editable){var htmlElement=$(window.fd.constants.AEM_FORM_SELECTOR,editable.dom).addBack("[data-form-page-path]"),formPath=htmlElement.attr("data-form-page-path"),url=Granite.HTTP.externalize("/editor.html"+formPath+".html");window.open(url)};window.fd.formExists=function(editable){return $(window.fd.constants.AEM_FORM_SELECTOR,
editable.dom).addBack(window.fd.constants.AEM_FORM_SELECTOR).length>0};window.fd.aemFormExistsInPage=function(){return Granite.author.store.find({"type":"fd/af/components/aemform"}).length>0}})();
(function(channel,ns){var _superSanitizeCQHandler=ns.util.sanitizeCQHandler,_superExecuteListener=ns.Editable.prototype._executeListener;ns.util.sanitizeCQHandler=function(code){if(window.guidelib==null&&code!=null&&typeof code==="string"&&(code.indexOf("guidelib")===0||code.indexOf("guidelib.author"))>=0);else if(code&&typeof code==="function")return code;else return _superSanitizeCQHandler.call(this,code)};ns.Editable.prototype._executeListener=function(listenerName,parameters){if(this.config&&
this.config.editConfig.listeners[listenerName]==null&&parameters&&parameters[0].indexOf("guideContainer")>=0);else return _superExecuteListener.call(this,listenerName,parameters)};channel.on("editor-frame-mode-changed.aemform",function(){if(window.fd.aemFormExistsInPage()){var wcModeCookie=$.cookie("wcmmode");if(wcModeCookie=="preview"||wcModeCookie=="edit")window.location.reload()}})})($(document),Granite.author);
(function($,ns,channel,window,undefined){var self={};var NAME="Experience Fragments",SEARCH_ROOT="/content/experience-fragments",ASSET_VIEW_SERVLET="/bin/wcm/contentfinder/experiencefragments/view.html",ITEM_RT="cq/experience-fragments/components/xfpage/editor/card";var searchPath="/content/experience-fragments";self.searchRoot=SEARCH_ROOT;self.loadAssets=function(query,lowerLimit,upperLimit){var currentEditedPath,currentEditedPage=$("iframe#ContentFrame").attr("src");if(currentEditedPage)currentEditedPath=
currentEditedPage.replace(".html","");var param={"_dc":(new Date).getTime(),"query":query,"excludedPath":currentEditedPath,"itemResourceType":ITEM_RT,"limit":lowerLimit+".."+upperLimit,"_charset_":"uft-8"};return $.ajax({type:"GET",dataType:"html",url:Granite.HTTP.externalize(ASSET_VIEW_SERVLET)+searchPath,data:param})};self.setSearchPath=function(path){if(path)searchPath=path.replace(/\/$/,"")};self.setItemResourceType=function(resourceType){ITEM_RT=resourceType};self.resetSearchPath=function(){searchPath=
this.searchRoot};ns.ui.assetFinder.register(NAME,self)})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var isDebugEnabled=window.location.href.indexOf("debug-xf\x3d1")!=-1;var windowUI=$(window).adaptTo("foundation-ui");function _debug(msg){if(isDebugEnabled)console.log(msg)}var XF_CONTROLLER_NAME="experiencefragment";var BB_CONTROLLER_NAME="buildingblock";var assetDnd=ns.ui.assetFinder.AssetDragAndDrop,dropController=ns.ui.dropController;var buildController=function(name,onDrop){var DragAndDrop=ns.util.extendClass(assetDnd,{constructor:function(){assetDnd.constructor.apply(this,
arguments)}});DragAndDrop.prototype.getTypeName=function(){return name};if(onDrop)DragAndDrop.prototype.handleDrop=onDrop;return new DragAndDrop};dropController.register(XF_CONTROLLER_NAME,buildController(XF_CONTROLLER_NAME));dropController.register(BB_CONTROLLER_NAME,buildController(BB_CONTROLLER_NAME,function(event){var isInBuildingBlock=false,targetEditable=event.currentDropTarget.targetEditable;while(targetEditable.getParent()){if(targetEditable.getParent().type=="cq/experience-fragments/editor/components/buildingblock"){isInBuildingBlock=
true;break}targetEditable=targetEditable.getParent()}if(isInBuildingBlock){windowUI.notify("",Granite.I18n.get("Building blocks cannot be added to building blocks."),"notice");return}ns.ui.assetFinder.AssetDragAndDrop.prototype.handleDrop(event)}))})(jQuery,Granite.author,jQuery(document),this);
(function($,ns,channel,window,undefined){var RT_BUILDING_BLOCK="cq/experience-fragments/editor/components/buildingblock";var isMasterBuildingBlock=function(editable){return editable.type==RT_BUILDING_BLOCK&&editable.dom&&!!editable.dom.find(".xf-master-building-block").length};var setReferenceBlockLayout=function(children){children.forEach(function(child){child.config.editConfig.actions=["LAYOUT"];child.config.editConfig.droptarget=[];child.config.editConfig.orderable=false;if(child.getChildren())setReferenceBlockLayout(child.getChildren())})};
var addListenersToMasterBlock=function(masterBlock){var refreshReferences=function(references){references.forEach(function(reference){reference.refresh()})};var references=ns.editables.filter(function(editable){var attrName="data-master-building-block-path";return editable.type==RT_BUILDING_BLOCK&&editable.dom&&editable.dom.find("["+attrName+"]").attr(attrName)==masterBlock.path});var updateReferencesListener=function(){refreshReferences(references)};if(!!references.length){var addChangeListeners=
function(block){block.afterChildEdit=updateReferencesListener;block.afterChildDelete=updateReferencesListener;block.afterChildInsert=function(){block.refresh();updateReferencesListener()};var children=block.getChildren();if(children)children.forEach(function(child){addChangeListeners(child)})};addChangeListeners(masterBlock)}};var updateBuildingBlocks=function(){var buildingBlocks=Granite.author.editables.filter(function(item){return item.type==RT_BUILDING_BLOCK});buildingBlocks.forEach(function(buildingBlock){if(buildingBlock.dom&&
!buildingBlock.dom.find(".cq-dd-buildingblock.cq-placeholder").length)buildingBlock.hasPlaceholder=function(){return false};if(!isMasterBuildingBlock(buildingBlock))setReferenceBlockLayout(buildingBlock.getChildren());else addListenersToMasterBlock(buildingBlock)})};channel.on("cq-editables-updated",updateBuildingBlocks);channel.on("cq-contentframe-layout-change",function(){var masterBlocks=Granite.author.editables.filter(function(editable){return isMasterBuildingBlock(editable)});masterBlocks.forEach(function(masterBlock){masterBlock.overlay&&
masterBlock.overlay.dom.addClass("cq-xf-building-block-master")})})})(jQuery,Granite.author,jQuery(document),this);(function(ns){ns.experienceFragments=ns.experienceFragments||{}})(Granite.author);(function(ns){ns.actions=ns.actions||{}})(Granite.author.experienceFragments);
(function($,ns){var MSG_NO_FRAGMENT_PATH=Granite.I18n.get("The experience fragment doesn't have an associated variation");ns.experienceFragments.actions.editInNewTab=function(){var ui=$(window).adaptTo("foundation-ui");$.get(this.path+".json").then(function(response){if(typeof response["fragmentPath"]!=="undefined")window.open(Granite.HTTP.externalize("/editor.html"+response["fragmentPath"]+".html"));else ui.notify("",MSG_NO_FRAGMENT_PATH,"notice")})}})(jQuery,Granite.author);CQ=window.CQ||{};
(function(ns){ns.XF={}})(CQ);
(function($,ns,channel){var DO_NOT_CONVERT=["screens/core","cq/experience-fragments/editor/components/experiencefragment","cq/experience-fragments/editor/components/buildingblock","wcm/foundation/components/responsivegrid/new"];var convertAction=new ns.ui.ToolbarAction({name:"XFCONVERT",icon:"filingCabinet",text:Granite.I18n.get("Convert to experience fragment variation"),isNonMulti:true,execute:function(){CQ.XF.convertToXf()},condition:function(editable){var hasBuildingBlocks=false,isInBuildingBlock=
false,fromTemplate=editable.isStructure();var currentEditable=editable;while(currentEditable.getParent()){if(currentEditable.getParent().type==DO_NOT_CONVERT[2]){isInBuildingBlock=true;break}currentEditable=currentEditable.getParent()}var setHasBuildingBlockChildren=function(editable){editable.getChildren().forEach(function(child){if(child.type=="cq/experience-fragments/editor/components/buildingblock")hasBuildingBlocks=true;else setHasBuildingBlockChildren(child)})};setHasBuildingBlockChildren(editable);
var isRestricted=DO_NOT_CONVERT.filter(function(type){return editable.type.indexOf(type)!=-1});return isRestricted.length==0&&!hasBuildingBlocks&&!isInBuildingBlock&&!fromTemplate}});if(!ns.EditorFrame.editableToolbar)channel.on("cq-layer-activated",function(event){if(event.layer==="Edit")ns.EditorFrame.editableToolbar.registerAction("XFCONVERT",convertAction)});else ns.EditorFrame.editableToolbar.registerAction("XFCONVERT",convertAction)})(jQuery,Granite.author,jQuery(document));
(function($,ns){var _author=Granite.author;ns.convertToXf=function(){var dialogUrl=Granite.HTTP.externalize("/libs/cq/experience-fragments/content/v2/conversion.html/libs/cq/experience-fragments/content/v2/conversion/converter"),dlg=new _author.ui.Dialog({getConfig:function(){return{src:dialogUrl,loadingMode:"auto",layout:"auto"}},getRequestData:function(){return{currentPage:_author.ContentFrame.contentURL,componentPaths:_author.selection.selected.map(function(e){return e.path}).join("#"),referrer:_author.ContentFrame.getContentPath()}},
onSuccess:function(){_author.ContentFrame.reload()},onReady:function(){var $dialog=_author.DialogFrame.currentFloatingDialog;var componentPaths=_author.selection.selected.map(function(e){return e.path});var isStructure=_author.selection.selected[0].isStructure();var $form=$dialog.find("form");$.each(componentPaths,function(idx,value){$form.append("\x3cinput type\x3d'hidden' value\x3d'"+value+"' name\x3d'componentPath'/\x3e")});$form.append("\x3cinput type\x3d'hidden' value\x3d'"+isStructure+"' name\x3d'isStructure'/\x3e");
CQ.XF.adjustRequiredFields($form)}});_author.DialogFrame.openDialog(dlg)}})(jQuery,CQ.XF);(function($,Granite,undefined){window.CQ=window.CQ||{};window.CQ.Inbox=window.CQ.Inbox||{};window.CQ.Inbox.UI=window.CQ.Inbox.UI||{};window.CQ.Inbox.UI.commons=window.CQ.Inbox.UI.commons||{};window.CQ.Inbox.UI.sharingtableUtils=window.CQ.Inbox.UI.sharingtableUtils||{}})(Granite.$,Granite);
(function($,Granite,undefined){var inboxSettingsDialog="#inboxSettingsDialog";var deferreds={};window.CQ.Inbox.UI.commons.loadDialog=function(dialogPath,forceLoad){var deferred=deferreds[dialogPath];if(!deferred||forceLoad){var deferred=$.Deferred();deferreds[dialogPath]=deferred;var url=Granite.HTTP.externalize(dialogPath+".html?ch_ck\x3d"+Date.now());$.get(url).done(function(dialogHtml){var parser=$(window).adaptTo("foundation-util-htmlparser");parser.parse(dialogHtml,true).then(function(parsedDialogHtml){var $dialog=
$(parsedDialogHtml.firstChild);if(forceLoad&&deferred)$(inboxSettingsDialog).remove();$(document.body).append($dialog);$dialog.trigger("cui-contentloaded")});setTimeout(function(){deferred.resolve()},10)}).fail(function(){deferred.reject(Granite.I18n.get("Unable to load "+dialogPath))})}return deferred.promise()};window.CQ.Inbox.UI.commons.removeDialog=function(dialog,dialogPath){if(dialog)dialog.remove();if(dialogPath)delete deferreds[dialogPath]}})(Granite.$,Granite);
(function($,Granite,undefined){var DIALOG_PATH="/mnt/overlay/cq/inbox/content/inbox/dialogs/workitemcompletedialog";var SHARE_INBOX_ITEM_DIALOG_PATH="/mnt/overlay/cq/inbox/content/inbox/dialogs/shareinboxitemdialog";var INBOX_SHARE_INBOX_ITEM_DIALOG="#shareInboxItemDialog";var INBOX_SHARES_INBOX_ITEM_WITH_TABLE="#shares-inbox-item-with-table";var INBOX_SHARE_INBOX_ITEM_FORM="#inbox-share-inbox-item-form";var INBOX_SHARE_INBOX_ITEM_SEARCH="#inbox-share-inbox-item-search";var INBOX_SHARE_INBOX_ITEM_BUTTON=
"#inbox-share-inbox-item-button";var ns=".cq-inbox-share";var INBOX_SHARE_INBOX_ITEM_DELETE_ROW="inbox-share-inbox-item-delete-row";var INBOX_SHARE_INBOX_ITEM_WITH_USER="inbox-share-inbox-item-with-user";var INBOX_SHARES_INBOX_ITEM_WITH_TABLE_CONTAINER="#inbox-shares-inbox-item-with-container";var INBOX_SHARE_INBOX_ITEM_SAVE=".inbox-share-inbox-item-save";var ui=$(window).adaptTo("foundation-ui");window.CQ.Inbox.UI.commons.completeWorkitem=function(workitemId,successURL){doWorkitemAction(workitemId,
".routes.json","routes",Granite.I18n.get("Next Step"),Granite.I18n.get("Complete Work Item"),Granite.I18n.get("Failed to load workitem information. The selected item may no longer be available."),"advance","route-",function(selectionChoices){if(selectionChoices&&selectionChoices.length>1)return false;return true},null,successURL,true)};window.CQ.Inbox.UI.commons.doSharedAction=function(cmd,workItemId,errorHeader,errorMessage,successURL,shouldReload){ui.wait();var submitAction="/bin/workflow/inbox";
var data={"cmd":cmd,":status":"browser","_charset_":"utf-8","item":workItemId};$.ajax({url:submitAction,type:"POST",data:data}).done(function(){renderSuccessPage(successURL,shouldReload)}).fail(function(xhr){ui.clearWait();ui.prompt(Granite.I18n.get(errorHeader),Granite.I18n.get(errorMessage),"error",[{text:Granite.I18n.get("OK"),primary:true,handler:function(){renderSuccessPage(successURL,shouldReload)}}])})};window.CQ.Inbox.UI.commons.stepBackWorkitem=function(workitemId,successURL){doWorkitemAction(workitemId,
".backroutes.json","backroutes",Granite.I18n.get("Previous Step"),Granite.I18n.get("Step Back Item"),Granite.I18n.get("Failed to load the step back information. The selected item may no longer be available."),"advanceBack","backroute-",function(selectionChoices){if(selectionChoices)if(selectionChoices.length>1)return false;else if(selectionChoices.length==1)return true;return true},function(workitemRoutes){if(workitemRoutes&&workitemRoutes.length>0)return false;else{ui.prompt(Granite.I18n.get("Step Back"),
Granite.I18n.get("The selected item cannot step back."),"info",[{text:Granite.I18n.get("OK"),primary:true}]);return true}},successURL)};window.CQ.Inbox.UI.commons.delegateWorkitem=function(workitemId,successURL){doWorkitemAction(workitemId,".delegatees.json","delegatees",Granite.I18n.get("User"),Granite.I18n.get("Delegate Item"),Granite.I18n.get("Failed to load the delegation information. The selected item may no longer be available."),"delegate","delegatee-",function(workitemRoutes){if(workitemRoutes&&
workitemRoutes.length>1)return false;return true},function(workitemRoutes){if(workitemRoutes&&workitemRoutes.length>0)return false;else{ui.prompt(Granite.I18n.get("Delegate Item"),Granite.I18n.get("The selected item cannot be delegated."),"info",[{text:Granite.I18n.get("OK"),primary:true}]);return true}},successURL)};window.CQ.Inbox.UI.commons.shareInboxItem=function(inboxItemId,successURL,shouldReload,itemTitle){CQ.Inbox.UI.commons.loadDialog(SHARE_INBOX_ITEM_DIALOG_PATH).done(function(){var inboxShareInboxItemDialog=
$(INBOX_SHARE_INBOX_ITEM_DIALOG);var inboxShareInboxItemForm=inboxShareInboxItemDialog.find(INBOX_SHARE_INBOX_ITEM_FORM);var inboxSharesInboxItemWithTable=inboxShareInboxItemForm.find(INBOX_SHARES_INBOX_ITEM_WITH_TABLE);var inboxSharesInboxItemWithTableContainer=inboxShareInboxItemDialog.find(INBOX_SHARES_INBOX_ITEM_WITH_TABLE_CONTAINER);resetShareInboxItemDialog(inboxSharesInboxItemWithTable,inboxShareInboxItemForm);var dialogTitle=getShareDialogTitle(itemTitle);inboxShareInboxItemDialog[0].set({header:{innerHTML:dialogTitle}});
if(inboxShareInboxItemDialog.length>0)inboxShareInboxItemDialog.get(0).show();window.CQ.Inbox.UI.sharingtableUtils.toggleTableVisibility(INBOX_SHARES_INBOX_ITEM_WITH_TABLE,inboxSharesInboxItemWithTableContainer,INBOX_SHARE_INBOX_ITEM_SAVE);inboxShareInboxItemDialog.find(INBOX_SHARE_INBOX_ITEM_SEARCH).off("change"+ns).on("change"+ns,function(){var isEntryUniqueCallback=function(inboxShareInboxItemDialog,INBOX_SHARE_INBOX_ITEM_SEARCH){return!checkDuplicateUsers(inboxShareInboxItemDialog,INBOX_SHARE_INBOX_ITEM_SEARCH)};
window.CQ.Inbox.UI.sharingtableUtils.toggleButton(INBOX_SHARES_INBOX_ITEM_WITH_TABLE,INBOX_SHARE_INBOX_ITEM_SEARCH,INBOX_SHARE_INBOX_ITEM_BUTTON,isEntryUniqueCallback)});inboxShareInboxItemDialog.find(INBOX_SHARE_INBOX_ITEM_BUTTON).off("click"+ns).on("click"+ns,function(){var userInfo=CQ.Inbox.UI.commons.getUserNameAndIdFromAutoComplete(INBOX_SHARE_INBOX_ITEM_SEARCH);var deleteRowCallback=function(event,tableId){window.CQ.Inbox.UI.sharingtableUtils.removeTableRow($(event.target).closest("tr"),null,
tableId);window.CQ.Inbox.UI.sharingtableUtils.toggleTableVisibility(tableId,$(INBOX_SHARES_INBOX_ITEM_WITH_TABLE_CONTAINER),INBOX_SHARE_INBOX_ITEM_SAVE)};window.CQ.Inbox.UI.sharingtableUtils.addTableRow(INBOX_SHARES_INBOX_ITEM_WITH_TABLE,userInfo,INBOX_SHARE_INBOX_ITEM_WITH_USER,INBOX_SHARE_INBOX_ITEM_DELETE_ROW,deleteRowCallback,false,false);window.CQ.Inbox.UI.sharingtableUtils.toggleTableVisibility(INBOX_SHARES_INBOX_ITEM_WITH_TABLE,inboxSharesInboxItemWithTableContainer,INBOX_SHARE_INBOX_ITEM_SAVE);
inboxShareInboxItemDialog.find(INBOX_SHARE_INBOX_ITEM_SEARCH).val(null);inboxShareInboxItemDialog.find(INBOX_SHARE_INBOX_ITEM_BUTTON).attr("disabled",true)});inboxShareInboxItemDialog.find(INBOX_SHARE_INBOX_ITEM_SAVE).off("click"+ns).on("click"+ns,function(){var that=this;ui.wait();this.disabled=true;var users=getExplicitShareUsersList(INBOX_SHARES_INBOX_ITEM_WITH_TABLE,INBOX_SHARE_INBOX_ITEM_WITH_USER);saveExplicitSharingList(inboxItemId,"sharedwith-",users,successURL,shouldReload).done(function(){renderSuccessPage(successURL,
shouldReload)}).fail(function(xhr){ui.clearWait();ui.prompt(Granite.I18n.get("Share Item"),Granite.I18n.get("Item can't be shared"),"error",[{text:Granite.I18n.get("OK"),primary:true,handler:function(){}}])}).always(function(){inboxShareInboxItemDialog.get(0).hide();ui.clearWait();that.disabled=false})})}).fail(function(error){ui.alert(Granite.I18n.get("Error"),error,"error")})};window.CQ.Inbox.UI.commons.getUserNameAndIdFromAutoComplete=function(autoCompleteId){var autoCompleteElem=$(autoCompleteId);
var userId,userDisplayName;if(autoCompleteElem!=null&&autoCompleteElem.length>0){userId=autoCompleteElem.val();userDisplayName=userId;var inputElem=autoCompleteElem.find("input");if(inputElem!=null&&inputElem.length>0)userDisplayName=inputElem.val()}return{id:userId,displayName:userDisplayName}};function resetShareInboxItemDialog(tableObject,formObject){if(tableObject.length>0)tableObject.get(0).items.clear();if(formObject.length>0)formObject.get(0).reset()}function getExplicitShareUsersList(tableId,
columnClass){var userList=[];var elementList=$(tableId+" tr td."+columnClass+" span");$.each(elementList,function(index,element){userList.push(element.innerText)});return userList}function saveExplicitSharingList(inboxItemId,postDataSelector,usersList,successURL,shouldReload){var submitAction="/bin/workflow/inbox";var data={"cmd":"share",":status":"browser","_charset_":"utf-8","item":inboxItemId};data[postDataSelector+inboxItemId]=usersList.join(",");return $.ajax({url:submitAction,type:"POST",data:data})}
function getShareDialogTitle(itemTitle){if(itemTitle)return Granite.I18n.get("Share '{0}'",[itemTitle],"the title of item to be shared");else return Granite.I18n.get("Share Inbox Item")}function checkDuplicateUsers(tableId,elementId){return getExplicitShareUsersList(tableId,INBOX_SHARE_INBOX_ITEM_WITH_USER).indexOf($(elementId).val())>=0?true:false}var workitemActionDialogNS=".cq-inbox-workitem-action-dialog";function submitInjectedDialogToPayload(payloadPath){var deferred=$.Deferred();if(payloadPath&&
payloadPath.length){var originalDialog=$(".external-dialog-injection");var dialogClone=originalDialog.clone();var dialogForm=$("\x3cform\x3e");var originalDialog=originalDialog.replaceWith(dialogClone);dialogForm.append(originalDialog);dialogForm.append('\x3cinput type\x3d"hidden" name\x3d":status" value\x3d"browser"/\x3e');var dialogData=dialogForm.serializeAsJSON();if(hasDotSlash(dialogData)){var decoy=$(".external-dialog-injection");decoy.replaceWith(originalDialog);$.ajax({type:"POST",url:Granite.HTTP.externalize(payloadPath),
data:dialogData}).done(function(){var formData=originalDialog.closest("form").serializeAsJSON();deferred.resolve(formData)}).fail(function(jqXHR,textStatus,errorThrown){deferred.reject(jqXHR,textStatus,errorThrown)})}else{var formData=originalDialog.closest("form").serializeAsJSON();deferred.resolve(formData)}}else deferred.resolve();return deferred}function renderSuccessPage(successURL,shouldReload){var omniSearchForm=$(".granite-omnisearch-form");if(omniSearchForm.length>0)omniSearchForm.submit();
else if(successURL)window.location.href=Granite.HTTP.getContextPath()+successURL;else if(shouldReload){if(shouldReload===true)window.location.reload(true)}else window.location.reload(true)}function hasDotSlash(dialogData){if(dialogData)for(var property in dialogData)if(dialogData.hasOwnProperty(property))if(property.startsWith("./"))return true;return false}function doWorkitemAction(itemId,dropdownSelector,dropdownJSONSelector,dropdownLabel,title,errorMessage,command,postDataSelector,isSelectReadonlyCallback,
abortActionCallback,successHref,injectCustomDialog){var dialog=$("#workitemCompletionDialog");CQ.Inbox.UI.commons.removeDialog(dialog,DIALOG_PATH);CQ.Inbox.UI.commons.loadDialog(DIALOG_PATH).done(function(){var routeSourceURL=itemId+dropdownSelector;$("#workitemCompletionDialog coral-dialog-header").text(title);var xhr=$.get(Granite.HTTP.externalize(routeSourceURL)).done(function(routeInfoAsJSON){var workitemRoutes;if(routeInfoAsJSON&&routeInfoAsJSON[dropdownJSONSelector])workitemRoutes=routeInfoAsJSON[dropdownJSONSelector];
$(".cq-inbox-dialog-injection-anchor").empty();loadCustomDialogInjection(itemId,injectCustomDialog).done(function(injectionHTML){if(injectionHTML){$(".cq-inbox-dialog-injection-anchor").append(injectionHTML);$(".cq-inbox-dialog-injection-anchor").trigger("foundation-contentloaded")}var submitAction="/bin/workflow/inbox";var form=$("#updatetaskform");var dialog=$("#workitemCompletionDialog");var select=dialog.find("coral-select").get(0);if(select&&select.items)select.items.clear();var commentField=
$("[name\x3dcomment]",dialog);if(commentField)commentField.val("");if(workitemRoutes&&workitemRoutes.length>0){select.show();for(var routeIndex=0;routeIndex<workitemRoutes.length;routeIndex++){var workitemRoute=workitemRoutes[routeIndex];select.items.add({content:{innerHTML:workitemRoute.label_xss},value:workitemRoute.rid})}}else select.hide();$(".workitem-dialog-select").parent().find("label").text(dropdownLabel);var $select=$(".workitem-dialog-select");var coralSelect=$select[0];coralSelect.readOnly=
isSelectReadonlyCallback(workitemRoutes);if(abortActionCallback&&abortActionCallback(workitemRoutes))return;var coralDialog=dialog.get(0);coralDialog.show();dialog.find(".coral3-Dialog-closeButton").off("click"+workitemActionDialogNS).on("click"+workitemActionDialogNS,function(){$(".cq-inbox-dialog-injection-anchor").empty()});dialog.find(".workitem-complete-dialog-cancel").off("click"+workitemActionDialogNS).on("click"+workitemActionDialogNS,function(){$(".cq-inbox-dialog-injection-anchor").empty()});
dialog.find(".workitem-complete-dialog-submit").off("click"+workitemActionDialogNS).on("click"+workitemActionDialogNS,function(){var that=this;if(!checkRouteSelection())return;if(!validateFormFields(dialog))return;ui.wait();this.disabled=true;var injectedSubmitDeferred=$.Deferred();var payloadPath=$(".external-dialog-injection").data("payloadpath");$("form coral-fileupload").each(function(index,element){var name=$(element).attr("name");if(name)if(name.indexOf("./")==0)name=name.substr(1);$(element)[0].action=
Granite.HTTP.getContextPath()+payloadPath+name;$(element)[0].upload()});if(injectionHTML&&payloadPath)injectedSubmitDeferred=submitInjectedDialogToPayload(payloadPath);else injectedSubmitDeferred.resolve();injectedSubmitDeferred.done(function(extendedFormData){submitForm(form,submitAction,itemId,command,postDataSelector,extendedFormData).done(function(){$(".cq-inbox-dialog-injection-anchor").remove();if(successHref)window.location=Granite.HTTP.getContextPath()+successHref;else window.location.reload(true)}).fail(function(xhr){form.trigger("foundation-form-submit-callback",
[xhr]);coralDialog.hide();ui.clearWait();that.disabled=false}).done(function(){$(".cq-inbox-dialog-injection-anchor").empty()})})})}).fail(function(){ui.prompt(title,errorMessage,"error",[{text:Granite.I18n.get("OK"),primary:true,handler:function(){window.location.reload(true)}}])})}).fail(function(){ui.prompt(title,errorMessage,"error",[{text:Granite.I18n.get("OK"),primary:true,handler:function(){window.location.reload(true)}}])})}).fail(function(error){ui.alert(Granite.I18n.get("Error"),error,"error")})}
function checkRouteSelection(){var actionSelect=$("#workitemCompletionDialog").find("coral-select");if(actionSelect.length>0)if(!actionSelect[0].hidden)if(!actionSelect.val())return false;return true}function loadCustomDialogInjection(itemId,checkForDialog){var deferred=$.Deferred();if(itemId&&checkForDialog){var url=Granite.HTTP.externalize("/libs/cq/inbox/content/inbox/dialogs/dialogInjectionRender.html?item\x3d"+encodeURIComponent(itemId)+"\x26ch_ck\x3d"+Date.now());$.get(url).done(function(injectionHTML){deferred.resolve(injectionHTML)}).fail(function(){deferred.reject(Granite.I18n.get("Unable to load "+
itemId))})}else deferred.resolve();return deferred.promise()}function submitForm($form,postUrl,taskId,command,postDataSelector,extendedFormdata){var $nextStepSelect=$("#workitemCompletionDialog").find("coral-select");var coralNextStepSelect=$nextStepSelect[0];var data={"cmd":command,":status":"browser","_charset_":"utf-8","item":taskId};if(extendedFormdata)$.extend(data,extendedFormdata);data[postDataSelector+taskId]=coralNextStepSelect.value;data["comment-"+taskId]=$("[name\x3dcomment]","#workitemCompletionDialog").val();
return $.ajax({url:postUrl,type:"POST",data:data})}function validateFormFields(dialog){var isFormValid=true;var fields=dialog.find(".coral-Form-field").toArray();fields.forEach(function(field){var api=$(field).adaptTo("foundation-validation");if(api){if(!api.checkValidity())isFormValid=false;api.updateUI()}});return isFormValid}})(Granite.$,Granite);
(function($,Granite,undefined){var ns=".cq-inbox-list";var ui=$(window).adaptTo("foundation-ui");window.CQ.Inbox.UI.commons.approveRejectTask=function(submitAction,itemId,taskActions,actionTaken){var form=$("#updatetaskform");var approveUrl="/bin/workflow/inbox/access/approve";submitForm(form,true,submitAction,itemId,actionTaken).done(function(){if(actionTaken==="APPROVE"){var data={":status":"browser","_charset_":"utf-8","item":itemId};$.ajax({url:approveUrl,type:"POST",data:data})}renderSuccessPage()}).fail(function(xhr){form.trigger("foundation-form-submit-callback",
[xhr]);ui.clearWait();that.disabled=false})};window.CQ.Inbox.UI.commons.completeTask=function(submitAction,itemId,taskActions){var form=$("#updatetaskform");var dialog=$("#taskCompletionDialog");var select=dialog.find("coral-select").get(0);if(select&&select.items)select.items.clear();var commentField=$("[name\x3dcomment]",dialog);if(commentField)commentField.val("");if(taskActions&&taskActions.length>0){select.show();for(var actionIndex=0;actionIndex<taskActions.length;actionIndex++){var taskAction=
taskActions[actionIndex];select.items.add({content:{innerHTML:taskAction.actionName},value:taskAction.actionId})}}else select.hide();dialog.get(0).show();dialog.find(".task-complete-dialog-submit").off("click"+ns).on("click"+ns,function(){var that=this;if(!checkTaskAction())return;ui.wait();this.disabled=true;submitForm(form,true,submitAction,itemId).done(function(){window.location.reload(true)}).fail(function(xhr){form.trigger("foundation-form-submit-callback",[xhr]);dialog.get(0).hide();ui.clearWait();
that.disabled=false})})};window.CQ.Inbox.UI.commons.reassignTask=function(submitAction,itemId,projectPath){var form=$("#updatetaskform");var dialog=$("#taskReAssignDialog");var $cuiSelectList=$(".coral-Autocomplete .coral-SelectList");var originalURL=$cuiSelectList.attr("data-task-original-url");var updatedURL=$cuiSelectList.attr("data-granite-autocomplete-src");if(originalURL===undefined||originalURL===""){$cuiSelectList.attr("data-task-original-url",updatedURL);originalURL=updatedURL}$cuiSelectList.attr("data-granite-autocomplete-src",
originalURL+"\x26projectPath\x3d"+projectPath);var select=dialog.find("coral-select").get(0);if(select&&select.items)select.items.clear();dialog.get(0).show();dialog.find(".task-reassign-dialog-submit").off("click"+ns).on("click"+ns,function(){var that=this;ui.wait();this.disabled=true;submitReassignForm(form,true,submitAction,itemId).done(function(){window.location.reload(true)}).fail(function(xhr){form.trigger("foundation-form-submit-callback",[xhr])}).always(function(){dialog.get(0).hide();ui.clearWait();
that.disabled=false})})};function renderSuccessPage(){var omniSearchForm=$(".granite-omnisearch-form");if(omniSearchForm.length>0)omniSearchForm.submit();else window.location.reload(true)}function checkTaskAction(){var actionSelect=$("#taskCompletionDialog").find("coral-select");if(actionSelect.length>0)if(!actionSelect[0].hidden)if(!actionSelect.val())return false;return true}function submitForm($form,completeTask,postUrl,taskId,actionTaken){var taskModel=$form.serializeAsJSON();taskModel["ownerId"]=
taskModel["assignee"];delete taskModel["assignee"];taskModel["title"]=taskModel["name"];if(completeTask){if(actionTaken)taskModel["action"]=actionTaken;else{var $actionSelect=$("#taskCompletionDialog").find("coral-select");if($actionSelect.length>0){var coralActionSelect=$actionSelect[0];if(!coralActionSelect.hidden)taskModel["action"]=coralActionSelect.value}}taskModel["comment"]=$("[name\x3dcomment]","#taskCompletionDialog").val();taskModel["status"]="COMPLETE";return saveTask(postUrl,taskId,taskModel)}else return saveTask(postUrl,
taskId,taskModel)}function submitReassignForm($form,reassignTask,postUrl,taskId){var taskModel=$form.serializeAsJSON();taskModel["ownerId"]=taskModel["assignee"];delete taskModel["assignee"];taskModel["title"]=taskModel["name"];if(reassignTask){taskModel["ownerId"]=$("[name\x3dassignee]","#taskReAssignDialog").val();return saveTask(postUrl,taskId,taskModel)}else return saveTask(postUrl,taskId,taskModel)}function saveTask(postUrl,taskId,data){var url=Granite.HTTP.externalize(postUrl);url+="?taskId\x3d"+
encodeURIComponent(taskId);if(data["action"]){url+=(url.indexOf("?")>0?"\x26":"?")+"selectedAction\x3d"+encodeURIComponent(data["action"]);delete data["action"]}url+="\x26_charset_\x3dutf-8";var jsonTask=createJSONTask(data);return $.ajax({type:"POST",url:url,contentType:"application/json",processData:false,data:JSON.stringify(jsonTask)})}function createJSONTask(formDataAsJSON){var result={};setTaskProperty("description",result,formDataAsJSON);setTaskProperty("instructions",result,formDataAsJSON);
setTaskProperty("name",result,formDataAsJSON);setTaskProperty("ownerId",result,formDataAsJSON);setTaskProperty("status",result,formDataAsJSON);setTaskProperty("value",result,formDataAsJSON);setTaskProperty("contentPath",result,formDataAsJSON);result.properties={};for(var property in formDataAsJSON)if(formDataAsJSON.hasOwnProperty(property)&&!property.startsWith(":"))result.properties[property]=formDataAsJSON[property];return result}function setTaskProperty(propertyName,result,original){if(original.hasOwnProperty(propertyName)&&
original[propertyName]){result[propertyName]=original[propertyName];delete original[propertyName]}}function getUrlVar(key){var result=(new RegExp(key+"\x3d([^\x26]*)","i")).exec(window.location.search);return result&&decodeURIComponent(result[1])||""}$.fn.serializeAsJSON=function(){var o={};var a=this.serializeArray();$.each(a,function(){if(o[this.name]){if(!o[this.name].push)o[this.name]=[o[this.name]];o[this.name].push(this.value||"")}else o[this.name]=this.value||""});return o}})(Granite.$,Granite);
(function(document,$,Granite){var INBOX_SHARE_INBOX_ITEM_SAVE=".inbox-share-inbox-item-save";var ns=".cq-inbox-share";var FOUNDATION_COLLECTION_ITEM="foundation-collection-item";var REQUEST_STATUS="requestStatus";var TABLE_EMPTY_TEXT="There is no item.";var STATUS_MAP={pending:Granite.I18n.get("Request Pending"),rejected:Granite.I18n.get("Rejected")};var HAS_ACCESS_TO_TABLE="#has-access-to-table";var CQ_INBOX_DATA_WORKFLOW_ID="data-workflow-id";var CQ_INBOX_WORKFLOW_ID_CELL="workflow-id-cell";window.CQ.Inbox.UI.sharingtableUtils.createCell=
function(cellClass,text,cellAttributes){var cell=new Coral.Table.Cell;if(cellClass)cell.classList.add(cellClass);if(cellAttributes)for(var keyName in cellAttributes)cell.setAttribute(keyName,cellAttributes[keyName]);var span=document.createElement("span");span.innerText=text;cell.appendChild(span);return cell};window.CQ.Inbox.UI.sharingtableUtils.removeTableRow=function(rowElement,tableClass,tableId,includeEmptyRow){var tableSelector=tableClass||tableId;var table=rowElement.parents(tableSelector);
if(table.length&&rowElement.length)table.get(0).items.remove(rowElement.get(0));if(includeEmptyRow&&table.get(0).items.length===0)window.CQ.Inbox.UI.sharingtableUtils.addEmptyRow(table)};window.CQ.Inbox.UI.sharingtableUtils.toggleTableVisibility=function(tableId,tableContainerObject,buttonSelector){var tableObject=tableContainerObject.find(tableId);if(tableObject.length)if(tableObject.get(0).items.length>0){tableContainerObject.show();$(buttonSelector).attr("disabled",false)}else{tableContainerObject.hide();
$(buttonSelector).attr("disabled",true)}};window.CQ.Inbox.UI.sharingtableUtils.toggleButton=function(tableId,elementId,buttonId,isEntryUniqueCallback){if(buttonId!==null)if($(elementId).val()&&isEntryUniqueCallback(tableId,elementId))$(buttonId).attr("disabled",false);else $(buttonId).attr("disabled",true)};window.CQ.Inbox.UI.sharingtableUtils.addEmptyRow=function(tableObject){if(tableObject&&tableObject.length){var row=tableObject[0].items.add({});var cell=new Coral.Table.Cell;cell.set({content:{textContent:Granite.I18n.get(TABLE_EMPTY_TEXT)}});
cell.setAttribute("alignment","center");cell.setAttribute("colspan","3");row.appendChild(cell)}};window.CQ.Inbox.UI.sharingtableUtils.addTableRow=function(tableId,rowData,idCellClass,deleteButtonClass,deleteRowCallback,addRequestStatusCell,handleEmptyRow){var row,index,itemToRemove;var table=$(tableId);if(handleEmptyRow&&!window.CQ.Inbox.UI.sharingtableUtils.hasTableData(table))window.CQ.Inbox.UI.sharingtableUtils.removeEmptyRow(table);if(table.length>0){row=table.get(0).items.add({});row.classList.add(FOUNDATION_COLLECTION_ITEM);
index=getRejectedRequestIndex(table,rowData);if(index>=0){itemToRemove=table.get(0).items.getAll()[index];$(itemToRemove).remove()}row.appendChild(CQ.Inbox.UI.sharingtableUtils.createCell(null,Granite.I18n.get(rowData.displayName)));row.appendChild(CQ.Inbox.UI.sharingtableUtils.createCell(idCellClass,rowData.id));if(addRequestStatusCell){var statusCell=CQ.Inbox.UI.sharingtableUtils.createCell(REQUEST_STATUS,Granite.I18n.get(rowData.status));statusCell.setAttribute("alignment","center");row.appendChild(statusCell)}if(tableId===
HAS_ACCESS_TO_TABLE){var workflowIdCell=window.CQ.Inbox.UI.sharingtableUtils.createCell(CQ_INBOX_WORKFLOW_ID_CELL,null,{CQ_INBOX_DATA_WORKFLOW_ID:null});row.appendChild(workflowIdCell)}if(deleteButtonClass){var cell=new Coral.Table.Cell;var button=(new Coral.Button).set({icon:"delete",iconSize:"S",variant:"minimal"});button.classList.add(deleteButtonClass);cell.setAttribute("alignment","right");cell.appendChild(button);row.appendChild(cell);$(button).off("click"+ns).on("click"+ns,function(event){deleteRowCallback(event,
tableId)})}}};window.CQ.Inbox.UI.sharingtableUtils.hasTableData=function(tableObject){var allRows=tableObject.get(0).items.getAll();return allRows[0].cells.length<=1?false:true};window.CQ.Inbox.UI.sharingtableUtils.removeEmptyRow=function(tableObject){tableObject.get(0).items.getAll()[0].remove()};function getRejectedRequestIndex(tableObject,rowData){var i,items,length;items=tableObject.get(0).items.getAll();length=items.length;for(i=0;i<length;i++){var id=$(items[i]).find(".has-access-to-user-id span").text();
var status=$(items[i]).find(".requestStatus span").text().trim();if(id===rowData.id&&status===STATUS_MAP.rejected)return i}return-1}})(document,Granite.$,Granite);
(function($,ns,channel,window,undefined){var detailPagePath="/mnt/overlay/cq/inbox/content/inbox/details/workitem";channel.on("click",".editor-StatusBar-action[data-status-action-id\x3dworkflow-complete]",function(){var statusData=$(this).data("statusData");CQ.Inbox.UI.commons.completeWorkitem(statusData.workItemId)});channel.on("click",".editor-StatusBar-action[data-status-action-id\x3dworkflow-stepback]",function(){var statusData=$(this).data("statusData");CQ.Inbox.UI.commons.stepBackWorkitem(statusData.workItemId)});
channel.on("click",".editor-StatusBar-action[data-status-action-id\x3dworkflow-delegate]",function(){var statusData=$(this).data("statusData");CQ.Inbox.UI.commons.delegateWorkitem(statusData.workItemId)});channel.on("click",".editor-StatusBar-action[data-status-action-id\x3dworkflow-viewdetails]",function(){var statusData=$(this).data("statusData");var workItemId=statusData.workItemId;var url=Granite.HTTP.externalize(detailPagePath+".html?item\x3d"+workItemId);window.open(url)})})(jQuery,Granite.author,
jQuery(document),this);