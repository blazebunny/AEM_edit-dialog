(function(c,f,h,l,k,m){c(k).on("foundation-contentloaded",function(e){e=c(e.target);e.hasClass("cq-Dialog")&&e.find(".ac-Scene7-parameters").each(function(){function e(){var b=d.map(function(){var a=c(this).find(".coral-Form-fieldlabel").text(),b=c(this).find(".js-ac-scene7-input").val();return a+"\x3d"+b}).get().join("\x26");a.val(b)}var b=c(this),a=b.find(".js-ac-scene7-substitutions"),d=b.find(".coral-Form-fieldwrapper");d.each(function(){var a=c(this).find(".js-ac-scene7-input"),b=c(this).find(".js-ac-scene7-reset");
a.on("change keyup",e);b.click(function(){a.val(decodeURIComponent(c(this).attr("data-original-value")));e()})})})})})(jQuery,Granite,jQuery(document),this,document);(function(c,f){c(f).on("dialog-ready",function(){})})($,document);(function(c,f){c(f).on("dialog-ready",function(){})})($,document);(function(c,f){c(f).on("dialog-ready",function(){})})($,document);
(function(c,f){function h(a){(a=c(a.target).val())&&"||"!=a||!n()?e(!1):e(!0)}function l(a){k(c(a.target).val())}function k(a){"image"==a?(c("#viewerPreset").parent().hide(),c("#imagePreset").parent().show(),c("#s7URLModifiers").parent().show(),c("#s7ViewerModifiers").parent().hide(),f.getElementById("s7ViewerModifiers").value="",d(c("#viewerPreset")),m(),e(!0)):"smartCrop"==a?(c("#viewerPreset").parent().hide(),c("#imagePreset").parent().hide(),c("#s7URLModifiers").parent().show(),c("#s7Breakpoints").parent().hide(),
c("#s7ViewerModifiers").parent().hide(),f.getElementById("s7ViewerModifiers").value="",d(c("#viewerPreset")),d(c("#imagePreset")),e(!0),g(!1)):(c("#viewerPreset").parent().show(),c("#imagePreset").parent().hide(),c("#s7URLModifiers").parent().hide(),f.getElementById("s7URLModifiers").value="",c("#s7Breakpoints").parent().hide(),c("#s7ViewerModifiers").parent().show(),d(c("#imagePreset")),e(!1),g(!0))}function m(){p(c("#imagePreset"),function(a){a?(c("#s7Breakpoints").parent().hide(),g(!0),c("#s7Breakpoints").val("")):
(c("#s7Breakpoints").parent().show(),g(!1))})}function e(a){a?(c("#dmLinkUrl").parent().show(),c("#dmLinkTarget").parent().show(),c("#dmAltText").parent().show()):(c("#dmLinkUrl").parent().hide(),c("#dmLinkTarget").parent().hide(),c("#dmAltText").parent().hide())}function g(a){a?(c("#dmHeight").parent().show(),c("#dmWidth").parent().show()):(c("#dmHeight").parent().hide(),c("#dmWidth").parent().hide())}function b(a,b){a.find('[type\x3d"radio"]').each(function(){c(this).prop("checked",c(this).val()==
b)})}function a(a,b){a=a.find('[type\x3d"radio"]');var d=b;a.each(function(){c(this).prop("checked")&&(d=c(this).val())});return d}function d(a){a.find("coral-select-item[selected]").removeAttr("selected");a.find("button").find("span").html("NONE")}function n(){return"Image"==c("#s7AssetType").val()}function p(a,b){var d=a.val();if(""==d)b(!0);else{var e="/conf/global/settings/dam/dm/presets/macros/"+d+".children.3.json";c.get(e,function(a){0<a.length?a[0].hei&&a[0].wid?b(!0):b(!1):(e="/etc/dam/imageserver/macros/"+
d+".children.3.json",c.get(e,function(a){0<a.length&&a[0].hei&&a[0].wid?b(!0):b(!1)}))})}}c(f).on("dialog-ready",function(){c("#s7PresetType").off("change",l);c("#imagePreset").off("change",m);c("#s7PresetType").on("change",l);c("#imagePreset").on("change",m);c("#viewerPreset").on("change",h);Coral.commons.ready(c("#s7PresetType").get(0),function(){var d=c("#viewerPreset").val(),f=c("#imagePreset").val(),g=c("#s7Breakpoints").val(),p=a(c("#s7PresetType"),"image");g=g?g.trim():g;if(n())if(d&&"||"!=
d)e(!1),k("viewer"),b(c("#s7PresetType"),"viewer");else{e(!0);if(f&&""!=f||g||"smartCrop"!=p)p="image";k(p);b(c("#s7PresetType"),p)}else c("#imagePreset").parent().hide(),c("#s7PresetType").parent().hide(),c("#s7URLModifiers").parent().hide(),c("#s7Breakpoints").parent().hide(),e(!1),b(c("#s7PresetType"),"viewer")})})})($,document);
(function(c,f){var h=function(c){var k;f.ajax({url:location.protocol+"//"+location.host+c+"/jcr:content.targetactivities.json",async:!1,success:function(c,e,f){"success"==e&&(k=c)}});return k};f(c).on("foundation-contentloaded.cq-siteadmin-admin-properties",function(){var l=f("coral-select[name\x3d'./cq:target-ambits']",f(this));if(0<l.length)l.on("change",function(k){if((k=(k=k.currentTarget&&k.currentTarget.selectedItem?k.currentTarget.selectedItem.value:void 0)?h(k):void 0)&&k.activities&&0<k.activities.length){k=
k.activities;var m=f(c.createElement("div")),e=f(c.createElement("p")).appendTo(m);1===k.length?e.text(Granite.I18n.get("Your change will affect the following activity which will be re-synced:")):e.text(Granite.I18n.get("Your change will affect the following activities which will be re-synced:",k.length));e=[];for(var g=Math.min(k.length,12),b=0;b<g;b++){var a=k[b]["jcr:title"]||k[b].path;e.push(f(c.createElement("b")).text(a).prop("outerHTML"))}k.length>g&&e.push("\x26#8230;");f(c.createElement("p")).html(e.join("\x3cbr\x3e")).appendTo(m);
f(window).adaptTo("foundation-ui").prompt(Granite.I18n.get("Affected activities"),m.html(),"notice",[{text:Granite.I18n.get("Close")}])}})})})(document,Granite.$);
(function(c,f,h){function l(){var a=h.Deferred();h.get(f.HTTP.externalize(E.dataset.effectiveAclSrc),{_dc:(new Date).getTime()}).done(function(b){var d=h.parseHTML(b);Coral.commons.ready(E,function(){var b,c;for(b=0;b<d.length;b++){var e=d[b];if(e.querySelector&&(c=e.querySelector(".foundation-collection")))break}c&&(c.classList.contains("list")||c.classList.add("list"),E.content.innerHTML=null,E.content.appendChild(c));c=E.content.querySelectorAll(".shortenpath");for(b=0;b<c.length;b++)e=h(c[b]),
e.data("shortened")||((new f.UI.Shortener(e)).shorten(),e.data("shortened",!0));a.resolve()})});return a.promise()}function k(a,b,d){if(a=a.querySelector(b))a.checked=d}function m(a){var b=a.currentTarget;if(a.matchedTarget.classList.contains("js-cq-sites-PermissionsProperties-acl--read")){if(!a.target.checked){var d=b.querySelectorAll(".js-cq-sites-PermissionsProperties-acl");if(d)for(var c=0;c<d.length;c++)d[c].checked=!1}}else a.matchedTarget.classList.contains("js-cq-sites-PermissionsProperties-acl--modify")?
a.target.checked||(b.querySelector(".js-cq-sites-PermissionsProperties-acl--delete").checked=!1):a.matchedTarget.classList.contains("js-cq-sites-PermissionsProperties-acl--delete")&&a.target.checked&&(b.querySelector(".js-cq-sites-PermissionsProperties-acl--modify").checked=!0);a.target.checked&&(a=b.querySelector(".js-cq-sites-PermissionsProperties-acl--read"))&&(a.checked=!0)}function e(a,b){k(a,".js-cq-sites-PermissionsProperties-acl--read",b.read);k(a,".js-cq-sites-PermissionsProperties-acl--modify",
b.modify);k(a,".js-cq-sites-PermissionsProperties-acl--delete",b["delete"]);k(a,".js-cq-sites-PermissionsProperties-acl--replicate",b.replicate);k(a,".js-cq-sites-PermissionsProperties-acl--create",b.create);b=!a.querySelector(".js-cq-sites-PermissionsProperties-acl input[type\x3d'checkbox']:checked");a.querySelector(".js-cq-sites-PermissionsDialog-aclSubmit").disabled=b}function g(a){if(a&&!a.querySelector(".js-cq-sites-PermissionsProperties-row--empty")){var b=a.querySelector("tbody");b||(b=document.createElement("tbody",
"coral-table-body"),a._elements.table.appendChild(b));b.appendChild(h(U(I))[0])}}function b(a){var b=a.target.closest(".js-cq-sites-PermissionsProperties-row"),d=JSON.parse(b.dataset.acl);Q.prompt(z.deletePermissionsTitle,z.deletePermissionsDescription,"error",[{text:z.cancel,id:"no"},{text:z.deleteText,id:"yes",warning:!0}],function(a){"yes"===a&&(a={type:"POST",data:{principalName:d.principalName,path:f.HTTP.encodePath(x),action:"remove",_charset_:"UTF-8"},complete:function(a,d){"success"===d&&
(a=b.closest("table[is\x3d'coral-table']"),h(b).remove(),a&&1>a.items.length&&g(a))}},h.ajax(f.HTTP.externalize(x+".pagepermissions.conf"),a))})}function a(a,b){return{name:a,value:b[a]}}function d(b){var d=[];d.push(a("read",b));d.push(a("modify",b));d.push(a("delete",b));d.push(a("replicate",b));d.push(a("create",b));return d}function n(a,b){return a.querySelector(".js-cq-sites-PermissionsProperties-acl--"+b).checked}function p(a){if(a=A.querySelectorAll(".js-cq-sites-CreatePermissionsDialog-authorizableList coral-taglist[foundation-autocomplete-value] coral-tag")){for(var b=
[],d=0;d<a.length;d++){var c=a[d],e=c.label.innerText.trim();b.push({principalName:c.dataset.foundationAutocompleteCustomPrincipalname,avatar:c.dataset.foundationAutocompleteCustomImage,label:e,read:n(A,"read"),modify:n(A,"modify"),"delete":n(A,"delete"),replicate:n(A,"replicate"),create:n(A,"create"),hasAclEdit:!0})}K(b)}}function y(a){if(a=N.querySelectorAll(".js-cq-sites-CUGPermissionsDialog-authorizableList coral-taglist[foundation-autocomplete-value] coral-tag")){for(var b=[],d=0;d<a.length;d++){var c=
a[d],e=c.label.innerText.trim();b.push({principalName:c.dataset.foundationAutocompleteCustomPrincipalname||e,avatar:c.dataset.foundationAutocompleteCustomImage||"/libs/granite/security/clientlib/themes/default/resources/sample-group-thumbnail.36.png",label:e,read:!0,modify:!1,"delete":!1,replicate:!1,create:!1,hasAclEdit:!0})}v(b)}}function F(a){var b=[];a=document.querySelectorAll(a);for(var d=0;d<a.length;d++){var c=a[d].dataset.acl;c&&(c=JSON.parse(c),b.push({principalName:c.principalName,avatar:c.avatar,
label:c.label,read:c.read,modify:c.modify,"delete":c["delete"],replicate:c.replicate,create:c.create,hasAclEdit:c.hasAclEdit}))}return b}function v(a){var b,d,c=[];a=a||[];for(b=0;b<a.length;b++)c.push(a[b].principalName);var e=F(".js-cq-sites-PermissionsProperties-row--closedUserGroup");for(b=0;b<e.length;b++)c.push(e[b].principalName);var k=!1;1>c.length&&(k=!0,c.push(""));c={type:"POST",data:{principalNames:c,_charset_:"UTF-8"},complete:function(c,f){if("success"===f)if(1>e.length&&(!a||1>a.length))g(document.querySelector(".js-cq-sites-ClosedUserGroup-permissions"));
else for(k||(c=w.querySelector("tbody tr:not(.js-cq-sites-PermissionsProperties-row)"))&&c.parentNode.removeChild(c),b=0;b<a.length;b++){c=!1;f=a[b];for(d=0;d<e.length;d++)if(f.principalName===e.principalName){c=!0;break}c||r(w,f,".js-cq-sites-PermissionsProperties-row--closedUserGroup",".js-cq-sites-ClosedUserGroup-permissions .js-cq-sites-PermissionsProperties-row--empty",O)}}};h.ajax(f.HTTP.externalize(x+".cugpolicy.conf"),c)}function D(a){Q.prompt(z.deleteCUGEntryTitle,z.deleteCUGEntryDescription,
"error",[{text:z.cancel,id:"no"},{text:z.deleteText,id:"yes",warning:!0}],function(b){"yes"===b&&(b=a.target.closest(".js-cq-sites-PermissionsProperties-row--closedUserGroup"),b.parentNode.removeChild(b),v())})}function G(a){N||(N=document.querySelector(".js-cq-sites-CUGPermissionsDialog"),N.on("click",".js-cq-sites-CUGPermissionsDialog-save",y));N.setAttribute("open","");(a=document.querySelector(".js-cq-sites-CUGPermissionsDialog-authorizableList"))&&a.clear()}function H(a){A||(A=document.querySelector(".js-cq-sites-CreatePermissionsDialog"),
A.on("click",".js-cq-sites-CreatePermissionsDialog-add",p),A.on("click",".js-cq-sites-PermissionsProperties-acl",m));A.setAttribute("open","");a=A;var b=document.querySelector(".js-cq-sites-CreatePermissionsDialog-authorizableList");b&&b.clear();b=a.querySelectorAll(".js-cq-sites-PermissionsProperties-acl");for(var d=0;d<b.length;d++)b[d].checked=!1;a.querySelector(".js-cq-sites-PermissionsDialog-aclSubmit").disabled=!0}function R(a){var b=a.target.closest(".js-cq-sites-PermissionsProperties-row"),
d=JSON.parse(b.dataset.acl);B||(B=document.querySelector(".js-cq-sites-EditPermissionsDialog"),B.on("click",".js-cq-sites-PermissionsProperties-acl",m));B.off("click",".js-cq-sites-EditPermissionsDialog-update").on("click",".js-cq-sites-EditPermissionsDialog-update",function(){K([{principalName:d.principalName,avatar:d.avatar,label:d.label,read:n(B,"read"),modify:n(B,"modify"),"delete":n(B,"delete"),replicate:n(B,"replicate"),create:n(B,"create"),hasAclEdit:!0}])});B.setAttribute("open","");e(B,d);
return t(a)}function K(a){var b,c=[],e=L.items.getAll(),k={};for(b=0;b<e.length;b++){var g=e[b];g.dataset.acl&&(g=JSON.parse(g.dataset.acl),k[g.principalName]=g,c.push({principalName:g.principalName,privileges:d(g)}))}if(a)for(b=0;b<a.length;b++){g=a[b];for(var p=!1,n=0;n<c.length;n++)if(g.principalName===c[n].principalName){k[g.principalName]=g;c[n]={principalName:g.principalName,privileges:d(g)};p=!0;break}p||(k[g.principalName]=g,c.push({principalName:g.principalName,privileges:d(g)}))}a={predicate:"siteadmin",
path:f.HTTP.encodePath(x),changelog:JSON.stringify(c),contentType:"application/json; charset\x3dutf-8",action:"edit",_charset_:"UTF-8"};h.post(f.HTTP.externalize(x+".pagepermissions.conf"),a,function(a,b){if("success"===b&&a.changelog){a=a.changelog;for(b=0;b<a.length;b++){var d=a[b],c;for(c in k)if(k.hasOwnProperty(c)&&c===d.principalName){var g=k[c];g.read=d.privileges.read||!1;g.modify=d.privileges.modify||!1;g["delete"]=d.privileges["delete"]||!1;g.replicate=d.privileges.replicate||!1;g.create=
d.privileges.create||!1}}h(e).remove();if(k)for(var f in k)k.hasOwnProperty(f)&&r(L,k[f],".js-cq-sites-PermissionsProperties-row",".js-cq-sites-UserGroup-permissions .js-cq-sites-PermissionsProperties-row--empty",S);q()}})}function r(a,b,d,c,e){b.data=JSON.stringify(b);var g=a.querySelector(c);g&&(c=g.parentNode,c.removeChild(g));c=a.querySelectorAll(d);for(d=0;d<c.length;d++)if(g=JSON.parse(c[d].dataset.acl),b.principalName===g.principalName){a=c[d];b=h(S(b))[0];a.parentElement.replaceChild(b,a);
return}b=h(e(b))[0];a.items.add(b)}function u(){S=function(a){return'\x3ctr is\x3d"coral-table-row" class\x3d"js-cq-sites-PermissionsProperties-row" data-acl\x3d\''+a.data+'\'\x3e\n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-labelColumn"\x3e \n                          \x3cimg class\x3d"cq-sites-Permissions-thumbnail" src\x3d"'+a.avatar+'"/\x3e\n                          \x3cspan class\x3d"cq-sites-Permissions-label"\x3e'+a.label+'\x3c/span\x3e \n                      \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+
(a.read?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+(a.modify?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+(a.delete?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+
(a.replicate?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+(a.create?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-actions"\x3e \n                          \x3cbutton is\x3d"coral-button" type\x3d"button" variant\x3d"quiet" icon\x3d"edit"  \n                                  class\x3d"js-cq-sites-PermissionsProperties-edit"\x3e\x3c/button\x3e \n                          \x3cbutton is\x3d"coral-button" type\x3d"button" variant\x3d"quiet" icon\x3d"delete" \n                                  class\x3d"js-cq-sites-PermissionsProperties-delete"\x3e\x3c/button\x3e \n                      \x3c/td\x3e \n                  \x3c/tr\x3e'};
O=function(a){return'\x3ctr is\x3d"coral-table-row"  \n                       class\x3d"js-cq-sites-PermissionsProperties-row js-cq-sites-PermissionsProperties-row--closedUserGroup"  \n                       data-acl\x3d\''+a.data+'\'\x3e\n                        \x3ctd is\x3d"coral-table-cell"\x3e \n                            \x3cimg class\x3d"cq-sites-Permissions-thumbnail" src\x3d"'+(a.avatar?a.avatar:"")+'"/\x3e\n                            \x3cspan class\x3d"cq-sites-Permissions-label"\x3e '+
a.label+' \x3c/span\x3e \n                        \x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e \n                            \x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e \n                        \x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e\x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e\x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e\x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e\x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-actions"\x3e \n                            \x3cbutton is\x3d"coral-button" type\x3d"button" variant\x3d"quiet" icon\x3d"delete"  \n                                    class\x3d"js-cq-sites-ClosedUserGroup-delete"\x3e\x3c/button\x3e \n                        \x3c/td\x3e \n                    \x3c/tr\x3e'};
U=function(a){return'\x3ctr is\x3d"coral-table-row" class\x3d"js-cq-sites-PermissionsProperties-row--empty"\x3e \n                     \x3ctd is\x3d"coral-table-cell" colspan\x3d"7" alignment\x3d"center"\x3e '+a.label+" \x3c/td\x3e \n                   \x3c/tr\x3e"}}function M(){E||(E=document.querySelector(".js-cq-sites-EffectivePermissionsDialog"));l().then(function(){E.setAttribute("open",!0)})}function C(a){var b=a.target.closest("coral-dialog");if(b){a=b.querySelectorAll(".js-cq-sites-PermissionsProperties-acl");
b=b.querySelector(".js-cq-sites-PermissionsDialog-aclSubmit");for(var d=!0,c=0;c<a.length;c++)if(a[c].checked){d=!1;break}b.disabled=d}}function P(){var a=document.querySelector("[data-deprecated-cugconfig]"),b=document.querySelector(".js-cq-sites-ClosedUserGroupDialog-show");a&&b&&(b.disabled=!0)}function t(a){a.preventDefault();a.stopPropagation();h(".coral-Table-row--placeholder").remove();return!1}function q(){h(".js-cq-sites-PermissionsProperties-edit").on("mousedown",t);h(".js-cq-sites-PermissionsProperties-edit").on("mouseup",
t);h(".js-cq-sites-PermissionsProperties-delete").on("mousedown",t);h(".js-cq-sites-PermissionsProperties-delete").on("mouseup",t)}var z={deletePermissionsTitle:f.I18n.get("Delete permission"),deletePermissionsDescription:f.I18n.get("Do you really want to delete permissions for this user/group?"),deleteCUGEntryTitle:f.I18n.get("Delete Closed User Group entry"),deleteCUGEntryDescription:f.I18n.get("Do you really want to remove the entry from the Closed User Group?"),cancel:f.I18n.get("Cancel"),deleteText:f.I18n.get("Delete"),
permissionsEmptyRowLabel:f.I18n.get("There is no item.")},Q=h(window).adaptTo("foundation-ui"),B,A,N,E,S,O,I={label:z.permissionsEmptyRowLabel},U,L,w,x,J;c.one("foundation-contentloaded",function(a){a=h(".js-cq-sites-PermissionsProperties");0<a.length&&(q(),a.on("click",".js-cq-sites-PermissionsProperties-edit",R),a.on("click",".js-cq-sites-PermissionsProperties-delete",b),a.on("click",".js-cq-sites-ClosedUserGroup-delete",D),a.on("coral-table:roworder",".js-cq-sites-UserGroup-permissions",function(){K()}),
c.on("click",".js-cq-sites-AddPermissionsDialog-show",H),c.on("click",".js-cq-sites-ClosedUserGroupDialog-show",G),c.on("click",".js-cq-sites-EffectivePermissionsDialog-show",M),c.on("click",".js-cq-sites-PermissionsProperties-acl",C),x=document.querySelector(".js-cq-sites-PermissionsProperties-pagePath").value,J=void 0!==document.querySelector(".js-cq-sites-PermissionsProperties-userAcl").dataset.userAclEdit,w=document.querySelector(".js-cq-sites-ClosedUserGroup-permissions"),L=document.querySelector(".js-cq-sites-UserGroup-permissions"),
L.orderable=J,u(),P())})})($(document),Granite,Granite.$);
(function(c,f,h,l){function k(b){var a=b;a.classList.contains("coral-TagList")||(a=l(b).parents(".coral-PathBrowser.js-cq-TagsPickerField").nextAll(".coral-TagList.js-TagsPickerField-tagList")[0]);return a}function m(b,a){var d=a.data("fieldname"),c=a.find("input[name\x3d'"+d+"'][value\x3d'"+b.tagID+"']"),e=a.hasClass("cq-TagList--patchMode")?"+"+b.tagID:b.tagID;if(0===c.length){c=l('\x3cli role\x3d"option" aria-selected\x3d"true" class\x3d"coral-TagList-tag coral-TagList-tag--multiline"/\x3e').attr("title",b.titlePath);
var g=l('\x3cbutton class\x3d"coral-MinimalButton coral-TagList-tag-removeButton" type\x3d"button"/\x3e').attr("title",h.I18n.get("Remove")),k=l('\x3ci class\x3d"coral-Icon coral-Icon--sizeXS coral-Icon--close"/\x3e');b=l('\x3cspan class\x3d"coral-TagList-tag-label"\x3e').text(b.titlePath);d=l('\x3cinput type\x3d"hidden"/\x3e').attr("name",d).attr("value",e);g.append(k);c.append(g).append(b).append(d);a.append(c);a.trigger("itemadded")}}c=l(c).adaptTo("foundation-registry");var e,g=[".coral-PathBrowser.js-cq-TagsPickerField + .coral-TagList.js-TagsPickerField-tagList",
".coral-PathBrowser.js-cq-TagsPickerField .coral-InputGroup-input.js-coral-pathbrowser-input"];c.register("foundation.adapters",{type:"foundation-field",selector:".coral-TagList.js-TagsPickerField-tagList",adapter:function(b){var a=l(b).prevAll(".coral-PathBrowser.js-cq-TagsPickerField").find(".coral-InputGroup-input.js-coral-pathbrowser-input")[0];if(a)return{isRequired:function(){return a.required},setRequired:function(b){a.required=b}}}});c.register("foundation.validation.validator",{selector:g.join(", "),
validate:function(b){b=k(b);if(b.hasAttribute("aria-required")&&0===b.querySelectorAll(".coral-TagList-tag").length)return e||(e=h.I18n.get("Please fill out this field.")),e},show:function(b,a){b=l(k(b));var d=b.adaptTo("foundation-field");d&&d.setRequired&&d.setRequired(!0);b.nextAll(".coral-Form-fieldinfo").addClass("u-coral-screenReaderOnly");if(d=b.data("foundation-validation.internal.error")){var c=l(d).data("foundation-validation.internal.error.tooltip");c.content.innerHTML=a;d.parentNode||
b.after(d,c)}else d=new Coral.Icon,d.icon="alert",d.classList.add("coral-Form-fielderror"),c=new Coral.Tooltip,c.variant="error",c.placement=b.closest("form").hasClass("coral-Form--vertical")?"left":"bottom",c.target=d,c.content.innerHTML=a,l(d).data("foundation-validation.internal.error.tooltip",c),b.data("foundation-validation.internal.error",d),b.after(d,c)},clear:function(b){b=l(k(b));var a=b.adaptTo("foundation-field");a&&a.setRequired&&a.setRequired(!1);if(a=b.data("foundation-validation.internal.error")){var d=
l(a).data("foundation-validation.internal.error.tooltip");d.hide();d.remove();a.remove()}b.nextAll(".coral-Form-fieldinfo").removeClass("u-coral-screenReaderOnly")}});CUI.PathBrowser.register("optionLoader",{name:"cq.tagbrowser.optionloader",handler:function(b,a){l.get(this.$element.data("browserpath")+".tags.json",{suggestByTitle:b,rootPath:this.$element.data("root-path"),start:0,limit:50,count:!1,_charset_:"UTF-8",replicationStateRequired:!1},function(b){b=b.tags;for(var d=[],c=0;c<b.length;c++)d.push(b[c]);
a&&a(d)},"json");return!1}});CUI.PathBrowser.register("optionValueReader",{name:"cq.tagbrowser.optionValueReader",handler:function(b){return b.path}});CUI.PathBrowser.register("optionTitleReader",{name:"cq.tagbrowser.optionTitleReader",handler:function(b){return b.titlePath}});CUI.PathBrowser.register("optionRenderer",{name:"cq.tagbrowser.optionRenderer",handler:function(b,a){b=this.options.options[a];var d="";this.options.showTitles&&this.options.optionDisplayStrings[a]&&0<this.options.optionDisplayStrings[a].length&&
(d=this.options.optionDisplayStrings[a]);return l("\x3cli\x3e",{"class":"coral-SelectList-item coral-SelectList-item--option","data-value":b}).text(d)}});CUI.PathBrowser.register("autocompleteCallback",{name:"cq.tagbrowser.autocompleteCallback",handler:function(b){var a=this,d=l.Deferred();if(a.options.optionLoader){var c={loadOptions:a.optionLoader},e=l.Deferred();e.promise(c);c.done(function(b){l.isFunction(b.promise)?b.done(function(b){a._rebuildOptions(d,"",b)}):a._rebuildOptions(d,"",b)});(b=
c.loadOptions(b,function(a){e.resolve(a)}))&&e.resolve(b)}return d.promise()}});l(f).on("click",".js-cq-TagsPickerField ~ .coral-TagList .coral-TagList-tag-removeButton",function(b){b=l(b.target).closest(".coral-TagList-tag");var a=b.parent(".coral-TagList");b.remove();a.trigger("itemremoved")});l(f).on("itemremoved",".cq-TagList--patchMode",function(b,a){b=l(this);var c=b.data("fieldname");a=a.value.replace("+","-");a=l('\x3cinput type\x3d"hidden" name\x3d"'+c+'" value\x3d"'+a+'"/\x3e');b.append(a)});
l(f).on("itemadded itemremoved",g[0],function(){var b=l(this).adaptTo("foundation-validation");b&&(b.checkValidity(),b.updateUI())});l(f).on("foundation-contentloaded",function(b){l(b.target).find(".js-cq-TagsPickerField.coral-PathBrowser").each(function(){var a=l(this).data("pathBrowser");a.$picker.off("coral-pathbrowser-picker-confirm.tagspicker").on("coral-pathbrowser-picker-confirm.tagspicker",function(b){b=a.inputElement;var c=l(this).find(".coral-ColumnView").data("columnView").getSelectedItems();
0<c.length&&(l.each(c,function(){var b=this.item,c=a.$element.siblings(".coral-TagList.js-TagsPickerField-tagList");b={titlePath:b.data("titlepath"),tagID:b.data("id")};m(b,c)}),l(b).val(""),l(".coral-ColumnView-item.is-active.is-selected",l(this)).toggleClass("is-active is-selected"))});a.dropdownList.off("selected.tagspicker").on("selected.tagspicker",function(a){var b=l(this).closest(".js-cq-TagsPickerField.coral-PathBrowser");l.get(a.selectedValue+".tag.json",{},function(a){if(void 0!==a){var c=
b.siblings(".coral-TagList.js-TagsPickerField-tagList");m(a,c);b.find(".js-coral-pathbrowser-input").val("")}else b.addClass("is-invalid"),b.focus()},"json")});a.inputElement.off("keypress.tagspicker").on("keypress.tagspicker",function(a){var b=l(this).closest(".js-cq-TagsPickerField.coral-PathBrowser");13===a.keyCode&&(a.preventDefault(),a=b.siblings(".coral-TagList.js-TagsPickerField-tagList"),b={titlePath:l(this).val(),tagID:l(this).val()},a.data("allowcreate")&&m(b,a),l(this).val(""))})})})})(window,
document,Granite,Granite.$);
(function(c,f,h,l){function k(e,g){c('[handle\x3d"remove"]',e).off("click").on("click",function(b){b.stopPropagation();b="\x3cp\x3e"+f.I18n.get("You are removing styles that might be used by one or more components on one or more pages.");b=b+"\x3cbr/\x3e"+f.I18n.get("This might lead to style changes on pages based on templates using this policy.");b+="\x3c/p\x3e";m.prompt(f.I18n.get("Delete Styles"),b,"notice",[{text:f.I18n.get("Cancel")},{text:f.I18n.get("Delete"),warning:!0,handler:function(){e.remove();
g.trigger("change")}}])})}var m=c(window).adaptTo("foundation-ui");l.on("dialog-ready",function(){c(".cq-AllowedStyles-multifield").each(function(e,g){Coral.commons.ready(g,function(b){c("coral-multifield-item",b).each(function(a,c){Coral.commons.ready(c,function(a){k(a,b)})});b.on("change",function(){c("coral-multifield-item",b).each(function(a,d){Coral.commons.ready(d,function(a){var d=c(".cq-AllowedStyles-styleId",a);d.val()||d.val(Date.now());k(a,b)})})})})})});l.on("coral-select:showitems",".cq-DefaultElement-selection",
function(e){e=e.currentTarget;var g=c(e).find("button").outerHeight(!0);g=e.items.length*(g+5);var b=parseInt(c(e).find("coral-selectlist").css("max-height"),10);g=Math.min(g,b);c(e).css("margin-bottom",g)});l.on("coral-select:hideitems",".cq-DefaultElement-selection",function(e){c(e.currentTarget).css("margin-bottom",0)})})(jQuery,Granite,Granite.author,jQuery(document));
(function(c,f,h,l,k,m){h.on("foundation-contentloaded",function(){h.find(".js-cq-DropArea").each(function(){var e=c(this);var g=e.hasClass("js-cq-DropArea--image")?Granite.I18n.get("Drop an image"):Granite.I18n.get("Drop an asset");var b=c('\x3cspan class\x3d".cq-DropArea-placeholder"\x3e'+g+"\x3c/span\x3e"),a=c('\x3cimg class\x3d"cq-DropArea-thumbnail"/\x3e');e.empty();e.append(b);e.append(a);e.on("assetSelected",function(c){c.silent&&c.stopImmediatePropagation();c=c.path;b&&0<b.length&&b.toggle(!(c&&
0<c.length));a&&0<a.length&&a.attr("src",c||"")})})})})(jQuery,Granite.author,jQuery(document),this,document);
(function(c,f,h,l,k,m){function e(a,b){if(a&&a.name&&0<a.name.length){var d=(new RegExp(/([a-zA-Z0-9_-]+)/)).exec(a.name);if(d&&1<d.length){var e="js-cq-DropArea-param-"+d[1];d="./"+a.name;P.find("."+e).remove();e=c('\x3cspan class\x3d"'+e+'"\x3e\x3c/span\x3e');b?e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'@Delete" value\x3d"true"\x3e'):(a.title?e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'/jcr:title" value\x3d"'+a.title+'"\x3e'):e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'/jcr:title@Delete" value\x3d"delete"\x3e'),
a.fileReference?e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'/fileReference" value\x3d"'+a.fileReference+'"\x3e'):e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'/fileReference@Delete" value\x3d"delete"\x3e'));P.append(e)}}}function g(a){if(a){a=a instanceof jQuery?a:c(a);var b=new RegExp(/([0-9]+)$/);var d=a.data("name");b=b.exec(d);var g;b&&(g=parseInt(b[1]));b=a.data("fileReference");var k=a.text();if(k===K||k===b)k="";d={id:g,name:d,title:k,path:a.data("path"),fileReference:b,mimeType:a.data("dataAssetMimetype")};
e(d)}return d}function b(){var a=M++;return{id:a,name:"image"+a,title:"",path:"",fileReference:"",mimeType:""}}function a(a){r=[];var c=a.items.getAll(),d=c.length;if(0<d){for(a=0;a<d;a++){var e=g(c[a]);r.push(e)}u=r[0]}else u=e=b(),r.push(e),D(e),a.value=e.name;c=-1;for(d=0;d<r.length;d++)c<r[d].id&&(c=r[d].id);M=c+1}function d(a){for(var b=0;b<r.length;b++)if(a.name===r[b].name)return b;return-1}function n(a){for(var b=t.items.getAll(),c=0,d=b.length;c<d;c++){var e=b[c];if(a===e.value)return e}}
function p(a){a&&a.name?u=a:(a=a&&0<a.length?n(a):t.items.first(),u=g(a));t.value=u.name;y(u);e(u)}function y(a){z.value=a&&a.title?a.title:"";q.trigger(c.Event("assetSelected",{path:a&&a.fileReference?a.fileReference:"",silent:!0}))}function F(a){return a.title&&0<a.title.length?a.title:a.fileReference&&0<a.fileReference?a.fileReference:K}function v(a,b){if(!b||0>b)b=d(a);-1===b?(r.push(a),b=r.length-1,D(a,b)):(b=n(a.name))&&a&&(b.content&&(b.content.textContent=F(a)),b.value=a.name,b.dataset&&(b.dataset.name=
a.name,b.dataset.path=a.path,b.dataset.fileReference=a.fileReference,b.dataset.dataAssetMimetype=a.mimeType));t.value=a.name;e(a)}function D(a,b){if(!n(a.name)){var d=t.items.getAll(),e;c.isNumeric(b)&&b<t.items.length&&(e=d[b]);b=t.items.add(R(a),e);b.dataset.name=a.name;b.dataset.path=a.path;b.dataset.fileReference=a.fileReference;b.dataset.dataAssetMimetype=a.mimeType;t.value=a.name}}function G(){var a=b();r.push(a);D(a);p(a);e(u)}function H(){var a=d(u);if(0<=a){var c=r.splice(a,1)[0];var g=t.items.length;
if(c&&a<g){0<r.length?g=0<a?a<r.length-1?r[a]:r[a-1]:r[0]:(g=b(),r.push(g),D(g));g&&g.path&&0<g.path.length&&(t.value=g.name);var k=t.items.getAll();t.items.remove(k[a]);p(g);e(c,!0)}}}function R(a){return{content:{textContent:F(a)},value:a.name}}var K=Granite.I18n.get("New slide"),r=[],u,M=0,C,P=c('\x3cspan class\x3d"js-cq-DropArea-params"\x3e\x3cinput type\x3d"hidden" name\x3d"_charset_" value\x3d"utf-8" /\x3e\x3c/span\x3e'),t,q,z;h.on("foundation-contentloaded",function(){C=c(".js-cq-Slideshow-content").eq(0);
if(0<C.length){M=0;t=C.find(".js-cq-Slideshow-select")[0];var b=C.find(".js-cq-Slideshow-add")[0],e=C.find(".js-cq-Slideshow-delete")[0];z=C.find(".js-cq-Slideshow-name")[0];q=C.find(".js-cq-Slideshow-dropArea").eq(0);0===C.find(".js-cq-DropArea-params").length&&C.prepend(P);a(t);y(u);b.on("click",G);e.on("click",H);q.on("assetSelected",function(a){u.path="";u.fileReference=a.path;u.mimeType=a.mimetype;v(u)});C.on("blur keyup",".js-cq-Slideshow-name",function(a){u.title=a.target.value;a=d(u);a<=r.length&&
v(u,a)});t.on("change",function(a){a.target.selectedItem&&p(a.target.selectedItem.value)})}})})(jQuery,Granite.author,jQuery(document),this,document);
(function(c,f,h){function l(c,g){var b=g.editorKernel;g.sourceEditMode&&b.fireUIEvent("disablesourceedit");b.hasBackgroundToolbar(c)||b.addBackgroundToolbar({tbType:c,isFullScreen:b.getEditContext().getState("fullscreenadapter").isFullScreen(),useFixedInlineToolbar:!0});b.setActiveToolbar(c)}var k=function(c,g){var b=c.data("editorType");g=c.data("externalStyleSheets");var a;if("table"===b){var d={useColPercentage:!1,rtePlugins:{table:{features:"*",defaultValues:{width:"100%"},editMode:CUI.rte.plugins.TablePlugin.EDITMODE_TABLE}}};
var e=function(a){return Granite.Util.applyDefaults({},d,a)}}var k=new CUI.RichText({element:c,componentType:b,preventCaretInitialize:!0});if(g&&0<g.length)for(g=g.split(","),b=0;b<g.length;b++){var f=h("head link[href\x3d'"+g[b]+"']");0>=f.length&&(f=h('\x3clink rel\x3d"stylesheet" href\x3d"'+g[b]+'" type\x3d"text/css"\x3e'),h("head").append(f),(a=c.data("externalStyleElements"))?a.push(f):a=[f],c.data("externalStyleElements",a))}CUI.rte.ConfigUtils.loadConfigAndStartEditing(k,c,e)};h(f).on("foundation-contentloaded",
function(c){var e=h(c.target).hasClass(".cq-RichText")?h(c.target):h(c.target).find(".cq-RichText");e.each(function(){var a=h(this);a.closest(".cq-RichText-FixedColumn-column").addClass("coral-RichText-FixedColumn-column");a.closest(".coral-RichText-FixedColumn-column:not(.cq-RichText-FixedColumn-column)").addClass("cq-RichText-FixedColumn-column")});e.each(function(){var a=h(this),b=a.find(".cq-RichText-editable");if(!b.data("rteinstance")){var c=a.find("input[type\x3d'hidden'][data-cq-richtext-input\x3d'true']").val();
b.empty().append(c)}a.on("keypress","input",function(a){13===a.keyCode&&a.preventDefault()})});e.on("change","[data-cq-richtext-editable\x3d'true']",function(){var a=h(this).closest(".cq-RichText"),b=a.find(".cq-RichText-editable").data("rteinstance");a.find("input[type\x3dhidden][data-cq-richtext-input\x3d'true']").val(b.getContent())});var b=h(c.target).find(".cq-RichText\x3e.cq-RichText-editable");b.each(function(){var a=h(this);if(a.data("customStart"))a.on("rte-start",function(){var a=h(this);
if(a.data("useFixedInlineToolbar")&&!a.data("rteinstance")){var b=h(this).parent().find("input[type\x3dhidden][data-cq-richtext-input\x3d'true']").val();a.empty().append(b);k(a)}});else a.data("useFixedInlineToolbar")&&!a.data("rteinstance")&&k(a);a.on("editing-start",function(){var a=h(this).data("rteinstance"),b=h(this),c=b.closest("coral-dialog");a.editorKernel.getToolbar().hide();c.length&&!0===c[0].fullscreen&&l("dialogFullScreen",a);b.closest("coral-dialog-content").on("click",function(b){b=
h(b.target);b.closest(".cq-RichText").length||(CUI.rte.Common.ua.isSafari&&b.is("input[type\x3d'radio'], input[type\x3d'checkbox']")&&(b=a.editorKernel.getEditContext(),CUI.rte.Selection.getSelection(b).removeAllRanges()),a.useFixedInlineToolbar&&!a.sourceEditMode&&a.editorKernel.toolbar.hide())})});h(this).on("click",function(){var a=this;b.each(function(){var b=h(this).data("rteinstance");this!==a&&b&&!b.sourceEditMode&&b.editorKernel.getToolbar().hide()})})})});var m=function(){var c=h(this);var g=
c.data("rteinstance");var b=c.data("externalStyleElements");if(g){g.finish(!1);if(b)for(g=0;g<b.length;g++)b[g].remove();c.removeData("rteinstance")}};h(f).on("dialog-beforeclose",".cq-Dialog",function(c){h(c.target).hasClass("cq-Dialog")&&h(this).find(".cq-RichText\x3e.cq-RichText-editable").each(m)});h(f).on("dialog-layouttoggle-fullscreen",".cq-Dialog",function(c){h(c.target).find(".cq-RichText\x3e.cq-RichText-editable").each(function(){var c=h(this).data("rteinstance");c&&l("dialogFullScreen",
c)})});h(f).on("dialog-layouttoggle-floating",".cq-Dialog",function(c){h(c.target).find(".cq-RichText\x3e.cq-RichText-editable").each(function(){var c=h(this).data("rteinstance");c&&l("inline",c)})});h(f).on("click",".coral-Wizard-nextButton",function(c){h(this).closest(".foundation-form").find(".cq-RichText\x3e.cq-RichText-editable").each(m)});CUI.rte.Theme.BLANK_IMAGE=Granite.HTTP.externalize("/libs/clientlibs/granite/richtext/resources/images/blank.png")})(window,document,Granite.$);
(function(c,f,h){function l(c){if(c=c.adaptTo("foundation-validation"))c.checkValidity(),c.updateUI()}var k;c=h(c).adaptTo("foundation-registry");c.register("foundation.adapters",{type:"foundation-field",selector:".cq-RichText,.cq-RichText-editable",adapter:function(c){var e=c.querySelector(".cq-RichText-editable");if(e)return{isInvalid:function(){return e.hasAttribute("invalid")},setInvalid:function(c){c?e.setAttribute("invalid",""):e.removeAttribute("invalid")},getName:function(){return e.getAttribute("name")},
setName:function(g){c.querySelector("input[type\x3d'hidden'][data-cq-richtext-input\x3d'true']").name=g;e.setAttribute("name",g)}}}});c.register("foundation.validation.selector",{submittable:".cq-RichText,.cq-RichText-editable",candidate:".cq-RichText,.cq-RichText-editable"});c.register("foundation.validation.validator",{selector:".cq-RichText,.cq-RichText-editable",validate:function(c){c=h(c).find(".cq-RichText-editable").addBack(".cq-RichText-editable");var e;if(c.data("rteinstance").sourceEditMode)return Granite.I18n.get("Please exit Source-edit mode before saving the changes");
if("true"===c.attr("aria-required")&&(c.data("rteinstance")&&(e=c.data("rteinstance").getContent()),void 0===e&&(e=c.html()),0===e.length))return k||(k=Granite.I18n.get("Please fill out this field.")),k}});h(f).on("foundation-contentloaded",function(c){h(c.target).find(".cq-RichText-editable").each(function(){h(this).on("editing-start",function(){var c=h(this);c.data("rteinstance").editorKernel.addUIListener("disablesourceedit",function(){l(c)})})})});h(f).on("change",".cq-RichText-editable",function(c){l(h(this))})})(window,
document,Granite.$);
(function(c,f,h,l,k,m){function e(a){var b="";a.duplicate&&0<a.duplicate.length&&(b+='\x3cinput type\x3d"hidden" name\x3d"'+a.absolutePath+'@CopyFrom" value\x3d"'+a.duplicate+'" /\x3e');b+='\x3cinput type\x3d"hidden" name\x3d"'+B+'/sling:resourceType" value\x3d"'+A+'" /\x3e\x3cinput type\x3d"hidden" name\x3d"'+B+'/cq:policy" value\x3d"'+a.relativePath+'" /\x3e\x3cinput type\x3d"hidden" name\x3d"./jcr:primaryType" value\x3d"nt:unstructured" /\x3e\x3cinput type\x3d"hidden" name\x3d"./jcr:content/jcr:primaryType" value\x3d"nt:unstructured" /\x3e';V=
c(".cq-Policy-params");V.empty();V.append(b)}function g(a){var b="policy_"+(new Date).getTime();return c.extend({},{title:"",text:"",description:"",absolutePath:I+b,relativePath:Q+"/"+b,type:O},a)}function b(a){for(var b=x.items.getAll(),c=0,d=b.length;c<d;c++){var e=b[c];if(a===e.value)return e}}function a(a){if(a){if(a&&a.absolutePath)q=a;else{a=a&&0<a.length?b(a):x.items.first();if(a){var d=a instanceof jQuery?a:c(a);a=d.text();var g=d.val(),k=d.text();k===P&&(k="");d={title:a,text:k,nodeName:d.attr("data-policy-name")||
"",description:d.attr("data-policy-description")||"",absolutePath:g||"",relativePath:d.attr("data-policy-relative-path")||"",type:d.attr("data-policy-resource-type")||""}}q=d}q&&(F(q.absolutePath),d=q,T.value=d&&d.text?d.text:"",X.value=d&&d.description?d.description:"",e(q),(d=q)&&w.closest("form.cq-dialog").attr("action",d.absolutePath))}}function d(a){return a.text&&0<a.text.length?a.text:a.title&&0<a.title.length?a.title:P}function n(a){return{content:{textContent:d(a)},value:a.absolutePath}}
function p(a,b){a.dataset.description=b.description;a.dataset.policyName=b.nodeName;a.dataset.policyRelativePath=b.relativePath;a.dataset.policyResourceType=b.type}function y(a,d){if(!b(a.absolutePath)){var e=x.items.getAll(),g;c.isNumeric(d)&&d<x.items.length&&(g=e[d]);d=x.items.add(n(a),g);p(d,a);F(a.absolutePath)}}function F(a){Coral.commons.ready(x,function(){x.value=a})}function v(){var b=g();y(b);a(b);K()}function D(){var b=c.extend(!0,{},q),d=t+" "+b.text,e="policy_"+(new Date).getTime();b.text=
d;b.title=d;b.nodeName=e;b.duplicate=q.absolutePath;b.absolutePath=I+e;b.relativePath=Q+"/"+e;y(b);a(b)}function G(a){return(a=b(a.absolutePath))&&a.dataset.policyPersisted}function H(){G(q)?R():f.ui.helpers.prompt({title:Granite.I18n.get("Save Policy"),message:Granite.I18n.get("You must save the current policy before opening the design dialog."),actions:[{id:"CANCEL",text:Granite.I18n.get("Cancel","Label for Cancel button")},{id:"SAVE",text:Granite.I18n.get("Save","Label for persisting the policy before opening a classic design dialog"),
primary:!0}],callback:function(a){"SAVE"===a&&w.closest("form.cq-dialog").eq(0).on("submit",R).submit()}})}function R(){c.ajax({url:L,type:"get",data:{content:q.absolutePath,resourceType:O,policy:!0}}).done(function(a){c(k.body).append(a);var b=k.querySelector(".cq-compat-dialog");c(l).on("dialogwrapper-ready",function(){b.setAttribute("backdrop","modal");b.setAttribute("movable",!0)});var d=f.DialogFrame.closeDialog;f.DialogFrame.closeDialog=function(){f.DialogFrame.closeDialog=d}})}function K(){W.wait();
c.ajax({url:U+".html"+q.absolutePath,type:"get",data:{policyContentResourceType:Q,referrer:z,resourceType:O}}).done(function(a){var b=f.DialogFrame.currentFloatingDialog.remove();a=c(a).find(".js-cq-Policy-designWrapper").children();b.find(".js-cq-Policy-designWrapper").empty().append(a);c(k.body).append(b);f.DialogFrame.currentFloatingDialog=b;W.clearWait();b.trigger("cui-contentloaded");h.trigger("dialog-ready")})}function r(){q.text=q.title=T.value;q.description=X.value;var a=q;if(a){var c=b(a.absolutePath);
c&&a&&(c.content&&(c.content.textContent=d(a)),c.value=a.absolutePath,c.dataset&&p(c,a));e(a)}M()}function u(){if(q.absolutePath.substring(0,q.absolutePath.lastIndexOf("/")+1)===I){var a=I.indexOf("/settings/wcm/policies/"),b=I.substr(0,a+23-1);a=I.substr(a+23,I.length);var d={};if(1>a.length)return c.Deferred().resolve();a.lastIndexOf("/")===a.length-1&&(a=a.substr(0,a.length-1));a=a.split("/");do d["./"+a.join("/")+"/jcr:primaryType"]="nt:unstructured",a.splice(a.length-1,1);while(0<a.length);return c.ajax({url:b,
type:"post",data:d})}return c.Deferred().resolve()}function M(){!T.value||1>T.value.length?J.setAttribute("disabled",!0):J.removeAttribute("disabled")}function C(){W.wait();return c.ajax({type:"GET",url:Granite.HTTP.externalize("/mnt/overlay/cq/gui/components/authoring/dialog/policy/templates.html"+q.absolutePath),dataType:"html"}).done(function(a){c(".js-cq-Policy-templates").find(".js-cq-Policy-templates-list").replaceWith(a);W.clearWait()})}var P=Granite.I18n.get("New policy"),t=Granite.I18n.get("Copy of"),
q,z,Q,B,A,N,E,S,O,I,U,L,w,x,J,Y,Z,T,X,V=c('\x3cspan class\x3d"cq-Policy-params"\x3e\x3cinput type\x3d"hidden" name\x3d"_charset_" value\x3d"utf-8" /\x3e\x3c/span\x3e'),W=c(l).adaptTo("foundation-ui");m=c(l).adaptTo("foundation-registry");h.on("foundation-contentloaded",function(){w=c(".js-Policy-dialog-content").eq(0);if(0<w.length){var b=c(".js-editor-Policy").eq(0);E=Granite.HTTP.internalize(b.closest("form.cq-dialog").attr("action"))||b.attr("data-policy-absolute-path");z=b.attr("data-policy-content-path");
Q=b.attr("data-policy-content-resource-type");B=b.attr("data-policy-mapping-path");S=b.attr("data-policy-relative-path");N=b.attr("data-policy-name");O=b.attr("data-policy-resource-type");I=b.attr("data-policy-directory-path");A=b.attr("data-policy-mapping-resource-type");U=b.attr("data-design-dialog-path");L=b.attr("data-design-dialog-classic-path");Y=w.find(".js-Policy-create")[0];Z=w.find(".js-Policy-duplicate")[0];T=w.find(".js-Policy-detail-title")[0];X=w.find(".js-Policy-detail-description")[0];
x=w.find(".js-Policy-dialog-select")[0];0===w.find(".cq-Policy-params").length&&w.prepend(V);Y.off(".policy").on("click.policy",v);Z.off(".policy").on("click.policy",D);w.off(".policy").on("blur keyup.policy",".js-Policy-detail-title",r);w.off(".policy").on("blur keyup.policy",".js-Policy-detail-description",r);x.off(".policy").on("change.policy",function(b){b.target.selectedItem&&(a(b.target.selectedItem.value),K(),M())});E&&0<x.items.length?(a(E),q||(a(g({nodeName:N,absolutePath:E,relativePath:S,
type:O})),y(q))):(a(g()),y(q));J=w.find(".js-cq-Policy-openClassicDesign")[0];L&&0<L.length&&J&&(J.className+=" is-visible",J.off(".policy").on("click.policy",H),M());C()}});m.register("foundation.form.submit",{selector:"form.cq-dialog",handler:function(a){return null!==a.querySelector(".js-Policy-dialog-content")?u():c.Deferred().resolve()}})})(jQuery,Granite.author,jQuery(document),this,document);
(function(c,f,h,l,k){function m(a,b,e,g,k){if(a&&0!==a.length&&g&&!(1>g.length)){var d=a.find("[data-name\x3d'"+b+"']").eq(0);if("-"!==g){var f=[];g=Array.isArray(g)?g:g.split(",");0<d.length&&(f=(f=d.val())?c.isArray(f)?f:-1===f.indexOf(",")?[f]:f.split(","):[]);if(k){if(g){f=f||[];0<g.length&&0<f.length&&-1<f.indexOf("-")&&(f=[]);k=0;for(var h=g.length;k<h;k++){for(var m=!1,p=g[k],n=0,l=f.length;n<l;n++)if(p===f[n]){m=!0;break}m||f.push(p)}}}else if(g)for(f=f||[],k=0,h=g.length;k<h;k++){m=-1;p=
g[k];n=0;for(l=f.length;n<l;n++)if(p===f[n]){m=n;break}-1<m&&f.splice(m,1)}g="-";0<f.length&&(g=f.join(","))}0<d.length?d.val(g):a.append('\x3cinput type\x3d"hidden" data-name\x3d"'+b+'" name\x3d"'+e+'" value\x3d"'+g+'"/\x3e')}}function e(a,b){!a||0===a.length||!b||1>b.length||a.find("input[type\x3d'hidden'][data-name\x3d"+b+"]").remove()}function g(a,b){return!b||1>b.length?"./plugins/"+a+"/features":"./"+(b.data("pluginRootName")||"plugins")+"/"+a+"/features"}function b(a){var b=c(a).closest("coral-checkbox"),
f=b.closest(".js-cq-IPEPlugin-group"),k=b.data("name"),h=b.data("features");if(k){var l=f.closest("form").find(".js-cq-IPEPlugin-hiddenInput").eq(0);a=a.querySelector("input[type\x3dcheckbox]").checked;b.is(".js-cq-IPEPlugin-feature")?!l||!k||1>k.length||!h||1>h.length||(b=g(k,f),h&&(e(l,name),m(l,k,b,h,a))):(b=g(k,f),e(l,k),h&&0<h.length&&m(l,k,b,a?h:"-",a));k=f.data("name");h=f.find(".js-cq-IPEPlugin input[type\x3dcheckbox]:checked").length;k&&0<k.length&&m(l,k,g(k,f),f.data("features"),0<h)}}h.on("dialog-loaded",
function(a){h.off(".IPEPlugin");h.find(".js-cq-IPEPlugin-group").each(function(){var a=c(this).closest("form");1>a.find(".js-cq-IPEPlugin-hiddenInput").length&&a.append('\x3cspan class\x3d"js-cq-IPEPlugin-hiddenInput"\x3e')});h.on("click.IPEPlugin",".js-cq-IPEPlugin",function(a){b(a.currentTarget)});c(".cq-Dialog .js-cq-IPEPlugin").each(function(){b(this)})})})(jQuery,Granite.author,jQuery(document),this);
(function(c,f,h,l,k,m){var e=["imageMap","imageCrop","imageRotate"],g=function(b){var a=this;a._element=b.element;a._$element=c(b.element);var d=a._$element.find("input[type\x3dfile]").attr("name");d=d.substr(0,d.lastIndexOf("/"))||"";""!==d&&(d+="/");a.path=d;null==b.allowUpload?a._allowUpload=a._element.hasAttribute("data-cq-fileupload-allowupload"):("string"===typeof b.allowUpload&&(b.allowUpload="true"==b.allowUpload),a._allowUpload=b.allowUpload);a._element.action||(a._element.action=a._$element.closest("form.cq-dialog").attr("action"));
a._element.parameters=[];a._inputs=[];a._$element.find("input[type\x3d'hidden'][data-cq-fileupload-parameter]").each(function(){var b=this.getAttribute("data-cq-fileupload-parameter");a._inputs[b]=this});a._removeDuplicateHiddenInputs();a._bindEvents();a._hasImageMimeType()&&a._addImageEditorFields()};g.prototype._appendHiddenInput=function(b,a){var d=this._$element.closest("form").find("input[name\x3d'"+b+"']");if(0===d.length)d=c("\x3cinput type\x3d'hidden'/\x3e").attr("name",b),a.hasOwnProperty("class")&&
d.attr("class",a["class"]),this._element.appendChild(d[0]);else if(0===d.closest(this._element).length)return;this._updateHiddenInput(d[0],a);return d[0]};g.prototype._updateHiddenInput=function(b,a){b!==m&&a!==m&&(a.value!==m&&b.setAttribute("value",a.value),a.disabled?c(b).prop("disabled",!0):!1===a.disabled&&c(b).removeProp("disabled"))};g.prototype._removeDuplicateHiddenInputs=function(){var b=this;b._$element.find("input[type\x3d'hidden']").each(function(){1<b._$element.closest("form").find("input[name\x3d'"+
this.getAttribute("name")+"']").length&&this.parentNode.removeChild(this)})};g.prototype._addParamInputs=function(b){var a;if("string"===typeof b)try{b=JSON.parse(b)}catch(n){}if("object"===typeof b)for(a in b)if(b.hasOwnProperty(a)){var c=this._appendHiddenInput(a,{value:b[a],disabled:!1});c&&c.setAttribute("data-cq-fileupload-parameter","additional")}};g.prototype._removeAdditionalSlingParamHiddenInputs=function(){this._$element.find("[data-cq-fileupload-parameter\x3d'additional']").remove()};g.prototype._bindEvents=
function(){var b=this;b._$element.find("[coral-fileupload-clear]").on("click",function(a){b._updateHiddenInput(b._inputs.filename,{value:"",disabled:!1});b._updateHiddenInput(b._inputs.filereference,{value:"",disabled:!1});b._$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("true");b._updateHiddenInput(b._inputs.filedelete,{value:"true",disabled:!1});b._updateHiddenInput(b._inputs.filemovefrom,{value:"",disabled:!0});b._removeAdditionalSlingParamHiddenInputs();b._element.classList.remove("is-filled");
b._$element.find("[data-cq-fileupload-thumbnail-img]").empty()});b._$element.on("assetselected",function(a){!b._element.disabled&&b._isMimeTypeAllowed(a.mimetype)&&(b._removeAdditionalSlingParamHiddenInputs(),b._updateHiddenInput(b._inputs.filereference,{value:a.path,disabled:!1}),b._updateHiddenInput(b._inputs.filedelete,{value:"false"}),b._$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("true"),b._updateHiddenInput(b._inputs.filemovefrom,{value:"false"}),b._addParamInputs(a.param),
b._element.classList.add("is-filled"),b._$element.find("[data-cq-fileupload-thumbnail-img]").empty().append(a.thumbnail),b._$element.trigger("change"),b._$element.find(".cq-FileUpload-edit").data("cqFileuploadFilereference",a.path).prop("disabled",!1))});b._allowUpload&&(b._element.on("coral-fileupload:fileadded",function(a){b._removeAdditionalSlingParamHiddenInputs();if(b._hasImageMimeType()){var c=b._$element.closest("form");c&&(c=c.attr("action").replace("_jcr_content","jcr:content"),f.author&&
f.author.editables&&(c=f.author.editables.find(c),0<c.length&&"function"===typeof c[0].getDropTarget&&(c=c[0].getDropTarget("image"))&&b._addParamInputs(c.params)))}c=b._$element.find("input[type\x3dfile]");a=a.detail.item.file.name;var g=c.attr("name"),e=b._element.getAttribute("data-cq-fileupload-temporaryfilename");c.attr("name",e);b._element.upload(a);c.attr("name",g);b._$element.trigger("change");b._$element.find(".cq-FileUpload-edit").prop("disabled",!0)}),b._element.on("coral-fileupload:load",
function(a){var d=b._$element.find("[data-cq-fileupload-thumbnail-img]"),g=a.detail.item._originalFile;d.empty();-1!==g.type.indexOf("image")?function(a,b){b.onload=function(b){a.append(c("\x3cimg/\x3e").attr("src",b.target.result))};b.readAsDataURL(g)}(d,new FileReader):(a=c("\x3cp\x3e"+g.name+"\x3c/p\x3e"),d.append(a));d=b._element.getAttribute("data-cq-fileupload-temporaryfilepath");b._updateHiddenInput(b._inputs.filename,{value:g.name,disabled:!1});b._updateHiddenInput(b._inputs.filereference,
{value:"",disabled:!1});b._updateHiddenInput(b._inputs.filedelete,{disabled:!0});b._updateHiddenInput(b._inputs.filemovefrom,{value:d,disabled:!1});b._$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("true");b._temporaryFileUploaded=!0;b._element.classList.add("is-filled");b._element.classList.remove("is-active")}),h.off("dialog-closed.fileupload").one("dialog-closed.fileupload",function(a){b._temporaryFileUploaded&&b._deleteTemporaryFileUpload()}),h.off("dragover.fileupload").on("dragover.fileupload",
function(a){a.originalEvent.dataTransfer&&a.originalEvent.dataTransfer.files&&b._element.classList.add("is-active")}).off("dragleave.fileupload").on("dragleave.fileupload",function(){b._element.classList.remove("is-active")}))};g.prototype._deleteTemporaryFileUpload=function(){var b={};b[this._element.getAttribute("data-cq-fileupload-temporaryfiledelete")]=!0;c.post(this._element.action,b)};g.prototype._isMimeTypeAllowed=function(b){var a=!1,c=this._element.accept.split(",");if(""==c)return!0;c.some(function(c){if(c===
b||"*"===c||(new RegExp(c)).test(b))return a=!0});return a};g.prototype._hasImageMimeType=function(){for(var b=this._element.accept.split(","),a=!1,c=0;c<b.length&&!(a=b[c].match("image/*"));c++);return a};g.prototype._addImageEditorFields=function(){var b=this;e.forEach(function(a){b._appendHiddenInput(b.path+a+"@Delete",{"class":"cq-ImageEditor-param",disabled:!0,value:""})})};h.on("foundation-contentloaded",function(b){c(b.target).find("coral-fileupload.cq-FileUpload").each(function(){Coral.commons.ready(this,
function(a){a:{if(f.author){var b=c(a).closest("form.cq-dialog");if(!(1>b.length)&&(b=b.attr("action").replace("_jcr_content","jcr:content"),(b=Granite.HTTP.internalize(b))&&!(1>b.length)&&(b=f.author.editables.find(b))&&0<b.length)){b=f.author.editableHelper.getStyleProperty(b[0],"allowUpload");break a}}b=void 0}new g({element:a,allowUpload:b})})})});h.off("click.fileupload",".cq-FileUpload-edit").on("click.fileupload",".cq-FileUpload-edit",function(b){var a=c(b.currentTarget);b=a.data("cqFileuploadFilereference");
a=a.data("cqFileuploadViewinadminuri");b=Granite.URITemplate.expand(a,{item:b});b=Granite.HTTP.externalize(b);"single"===c("meta[name\x3d'user.preferences.winmode']").attr("content")?k.location.href=b:k.open(b)})})(Granite.$,Granite,jQuery(document),document,this);
(function(c,f,h,l,k,m){f=c(k).adaptTo("foundation-registry");f.register("foundation.adapters",{type:"foundation-field",selector:"coral-fileupload.cq-FileUpload",adapter:function(e){return{isRequired:function(){return e.dataset.cqFileuploadRequired!==m},setRequired:function(c){c?e.dataset.cqFileuploadRequired="":delete e.dataset.cqFileuploadRequired},getName:function(){e.dataset.cachedElementName||(e.dataset.cachedElementName=e.name);return e.dataset.cachedElementName},setName:function(g){this._inputs=
[];var b=g.substr(0,g.lastIndexOf(e.dataset.cachedElementName));e.name=g;c("input[type\x3d'hidden'][data-cq-fileupload-parameter]",e).each(function(a,d){"filemovefrom"!==c(d).data("data-cq-fileupload-parameter")&&(this.dataset.cachedElementName||(this.dataset.cachedElementName=this.getAttribute("name")),this.setAttribute("name",b+this.dataset.cachedElementName))})}}}});f.register("foundation.validation.validator",{selector:"coral-fileupload.cq-FileUpload[data-cq-fileupload-required]",validate:function(c){if(!c.uploadQueue.length&&
!c.classList.contains("is-filled"))return Granite.I18n.get("Please fill out this field.")}})})(Granite.$,Granite,jQuery(document),document,this);
(function(c,f,h,l,k,m){var e=["imageMap","imageCrop","imageRotate"],g="\x3cspan class\x3d'cq-FileUpload-clear coral-Button coral-Button--quiet'\x3e"+Granite.I18n.get("Clear")+"\x3c/span\x3e",b="\x3cdiv class\x3d'cq-FileUpload-thumbnail'\x3e\x3cdiv class\x3d'cq-FileUpload-thumbnail-img'\x3e\x3c/div\x3e\x3cdiv class\x3d'cq-FileUpload-thumbnail-dropHere'\x3e\x3ci class\x3d'coral-Icon coral-Icon--image cq-FileUpload-icon'\x3e\x3c/i\x3e\x3cspan class\x3d'cq-FileUpload-label'\x3e"+Granite.I18n.get("Drop an asset here or \x3ca class\x3d'coral-Link {0}'\x3ebrowse\x3c/a\x3e for a file to upload.",
"cq-FileUpload-browse","0 replace by class name, not visible string")+"\x3c/div\x3e\x3c/div\x3e";f.FileUploadField=function(a,b,c){this.widget=a;this.resourceURL=b;a=this.widget.$inputContainer.find("input[type\x3d'file']");null==c?this.widget.options.allowUpload="undefined"===typeof a.data("allowupload")||!!a.data("allowupload"):("string"===typeof c&&(c="true"==c),this.widget.options.allowUpload=c);this._computeFieldNames();this._createMissingElements();this._bindEvents();this.widget.$element.addClass("cq-FileUpload");
this.widget.$element.addClass("cq-droptarget");this.widget.$inputContainer.hide();this.widget.options.uploadUrl=b};f.FileUploadField.prototype._appendThumbnail=function(a,b){var d="?:ck\x3d"+(new Date).getTime();a=c("\x3cimg/\x3e",{alt:a,"class":"cq-dd-image",src:a+d});b.append(a);this.widget.$element.addClass("is-filled")};f.FileUploadField.prototype._createThumbnailFromRendition=function(a,b,g){g||(g="cq5dam.web");var d=this,e=a+"/jcr:content/renditions.1.json";c.getJSON(e).then(function(c){var e=
null,k;for(k in c)if(c.hasOwnProperty(k)&&0===k.indexOf(g)){e=a+"/jcr:content/renditions/"+k;break}d._appendThumbnail(e?e:a,b)},function(){b.append(c("\x3cp\x3eExpecting DAM asset to have renditions, but request to "+e+" failed\x3c/p\x3e"))})};f.FileUploadField.prototype._refreshThumbnail=function(){var a=this,b=a.widget.$element.find(".cq-FileUpload-thumbnail-img"),g;b.empty();c.ajax({url:a.resourceURL+".json",cache:!1}).done(function(d){var e=a.fieldNames.fileName.substr(a.fieldNames.fileName.lastIndexOf("/")+
1),k=a.fieldNames.fileReference.substr(a.fieldNames.fileReference.lastIndexOf("/")+1);e=d[e];if((d=d[k])||e)a._hasImageMimeType()?d?a._createThumbnailFromRendition(d,b):a._appendThumbnail(a.resourceURL+".img.png",b):a._hasVideoMimeType()&&d?a._createThumbnailFromRendition(d,b,"cq5dam.thumbnail.3"):(g=c("\x3cp\x3e"+(d||e)+"\x3c/p\x3e"),b.append(g),a.widget.$element.addClass("is-filled"))})};f.FileUploadField.prototype._addElements=function(){var a=c(b);this.widget.options.allowUpload||a.find(".cq-FileUpload-label").text(Granite.I18n.get("Drop an asset here."));
this.widget.$element.append(a);this.widget.$element.find(".cq-FileUpload-thumbnail-img").after(c(g));a.find(".cq-FileUpload-browse").append(this.widget.$inputContainer.find('input[type\x3d"file"]'))};f.FileUploadField.prototype._computeFieldNames=function(){var a=this.widget.$element.find("input[type\x3dfile]"),b=a.attr("name")||"",c=b.substr(0,b.lastIndexOf("/"))||"",g=c.match(/^\.(\/.+)$/);".sftmp"===b.substr(-6)&&(b=b.substr(0,b.length-6));""!==c&&(c+="/");this.path=c;this.fieldNames={fileName:a.data("fileNameParameter")||
c+"fileName",fileReference:a.data("filereferenceparameter")||c+"fileReference",lastModified:c+"jcr:lastModified",lastModifiedBy:c+"jcr:lastModifiedBy",fileDelete:b+"@Delete",fileMoveFrom:b+"@MoveFrom",tempFileName:b+".sftmp",tempFileDelete:b+".sftmp@Delete"};g?(this._tempFilePath=this.resourceURL+this.fieldNames.tempFileName.substr(1),this.resourceURL+=g[1]):this._tempFilePath=this.resourceURL+"/"+this.fieldNames.tempFileName;this._tempFilePath=this._tempFilePath.replace(new RegExp("^"+f.HTTP.getContextPath()),
"").replace("_jcr_content","jcr:content")};f.FileUploadField.prototype._addParamFields=function(a){var b;if("string"===typeof a)try{a=JSON.parse(a)}catch(n){}if("object"===typeof a)for(b in a)a.hasOwnProperty(b)&&this._appendHiddenField(b,"cq-FileUpload-param",a[b])};f.FileUploadField.prototype._addImageEditorFields=function(){var a=this;e.forEach(function(b){a._appendHiddenField(a.path+b+"@Delete","cq-ImageEditor-param","",!0)})};f.FileUploadField.prototype._addHiddenFields=function(){this._appendHiddenField(this.fieldNames.fileName,
"cq-FileUpload-filename",!1,!0);this._appendHiddenField(this.fieldNames.fileReference,"cq-FileUpload-filereference",!1,!0);this._appendHiddenField(this.fieldNames.fileDelete,"cq-FileUpload-filedelete",!1,!0);this._appendHiddenField(this.fieldNames.fileMoveFrom,"cq-FileUpload-filemovefrom",this._tempFilePath,!0);this._appendHiddenField(this.fieldNames.lastModified);this._appendHiddenField(this.fieldNames.lastModifiedBy)};f.FileUploadField.prototype._removeAdditionalSlingParamHiddenFields=function(){this.widget.$element.find("inputcq-FileUpload-param").remove()};
f.FileUploadField.prototype._appendHiddenField=function(a,b,g,e){var d=this.widget.$element.closest("form").find('input[name\x3d"'+a+'"]');if(0===d.length)d=c("\x3cinput type\x3d'hidden'/\x3e").attr("name",a),this.widget.$element.append(d);else if(0===d.closest(this.widget.$element).length)return;if(b!==m)for(c.isArray(b)||(b=[b]),a=0;a<b.length;a++)d.addClass(b[a]);g!==m&&d.attr("value",g);e!==m&&d.attr("disabled",!0)};f.FileUploadField.prototype._createMissingElements=function(){this._addElements();
this._addHiddenFields();this._refreshThumbnail();this._hasImageMimeType()&&this._addImageEditorFields()};f.FileUploadField.prototype._bindEvents=function(){var a=this,b=null,g=!1;a.widget.$element.find(".cq-FileUpload-browse").on("click tap",function(){a.widget.$element.hasClass("is-disabled")||a.widget.$inputContainer.find("input[type\x3d'file']").trigger("click")});a.widget.$element.find(".cq-FileUpload-clear").on("click tap",function(b){a.widget.$element.find(".cq-FileUpload-filedelete").removeAttr("disabled").val("true");
a.widget.$element.find(".cq-FileUpload-filereference").removeAttr("disabled").val("");a.widget.$element.find(".cq-FileUpload-filename").removeAttr("disabled").val("");a.widget.$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("true");a._removeAdditionalSlingParamHiddenFields();a.widget.$element.find(".cq-FileUpload-filemovefrom").attr("disabled",!0);a.widget.$element.removeClass("is-filled");a.widget.$element.find(".cq-FileUpload-thumbnail-img").empty();a.widget.$element.find('input[type\x3d"file"]').val("");
a.widget.$element.trigger("change")});a.widget.$element.on("assetselected",function(b){var c=b.path,d=b.param,g=b.thumbnail;b=b.mimetype;!a.widget.$element.hasClass("is-disabled")&&a._isMimeTypeAllowed(b)&&(a._removeAdditionalSlingParamHiddenFields(),a.widget.$element.find(".cq-FileUpload-filereference").removeAttr("disabled").val(c),a.widget.$element.find(".cq-ImageEditor-param").removeAttr("disabled").val(""),a.widget.$element.find(".cq-FileUpload-filedelete").val("false"),a.widget.$element.find(".cq-FileUpload-filemovefrom").val("false"),
a.widget.$element.find(".cq-FileUpload-thumbnail-img").empty().append(g),a._addParamFields(d),a.widget.$element.addClass("is-filled"),a.widget.$element.trigger("change"))});a.widget.$element.on("fileselected",function(c){var d;if(!a.widget.$element.hasClass("is-disabled")&&a.widget.options.allowUpload){a._removeAdditionalSlingParamHiddenFields();a._hasImageMimeType()&&(d=a.widget.$element.closest("form"))&&(d=d.attr("action").replace("_jcr_content","jcr:content"),f.author&&f.author.editables&&(d=
f.author.editables.find(d),0<d.length&&"function"===typeof d[0].getDropTarget&&(d=d[0].getDropTarget("image"))))&&(d=d.params,a._addParamFields(d));delete a.widget.fileNameElement;delete a.widget.options.fileNameParameter;if(a.widget.options.useHTML5)c.item.fileName=a.fieldNames.tempFileName,a.widget.uploadFile(c.item);else{d=a.widget.$element.find("input[type\x3dfile]");var g=d.attr("name");b=c.item.fileName;d.attr("name",a.fieldNames.tempFileName);a.widget.uploadFile(c.item);d.attr("name",g)}a.widget.$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("");
a.widget.$element.trigger("change")}});a.widget.$element.on("dropzonedragover",function(b){a.widget.$element.addClass("is-hovered")});a.widget.$element.on("dropzonedragleave",function(b){a.widget.$element.removeClass("is-hovered")});a.widget.$element.on("dropzonedrop",function(b){a.widget.$element.removeClass("is-hovered")});c(k).on("dragover",function(b){b.originalEvent.dataTransfer&&b.originalEvent.dataTransfer.files&&a.widget.$element.addClass("is-active")}).on("dragleave",function(){a.widget.$element.removeClass("is-active")});
Granite.author&&!a.widget.options.useHTML5&&(a.widget.$element.on("drop",function(b){a.widget.$element.trigger("dropzonedrop")}),a.widget.$element.on("dragover",function(b){b.stopPropagation();b.preventDefault();a.widget.$element.trigger("dropzonedragover")}),a.widget.$element.on("dragleave",function(b){b.stopPropagation();b.preventDefault();a.widget.$element.trigger("dropzonedragleave")}));a.widget.$element.on("fileuploadload",function(d){var g=c(d.content).find("#Status").text();var e=d.item||{};
e.file=e.file||{};e.file.type=e.file.type||"";e.file.name=e.file.name||b;b=null;a.widget._internalOnUploadLoad(d,e,g,d.content)});a.widget.$element.on("fileuploadsuccess",function(b){var d=a.widget.$element.find(".cq-FileUpload-thumbnail-img"),e=b.item.file;d.empty();-1!==e.type.indexOf("image")?(a.widget.$element.addClass("is-filled"),function(a,b){b.onload=function(b){a.append(c("\x3cimg/\x3e").attr("src",b.target.result))};b.readAsDataURL(e)}(d,new FileReader)):(b=c("\x3cp\x3e"+e.name+"\x3c/p\x3e"),
a.widget.$element.addClass("is-filled"),d.append(b));a.widget.$element.find(".cq-FileUpload-filereference").removeAttr("disabled").val("");a.widget.$element.find(".cq-FileUpload-filedelete").attr("disabled","true");a.widget.$element.find(".cq-FileUpload-filemovefrom").removeAttr("disabled").val(a._tempFilePath);a.widget.$element.find(".cq-FileUpload-filename").removeAttr("disabled").prop("value",e.name);g=!0});h.one("dialog-closed",function(b){g&&a._deleteTempUpload()})};f.FileUploadField.prototype._deleteTempUpload=
function(){var a={};a[this.fieldNames.tempFileDelete]=!0;c.post(this.widget.options.uploadUrl,a)};f.FileUploadField.prototype._isMimeTypeAllowed=function(a){var b=!1;this.widget.options.mimeTypes.some(function(c){if("*"===c||(new RegExp(c)).test(a))return b=!0});return b};f.FileUploadField.prototype._hasImageMimeType=function(){return-1!==this.widget.options.mimeTypes.indexOf("image")};f.FileUploadField.prototype._hasVideoMimeType=function(){return-1!==this.widget.options.mimeTypes.indexOf("video")};
h.on("cui-contentloaded",function(a){c(a.target).find(".coral-FileUpload:not('.is-initialized')").each(function(){var a=c(this),b=a.data("fileUpload"),g=a.parents("form.cq-dialog").attr("action");a.addClass("is-initialized");if(b&&!a.parents(".cq-wcm-pagethumbnail").length){a=f.FileUploadField;var e=c(this).closest("form.cq-dialog");1>e.length?e=void 0:(e=e.attr("action").replace("_jcr_content","jcr:content"),e=Granite.HTTP.internalize(e),e=!e||1>e.length?void 0:(e=f.author.editables.find(e))&&0<
e.length?f.author.editableHelper.getStyleProperty(e[0],"allowUpload"):void 0);new a(b,g,e)}})})})(jQuery,Granite,jQuery(document),this,document);
(function(c,f){function h(c){c.each(function(c,e){f(e).is("coral-select")?Coral.commons.ready(e,function(c){l(c,e);c.on("change",function(){l(c,e)})}):(c=f(e).data("select"))&&l(c,e)})}function l(c,h){h=f(h).data("cqDialogDropdownShowhideTarget");var e=f(h);if(h){var g;"undefined"!==typeof c.value?g=c.value:"function"===typeof c.getValue&&(g=c.getValue());e.not(".hide").addClass("hide");e.filter("[data-showhidetargetvalue\x3d'"+g+"']").removeClass("hide")}}f(c).on("foundation-contentloaded",function(c){h(f(".cq-dialog-dropdown-showhide",
c.target))});f(c).on("selected",".cq-dialog-dropdown-showhide",function(c){h(f(this))})})(document,Granite.$);$(document).on("foundation-contentloaded",function(c){var f=$(".cq-dialog .cq-ComponentStyles");f.find("coral-select").on("change",function(c){var h="";f.find("coral-select").each(function(){var c=this.value;c&&(h.length&&(h+=" "),h+=c)});f.find("input[type\x3dhidden]").first().val(h)})});
(function(c,f,h,l){Granite.DialogUtils={unifySpacing:function(c){if(c){var f=c.classList.contains("cq-dialog-floating"),e=c.querySelector("coral-dialog-content"),g=e.querySelector(".cq-dialog-content"),b=c.querySelector(".coral-TabPanel"),a=c.querySelectorAll(".coral-TabPanel-content"),d=c.querySelectorAll(".coral-FixedColumn");if("coral-tabview"!==g.tagName.toLowerCase()&&!g.querySelector("coral-tabview")){f?e.classList.add("u-coral-noPadding","u-coral-noMargin"):(e.classList.remove("u-coral-noPadding"),
e.classList.add("u-coral-noMargin"),c.style.overflow="auto");if(b)for(b.classList.add("u-coral-noPadding","u-coral-noMargin"),c=0;c<a.length;c++)a[c].classList.add("u-coral-noPadding","u-coral-noMargin");if(0<d.length)for(c=0;c<d.length;c++)d[c].classList.add("u-coral-noPadding","u-coral-noMargin"),d[c].querySelector(".coral-FixedColumn-column").classList.add("u-coral-padding","u-coral-noMargin");else if(b)for(c=0;c<a.length;c++)a[c].classList.remove("u-coral-noPadding"),a[c].classList.add("u-coral-padding");
else 1===g.children.length&&g.children[0].classList.add("u-coral-padding")}}}}})(window,document,Granite.$,Granite.author);
(function(c,f,h,l){function k(g){g.data("cqDialogReturntoreferral")?c.location=f.referrer:g.closest(".cq-dialog-page").length?c.location=g.data("cqDialogPageeditor"):g.remove();e.trigger("dialog-closed")}function m(c){c.trigger("dialog-beforeclose");c=c.find("form").eq(0);c.trigger("dialog-beforeclose");k(c)}h(c).adaptTo("foundation-ui");var e=h(f);e.on("click",".cq-dialog-cancel",function(c){c.preventDefault();c=h(this).closest(".cq-Dialog");m(c)});e.on("coral-overlay:beforeclose",".cq-Dialog",function(c){h(c.target).hasClass("cq-Dialog")&&
m(h(this))});e.on("click",".cq-dialog-layouttoggle",function(c){var b=this.closest("coral-dialog");Granite.DialogUtils.unifySpacing(b);c.preventDefault()});e.on("click",".cq-dialog-help",function(e){e.preventDefault();e=h(this);c.open(e.data("href"),"_blank")});e.on("foundation-form-submitted",".cq-Dialog",function(c,b,a){!0===b?(c=h(this),e.trigger("dialog-success"),c.trigger("dialog-beforeclose"),c.find("form").eq(0).trigger("dialog-beforeclose"),k(c.find("form").eq(0))):e.trigger("dialog-fail",
a)});e.on("foundation-contentloaded",function(c){c=h(c.target).find("#cq-sites-properties-form, .cq-dialog");if(c.length){var b=c.find("input[name\x3d'./sling:resourceType']").val();Granite.DialogUtils.unifySpacing(c.parents("coral-dialog").get(0));e.trigger(h.Event("dialog-loaded",{dialog:c,resourceType:b}))}});h("body").on("submit",".cq-Dialog",function(c){h(this).find("input, textarea").blur()})})(window,document,Granite.$,Granite.author);
(function(c,f){var h=/^([0-9]+(\.[0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc))$/;c(window).adaptTo("foundation-registry").register("foundation.validation.validator",{selector:'[data-validation\x3d"cq.cssunit"]',validate:function(c){if(!c.value&&!h.test(c.value))return f.I18n.get("Must be a valid CSS length. ex: 10px or 2.3em")}});var l=/^[a-zA-Z0-9_\\.\\/:\\-]+$/;c(window).adaptTo("foundation-registry").register("foundation.validation.validator",{selector:'[data-validation\x3d"cq.formfieldname"]',validate:function(c){if(!c.value&&
!l.test(c.value))return f.I18n.get("Element name should only contain characters, numbers or _./:-")}})})(Granite.$,Granite);
(function(c,f,h,l,k,m){h.on("change",".js-cq-AllowedComponents-component coral-checkbox",function(){var e=c(this).closest(".js-cq-AllowedComponents-componentGroup"),g=e.find(".js-cq-AllowedComponents-groupCheckbox"),b=e.find(".js-cq-AllowedComponents-group coral-tag"),a=e.find(".js-cq-AllowedComponents-component coral-checkbox");e=a.length;a=a.filter(function(){return this.checked}).length;g.prop("indeterminate",0<a&&a<e);b.get(0).label.textContent=a;b.attr("hidden",0<a?null:"")});h.on("change",".js-cq-AllowedComponents-groupCheckbox",
function(e){var g=c(this).closest(".js-cq-AllowedComponents-componentGroup");e=g.find(".js-cq-AllowedComponents-group coral-tag");g=g.find(".js-cq-AllowedComponents-component coral-checkbox");g.prop("checked",this.checked).prop("disabled",this.checked);e.get(0).label.textContent=g.length;e.attr("hidden",this.checked?null:"")})})(jQuery,Granite.author,jQuery(document),this,document);
(function(c,f,h,l,k,m){function e(){p=[];n={};y=m;y||(y=a.find(".js-cq-AllowedComponents-componentTitle"));var b=y;for(var c=0,d=b.length;c<d;c++){var e=[],g=b.eq(c),f=g.closest(".js-cq-AllowedComponents-component"),k=f.closest(".js-cq-AllowedComponents-componentGroup"),h=k.find(".js-cq-AllowedComponents-groupTitle").text(),l=f.data("resourceType");e.push(g.text().trim().toLowerCase());e.push(h.trim().toLowerCase());l&&0<l.length&&e.push(l);p.push({labels:e.slice(),element:f.get(0)});if(n[h])for(g=
n[h],f=0,k=e.length;f<k;f++)0>g.labels.indexOf(e[f])&&g.labels.push(e[f]);else n[h]={labels:e,element:k.get(0)}}}function g(a){for(var b in a)a.hasOwnProperty(b)&&a[b].element.removeAttribute("hidden")}function b(a,b){if(a&&!(1>a.length))for(var c in b)if(b.hasOwnProperty(c)){for(var d=b[c],e=d.labels,g=!1,f=0,k=e.length;f<k;f++)if(-1<e[f].indexOf(a.toLowerCase())){g=!0;break}g?d.element.removeAttribute("hidden"):d.element.setAttribute("hidden","")}}var a,d,n,p,y;h.on("foundation-contentloaded",function(){a=
c(".js-cq-AllowedComponents").eq(0);d=c(".js-cq-AllowedComponents-filter").eq(0);0<d.length&&0<a.length&&(e(),d.on("input coral-search:clear",function(){var a=d.val();a||0<a.length?!a||1>a.length||(b(a,n),b(a,p)):(g(p),g(n))}))})})(jQuery,Granite.author,jQuery(document),this,document);
(function(c,f,h,l,k){function m(a){return'\x3cspan class\x3d"js-cq-AssetToComponentMapper-mappingHiddenInputs"\x3e\x3c/span\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper"\x3e\x3clabel class\x3d"coral-Form-fieldlabel"\x3e'+Granite.I18n.get("Component")+'\x3c/label\x3e\x3ccoral-select name\x3d"./cq:authoring/assetToComponentMapping/'+a+'/resourceType" class\x3d"js-cq-AssetToComponentMapper-resourceType coral-Form-field" placeholder\x3d"'+Granite.I18n.get("Choose a component")+'" required\x3e\x3c/coral-select\x3e\x3c/div\x3e\x3ccoral-alert variant\x3d"warning" class\x3d"cq-AssetToComponentMapper-resourceType--notAllowed"\x3e\x3ccoral-alert-content\x3e'+
Granite.I18n.get("Component not allowed by the container")+'\x3c/coral-alert-content\x3e\x3c/coral-alert\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper" hidden\x3e\x3clabel class\x3d"coral-Form-fieldlabel"\x3e'+Granite.I18n.get("Drop target")+'\x3c/label\x3e\x3ccoral-select name\x3d"./cq:authoring/assetToComponentMapping/'+a+'/droptarget" class\x3d"js-cq-AssetToComponentMapper-dropTarget coral-Form-field" placeholder\x3d"'+Granite.I18n.get("Choose a drop target")+'" required\x3e\x3c/coral-select\x3e\x3c/div\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper" hidden\x3e\x3clabel class\x3d"coral-Form-fieldlabel"\x3e'+
Granite.I18n.get("Asset Group")+'\x3c/label\x3e\x3ccoral-select name\x3d"./cq:authoring/assetToComponentMapping/'+a+'/assetGroup" class\x3d"js-cq-AssetToComponentMapper-assetGroup coral-Form-field" placeholder\x3d"'+Granite.I18n.get("Choose an asset group")+'" required\x3e\x3c/coral-select\x3e\x3c/div\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper"\x3e\x3clabel class\x3d"coral-Form-fieldlabel"\x3e'+Granite.I18n.get("Mime types")+'\x3c/label\x3e\x3ccoral-multifield class\x3d"js-cq-AssetToComponentMapper-mimeTypes coral-Form-field" disabled\x3e\x3cbutton coral-multifield-add type\x3d"button" is\x3d"coral-button" class\x3d"js-cq-AssetToComponentMapper-addMimeType" disabled\x3e'+
Granite.I18n.get("Add type")+'\x3c/button\x3e\x3ctemplate coral-multifield-template\x3e\x3cinput is\x3d"coral-textfield" type\x3d"text" name\x3d"./cq:authoring/assetToComponentMapping/'+a+'/assetMimetype"\x3e\x3c/template\x3e\x3c/coral-multifield\x3e\x3c/div\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper"\x3e\x3cbutton is\x3d"coral-button" variant\x3d"warning" class\x3d"js-cq-AssetToComponentMapper-deleteMapping coral-Form-field"\x3e'+Granite.I18n.get("Delete")+"\x3c/button\x3e\x3c/div\x3e"}function e(a){Coral.commons.ready(a,
function(b){if(b.selectedItem)var c=b.selectedItem.value;b.items.clear();var d=a.closest(".js-cq-AssetToComponentMapper-mapping");d.className=d.className.replace("cq-AssetToComponentMapper-mapping--notAllowed","");var e=c,f=[],g;for(g in H){if(H.hasOwnProperty(g))var k=H[g];k&&f.push({content:{textContent:k.title+" - "+k.group},value:k.resourceType,selected:e&&e===k.resourceType})}c&&!H[c]&&((c=G[c])&&f.unshift({content:{textContent:c.title+" - "+c.group},value:c.resourceType,selected:!0}),d.classList.add("cq-AssetToComponentMapper-mapping--notAllowed"));
d=0;for(c=f.length;d<c;d++)b.items.add(f[d])})}function g(){var a=v.items.add({label:{innerHTML:Granite.I18n.get("New Asset Mapping")},selected:!0}),b="mapping_"+ +new Date;a.dataset.name=b;a.classList.add("js-cq-AssetToComponentMapper-mapping");b=c.parseHTML(m(b));for(var d=0,f=b.length;d<f;d++)a.content.appendChild(b[d]);a=a.content.querySelector(".js-cq-AssetToComponentMapper-resourceType");e(a)}function b(a){if(a=a.target.closest(".js-cq-AssetToComponentMapper-mapping")){var b=a.dataset.name,
c=document.createElement("input");c.type="hidden";c.name="./cq:authoring/assetToComponentMapping/"+b+"@Delete";c.value="";v.appendChild(c);v.items.remove(a)}}function a(a,b){if(b.groups){var c=!0;b.groups.forEach(function(b){a.items.add({content:{textContent:b},value:b,selected:c});c=!1});a.closest(".coral-Form-fieldwrapper").hidden=2>b.groups.length}}function d(b,c){if(b&&c&&c.dropTargets){var d=b.querySelector(".js-cq-AssetToComponentMapper-dropTarget"),e=b.querySelector(".js-cq-AssetToComponentMapper-assetGroup"),
f=b.querySelector(".js-cq-AssetToComponentMapper-mimeTypes");d.items.clear();e.items.clear();f.items.clear();var g=!0;d.closest(".coral-Form-fieldwrapper").hidden=2>c.dropTargets.length;c.dropTargets.forEach(function(f){d.items.add({content:{textContent:f.name},value:f.name,selected:g});g&&(a(e,f),p(b,c));g=!1})}}function n(a){var b=a.target,c=b.closest(".js-cq-AssetToComponentMapper-mapping"),e=c.querySelector(".js-cq-AssetToComponentMapper-dropTarget");(b=G[b.value])&&c&&d(c,b);c&&b&&e&&p(c,b);
a=a.target.closest(".js-cq-AssetToComponentMapper-mapping");c=a.querySelector(".js-cq-AssetToComponentMapper-resourceType");c=G[c.value];a.label.innerHTML=c.title+" - "+c.group}function p(a,b){if(a&&b&&b.dropTargets){var c=a.querySelector(".js-cq-AssetToComponentMapper-dropTarget"),d=a.querySelector(".js-cq-AssetToComponentMapper-mimeTypes"),e=a.querySelector(".js-cq-AssetToComponentMapper-addMimeType");c=c.value;d.disabled=!1;e.disabled=!1;e=b.dropTargets[0];for(var f=0;f<b.dropTargets.length;f++)if(c===
b.dropTargets[f].name){e=b.dropTargets[f];break}if(e&&(d.items.clear(),e.accept)){var g=a.dataset.name;e.accept.forEach(function(a){d.items.add({content:{htmlContent:(new Coral.Textfield).set({name:"./cq:authoring/assetToComponentMapping/"+g})}}).querySelector("input[type\x3d'text']").value=a})}}}function y(b){b=b.target;var c=b.closest(".js-cq-AssetToComponentMapper-mapping"),d=c.querySelector(".js-cq-AssetToComponentMapper-assetGroup"),e=c.querySelector(".js-cq-AssetToComponentMapper-resourceType").value;
e=G[e];for(var f,g=0;g<e.dropTargets.length;g++)if(b.value===e.dropTargets[g].name){f=e.dropTargets[g];break}d&&f&&a(d,f);c&&e&&b&&p(c,e)}var F,v,D,G={},H={};h.on("dialog-loaded",function(a){F=a.dialog[0];if(v=F.querySelector(".js-cq-AssetToComponentMapper")){var d=v.closest("coral-tabview");Coral.commons.ready(d,function(){d.on("coral-panelstack:change",function(a){if(a.detail.selection&&a.detail.selection.contains(v)){a=F.querySelectorAll(".js-cq-AllowedComponents-component input[type\x3d'checkbox']:checked");
H={};for(var b=0;b<a.length;b++){var c=a[b].closest(".js-cq-AllowedComponents-component");c&&(H[c.dataset.resourceType]=G[c.dataset.resourceType])}if(D=v.querySelectorAll(".js-cq-AssetToComponentMapper-resourceType"))for(a=0,b=D.length;a<b;a++)e(D[a])}})});D=v.querySelectorAll(".js-cq-AssetToComponentMapper-resourceType");a=F.querySelector(".js-cq-AssetToComponentMapper-addMapping");var f=JSON.parse(v.dataset.dropTargets);f&&(G=f.componentDropTargets||{});a.on("click",g);v.on("click",".js-cq-AssetToComponentMapper-deleteMapping",
b);c(v).on("change",".js-cq-AssetToComponentMapper-resourceType",n);c(v).on("change",".js-cq-AssetToComponentMapper-dropTarget",y)}})})(jQuery,Granite.author,jQuery(document),this);
(function(c,f){f(c).on("foundation-contentloaded",function(c){setTimeout(function(){f("form [data-validation\x3d'checkState']").prop("checked")?(f(".stateName").show(),f(".stateName \x3e input").attr("aria-required","true")):(f(".stateName").hide(),f(".stateName \x3e input").removeAttr("aria-required"))},500)});f(c).on("change","form [data-validation\x3d'checkState']",function(c){f(this).prop("checked")?(f(".stateName").show(),f(".stateName \x3e input").attr("aria-required","true")):(f(".stateName").hide(),
f(".stateName \x3e input").removeAttr("aria-required"))})})(document,Granite.$);$(document).on("foundation-contentloaded",function(c){$("form [data-validation\x3d'navigation-title']").updateErrorUI()});
var userGroups=[],allowedTemplateGroups=["administrators","cms-webops","regional-manager-emea","regional-manager-uki"],templatesCheck=["business-unit-config-template","locale-config-template","html-blank-template","html-pages-deployment-template","login-template"],pathArr=[],page=window.location.pathname+window.location.search;pathArr=~page.indexOf("createpagewizard")?page.split("/mnt/overlay/wcm/core/content/sites-ukiemea/createpagewizard.html"):page.split("/mnt/overlay/wcm/core/content/sites-ukiemea/properties.html?item\x3d");
var pagePath=decodeURIComponent(pathArr[1]),templateName="";
$(function(){if(pagePath.startsWith("/content/ukiemea-sites")||page.startsWith("/editor.html/content/ukiemea-sites")){var c=function(c,f){for(var e=!1,g=0;g<f.length;g++)if(-1<c.indexOf(f[g])){e=!0;break}return e},f=function(c,f){for(var e=!1,g=0;g<f.length;g++)if(-1<c.indexOf(f[g])){e=!0;break}return e};$.validator.register({selector:"form [data-validation\x3d'navigation-title']",validate:function(c){var f=c.val();c=c.attr("maxlength");var e=/[^a-zA-Z0-9 ]/;if(f){if(e.test(f))return"The field must not contain any special characters";
if(c&&f.length==c)return f=f.length-1,"The field must not contain more than "+f+" characters."}},show:function(c,f){touchDialog.addError(c,f)},clear:function(c){touchDialog.removeError(c)}});$.ajax({type:"GET",url:"/libs/granite/security/currentuser.json.rw.userprops.json?props\x3ddeclaredMemberOf",cache:!1,async:!1}).done(function(c,f,e){if(c=c.declaredMemberOf)for(f=0;f<c.length;f++)c[f].authorizableId&&userGroups.push(c[f].authorizableId)});if(pagePath.startsWith("/content/ukiemea-sites")){$.ajax({type:"POST",
url:"/bin/getTemplateBaseName",cache:!1,data:{pagePath:pagePath},success:function(c,f,e){templateName=jQuery.parseJSON(c).templatePath;templateName=templateName.substring(templateName.lastIndexOf("/")+1);h.resolve()},error:function(c){console.log(c)}});var h=new $.Deferred;h.done(function(){if(""!=templateName&&c(templateName,templatesCheck)&&!f(allowedTemplateGroups,userGroups)){var k=$(window).adaptTo("foundation-ui"),h=window.location.origin;k.alert("Warning","Permission denied","notice");setTimeout(function(){window.top.location.replace(h)},
1E3)}})}if(page.startsWith("/editor.html/content/ukiemea-sites")){h=new $.Deferred;var l=setInterval(function(){if(void 0!=$("#ContentFrame").contents().find('meta[name\x3d"template"]').attr("content")){var c=$("#ContentFrame").contents().find('meta[name\x3d"template"]').attr("content");clearInterval(l);h.resolve(c)}},100);h.done(function(k){if(void 0!=k&&c(k,templatesCheck)&&!f(allowedTemplateGroups,userGroups)){k=$(window).adaptTo("foundation-ui");var h=window.location.origin;k.alert("Warning",
"Permission denied","notice");setTimeout(function(){window.top.location.replace(h)},1E3)}})}}});
(function(c,f){f(c).on("foundation-contentloaded",function(c){setTimeout(function(){f("form [data-validation\x3d'checkState']").prop("checked")?(f(".stateName").show(),f(".stateName \x3e input").attr("aria-required","true")):(f(".stateName").hide(),f(".stateName \x3e input").removeAttr("aria-required"))},500)});f(c).on("change","form [data-validation\x3d'checkState']",function(c){f(this).prop("checked")?(f(".stateName").show(),f(".stateName \x3e input").attr("aria-required","true")):(f(".stateName").hide(),
f(".stateName \x3e input").removeAttr("aria-required"))})})(document,Granite.$);
(function(c,f){f(c).on("foundation-contentloaded",function(c){setTimeout(function(){f("form [data-validation\x3d'checkState']").prop("checked")?(f(".stateName").show(),f(".stateName \x3e input").attr("aria-required","true")):(f(".stateName").hide(),f(".stateName \x3e input").removeAttr("aria-required"))},500)});f(c).on("change","form [data-validation\x3d'checkState']",function(c){f(this).prop("checked")?(f(".stateName").show(),f(".stateName \x3e input").attr("aria-required","true")):(f(".stateName").hide(),
f(".stateName \x3e input").removeAttr("aria-required"))})})(document,Granite.$);$(document).on("foundation-contentloaded",function(c){$("form [data-validation\x3d'navigation-title']").updateErrorUI()});userGroups=[];allowedTemplateGroups=["administrators","cms-webops","regional-manager-latam"];var allowedEventTemplateGroups=["administrators","cms-webops","events"];templatesCheck="business-unit-config-template locale-config-template html-blank-template html-pages-deployment-template login-template event-template".split(" ");
pathArr=[];page=window.location.pathname+window.location.search;pathArr=~page.indexOf("createpagewizard")?page.split("/mnt/overlay/wcm/core/content/sites/createpagewizard.html"):page.split("/mnt/overlay/wcm/core/content/sites/properties.html?item\x3d");pagePath=decodeURIComponent(pathArr[1]);templateName="";
$(function(){if(pagePath.startsWith("/content/experian-sites")||page.startsWith("/editor.html/content/experian-sites")){var c=function(c,f){for(var e=!1,g=0;g<f.length;g++)if(-1<c.indexOf(f[g])){e=!0;break}return e},f=function(c,f){for(var e=!1,g=0;g<f.length;g++)if(-1<c.indexOf(f[g])){e=!0;break}return e};$.validator.register({selector:"form [data-validation\x3d'navigation-title']",validate:function(c){var f=c.val();c=c.attr("maxlength");var e=/[^a-zA-Z0-9 ]/;if(f){if(e.test(f))return"The field must not contain any special characters";
if(c&&f.length==c)return f=f.length-1,"The field must not contain more than "+f+" characters."}},show:function(c,f){touchDialog.addError(c,f)},clear:function(c){touchDialog.removeError(c)}});$.ajax({type:"GET",url:"/libs/granite/security/currentuser.json.rw.userprops.json?props\x3ddeclaredMemberOf",cache:!1,async:!1}).done(function(c,f,e){if(c=c.declaredMemberOf)for(f=0;f<c.length;f++)c[f].authorizableId&&userGroups.push(c[f].authorizableId)});if(pagePath.startsWith("/content/experian-sites")){$.ajax({type:"POST",
url:"/bin/getTemplateBaseName",cache:!1,data:{pagePath:pagePath},success:function(c,f,e){templateName=jQuery.parseJSON(c).templatePath;templateName=templateName.substring(templateName.lastIndexOf("/")+1);h.resolve()},error:function(c){console.log(c)}});var h=new $.Deferred;h.done(function(){if(""!=templateName&&c(templateName,templatesCheck)&&(!f(allowedTemplateGroups,userGroups)||!f(allowedEventTemplateGroups,userGroups))){var h=$(window).adaptTo("foundation-ui"),l=window.location.origin;h.alert("Warning",
"Permission denied","notice");setTimeout(function(){window.top.location.replace(l)},1E3)}})}if(page.startsWith("/editor.html/content/experian-sites")){h=new $.Deferred;var l=setInterval(function(){if(void 0!=$("#ContentFrame").contents().find('meta[name\x3d"template"]').attr("content")){var c=$("#ContentFrame").contents().find('meta[name\x3d"template"]').attr("content");clearInterval(l);h.resolve(c)}},100);h.done(function(h){if(void 0!=h&&c(h,templatesCheck)&&(!f(allowedTemplateGroups,userGroups)||
!f(allowedEventTemplateGroups,userGroups))){h=$(window).adaptTo("foundation-ui");var k=window.location.origin;h.alert("Warning","Permission denied","notice");setTimeout(function(){window.top.location.replace(k)},1E3)}})}}});